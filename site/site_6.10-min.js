if(!window.SITE){window.SITE={gtagInitiated:false,root:"/mapa"}}window.dataLayer=window.dataLayer||[];SITE.ga=function(){if(arguments[0]==="set"&&arguments[1]==="page_path"){SITE.root=arguments[2]}if(gtag&&(window.location.href.indexOf("diatonicmap.com.br")>=0||window.location.href.indexOf("androidplatform")>=0)&&SITE.getVersion("mainSITE","")!=="debug"&&SITE.getVersion("mainSITE","")!=="unknown"){if(SITE.debug){console.log("App is in Debug mode")}else{if(!SITE.gtagInitiated){gtag("js",new Date());gtag("config","UA-62839199-4");SITE.gtagInitiated=true}gtag(arguments[0],arguments[1],arguments[2])}}else{console.log("Funcao gtag não definida.")}};SITE.findGetParameter=function(c){var a=null,e=[];var b=window.location.search.substr(1).split("&");for(var d=0;d<b.length;d++){e=b[d].split("=");if(e[0]===c){a=decodeURIComponent(e[1])}}return a};SITE.getDate=function(){var b=new Date();var a=b.getDate();var c=b.getMonth()+1;var d=b.getFullYear();return d*10000+c*100+a};SITE.getVersion=function(a,b){var d=document.getElementById(a);if(!d){return"unknown"}var c=d.src.match(/\_[0-9]*\.[0-9]*[\.[0-9]*]*/g);return c?b+c[0].substr(1):"debug"};SITE.getLanguage=function(){var b=window.navigator.userLanguage||window.navigator.language;if(b.indexOf("-")>=0){b=b.replace("-","_");for(var a in SITE.properties.known_languages){if(a.toLowerCase()===b.toLocaleLowerCase()){return a}}}for(var a in SITE.properties.known_languages){if(a.substr(0,2)===b.substr(0,2)){return a}}return"en_US"};SITE.LoadProperties=function(){var b=false;try{SITE.properties=JSON.parse(FILEMANAGER.loadLocal("diatonic-map.site.properties"))}catch(c){waterbug.log("Could not load the properties.");waterbug.show("Could not save the properties");SITE.ga("event","html5storage",{event_category:"Error",event_label:"loadingLocal",non_interaction:true})}var a=SITE.getVersion("mainSITE","");if(!SITE.properties){SITE.ResetProperties()}else{if(a==="debug"){SITE.properties.options.showConsole=true}else{if(!SITE.properties.version||SITE.properties.version==="debug"||parseFloat(SITE.properties.version)<parseFloat(a)){SITE.properties.version=a;b=true}}}if(!SITE.properties.known_languages){SITE.properties.known_languages={de_DE:{file:"languages/de_DE.lang",image:"images/de_DE.png",name:"Deustch"},en_US:{file:"languages/en_US.lang",image:"images/en_US.png",name:"US English"},es_ES:{file:"languages/es_ES.lang",image:"images/es_ES.png",name:"Español"},fr_FR:{file:"languages/fr_FR.lang",image:"images/fr_FR.png",name:"Français"},it_IT:{file:"languages/it_IT.lang",image:"images/it_IT.png",name:"Italiano"},pt_BR:{file:"languages/pt_BR.lang",image:"images/pt_BR.png",name:"Português do Brasil"}};SITE.properties.options.language=SITE.getLanguage();SITE.properties.colors.highLight="#ff0000";SITE.properties.options.showWarnings=false;SITE.properties.options.showConsole=false;SITE.properties.options.pianoSound=false;SITE.properties.options.autoRefresh=false;SITE.properties.options.keyboardRight=false;SITE.properties.options.suppressTitles=false;b=true}if(!SITE.properties.studio.media){SITE.properties.studio.media={visible:false,top:"20px",left:"1200px",width:100,height:200};SITE.properties.partGen.media={visible:false,top:"20px",left:"1200px",width:100,height:200};b=true}if(!SITE.properties.partEdit){SITE.properties.partEdit={media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};b=true}SITE.properties.options.tabFormat=0;SITE.properties.options.lyrics=true;SITE.properties.options.fingering=true;SITE.properties.options.rowsNumbered=false;if(SITE.properties.options.tabFormat===undefined){b=true;SITE.properties.options.tabFormat=0}if(SITE.properties.options.tabShowOnlyNumbers===undefined){b=true;SITE.properties.options.tabShowOnlyNumbers=false}if(b){SITE.SaveProperties()}};SITE.SaveProperties=function(){try{FILEMANAGER.saveLocal("diatonic-map.site.properties",JSON.stringify(SITE.properties))}catch(a){waterbug.log("Could not save the properties");waterbug.show("Could not save the properties");SITE.ga("event","html5storage",{event_category:"Error",event_label:"savingLocal",non_interaction:true})}};SITE.ResetProperties=function(){SITE.properties={};SITE.properties.known_languages={de_DE:{file:"languages/de_DE.lang",image:"images/de_DE.png",name:"Deustch"},en_US:{file:"languages/en_US.lang",image:"images/en_US.png",name:"US English"},es_ES:{file:"languages/es_ES.lang",image:"images/es_ES.png",name:"Español"},fr_FR:{file:"languages/fr_FR.lang",image:"images/fr_FR.png",name:"Français"},it_IT:{file:"languages/it_IT.lang",image:"images/it_IT.png",name:"Italiano"},pt_BR:{file:"languages/pt_BR.lang",image:"images/pt_BR.png",name:"Português do Brasil"}};SITE.properties.version=SITE.getVersion("mainSITE","");SITE.properties.colors={useTransparency:true,highLight:"#ff0000",fill:"white",background:"none",close:"#ff3a3a",open:"#ffba3b"};SITE.properties.options={language:SITE.getLanguage(),showWarnings:false,showConsole:false,pianoSound:false,autoRefresh:false,keyboardRight:false,suppressTitles:false,tabFormat:0,tabShowOnlyNumbers:false};SITE.properties.mediaDiv={visible:true,top:"20px",left:"1200px",width:100,height:200};SITE.properties.tabGen={abcEditor:{floating:false,maximized:false,top:"70px",left:"25px",width:"940px",height:"560px"},tabEditor:{floating:false,maximized:false,top:"140px",left:"75px",width:"940px",height:"560px"}};SITE.properties.partEdit={media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};SITE.properties.partGen={showABCText:false,convertFromClub:false,convertToClub:false,media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};SITE.properties.studio={mode:"normal",timerOn:false,trebleOn:true,bassOn:true,media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};FILEMANAGER.saveLocal("ultimaTablaturaEditada","");FILEMANAGER.saveLocal("ultimaPartituraEditada","");SITE.SaveProperties()};if(!window.SITE){window.SITE={}}if(!window.SITE.lang){window.SITE.lang={}}SITE.Translator=function(a){a=a||{};if(!a.language){a.language="pt_BR"}this.language=null;this.loadLanguage(a.language,a.callback)};SITE.Translator.prototype.loadLanguage=function(d,e){var c=1;var b=this;FILEMANAGER.register("LANG");if(!SITE.properties||!SITE.properties.known_languages){SITE.ResetProperties()
}if(!SITE.properties.known_languages[d]){b.log("Unknown language: "+d+". Loading English...");d="en_US";SITE.properties.options.language=d;SITE.SaveProperties()}var a=SITE.properties.known_languages[d].file;$.getJSON(a,{format:"json"}).done(function(f){FILEMANAGER.deregister("LANG",true);b.language=f}).fail(function(g,h,f){FILEMANAGER.deregister("LANG",false);b.log("Failed to load language "+d+":\nLoading: "+g.responseText.substr(1,40)+"...\nError:\n "+h+", "+f+".")}).always(function(){c--;if(c===0){e&&e()}})};SITE.Translator.prototype.menuPopulate=function(e,d){var a,b;e.emptySubMenu(d);for(var f in SITE.properties.known_languages){var c='<img src="'+SITE.properties.known_languages[f].image+'" />&#160;'+SITE.properties.known_languages[f].name;a=e.addItemSubMenu(d,c+"|"+f);if(this.language&&this.language.id===f){b=a}}if(b){e.setSubMenuTitle(d,e.selectItem(d,b))}};SITE.Translator.prototype.getResource=function(b){if(!this.language){return null}var a=this.language.resources[b];(!a)&&this.log('Missing translation for "'+b+'" in "'+this.language.langName+'".');return a};SITE.Translator.prototype.translate=function(a){if(!this.language){return}a=a||document;var d=a.querySelectorAll("[data-translate]");var f=Array.prototype.slice.apply(d);for(var c=0;c<f.length;c++){var e=f[c];var b=this.language.resources[e.getAttribute("data-translate")];if(b){switch(e.nodeName){case"INPUT":if(e.type==="text"){e.title=b.tip;e.value=b.val}break;case"BUTTON":case"DIV":case"I":e.title=b;break;default:e.innerHTML=b}}else{this.log('Missing translatation for "'+e.getAttribute("data-translate")+'" in "'+this.language.langName+'".')}}};SITE.Translator.prototype.sortLanguages=function(){this.languages.sort(function(d,c){return parseInt(d.menuOrder)-parseInt(c.menuOrder)})};SITE.Translator.prototype.log=function(a){if(a.substr(27,7)==="CORONA_"){return}if(a.substr(27,7)==="HOHNER_"){return}if(a.substr(27,6)==="GAITA_"){return}if(a.substr(27,11)==="CONCERTINA_"){return}waterbug.log(a);(SITE.properties.options.showConsole)&&waterbug.show()};if(!window.SITE){window.SITE={}}SITE.Media=function(b,d,a){var c=this;this.Div=b||null;this.proportion=0.55666667;this.youTubeURL=false;this.properties=a;if(d){this.showMediaButton=document.getElementById(d);this.showMediaButton.addEventListener("click",function(){c.callback("OPEN")},false)}this.mediaWindow=new DRAGGABLE.ui.Window(this.Div,null,{title:"showMedia",translator:SITE.translator,alternativeResize:true,top:this.properties.top,left:this.properties.left},{listener:this,method:"callback"})};SITE.Media.prototype.callback=function(b){switch(b){case"RESIZE":this.resize();var a=this.mediaWindow.dataDiv;this.properties.width=a.clientWidth;this.properties.height=a.clientHeight;SITE.SaveProperties();break;case"MOVE":var a=this.mediaWindow.topDiv;this.properties.top=a.style.top;this.properties.left=a.style.left;SITE.SaveProperties();break;case"OPEN":this.properties.visible=true;SITE.ga("event","page_view",{page_title:this.tabTitle,page_path:SITE.root+"/media"});SITE.SaveProperties();this.mediaWindow.setVisible(true);this.resize();this.posiciona();if(this.showMediaButton){this.showMediaButton.style.display="none"}break;case"CLOSE":this.pause();this.properties.visible=false;SITE.SaveProperties();if(this.showMediaButton){this.mediaWindow.setVisible(false);this.showMediaButton.style.display="block"}break}return false};SITE.Media.prototype.pause=function(){if(!this.mediaWindow||!this.currTab){return}var a=this.currTab.div.getElementsByTagName("iframe")[0];if(!a){return}a.contentWindow.postMessage('{"event":"command","func":"pauseVideo", "args":""}',"*")};SITE.Media.prototype.show=function(f){var h=this;var c,i;if(f.abc&&f.abc.metaText.url){c=f.abc.metaText.url}if(c){var d=300;var g=17;if(c!==this.url){this.url=c;this.tabTitle=f.abc.metaText.title;if(this.properties.width>100){d=this.properties.width;g=Math.round((d-100)/11)}else{if(window.innerWidth>=1200){d=600;g=46}else{if(window.innerWidth>=950){d=400;g=27}}}var o=d*this.proportion;this.mediaWindow.dataDiv.style.width=d+"px";this.mediaWindow.topDiv.style.width=d+"px";this.mediaWindow.dataDiv.style.height=o+"px";this.mediaWindow.topDiv.style.height=o+"px";if(!this.tabDiv){this.tabDiv=document.createElement("div");this.tabDiv.className="media-tabs";this.mediaWindow.topDiv.appendChild(this.tabDiv)}else{this.tabDiv.innerHTML="";this.mediaWindow.dataDiv.innerHTML=""}var m=c.split("\n");this.tabs={};this.currTab=null;for(var a=0;a<m.length&&a<10;a++){var p=(this.mediaWindow.id*10+a);this.youTubeURL=(m[a].match(/www.youtube-nocookie.com/g)!==null);this.isPDF=(m[a].match(/.*pdf/)!==null);var l=m[a].match(/\&.*\;/g);var n=m[a];var k="";if(l){n=m[a].replace(l[0],"");k=l[0].substring(3,l[0].length-1);if(k.length>g){k=k.substring(0,g)+"..."}}var b=document.createElement("div");b.className="media-content";this.mediaWindow.dataDiv.appendChild(b);if(this.youTubeURL){i='<iframe id="e'+p+'" src="'+n+'?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allowfullscreen="allowfullscreen" ></iframe>'}else{i='<embed id="e'+p+'" src="'+n+'" "></embed>'}b.innerHTML=i;this.embed=document.getElementById("e"+p);this.embed.style.width="100%";this.embed.style.height=(this.youTubeURL?"100%":(this.isPDF?"calc(100% - 4px)":"auto"));this.tabs["w"+p]={div:b,tit:k,u2be:this.youTubeURL};if(m.length>1){var e=document.createElement("input");e.id="w"+p;e.type="radio";e.name="mediaControl"+this.mediaWindow.id;e.className="tab-selector-"+a;this.tabDiv.appendChild(e);var e=document.createElement("label");e.htmlFor="w"+p;e.className="media-tab-label-"+a;e.innerHTML="#"+(a+1);this.tabDiv.appendChild(e)}}this.showTab=function(s){this.pause();for(var q in this.tabs){this.tabs[q].div.className="media-content";if(!s){s=q;var r=document.getElementById(s);if(r){r.checked=true}}}this.tabs[s].div.className="media-visible";this.currTab=this.tabs[s];this.mediaWindow.dataDiv.style.overflow=this.currTab.u2be?"hidden":"auto";this.mediaWindow.setSubTitle(this.currTab.tit?"- "+this.currTab.tit:"");this.resize()};if(m.length>1){var j=document.getElementsByName("mediaControl"+this.mediaWindow.id);for(var a=0;a<j.length;a++){j[a].addEventListener("change",function(){h.showTab(this.id)})}}h.showTab()}if(this.showMediaButton){this.showMediaButton.style.display=(this.properties.visible?"none":"inline")}this.mediaWindow.setVisible(this.properties.visible);if(this.properties.visible){this.resize();this.posiciona()}else{this.pause()}}else{this.pause();this.mediaWindow.setVisible(false);if(this.showMediaButton){this.showMediaButton.style.display="none"}}};SITE.Media.prototype.posiciona=function(){if(!this.mediaWindow.topDiv||this.mediaWindow.topDiv.style.display==="none"){return}var b=document.body.clientWidth||document.documentElement.clientWidth||window.innerWidth;b=Math.min(b,this.mediaWindow.parent.clientWidth);var d=this.mediaWindow.topDiv;var a=parseInt(d.style.left.replace("px",""));var c=a;if(a+d.offsetWidth>b){a=(b-(d.offsetWidth+30))}if(a<0){a=10}if(a!==c){d.style.left=a+"px";
this.properties.left=a+"px";SITE.SaveProperties()}};SITE.Media.prototype.resize=function(){var b=this.mediaWindow.menuDiv.clientHeight+(this.mediaWindow.bottomBar?this.mediaWindow.bottomBar.clientHeight:0);this.mediaWindow.dataDiv.style.width=this.mediaWindow.topDiv.clientWidth+"px";this.mediaWindow.dataDiv.style.height=(this.mediaWindow.topDiv.clientHeight-b)+"px";if(this.currTab.u2be){var a=(this.mediaWindow.topDiv.clientWidth*this.proportion);this.mediaWindow.dataDiv.style.height=a+"px";this.mediaWindow.topDiv.style.height=(a+b)+"px"}};if(!window.SITE){window.SITE={}}SITE.Mapa=function(f,a,d){document.body.style.overflow="hidden";var c=this;this.ypos=0;this.lastStaffGroup=-1;this.parserparams={};ABCXJS.write.color.useTransparency=SITE.properties.colors.useTransparency;ABCXJS.write.color.highLight=SITE.properties.colors.highLight;DIATONIC.map.color.fill=SITE.properties.colors.fill;DIATONIC.map.color.background=SITE.properties.colors.background;DIATONIC.map.color.close=SITE.properties.colors.close;DIATONIC.map.color.open=SITE.properties.colors.open;this.loadByIdx=this.songId=f.songId;this.keyboardDiv=f.keyboardDiv;this.fileLoadMap=document.getElementById("fileLoadMap");this.fileLoadRepertoire=document.getElementById("fileLoadRepertoire");this.settingsMenu=document.getElementById(f.settingsMenu);this.mapDiv=document.getElementById(f.mapDiv);this.accordion=new window.ABCXJS.tablature.Accordion(f.accordion_options,SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);this.abcParser=new ABCXJS.parse.Parse(null,this.accordion);this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);this.menu=new DRAGGABLE.ui.DropdownMenu(f.mapMenuDiv,{listener:c,method:"menuCallback",translate:true},[{title:"Acordeões",ddmId:"menuGaitas",itens:[]},{title:"Repertório",ddmId:"menuRepertorio",itens:["Índice|IDXREPERTOIRE","Restaurar o original|RESTOREREPERTOIRE","Carregar do drive local|LOADREPERTOIRE","Exportar para drive local|EXPORTREPERTOIRE","---","Extrair tablatura|PART2TAB",'Tablatura&nbsp;&nbsp;<i class="ico-open-right"></i> Partitura|TAB2PART','ABC&nbsp;&nbsp;<i class="ico-open-right"></i> Partitura|ABC2PART']},{title:"Informações",ddmId:"menuInformacoes",itens:["Mapas para acordeões|MAPS","Tablaturas para acordeões|TABS","Tablaturas para gaita transportada|TABSTRANSPORTADA","Símbolos de Repetição|JUMPS","Estúdio ABCX|ESTUDIO","Formato ABCX|ABCX","Sobre|ABOUT"]}]);this.accordionSelector=new ABCXJS.edit.AccordionSelector("menuGaitas",this.menu,{listener:this,method:"menuCallback"},["---","Salvar mapa corrente|SAVEMAP","Carregar mapa do disco local|LOADMAP"]);var e=document.getElementsByName(a.tabRadioGroup);for(var b=0;b<e.length;b++){e[b].addEventListener("change",function(){c.showTab(this.id)})}this.tuneContainerDiv=document.getElementById(a.tuneContainerDiv);this.renderedTune={text:undefined,abc:undefined,title:undefined,tab:"songs",div:document.getElementById(a.songSelectorParms.tabDiv),selector:document.getElementById(a.songSelectorParms.menuDiv)};this.renderedChord={text:undefined,abc:undefined,title:undefined,tab:"chords",div:document.getElementById(a.chordSelectorParms.tabDiv),selector:document.getElementById(a.chordSelectorParms.menuDiv)};this.renderedPractice={text:undefined,abc:undefined,title:undefined,tab:"practices",div:document.getElementById(a.practiceSelectorParms.tabDiv),selector:document.getElementById(a.practiceSelectorParms.menuDiv)};this.playButton=document.getElementById(d.playBtn);this.stopButton=document.getElementById(d.stopBtn);this.currentPlayTimeLabel=document.getElementById(d.currentPlayTimeLabel);this.media=new SITE.Media(this.mapDiv,f.btShowMedia,SITE.properties.mediaDiv);this.buttonChangeNotation=document.getElementById(f.btChangeNotation);this.printButton=document.getElementById(f.printBtn);this.toolsButton=document.getElementById(f.toolsBtn);this.gaitaNamePlaceHolder=document.getElementById(f.accordionNamePlaceHolder);this.gaitaImagePlaceHolder=document.getElementById(f.accordionImagePlaceHolder);this.printButton.addEventListener("click",function(g){c.printPartiture(this,g)},false);this.toolsButton.addEventListener("click",function(g){c.openEstudio(this,g)},false);this.fileLoadMap.addEventListener("change",function(g){c.loadMap(g)},false);this.fileLoadRepertoire.addEventListener("change",function(g){c.carregaRepertorioLocal(g)},false);this.settingsMenu.addEventListener("click",function(g){g.preventDefault();this.blur();c.showSettings()},false);this.buttonChangeNotation.addEventListener("click",function(g){g.preventDefault();this.blur();c.accordion.changeNotation()},false);this.playerCallBackOnScroll=function(g){c.setScrolling(g)};this.playerCallBackOnPlay=function(g){var h=g.getTime().cTime;if(c.gotoMeasureButton){c.gotoMeasureButton.value=g.currentMeasure}if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML=h}};this.playerCallBackOnEnd=function(h){var g=c.getActiveTab();c.playButton.title=SITE.translator.getResource("playBtn");c.playButton.innerHTML='<i class="ico-play"></i>';g.abc.midi.printer.clearSelection();c.accordion.clearKeyboard(true)};this.playButton.addEventListener("click",function(g){g.preventDefault();window.setTimeout(function(){c.startPlay("normal")},0)},false);this.stopButton.addEventListener("click",function(g){g.preventDefault();if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML="00:00"}c.midiPlayer.stopPlay()},false);this.midiPlayer.defineCallbackOnPlay(c.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(c.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(c.playerCallBackOnScroll);this.defineInstrument(true);this.showAccordionName();this.showAccordionImage();this.accordionSelector.populate(false);this.accordion.printKeyboard(this.keyboardDiv);this.loadOriginalRepertoire();SITE.translator.translate();this.resize()};SITE.Mapa.prototype.setup=function(a){if(this.accordion.accordionIsCurrent(a.accordionId)){if(a.songId){this.showTab("songsTab");this.showABC("songs#"+a.songId)}return}if(a.songId){this.songId=a.songId}this.midiPlayer.reset();this.accordion.loadById(a.accordionId);this.showAccordionName();this.showAccordionImage();this.accordionSelector.populate(false);SITE.translator.translate(this.menu.container);this.accordion.printKeyboard(this.keyboardDiv);this.loadOriginalRepertoire();this.resize();SITE.ga("event","page_view",{page_title:this.getActiveTab().title,page_path:SITE.root+"/"+this.accordion.getId()});if(!this.accordion.loaded.localResource){FILEMANAGER.saveLocal("property.accordion",this.accordion.getId())}};SITE.Mapa.prototype.resize=function(){var d=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var b=document.getElementById("section1");var a=document.getElementById("section2");var c=(d-b.clientHeight-(a.clientHeight-this.tuneContainerDiv.clientHeight)-78-14-2);this.tuneContainerDiv.style.height=Math.max(c,200)+"px";this.renderedTune.div.style.height=(Math.max(c,200)-5)+"px";(this.renderedTune.ps)&&this.renderedTune.ps.update();
this.renderedChord.div.style.height=(Math.max(c,200)-5)+"px";(this.renderedChord.ps)&&this.renderedChord.ps.update();this.renderedPractice.div.style.height=(Math.max(c,200)-5)+"px";(this.renderedPractice.ps)&&this.renderedPractice.ps.update();this.media.posiciona()};SITE.Mapa.prototype.menuCallback=function(a){switch(a){case"LOADMAP":this.fileLoadMap.click();break;case"SAVEMAP":this.save();break;case"RESTOREREPERTOIRE":this.restauraRepertorio();break;case"LOADREPERTOIRE":this.fileLoadRepertoire.click();break;case"EXPORTREPERTOIRE":this.exportaRepertorio();break;case"PART2TAB":this.openPart2Tab();break;case"TAB2PART":this.openTab2Part();break;case"ABC2PART":this.openABC2Part();break;case"IDXREPERTOIRE":if(!this.repertoireWin){this.repertoireWin=new SITE.Repertorio()}this.repertoireWin.geraIndex(this);break;case"JUMPS":this.showHelp("HelpTitle","JUMPS","/html/sinaisRepeticao.pt_BR.html",{width:"1024",height:"600"});break;case"ABCX":this.showHelp("HelpTitle","ABCX","/html/formatoABCX.pt_BR.html",{width:"1024",height:"600"});break;case"ESTUDIO":this.showHelp("HelpTitle","ESTUDIO","/html/estudioABCX.pt_BR.html",{width:"1024",height:"600"});break;case"TABS":this.showHelp("HelpTitle","TABS","/html/tablatura.pt_BR.html",{width:"1024",height:"600"});break;case"TABSTRANSPORTADA":this.showHelp("HelpTitle","TABSTRANSPORTADA","/html/tablaturaTransportada.pt_BR.html",{width:"1024",height:"600"});break;case"MAPS":this.showHelp("HelpTitle","MAPS","/html/mapas.pt_BR.html",{width:"1024",height:"600"});break;case"TUTORIAL":this.showHelp("HelpTitle","TUTORIAL","/html/tutoriais.pt_BR.html",{width:"1024",height:"600",print:false});break;case"ABOUT":this.showHelp("AboutTitle","","/html/about.pt_BR.html",{width:"800",print:false});break;case"GAITA_MINUANO_GC":case"CONCERTINA_PORTUGUESA":case"GAITA_HOHNER_CORONA_GCF":case"GAITA_HOHNER_CORONA_ADG":case"GAITA_HOHNER_CLUB_IIIM_BR":case"GAITA_MINUANO_BC_TRANSPORTADA":default:this.setup({accordionId:a})}};SITE.Mapa.prototype.loadOriginalRepertoire=function(){if(this.accordion.loaded.localResource){return}var b=this;var a=this.startLoader("LoadRepertoire",this.tuneContainerDiv);a.start(function(){b.doLoadOriginalRepertoire(a)},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")};SITE.Mapa.prototype.doLoadOriginalRepertoire=function(a){this.renderedChord.title=FILEMANAGER.loadLocal("property."+this.accordion.getId()+".chords.title")||this.accordion.loaded.getFirstChord();this.loadABCList(this.renderedChord.tab);this.renderedPractice.title=FILEMANAGER.loadLocal("property."+this.accordion.getId()+".practices.title")||this.accordion.loaded.getFirstPractice();this.loadABCList(this.renderedPractice.tab);var b;if(this.songId){b=this.accordion.loaded.songs.ids[this.songId];this.accordion.loaded.songs.details[b].hidden=false;delete this.songId}this.renderedTune.title=b||FILEMANAGER.loadLocal("property."+this.accordion.getId()+".songs.title")||this.accordion.loaded.getFirstSong();this.loadABCList(this.renderedTune.tab);this.showTab("songsTab");a.stop();if(this.loadByIdx){SITE.ga("event","page_view",{page_title:this.getActiveTab().title,page_path:SITE.root+"/index/"+this.accordion.getId()});if(!this.repertoireWin){this.repertoireWin=new SITE.Repertorio()}this.repertoireWin.geraIndex(this);delete this.loadByIdx}};SITE.Mapa.prototype.printPartiture=function(b,c){var a=this.getActiveTab();c.preventDefault();b.blur();if(a.div.innerHTML){SITE.ga("event","print",{event_category:"Mapa",event_label:a.title});this.printPreview(a.div.innerHTML,["#topBar","#mapaDiv"],a.abc.formatting.landscape)}};SITE.Mapa.prototype.openMapa=function(b){var a=this.getActiveTab();this.menu.enableSubMenu("menuGaitas");this.menu.enableSubMenu("menuRepertorio");this.setVisible(true);this.accordion.printKeyboard(this.keyboardDiv);this.resize();if(b!==undefined){if(b===a.text){this.renderTAB(a);return}else{a.text=b;this.accordion.loaded.setSong(a.title,a.text);this.renderTAB(a)}}};SITE.Mapa.prototype.closeMapa=function(){this.media.pause();this.midiPlayer.stopPlay();this.setVisible(false);this.menu.disableSubMenu("menuGaitas");this.menu.disableSubMenu("menuRepertorio")};SITE.Mapa.prototype.openPart2Tab=function(){if(!this.part2tab){this.part2tab=new SITE.TabGen(this,{tabGenDiv:"tabGenDiv",controlDiv:"p2tControlDiv-raw",saveBtn:"p2tSaveBtn",updateBtn:"p2tForceRefresh",openBtn:"p2tOpenInGenerator"})}this.part2tab.setup(this.activeTab.text)};SITE.Mapa.prototype.openABC2Part=function(){if(!this.ABC2part){this.ABC2part=new SITE.PartEdit(this,{partEditDiv:"partEditDiv",controlDiv:"a2pControlDiv-raw",showEditorBtn:"a2pShowEditorBtn",showMapBtn:"a2pShowMapBtn",updateBtn:"a2pForceRefresh",loadBtn:"a2pLoadBtn",saveBtn:"a2pSaveBtn",printBtn:"a2pPrintBtn",playBtn:"a2pPlayBtn",stopBtn:"a2pStopBtn",btShowMedia:"a2pbuttonShowMedia",currentPlayTimeLabel:"a2pCurrentPlayTimeLabel",generate_tablature:"accordion",accordion_options:{id:this.accordion.getId(),accordionMaps:DIATONIC.map.accordionMaps,translator:SITE.translator,render_keyboard_opts:{transpose:false,mirror:false,scale:0.8,draggable:true,show:false,label:false}}})}this.ABC2part.setup({accordionId:this.accordion.getId()})};SITE.Mapa.prototype.openTab2Part=function(){if(!this.tab2part){this.tab2part=new SITE.PartGen(this,{partGenDiv:"partGenDiv",controlDiv:"t2pControlDiv-raw",showMapBtn:"t2pShowMapBtn",showEditorBtn:"t2pShowEditorBtn",updateBtn:"t2pForceRefresh",loadBtn:"t2pLoadBtn",saveBtn:"t2pSaveBtn",editPartBtn:"t2pOpenInPartEditBtn",savePartBtn:"t2pSavePartBtn",gotoMeasureBtn:"t2pGotoMeasureBtn",playBtn:"t2pPlayBtn",stopBtn:"t2pStopBtn",currentPlayTimeLabel:"t2pCurrentPlayTimeLabel",btShowMedia:"t2pbuttonShowMedia",ckShowABC:"ckShowABC",ckConvertToClub:"ckConvertToClub",ckConvertFromClub:"ckConvertFromClub",generate_tablature:"accordion",accordion_options:{id:this.accordion.getId(),accordionMaps:DIATONIC.map.accordionMaps,translator:SITE.translator,render_keyboard_opts:{transpose:false,mirror:false,scale:0.8,draggable:true,show:false,label:false}}})}this.tab2part.setup({accordionId:this.accordion.getId()})};SITE.Mapa.prototype.openEstudio=function(c,e){var b=this;var d=b.getActiveTab();if(e){e.preventDefault();c.blur()}if(!this.studio){this.studio=new SITE.Estudio(this,{studioDiv:"studioDiv",studioControlDiv:"studioControlDiv",studioCanvasDiv:"studioCanvasDiv",generate_tablature:"accordion",showMapBtn:"showMapBtn",showEditorBtn:"showEditorBtn",showTextBtn:"showTextBtn",printBtn:"printBtn",saveBtn:"saveBtn",forceRefresh:"forceRefresh",btShowMedia:"buttonShowMedia2",accordion_options:{id:this.accordion.getId(),accordionMaps:DIATONIC.map.accordionMaps,translator:SITE.translator,render_keyboard_opts:{transpose:false,mirror:false,scale:0.8,draggable:true,show:false,label:false}},onchange:function(f){f.onChange()}},{modeBtn:"modeBtn",lyricsBtn:"lyricsBtn",fingeringBtn:"fingeringBtn",tabformatBtn:"tabformatBtn",timerBtn:"timerBtn",playBtn:"playBtn2",stopBtn:"stopBtn2",clearBtn:"clearBtn",gotoMeasureBtn:"gotoMeasureBtn",untilMeasureBtn:"untilMeasureBtn",stepBtn:"stepBtn",repeatBtn:"repeatBtn",stepMeasureBtn:"stepMeasureBtn",tempoSld:"tempoSld",GClefBtn:"GClefBtn",FClefBtn:"FClefBtn",currentPlayTimeLabel:"currentPlayTimeLabel2"})
}if(d.text){SITE.ga("event","page_view",{page_title:d.title,page_path:SITE.root+"/studioABCX/"+this.accordion.getId()});var a=this.startLoader("OpenEstudio",this.tuneContainerDiv);a.start(function(){b.studio.setup(d,b.accordion.getId());a.stop()},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")}};SITE.Mapa.prototype.startPlay=function(b,c){var a=this.getActiveTab();this.ypos=this.tuneContainerDiv.scrollTop;this.lastStaffGroup=-1;if(this.midiPlayer.playing){if(b==="normal"){this.playButton.title=SITE.translator.getResource("playBtn");this.playButton.innerHTML='<i class="ico-play"></i>';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}}else{this.accordion.clearKeyboard();if(b==="normal"){if(this.midiPlayer.startPlay(a.abc.midi)){SITE.ga("event","play",{event_category:"Mapa",event_label:a.title});this.playButton.title=SITE.translator.getResource("pause");this.playButton.innerHTML='<i class="ico-pause"></i>'}}else{if(this.midiPlayer.startDidacticPlay(a.abc.midi,b,c)){SITE.ga("event","didactic-play",{event_category:"Mapa",event_label:a.title})}}}};SITE.Mapa.prototype.setScrolling=function(c){if(!this.activeTab||c.currAbsElem.staffGroup===this.lastStaffGroup){return}this.lastStaffGroup=c.currAbsElem.staffGroup;var e=c.printer.staffgroups[0].top;var b=this.activeTab.div.clientHeight-e;var d=c.printer.staffgroups[c.currAbsElem.staffGroup].top-12;var a=d+c.printer.staffgroups[c.currAbsElem.staffGroup].height;if(a>b+this.ypos||this.ypos>d-e){this.ypos=d;this.activeTab.div.scrollTop=this.ypos}};SITE.Mapa.prototype.exportaRepertorio=function(){if(FILEMANAGER.requiredFeaturesAvailable()){var a=this.accordion.loaded;var b=a.getId().toLowerCase()+".repertorio.abcx";var c="";for(var d in a.songs.items){c+=a.songs.items[d]+"\n\n"}FILEMANAGER.download(b,c)}else{alert(SITE.translator.getResource("err_saving"))}};SITE.Mapa.prototype.save=function(){var a=this.accordion.loaded;var b='{\n   "id":'+JSON.stringify(a.id)+'\n  ,"menuOrder":'+JSON.stringify(a.menuOrder+100)+'\n  ,"model":'+JSON.stringify(a.model)+'\n  ,"tuning":'+JSON.stringify(a.tuning)+'\n  ,"buttons":'+JSON.stringify(a.buttons)+'\n  ,"pedal":'+JSON.stringify(a.keyboard.pedalInfo)+'\n  ,"keyboard":\n  {\n     "layout":'+JSON.stringify(a.keyboard.layout)+'\n     ,"keys":\n     {\n        "close":'+JSON.stringify(a.keyboard.keys.close)+'\n       ,"open":'+JSON.stringify(a.keyboard.keys.open)+'\n     }\n     ,"basses":\n     {\n        "close":'+JSON.stringify(a.keyboard.basses.close)+'\n       ,"open":'+JSON.stringify(a.keyboard.basses.open)+"\n     }\n  }\n}\n";FILEMANAGER.download(a.getId().toLowerCase()+".accordion",b)};SITE.Mapa.prototype.loadMap=function(a){var b=this;a.preventDefault();FILEMANAGER.loadLocalFiles(a,function(){var c=b.startLoader("LoadRepertoire",b.tuneContainerDiv);c.start(function(){b.doLoadMap(FILEMANAGER.files,c)},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>");a.target.value=""})};SITE.Mapa.prototype.doLoadMap=function(b,o){var c,m;var g="",k="",n="";for(var l=0;l<b.length;l++){if(b[l].type==="image"){m=b[l].content}else{switch(b[l].extension.toLowerCase()){case"accordion":c=JSON.parse(b[l].content);break;case"abcx":case"tunes":g+=b[l].content;break;case"chords":k+=b[l].content;break;case"practices":n+=b[l].content;break}}}if(c===undefined){o.stop();console.log("O arquivo principal .accordion não foi encontrado!");return}c.image=m||"images/accordion.default.gif";if(!this.accordion.accordionExists(c.id)){DIATONIC.map.accordionMaps.push(new DIATONIC.map.AccordionMap(c,true));DIATONIC.map.sortAccordions()}this.setup({accordionId:c.id});var e=this.accordion.loaded;if(k){var j={items:{},ids:{},details:{},sortedIndex:[]};var a=new ABCXJS.TuneBook(k);for(var p=0;p<a.tunes.length;p++){var i=a.tunes[p];var d=i.id;var h=false;if(d.toLowerCase().charAt(0)==="h"){d=d.substr(1);h=true}j.ids[d]=i.title;j.items[i.title]=i.abc;j.details[i.title]={composer:i.composer,id:d,hidden:h};j.sortedIndex.push(i.title)}e.chords=j;e.chords.sortedIndex.sort();this.renderedChord.title=e.getFirstChord();this.loadABCList(this.renderedChord.tab)}if(n){var j={items:{},ids:{},details:{},sortedIndex:[]};var a=new ABCXJS.TuneBook(n);for(var p=0;p<a.tunes.length;p++){var i=a.tunes[p];var d=i.id;var h=false;if(d.toLowerCase().charAt(0)==="h"){d=d.substr(1);h=true}j.ids[d]=i.title;j.items[i.title]=i.abc;j.details[i.title]={composer:i.composer,id:d,hidden:h};j.sortedIndex.push(i.title)}e.practices=j;e.practices.sortedIndex.sort();this.renderedPractice.title=e.getFirstPractice();this.loadABCList(this.renderedPractice.tab)}if(g){var j={items:{},ids:{},details:{},sortedIndex:[]};var a=new ABCXJS.TuneBook(g);for(var p=0;p<a.tunes.length;p++){var i=a.tunes[p];var d=i.id;var h=false;if(d.toLowerCase().charAt(0)==="h"){d=d.substr(1);h=true}j.ids[d]=i.title;j.items[i.title]=i.abc;j.details[i.title]={composer:i.composer,id:d,hidden:h};j.sortedIndex.push(i.title)}e.songs=j;e.songs.sortedIndex.sort();this.renderedTune.title=e.getFirstSong();this.loadABCList(this.renderedTune.tab)}this.showTab("songsTab");o.stop()};SITE.Mapa.prototype.restauraRepertorio=function(){var c=this;var b=c.accordion.loaded;if(b.localResource){return}var a=this.startLoader("ReloadRepertoire",c.tuneContainerDiv);a.start(function(){b.songs=b.loadABCX(b.songPathList,function(){c.renderedTune.title=b.getFirstSong();c.loadABCList(c.renderedTune.tab);c.showTab("songsTab");a.stop()})},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")};SITE.Mapa.prototype.carregaRepertorioLocal=function(a){var b=this;FILEMANAGER.loadLocalFiles(a,function(){b.doCarregaRepertorioLocal(FILEMANAGER.files);a.target.value=""})};SITE.Mapa.prototype.doCarregaRepertorioLocal=function(d){var g=false;var a=this.accordion.loaded;for(var c=0;c<d.length;c++){var f=new ABCXJS.TuneBook(d[c].content);for(var b=0;b<f.tunes.length;b++){if(!a.songs.items[f.tunes[b].title]){a.songs.sortedIndex.push(f.tunes[b].title)}var h=f.tunes[b].id;var e=false;if(h.toLowerCase().charAt(0)==="h"){h=h.substr(1);e=false}a.songs.items[f.tunes[b].title]=f.tunes[b].abc;a.songs.details[f.tunes[b].title]={composer:f.tunes[b].composer,id:h,hidden:e};a.songs.ids[h]=f.tunes[b].title;if(!g){this.renderedTune.title=f.tunes[b].title;g=true}SITE.ga("event","loadSong",{event_category:"Mapa",event_label:f.tunes[b].title})}}a.songs.sortedIndex.sort();this.loadABCList(this.renderedTune.tab);this.showTab("songsTab")};SITE.Mapa.prototype.showTab=function(b){var a=this.getActiveTab();if(a){a.selector.style.display="none";this.silencia(true)}a=this.setActiveTab(b);a.selector.style.display="block";this.media.show(a)};SITE.Mapa.prototype.showABC=function(g){var f,h,d=this;var e=d.getActiveTab();var c=g.split("#");if(g.indexOf("#")>=0&&parseInt(c[1])>0){f=c[0];h=this.accordion.loaded[f].ids[c[1]]}else{waterbug.logError("ABCX not found!");waterbug.show();return}if(e.title!==h&&e.menu.selectItem(e.ddmId,g)){e.title=h;e.text=this.accordion.loaded.getAbcText(e.tab,e.title);
var i=h.replace(/\(.*\)/g,"").trim();e.menu.setSubMenuTitle(e.ddmId,(i.length>43?i.substr(0,40)+"...":i));if(!this.accordion.loaded.localResource){FILEMANAGER.saveLocal("property."+this.accordion.getId()+"."+f+".title",e.title)}var b=this.startLoader("TABLoader"+f,this.tuneContainerDiv);b.start(function(){d.midiPlayer.stopPlay();d.renderTAB(e);SITE.ga("event","page_view",{page_title:e.title,page_path:SITE.root+"/"+d.accordion.getId()});d.media.show(e);d.tuneContainerDiv.scrollTop=0;b.stop()},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")}else{console.log("Song title not found!")}};SITE.Mapa.prototype.loadABCList=function(g){var b,f;switch(g){case"songs":b=this.renderedTune;b.ddmId="songsMenu";f=this.accordion.loaded.songs;break;case"practices":b=this.renderedPractice;b.ddmId="practicesMenu";f=this.accordion.loaded.practices;break;case"chords":b=this.renderedChord;b.ddmId="chordsMenu";f=this.accordion.loaded.chords;break}b.abc=b.text=undefined;b.div.innerHTML="";b.menu=new DRAGGABLE.ui.DropdownMenu(b.selector,{listener:this,method:"showABC",translate:false},[{title:"...",ddmId:b.ddmId,itens:[]}]);var e=false;for(var d=0;d<f.sortedIndex.length;d++){var h=f.sortedIndex[d];var a=h.replace(/\(.*\)/g,"").trim();var j=0;if(!f.details[h]||isNaN(parseInt(f.details[h].id))){waterbug.logError('Missing or incorrect ID (X:nnn) for "'+h+'"');waterbug.show()}else{j=f.details[h].id}if(f.details[h].hidden){continue}var c=b.menu.addItemSubMenu(b.ddmId,a+"|"+g+"#"+j);if(h===b.title){e=true;b.menu.setSubMenuTitle(b.ddmId,a);b.menu.selectItem(b.ddmId,c);b.text=this.accordion.loaded.getAbcText(g,h)}}if(!e&&f.sortedIndex.length>0){var h=f.sortedIndex[0];var a=h.replace(/\(.*\)/g,"").trim();b.menu.setSubMenuTitle(b.ddmId,a);b.menu.selectItem(b.ddmId,g+"#"+f.details[h].id);b.text=this.accordion.loaded.getAbcText(g,h)}this.setActiveTab(g+"Tab");this.renderTAB(b)};SITE.Mapa.prototype.renderTAB=function(a){if(a.title===undefined||a.text===undefined){a.text=undefined;a.title=undefined;return}this.parserparams.hideLyrices=!SITE.properties.options.lyrics;this.parserparams.hideFingering=!SITE.properties.options.fingering;this.parserparams.ilheirasNumeradas=SITE.properties.options.rowsNumbered;this.abcParser.parse(a.text,this.parserparams);a.abc=this.abcParser.getTune();a.text=this.abcParser.getStrTune();if(this.midiParser){this.midiParser.parse(a.abc,this.accordion.loadedKeyboard)}var b=new SVG.Printer(a.div);a.printer=new ABCXJS.write.Printer(b,this.printerparams,this.accordion.loadedKeyboard);a.printer.printABC(a.abc);a.printer.addSelectListener(this);this.accordion.clearKeyboard(true);a.div.scrollTop=0;if(a.ps){a.ps.update()}else{a.ps=new PerfectScrollbar(a.div,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500})}};SITE.Mapa.prototype.setActiveTab=function(a){document.getElementById(a).checked=true;if(this.activeTab){this.activeTab.selector.style.display="none"}switch(a){case"songsTab":this.activeTab=this.renderedTune;break;case"practicesTab":this.activeTab=this.renderedPractice;break;case"chordsTab":this.activeTab=this.renderedChord;break}return this.activeTab};SITE.Mapa.prototype.getActiveTab=function(){return this.activeTab};SITE.Mapa.prototype.setVisible=function(a){this.mapDiv.style.display=(a?"inline":"none")};SITE.Mapa.prototype.showAccordionImage=function(){this.gaitaImagePlaceHolder.innerHTML='<img src="'+this.accordion.loaded.image+'" alt="'+this.accordion.getFullName()+" "+SITE.translator.getResource("keys")+'" style="height:200px; width:200px;" />'};SITE.Mapa.prototype.showAccordionName=function(){this.gaitaNamePlaceHolder.innerHTML=this.accordion.getFullName()+' <span data-translate="keys">'+SITE.translator.getResource("keys")+"</span>"};SITE.Mapa.prototype.highlight=function(a){if(!this.midiPlayer.playing){this.accordion.clearKeyboard(true);this.midiParser.setSelection(a)}};SITE.Mapa.prototype.startLoader=function(e,b,d,c){var a=new window.widgets.Loader({id:e,bars:0,radius:0,lineWidth:20,lineHeight:70,timeout:1,background:"rgba(0,0,0,0.5)",container:b?b:document.body,onstart:d,oncomplete:c});return a};SITE.Mapa.prototype.defineInstrument=function(b){var c=SITE.properties.options.pianoSound?"acoustic_grand_piano":"accordion";var a=function(){var d=SITE.properties.options.pianoSound?0:21;MIDI.programChange(0,d);MIDI.programChange(1,d);MIDI.programChange(2,d);MIDI.programChange(3,d);MIDI.programChange(4,d);MIDI.programChange(5,d)};if(b){a();return}MIDI.widget=new sketch.ui.Timer({size:180,container:document.getElementById("mapaDiv"),cor1:SITE.properties.colors.close,cor2:SITE.properties.colors.open});MIDI.widget.setFormat(SITE.translator.getResource("loading"));MIDI.loadPlugin({soundfontUrl:"./soundfont/",instruments:c,onprogress:function(g,d,e){var f=((d*100)+e)/(g);MIDI.widget.setValue(Math.round(f))},callback:function(){a()}})};SITE.Mapa.prototype.showSettings=function(){var d=620;var c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var a=c/2-d/2;if(!this.settings){this.settings={};this.settings.window=new DRAGGABLE.ui.Window(null,null,{title:"PreferencesTitle",translator:SITE.translator,statusbar:false,top:"300px",left:a+"px",height:"480px",width:d+"px",zIndex:50},{listener:this,method:"settingsCallback"});SITE.ga("event","page_view",{page_title:SITE.translator.getResource("PreferencesTitle"),page_path:SITE.root+"/settings"});this.settings.window.topDiv.style.zIndex=101;var e=document.cookie.match(/(;)?cookiebar=([^;]*);?/)[2];var b="";if(e){b='&nbsp;<a href="#" onclick="document.cookie=\'cookiebar=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/\'; setupCookieBar(); return false;"><span data-translate="cookiePrefs" >'+SITE.translator.getResource("cookiePrefs")+"</span></a>"}this.settings.window.dataDiv.innerHTML='        <div class="menu-group">            <table>              <tr>                <th colspan="2"><span data-translate="PrefsIdiom" >'+SITE.translator.getResource("PrefsIdiom")+'</span></th>                <th><div id="settingsLanguageMenu" class="topMenu"></div></th>              </tr>              <tr style="display:none;">              <th colspan="2"><br><span data-translate="PrefsTabFormat" >'+SITE.translator.getResource("PrefsTabFormat")+'</span></th>              <th><br><div id="settingsTabMenu" class="topMenu"></div></th>              </tr>              <tr style="display:none;">                <td> </td><td colspan="2"><input id="chkOnlyNumbers" type="checkbox">&nbsp;<span data-translate="PrefsPropsOnlyNumbers" >'+SITE.translator.getResource("PrefsPropsOnlyNumbers")+'</span></td>              </tr>              <tr>                <th colspan="2"><br><span data-translate="PrefsColor" >'+SITE.translator.getResource("PrefsColor")+'</span></th><td></td>              </tr>              <tr>                <td style="width:15px;"></td><td data-translate="PrefsColorHighlight" >'+SITE.translator.getResource("PrefsColorHighlight")+'</td><td><input id="corRealce" type="text" ><input id="chkTransparency" type="checkbox">&nbsp;<span data-translate="PrefsColorTransparency" >'+SITE.translator.getResource("PrefsColorTransparency")+'</span></td>              </tr>              <tr>                <td></td><td data-translate="PrefsColorClosingBellows" >'+SITE.translator.getResource("PrefsColorClosingBellows")+'</td><td><input id="foleFechando" type="text" ></td>              </tr>              <tr>                <td></td><td data-translate="PrefsColorOpeningBellows" >'+SITE.translator.getResource("PrefsColorOpeningBellows")+'</td><td><input id="foleAbrindo" type="text" ></td>              </tr>              <tr>                <th colspan="2"><br><span data-translate="PrefsProps" >'+SITE.translator.getResource("PrefsProps")+'</span></th><td></td>              </tr>              <tr>                <td> </td><td colspan="2"><input id="chkPiano" type="checkbox">&nbsp;<span data-translate="PrefsPropsCKPiano" >'+SITE.translator.getResource("PrefsPropsCKPiano")+'</span></td>              </tr>              <tr>                <td> </td><td colspan="2"><input id="chkWarnings" type="checkbox">&nbsp;<span data-translate="PrefsPropsCKShowWarnings" >'+SITE.translator.getResource("PrefsPropsCKShowWarnings")+'</span></td>              </tr>              <tr>                <td> </td><td colspan="2"><input id="chkAutoRefresh" type="checkbox">&nbsp;<span data-translate="PrefsPropsCKAutoRefresh" >'+SITE.translator.getResource("PrefsPropsCKAutoRefresh")+'</span></td>              </tr>              <tr><td></td><td colspan="2">'+b+'</td></tr>            </table>        </div>        <div id="pg" class="pushbutton-group" style="right: 0; bottom: 0;" >            <div id="botao1"></div>\n            <div id="botao2"></div>\n            <div id="botao3"></div>\n        </div>';
this.settings.window.addPushButtons(["botao1|apply","botao2|reset|PrefsReset","botao3|cancel"]);this.settings.menu=new DRAGGABLE.ui.DropdownMenu("settingsLanguageMenu",{listener:this,method:"settingsCallback",translate:false},[{title:"Idioma",ddmId:"menuIdiomas",itens:[]}]);this.settings.tabMenu=new DRAGGABLE.ui.DropdownMenu("settingsTabMenu",{listener:this,method:"settingsCallback",translate:true},[{title:"...",ddmId:"menuFormato",itens:["&#160;Modelo Alemão|0TAB","&#160;Numérica 1 (se disponível)|1TAB","&#160;Numérica 2 (se disponível)|2TAB"]}]);this.settings.tabFormat=SITE.properties.options.tabFormat;this.settings.tabMenu.setSubMenuTitle("menuFormato",this.settings.tabMenu.selectItem("menuFormato",this.settings.tabFormat.toString()+"TAB"));this.picker=new DRAGGABLE.ui.ColorPicker(["corRealce","foleFechando","foleAbrindo"],{translator:SITE.translator});SITE.translator.menuPopulate(this.settings.menu,"menuIdiomas");this.settings.lang=SITE.properties.options.language;this.settings.useTransparency=document.getElementById("chkTransparency");this.settings.corRealce=document.getElementById("corRealce");this.settings.closeColor=document.getElementById("foleFechando");this.settings.openColor=document.getElementById("foleAbrindo");this.settings.showWarnings=document.getElementById("chkWarnings");this.settings.autoRefresh=document.getElementById("chkAutoRefresh");this.settings.pianoSound=document.getElementById("chkPiano");this.settings.chkOnlyNumbers=document.getElementById("chkOnlyNumbers")}this.settings.corRealce.style.backgroundColor=this.settings.corRealce.value=SITE.properties.colors.highLight;this.settings.closeColor.style.backgroundColor=this.settings.closeColor.value=SITE.properties.colors.close;this.settings.openColor.style.backgroundColor=this.settings.openColor.value=SITE.properties.colors.open;this.settings.chkOnlyNumbers.checked=SITE.properties.options.tabShowOnlyNumbers;this.settings.showWarnings.checked=SITE.properties.options.showWarnings;this.settings.autoRefresh.checked=SITE.properties.options.autoRefresh;this.settings.pianoSound.checked=SITE.properties.options.pianoSound;this.settings.useTransparency.checked=SITE.properties.colors.useTransparency;this.settings.window.setVisible(true)};SITE.Mapa.prototype.settingsCallback=function(b,a){switch(b){case"0TAB":case"1TAB":case"2TAB":this.settings.tabFormat=b;this.settings.tabMenu.setSubMenuTitle("menuFormato",this.settings.tabMenu.selectItem("menuFormato",b));break;case"de_DE":case"en_US":case"es_ES":case"fr_FR":case"it_IT":case"pt_BR":this.settings.lang=b;this.settings.menu.setSubMenuTitle("menuIdiomas",this.settings.menu.selectItem("menuIdiomas",b));break;case"MOVE":break;case"CLOSE":case"CANCEL":this.picker.close();this.settings.window.setVisible(false);break;case"APPLY":SITE.properties.colors.highLight=this.settings.corRealce.value;SITE.properties.colors.close=this.settings.closeColor.value;SITE.properties.colors.open=this.settings.openColor.value;SITE.properties.options.showWarnings=this.settings.showWarnings.checked;SITE.properties.options.autoRefresh=this.settings.autoRefresh.checked;SITE.properties.colors.useTransparency=this.settings.useTransparency.checked;this.picker.close();this.settings.window.setVisible(false);this.applySettings();SITE.SaveProperties();break;case"RESET":this.alert=new DRAGGABLE.ui.Alert(this.settings.window,b,"<br>"+SITE.translator.getResource("resetMsgTitle"),"<br>"+SITE.translator.getResource("resetMsgDescription"),{translator:SITE.translator});break;case"RESET-YES":this.alert.close();this.picker.close();this.settings.window.setVisible(false);SITE.ResetProperties();SITE.ga("event","reset",{event_category:"Configuration",event_label:SITE.properties.version});this.applySettings();break;case"RESET-NO":case"RESET-CANCEL":this.alert.close();break}};SITE.Mapa.prototype.applySettings=function(){if(parseInt(this.settings.tabFormat)!==SITE.properties.options.tabFormat||this.settings.chkOnlyNumbers.checked!==SITE.properties.options.tabShowOnlyNumbers){SITE.properties.options.tabShowOnlyNumbers=this.settings.chkOnlyNumbers.checked;SITE.properties.options.tabFormat=parseInt(this.settings.tabFormat);this.accordion.setFormatoTab(SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);this.accordion.loadedKeyboard.reprint();this.renderTAB(this.getActiveTab());if(this.studio){this.studio.accordion.setFormatoTab(SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);this.studio.accordion.loadedKeyboard.reprint();this.studio.renderedTune.printer.printABC(this.studio.renderedTune.abc)}if(this.tab2part){this.tab2part.accordion.setFormatoTab(SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);this.tab2part.renderedTune.printer.printABC(this.renderedTune.abc)}if(this.ABC2part){this.ABC2part.accordion.setFormatoTab(SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);this.ABC2part.renderedTune.printer.printABC(this.renderedTune.abc)}}if(this.settings.lang!==SITE.properties.options.language){SITE.properties.options.language=this.settings.lang;SITE.ga("event","changeLang",{event_category:"Configuration",event_label:SITE.properties.options.language});SITE.translator.loadLanguage(this.settings.lang,function(){SITE.translator.translate()})}if(this.settings.pianoSound.checked!==SITE.properties.options.pianoSound){SITE.properties.options.pianoSound=this.settings.pianoSound.checked;SITE.ga("event","changeInstrument",{event_category:"Configuration",event_label:SITE.properties.options.pianoSound?"piano":"accordion"});this.defineInstrument()}this.media.show(this.getActiveTab());if(this.studio){this.studio.setAutoRefresh(SITE.properties.options.autoRefresh);this.studio.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none"}if(this.part2tab){this.part2tab.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none"}if(this.tab2part){this.tab2part.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none"}if(this.ABC2part){this.ABC2part.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none"}this.resizeActiveWindow();ABCXJS.write.color.useTransparency=SITE.properties.colors.useTransparency;ABCXJS.write.color.highLight=SITE.properties.colors.highLight;DIATONIC.map.color.close=SITE.properties.colors.close;DIATONIC.map.color.open=SITE.properties.colors.open;this.accordion.loadedKeyboard.legenda.setOpen();this.accordion.loadedKeyboard.legenda.setClose()};SITE.Mapa.prototype.changePageOrientation=function(a){var b=document.createElement("style");document.head.appendChild(b);b.innerHTML="@page {margin: 1cm; size: "+a+"}"};SITE.Mapa.prototype.printPreview=function(b,c,d){var a=document.getElementById("printPreviewDiv");var e={};c.forEach(function(g){var f=document.getElementById(g.substring(1));e[g.substring(1)]=f.style.display;f.style.display="none"});this.changePageOrientation(d?"landscape":"portrait");a.innerHTML=b;a.style.display="block";setTimeout(function(){window.print();
a.style.display="none";c.forEach(function(g){var f=document.getElementById(g.substring(1));f.style.display=e[g.substring(1)]})})};SITE.Mapa.prototype.resizeActiveWindow=function(){if(this.studio&&window.getComputedStyle(this.studio.Div.parent).display!=="none"){this.studio.resize()}else{if(this.tab2part&&window.getComputedStyle(this.tab2part.Div.parent).display!=="none"){this.tab2part.resize()}else{if(this.ABC2part&&window.getComputedStyle(this.ABC2part.Div.parent).display!=="none"){this.ABC2part.resize()}else{if(this.part2tab&&window.getComputedStyle(this.part2tab.Div.parent).display!=="none"){this.part2tab.resize()}else{this.resize()}}}}};SITE.Mapa.prototype.silencia=function(a){if(this.studio&&window.getComputedStyle(this.studio.Div.parent).display!=="none"){if(this.studio.midiPlayer.playing){if(a){this.studio.midiPlayer.stopPlay()}else{this.studio.startPlay("normal")}}}else{if(this.tab2part&&window.getComputedStyle(this.tab2part.Div.parent).display!=="none"){if(this.tab2part.midiPlayer.playing){if(a){this.tab2part.midiPlayer.stopPlay()}else{this.tab2part.startPlay("normal")}}}else{if(this.midiPlayer.playing){if(a){this.midiPlayer.stopPlay()}else{this.startPlay("normal")}}}}};SITE.Mapa.prototype.setFocus=function(){if(this.studio&&window.getComputedStyle(this.studio.Div.parent).display!=="none"){this.studio.editorWindow.aceEditor.focus()}else{if(this.tab2part&&window.getComputedStyle(this.tab2part.Div.parent).display!=="none"){this.tab2part.editorWindow.aceEditor.focus()}else{if(this.ABC2part&&window.getComputedStyle(this.ABC2part.Div.parent).display!=="none"){this.ABC2part.editorWindow.aceEditor.focus()}else{}}}};SITE.Mapa.prototype.showHelp=function(h,g,d,c){var f=this;c=c||{};c.width=typeof c.width==="undefined"?"800":c.width;c.height=typeof c.height==="undefined"?undefined:c.height;c.print=typeof c.print==="undefined"?true:c.print;var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var b=e/2-c.width/2;if(!this.helpWindow){this.helpWindow=new DRAGGABLE.ui.Window(null,["print|printBtn"],{title:"",translator:SITE.translator,draggable:true,statusbar:false,top:"200px",left:b+"px",height:"auto",zIndex:70},{listener:this,method:"helpCallback"});this.helpWindow.dataDiv.style.height="auto"}SITE.ga("event","page_view",{page_title:SITE.translator.getResource(g||h),page_path:SITE.root+"/help"});this.helpWindow.setTitle(h,SITE.translator);this.helpWindow.setSubTitle(g,SITE.translator);this.helpWindow.setButtonVisible("PRINT",c.print);this.helpWindow.dataDiv.innerHTML='<object data="'+d+'" type="text/html" ></object>';this.iframe=this.helpWindow.dataDiv.getElementsByTagName("object")[0];this.iframe.style.width=c.width+"px";this.iframe.style.height=(c.height?c.height:400)+"px";this.helpWindow.setVisible(true);var a=this.startLoader("About",this.helpWindow.dataDiv);f.helpWindow.dataDiv.style.opacity="1";f.helpWindow.dataDiv.style.overflow="hidden";a.start(function(){if(c.height===undefined){f.iframe.addEventListener("load",function(){this.contentDocument.body.style.overflow="hidden";var k=this.contentDocument.getElementById("siteVerI");if(k){k.innerHTML=SITE.siteVersion}this.style.height=this.contentDocument.body.clientHeight+"px";f.helpWindow.dataDiv.style.opacity="1";a.stop()})}else{var j=window.setInterval(function i(){var n=f.iframe.contentDocument.getElementById("helpHeader");if(n){clearInterval(j);f.helpWindow.dataDiv.style.opacity="0";var n=f.iframe.contentDocument.getElementById("helpHeader");var m=f.iframe.contentDocument.getElementById("helpFrame");var k=f.iframe.contentDocument.getElementById("helpContainer");if(n){n.style.display="none"}if(m){m.style.overflow="hidden"}f.iframe.style.height=c.height+"px";if(k){k.style.top="0";k.style.height=(c.height-18)+"px";k.style.overflow="hidden";k.style.border="1px solid rgba(255, 153, 34, 0.2)";var l=new PerfectScrollbar(k,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500})}f.helpWindow.dataDiv.style.opacity="1";a.stop()}},100)}},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")};SITE.Mapa.prototype.helpCallback=function(b){if(b==="CLOSE"){this.helpWindow.setVisible(false)}else{if(b==="PRINT"){var a=this.iframe.contentDocument.getElementById("helpContainer");if(a){this.printPreview(a.innerHTML,["#"+this.helpWindow.topDiv.id,"#topBar","#mapaDiv"],false)}}}};if(!window.SITE){window.SITE={}}SITE.Estudio=function(b,f,e){this.mapa=b;this.parserparams={};this.ypos=0;this.lastStaffGroup=-1;this.lastYpos=0;var c=this;var a="canvasDiv";var d="warningsDiv";this.warnings=[];this.renderedTune={text:undefined,abc:undefined,title:undefined,tab:undefined,div:undefined,selector:undefined};this.Div=new DRAGGABLE.ui.Window(f.studioDiv,null,{translator:SITE.translator,statusbar:false,draggable:false,top:"3px",left:"1px",width:"100%",height:"100%",title:"EstudioTitle"},{listener:this,method:"studioCallback"});this.Div.setVisible(true);this.Div.dataDiv.style.overflow="hidden";if(f.generate_tablature){if(f.generate_tablature==="accordion"){this.accordion=new window.ABCXJS.tablature.Accordion(f.accordion_options,SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);if(f.accordionNameSpan){this.accordionNameSpan=document.getElementById(f.accordionNameSpan);this.accordionNameSpan.innerHTML=this.accordion.getFullName()}}else{throw new Error("Tablatura para "+f.generate_tablature+" não suportada!")}}this.editorWindow=new ABCXJS.edit.EditArea(this.Div.dataDiv,{listener:this,method:"editorCallback"},{draggable:SITE.properties.studio.editor.floating,toolbar:true,statusbar:true,translator:SITE.translator,title:"EstudioEditorTitle",compileOnChange:SITE.properties.options.autoRefresh});this.editorWindow.setVisible(false);this.controlDiv=document.createElement("DIV");this.controlDiv.setAttribute("id","controlDiv");this.controlDiv.setAttribute("class","controlDiv btn-group");this.Div.dataDiv.appendChild(this.controlDiv);this.controlDiv.innerHTML=document.getElementById(f.studioControlDiv).innerHTML;document.getElementById(f.studioControlDiv).innerHTML="";this.media=new SITE.Media(this.Div.dataDiv,f.btShowMedia,SITE.properties.studio.media);this.keyboardWindow=new DRAGGABLE.ui.Window(this.Div.dataDiv,["move","rotate","zoom","globe"],{title:"",translator:SITE.translator,statusbar:false,top:SITE.properties.studio.keyboard.top,left:SITE.properties.studio.keyboard.left},{listener:this,method:"keyboardCallback"});this.accordion.setRenderOptions({draggable:true,show:SITE.properties.studio.keyboard.visible,transpose:SITE.properties.studio.keyboard.transpose,mirror:SITE.properties.studio.keyboard.mirror,scale:SITE.properties.studio.keyboard.scale,label:SITE.properties.studio.keyboard.label});this.warningsDiv=document.createElement("DIV");this.warningsDiv.setAttribute("id",d);this.warningsDiv.setAttribute("class","warningsDiv");this.Div.dataDiv.appendChild(this.warningsDiv);
this.studioCanvasDiv=document.createElement("DIV");this.studioCanvasDiv.setAttribute("id",f.studioCanvasDiv);this.studioCanvasDiv.setAttribute("class","studioCanvasDiv");this.canvasDiv=document.createElement("DIV");this.canvasDiv.setAttribute("id",a);this.canvasDiv.setAttribute("class","canvasDiv");this.studioCanvasDiv.appendChild(this.canvasDiv);this.renderedTune.div=this.canvasDiv;this.Div.dataDiv.appendChild(this.studioCanvasDiv);if(this.ps){this.ps.destroy()}this.ps=new PerfectScrollbar(this.studioCanvasDiv,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});if(f.onchange){this.onchangeCallback=f.onchange}this.saveButton=document.getElementById(f.saveBtn);this.forceRefreshButton=document.getElementById(f.forceRefresh);this.printButton=document.getElementById(f.printBtn);this.showMapButton=document.getElementById(f.showMapBtn);this.showEditorButton=document.getElementById(f.showEditorBtn);this.modeButton=document.getElementById(e.modeBtn);this.lyricsButton=document.getElementById(e.lyricsBtn);this.fingeringButton=document.getElementById(e.fingeringBtn);this.tabformatButton=document.getElementById(e.tabformatBtn);this.timerButton=document.getElementById(e.timerBtn);this.FClefButton=document.getElementById(e.FClefBtn);this.GClefButton=document.getElementById(e.GClefBtn);this.playButton=document.getElementById(e.playBtn);this.stopButton=document.getElementById(e.stopBtn);this.gotoMeasureButton=document.getElementById(e.gotoMeasureBtn);this.untilMeasureButton=document.getElementById(e.untilMeasureBtn);this.currentPlayTimeLabel=document.getElementById(e.currentPlayTimeLabel);this.stepButton=document.getElementById(e.stepBtn);this.stepMeasureButton=document.getElementById(e.stepMeasureBtn);this.repeatButton=document.getElementById(e.repeatBtn);this.clearButton=document.getElementById(e.clearBtn);this.tempoButton=document.getElementById(e.tempoSld);this.showMapButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.showKeyboard()},false);this.showEditorButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.showEditor()},false);this.forceRefreshButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.fireChanged(0,{force:true,showProgress:true})},false);this.saveButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.salvaMusica()},false);this.printButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.ga("event","print",{event_category:"Mapa",event_label:c.renderedTune.title});c.mapa.printPreview(c.renderedTune.div.innerHTML,["#topBar","#studioDiv"],c.renderedTune.abc.formatting.landscape);return},false);this.modeButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.changePlayMode()},false);this.lyricsButton.addEventListener("click",function(g){if(c.midiPlayer.playing){c.studioStopPlay()}g.preventDefault();this.blur();SITE.properties.options.lyrics=!SITE.properties.options.lyrics;c.parserparams.hideLyrics=!SITE.properties.options.lyrics;c.setLyricsIcon();c.fireChanged(0,{force:true,showProgress:true})},false);this.fingeringButton.addEventListener("click",function(g){if(c.midiPlayer.playing){c.studioStopPlay()}g.preventDefault();this.blur();SITE.properties.options.fingering=!SITE.properties.options.fingering;c.parserparams.hideFingering=!SITE.properties.options.fingering;c.setFingeringIcon();c.fireChanged(0,{force:true,showProgress:true})},false);this.tabformatButton.addEventListener("click",function(g){if(c.midiPlayer.playing){c.studioStopPlay()}g.preventDefault();this.blur();SITE.properties.options.rowsNumbered=!SITE.properties.options.rowsNumbered;c.parserparams.ilheirasNumeradas=SITE.properties.options.rowsNumbered;c.fireChanged(0,{force:true,showProgress:true})},false);this.timerButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.properties.studio.timerOn=!SITE.properties.studio.timerOn;c.setTimerIcon(0)},false);this.FClefButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.properties.studio.bassOn=!SITE.properties.studio.bassOn;c.setBassIcon()},false);this.GClefButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.properties.studio.trebleOn=!SITE.properties.studio.trebleOn;c.setTrebleIcon()},false);this.playButton.addEventListener("click",function(g){g.preventDefault();this.blur();window.setTimeout(function(){c.startPlay("normal")},0)},false);this.stopButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.blockEdition(false);if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML="00:00"}c.studioStopPlay()},false);this.clearButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.renderedTune.printer.clearSelection();c.accordion.clearKeyboard(true);c.currentPlayTimeLabel.innerHTML="00:00";c.blockEdition(false);c.studioStopPlay()},false);this.stepButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.startPlay("note")},false);this.stepMeasureButton.addEventListener("click",function(g){g.preventDefault();c.startPlay("measure")},false);this.repeatButton.addEventListener("click",function(g){g.preventDefault();this.blur();if(!c.midiPlayer.playing){c.startPlay("repeat",c.gotoMeasureButton.value,c.untilMeasureButton.value)}},false);this.slider=new DRAGGABLE.ui.Slider(this.tempoButton,{min:25,max:200,start:100,step:25,speed:100,color:"white",bgcolor:"red",size:{w:115,h:23,tw:48},callback:function(g){c.midiPlayer.setAndamento(g)}});this.gotoMeasureButton.addEventListener("keypress",function(g){if(g.keyCode===13){c.startPlay("goto",this.value,c.untilMeasureButton.value)}},false);this.gotoMeasureButton.addEventListener("focus",function(g){if(this.value===SITE.translator.getResource("gotoMeasure").val){this.value=""}},false);this.gotoMeasureButton.addEventListener("blur",function(g){if(this.value===""){this.value=SITE.translator.getResource("gotoMeasure").val}},false);this.untilMeasureButton.addEventListener("keypress",function(g){if(g.keyCode===13){c.startPlay("goto",c.gotoMeasureButton.value,this.value)}},false);this.untilMeasureButton.addEventListener("focus",function(g){if(this.value===SITE.translator.getResource("untilMeasure").val){this.value=""}},false);this.untilMeasureButton.addEventListener("blur",function(g){if(this.value===""){this.value=SITE.translator.getResource("untilMeasure").val}},false);this.playerCallBackOnScroll=function(g){c.setScrolling(g)};this.playerCallBackOnPlay=function(g){var h=g.getTime().cTime;if(c.gotoMeasureButton&&!parseInt(c.untilMeasureButton.value)){c.gotoMeasureButton.value=g.currentMeasure}if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML=h}c.midiPlayer.setPlayableClefs((SITE.properties.studio.trebleOn?"T":"")+(SITE.properties.studio.bassOn?"B":""))};this.playerCallBackOnEnd=function(h){var j=c.midiPlayer.getWarnings();c.playButton.title=SITE.translator.getResource("playBtn");
c.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';c.renderedTune.printer.clearSelection();c.accordion.clearKeyboard(true);c.blockEdition(false);if(j){var i=document.getElementById("warningsDiv");var g="";j.forEach(function(k){g+=k+"<br/>"});i.style.color="blue";i.innerHTML=g}};this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);this.midiPlayer.defineCallbackOnPlay(this.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(this.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(this.playerCallBackOnScroll)};SITE.Estudio.prototype.setup=function(b,a){if(this.mapa){this.mapa.closeMapa()}this.accordion.loadById(a);this.renderedTune.abc=b.abc;this.renderedTune.text=b.text;this.renderedTune.title=b.title;this.changePlayMode(SITE.properties.studio.mode);this.setBassIcon();this.setTrebleIcon();this.setTimerIcon(0);this.setVisible(true);this.setString(b.text);this.fireChanged(0,{force:true});this.Div.setSubTitle("- "+this.accordion.getTxtModel());this.studioCanvasDiv.scrollTop=0;this.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none";this.showEditor(SITE.properties.studio.editor.visible);this.editorWindow.container.setSubTitle("- "+b.title);this.editorWindow.restartUndoManager();if(SITE.properties.studio.editor.floating){if(SITE.properties.studio.editor.maximized){this.editorWindow.setFloating(true);this.editorWindow.container.dispatchAction("MAXIMIZE")}else{this.editorWindow.container.dispatchAction("POPOUT")}}else{this.editorWindow.container.dispatchAction("POPIN")}this.showKeyboard(SITE.properties.studio.keyboard.visible);this.keyboardWindow.setTitle(this.accordion.getTxtTuning()+" - "+this.accordion.getTxtNumButtons());SITE.translator.translate(this.Div.topDiv)};SITE.Estudio.prototype.resize=function(){var i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var f=(i-78-10);var a=(d-8);this.Div.topDiv.style.left="3px";this.Div.topDiv.style.top="82px";this.Div.topDiv.style.height=Math.max(f,200)+"px";this.Div.topDiv.style.width=Math.max(a,400)+"px";var a=0,g=0;var j=this.controlDiv.clientHeight;var b=this.Div.dataDiv.clientHeight;if(!SITE.properties.showWarnings){a=this.warningsDiv.clientHeight}if(!SITE.properties.studio.editor.floating){g=this.editorWindow.container.topDiv.clientHeight+4}this.studioCanvasDiv.style.height=b-(a+g+j+6)+"px";this.posicionaTeclado();this.editorWindow.resize();(this.ps)&&this.ps.update()};SITE.Estudio.prototype.showKeyboard=function(a){SITE.properties.studio.keyboard.visible=(typeof a==="undefined"?!SITE.properties.studio.keyboard.visible:a);this.accordion.render_opts.show=SITE.properties.studio.keyboard.visible;if(SITE.properties.studio.keyboard.visible){this.keyboardWindow.setVisible(true);this.accordion.printKeyboard(this.keyboardWindow.dataDiv);document.getElementById("I_showMap").setAttribute("class","ico-folder-open");this.posicionaTeclado()}else{this.accordion.render_opts.show=false;this.keyboardWindow.setVisible(false);document.getElementById("I_showMap").setAttribute("class","ico-folder")}};SITE.Estudio.prototype.showEditor=function(a){SITE.properties.studio.editor.visible=(typeof a==="undefined"?!SITE.properties.studio.editor.visible:a);if(SITE.properties.studio.editor.visible){this.editorWindow.setVisible(true);this.editorWindow.resize();document.getElementById("I_showEditor").setAttribute("class","ico-folder-open")}else{document.getElementById("I_showEditor").setAttribute("class","ico-folder");this.editorWindow.setVisible(false)}this.resize()};SITE.Estudio.prototype.editorCallback=function(b,a){switch(b){case"0":break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":case"11":case"-1":case"-2":case"-3":case"-4":case"-5":case"-6":case"-7":case"-8":case"-9":case"-10":case"-11":this.fireChanged(parseInt(b),{force:true});break;case"OCTAVEUP":this.fireChanged(12,{force:true});break;case"OCTAVEDOWN":this.fireChanged(-12,{force:true});break;case"REFRESH":this.fireChanged(0,{force:true});break;case"DOWNLOAD":this.salvaMusica();break;case"MAXIMIZE":this.editorWindow.maximizeWindow(true,SITE.properties.studio.editor);break;case"RESTORE":this.editorWindow.maximizeWindow(false,SITE.properties.studio.editor);break;case"POPIN":this.editorWindow.dockWindow(true,SITE.properties.studio.editor,0,0,"calc(100% - 5px)","200px");this.resize();break;case"POPOUT":this.editorWindow.dockWindow(false,SITE.properties.studio.editor);this.resize();break;case"RESIZE":case"MOVE":this.editorWindow.retrieveProps(SITE.properties.studio.editor);break;case"CLOSE":this.showEditor(false);break}};SITE.Estudio.prototype.studioCallback=function(a){switch(a){case"CLOSE":this.closeEstudio(true);break}};SITE.Estudio.prototype.studioStopPlay=function(a){this.midiPlayer.stopPlay()};SITE.Estudio.prototype.closeEstudio=function(c){var b=this;if(!this.mapa){b.setVisible(false);b.studioStopPlay()}else{var a=this.mapa.startLoader("CloseStudio",b.studioCanvasDiv);a.start(function(){(c)&&SITE.SaveProperties();b.studioStopPlay();b.mapa.openMapa(b.getString());b.setVisible(false);a.stop()},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")}};SITE.Estudio.prototype.setVisible=function(a){this.Div.parent.style.display=a?"block":"none"};SITE.Estudio.prototype.setAutoRefresh=function(a){this.editorWindow.setCompileOnChange(a)};SITE.Estudio.prototype.getString=function(){return this.editorWindow.getString()};SITE.Estudio.prototype.setString=function(a){this.editorWindow.setString(a)};SITE.Estudio.prototype.keyboardCallback=function(b){switch(b){case"MOVE":var a=this.keyboardWindow.topDiv.style;SITE.properties.studio.keyboard.left=a.left;SITE.properties.studio.keyboard.top=a.top;break;case"ROTATE":this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);SITE.properties.studio.keyboard.transpose=this.accordion.render_opts.transpose;SITE.properties.studio.keyboard.mirror=this.accordion.render_opts.mirror;break;case"ZOOM":this.accordion.scaleKeyboard(this.keyboardWindow.dataDiv);SITE.properties.studio.keyboard.scale=this.accordion.render_opts.scale;break;case"GLOBE":this.accordion.changeNotation();SITE.properties.studio.keyboard.label=this.accordion.render_opts.label;break;case"CLOSE":this.showKeyboard(false);break}};SITE.Estudio.prototype.setScrolling=function(c){if(!this.studioCanvasDiv||!c.currAbsElem||c.currAbsElem.staffGroup===this.lastStaffGroup){return}this.lastStaffGroup=c.currAbsElem.staffGroup;var e=c.printer.staffgroups[0].top;var b=this.studioCanvasDiv.clientHeight-e;var d=c.printer.staffgroups[c.currAbsElem.staffGroup].top-12;var a=d+c.printer.staffgroups[c.currAbsElem.staffGroup].height;if(a>b+this.ypos||this.ypos>d-e){this.ypos=d;this.studioCanvasDiv.scrollTop=this.ypos}};SITE.Estudio.prototype.salvaMusica=function(){if(FILEMANAGER.requiredFeaturesAvailable()){this.fireChanged(0,{force:false,showProgress:true});var a=this.renderedTune.abc.metaText.title+".abcx";
var b=this.getString();FILEMANAGER.download(a,b)}else{alert(SITE.translator.getResource("err_saving"))}};SITE.Estudio.prototype.changePlayMode=function(a){SITE.properties.studio.mode=a?a:(SITE.properties.studio.mode==="normal"?"learning":"normal");this.midiPlayer.setAndamento(this.slider.getValue());if(SITE.properties.studio.mode==="normal"){$("#divDidacticPlayControls").hide();SITE.properties.studio.mode="normal";this.modeButton.innerHTML='<i class="ico-listening" ></i>';$("#divNormalPlayControls").fadeIn()}else{$("#divNormalPlayControls").hide();SITE.properties.studio.mode="learning";this.modeButton.innerHTML='<i class="ico-learning" ></i>';$("#divDidacticPlayControls").fadeIn()}};SITE.Estudio.prototype.posicionaTeclado=function(){if(!SITE.properties.studio.keyboard.visible){return}var b=window.innerWidth;var c=this.keyboardWindow.topDiv;var a=parseInt(c.style.left.replace("px",""));if(a+c.offsetWidth>b){a=(b-(c.offsetWidth+50))}if(a<0){a=10}c.style.left=a+"px"};SITE.Estudio.prototype.blockEdition=function(a){this.editorWindow.setReadOnly(!a);this.editorWindow.container.dispatchAction("READONLY");if(a){this.editorWindow.setEditorHighLightStyle()}else{this.editorWindow.clearEditorHighLightStyle();this.editorWindow.aceEditor.focus()}};SITE.Estudio.prototype.startPlay=function(b,d,a){this.ypos=this.studioCanvasDiv.scrollTop;this.lastStaffGroup=-1;var c=this;if(this.midiPlayer.playing){if(b==="normal"){this.playButton.title=SITE.translator.getResource("playBtn");this.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}this.blockEdition(false)}else{this.accordion.clearKeyboard();if(b==="normal"){this.blockEdition(true)}window.setTimeout(function(){c.StartPlayWithTimer(c.renderedTune.abc.midi,b,d,a,SITE.properties.studio.timerOn?10:0)},0)}};SITE.Estudio.prototype.setBassIcon=function(){if(SITE.properties.studio.bassOn){this.FClefButton.innerHTML='<i class="ico-clef-bass" ></i>'}else{this.FClefButton.innerHTML='<i class="ico-clef-bass" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:3px; filter: grayscale(1);"></i>'}};SITE.Estudio.prototype.setTrebleIcon=function(){if(SITE.properties.studio.trebleOn){this.GClefButton.innerHTML='<i class="ico-clef-treble" ></i>'}else{this.GClefButton.innerHTML='<i class="ico-clef-treble" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:3px; filter: grayscale(1);"></i>'}};SITE.Estudio.prototype.setTimerIcon=function(b){b=b||0;var a="00";if(SITE.properties.studio.timerOn){switch(b){case 0:a="00";break;case 1:a="05";break;case 2:a="15";break;case 3:a="20";break;case 6:a="30";break;case 9:a="45";break;default:a=""}if(a!==""){if(a!=="00"){MIDI.noteOn(0,90,100,0);MIDI.noteOff(0,90,b>3?0.1:0.05)}this.timerButton.innerHTML='<i class="ico-timer-'+a+'" ></i>'}}else{this.timerButton.innerHTML='<i class="ico-timer-00" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:4px; filter: grayscale(1);"></i>'}};SITE.Estudio.prototype.setLyricsIcon=function(){if(SITE.properties.options.lyrics){this.lyricsButton.innerHTML='<i class="ico-letter-l" ></i>'}else{this.lyricsButton.innerHTML='<i class="ico-letter-l" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:4px; filter: grayscale(1);"></i>'}};SITE.Estudio.prototype.setFingeringIcon=function(){if(SITE.properties.options.fingering){this.fingeringButton.innerHTML='<i class="ico-alien-fingering" ></i>'}else{this.fingeringButton.innerHTML='<i class="ico-alien-fingering" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:4px; filter: grayscale(1);"></i>'}};SITE.Estudio.prototype.StartPlayWithTimer=function(f,c,e,b,a){var d=this;if(c!=="note"&&SITE.properties.studio.timerOn&&a>0){d.setTimerIcon(a);a-=1;window.setTimeout(function(){d.StartPlayWithTimer(f,c,e,b,a)},1000/3)}else{d.setTimerIcon(0);if(c==="normal"){this.midiPlayer.setPlayableClefs("TB");if(this.midiPlayer.startPlay(this.renderedTune.abc.midi)){SITE.ga("event","play",{event_category:"Mapa",event_label:this.renderedTune.title});this.playButton.title=SITE.translator.getResource("pause");this.playButton.innerHTML='&#160;<i class="ico-pause"></i>&#160;'}}else{this.midiPlayer.setPlayableClefs((SITE.properties.studio.trebleOn?"T":"")+(SITE.properties.studio.bassOn?"B":""));SITE.ga("event","didactic-play",{event_category:"Mapa",event_label:this.renderedTune.title});this.midiPlayer.startDidacticPlay(this.renderedTune.abc.midi,c,e,b)}}};SITE.Estudio.prototype.parseABC=function(c,d){var g=this.getString();this.warnings=[];if(g===""){this.renderedTune.text=this.initialText=this.renderedTune.abc=undefined;return true}if(g===this.initialText&&!d){this.updateSelection();return false}if(typeof c!=="undefined"){if(this.transposer){this.transposer.reset(c)}else{this.transposer=new ABCXJS.parse.Transposer(c)}}if(!this.abcParser){this.abcParser=new ABCXJS.parse.Parse(this.transposer,this.accordion)}try{this.abcParser.parse(g,this.parserparams);this.renderedTune.abc=this.abcParser.getTune();this.renderedTune.text=this.initialText=this.abcParser.getStrTune()}catch(f){waterbug.log("Could not parse ABC.");waterbug.show()}if(g!==this.initialText){this.setString(this.renderedTune.text)}if(this.transposer&&this.editorWindow.keySelector){this.editorWindow.keySelector.populate(this.transposer.keyToNumber(this.transposer.getKeyVoice(0)))}var b=this.abcParser.getWarnings()||[];for(var a=0;a<b.length;a++){this.warnings.push(b[a])}if(this.midiParser){this.midiParser.parse(this.renderedTune.abc,this.accordion.loadedKeyboard);this.midiPlayer.reset();this.midiPlayer.setAndamento(this.slider.getValue());var b=this.midiParser.getWarnings();for(var a=0;a<b.length;a++){this.warnings.push(b[a])}}return true};SITE.Estudio.prototype.onChange=function(){this.studioCanvasDiv.scrollTop=this.lastYpos;this.resize()};SITE.Estudio.prototype.fireChanged=function(b,a){if(this.changing){return}this.lastYpos=this.studioCanvasDiv.scrollTop||0;this.changing=true;var c=a||{};var d=c.force||false;var e=c.showProgress||false;if(this.parseABC(b,d)){this.modelChanged(e)}else{delete this.changing}};SITE.Estudio.prototype.modelChanged=function(c){var b=this;if(c){var a=this.mapa.startLoader("ModelChanged",b.studioCanvasDiv);a.start(function(){b.onModelChanged(a)},"<br>&nbsp;&nbsp;&nbsp;Gerando partitura...<br><br>")}else{b.onModelChanged()}};SITE.Estudio.prototype.onModelChanged=function(a){this.renderedTune.div.innerHTML="";this.renderedTune.div.style.display="none";if(this.renderedTune.abc===undefined){delete this.changing;return}this.renderedTune.div.style.display="";var b=new SVG.Printer(this.renderedTune.div);this.renderedTune.printer=new ABCXJS.write.Printer(b,this.printerparams,this.accordion.loadedKeyboard);this.renderedTune.printer.printTune(this.renderedTune.abc,this.parserparams);
if(this.warningsDiv){this.warningsDiv.style.color=this.warnings.length>0?"red":"green";this.warningsDiv.innerHTML=(this.warnings.length>0?this.warnings.join("<br/>"):"No warnings or errors.")}this.renderedTune.printer.addSelectListener(this);this.updateSelection();if(this.onchangeCallback){this.onchangeCallback(this)}if(a){a.update(false,"<br>&nbsp;&nbsp;&nbsp;Gerando tablatura...<br><br>");a.stop()}this.media.show(this.renderedTune);delete this.changing};SITE.Estudio.prototype.highlight=function(a){if(!this.midiPlayer.playing){if(SITE.properties.studio.keyboard.visible){this.accordion.clearKeyboard(true);this.midiParser.setSelection(a)}if(SITE.properties.studio.editor.visible){this.editorWindow.setSelection(a)}}};SITE.Estudio.prototype.unhighlight=function(a){if(SITE.properties.studio.editor.visible){this.editorWindow.clearSelection(a)}};SITE.Estudio.prototype.updateSelection=function(c){var b=this;if(c){var a=b.editorWindow.getSelection();try{b.renderedTune.printer.rangeHighlight(a)}catch(d){}delete this.updating}else{if(this.updating){return}this.updating=true;setTimeout(b.updateSelection(true),300)}};if(!window.SITE){window.SITE={}}SITE.PartGen=function(c,g){this.mapa=c;this.parserparams=c.parserparams;var d=this;this.Div=new DRAGGABLE.ui.Window(g.partGenDiv,["help"],{translator:SITE.translator,statusbar:false,draggable:false,top:"3px",left:"1px",width:"100%",height:"100%",title:"PartGenTitle"},{listener:this,method:"t2pCallback"});this.Div.setVisible(true);this.Div.dataDiv.style.overflow="hidden";this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);var f=(g.accordion_options.id==="GAITA_HOHNER_CLUB_IIIM_BR");var a=(g.accordion_options.id==="GAITA_MINUANO_GC");var b="t2pCanvasDiv";var e="t2pWarningsDiv";this.renderedTune={text:undefined,abc:undefined,title:undefined,tab:undefined,div:undefined,selector:undefined};this.tabParser=new ABCXJS.Tab2Part(f,a,this);if(g.generate_tablature){if(g.generate_tablature==="accordion"){this.accordion=new window.ABCXJS.tablature.Accordion(g.accordion_options,SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);if(g.accordionNameSpan){this.accordionNameSpan=document.getElementById(g.accordionNameSpan);this.accordionNameSpan.innerHTML=this.accordion.getFullName()}}else{throw new Error("Tablatura para "+g.generate_tablature+" não suportada!")}}this.editorWindow=new ABCXJS.edit.EditArea(this.Div.dataDiv,{listener:this,method:"editorCallback"},{draggable:SITE.properties.partGen.editor.floating,toolbar:true,statusbar:true,translator:SITE.translator,title:"PartGenEditorTitle",compileOnChange:false});this.editorWindow.setVisible(false);this.editorWindow.container.setButtonVisible("OCTAVEUP",false);this.editorWindow.container.setButtonVisible("OCTAVEDOWN",false);this.editorWindow.keySelector.setVisible(false);this.editorWindow.showHiddenChars(true);this.controlDiv=document.createElement("DIV");this.controlDiv.setAttribute("id","t2pcontrolDiv");this.controlDiv.setAttribute("class","controlDiv btn-group");this.Div.dataDiv.appendChild(this.controlDiv);this.controlDiv.innerHTML=document.getElementById(g.controlDiv).innerHTML;document.getElementById(g.controlDiv).innerHTML="";this.media=new SITE.Media(this.Div.dataDiv,g.btShowMedia,SITE.properties.partGen.media);this.keyboardWindow=new DRAGGABLE.ui.Window(this.Div.dataDiv,["move","rotate","zoom","globe"],{title:"",translator:SITE.translator,statusbar:false,top:SITE.properties.partGen.keyboard.top,left:SITE.properties.partGen.keyboard.left},{listener:this,method:"keyboardCallback"});this.accordion.setRenderOptions({draggable:true,show:false,transpose:SITE.properties.partGen.keyboard.transpose,mirror:SITE.properties.partGen.keyboard.mirror,scale:SITE.properties.partGen.keyboard.scale,label:SITE.properties.partGen.keyboard.label});this.warningsDiv=document.createElement("DIV");this.warningsDiv.setAttribute("id",e);this.warningsDiv.setAttribute("class","warningsDiv");this.Div.dataDiv.appendChild(this.warningsDiv);this.abcDiv=document.createElement("DIV");this.abcDiv.style.display=SITE.properties.partGen.showABCText?"":"none";this.ckShowABC=document.getElementById(g.ckShowABC);this.ckShowABC.checked=SITE.properties.partGen.showABCText;this.ckConvertToClub=document.getElementById(g.ckConvertToClub);this.convertToClub=document.getElementById("convertToClub");this.ckConvertFromClub=document.getElementById(g.ckConvertFromClub);this.convertFromClub=document.getElementById("convertFromClub");this.ckConvertToClub.checked=false;this.convertToClub.style.display=f?"inline":"none";this.ckConvertFromClub.checked=false;this.convertFromClub.style.display=a?"inline":"none";this.studioCanvasDiv=document.createElement("DIV");this.studioCanvasDiv.setAttribute("id","t2pStudioCanvasDiv");this.studioCanvasDiv.setAttribute("class","studioCanvasDiv");this.canvasDiv=document.createElement("DIV");this.canvasDiv.setAttribute("id",b);this.canvasDiv.setAttribute("class","canvasDiv");this.studioCanvasDiv.appendChild(this.abcDiv);this.studioCanvasDiv.appendChild(this.canvasDiv);this.renderedTune.div=this.canvasDiv;this.Div.dataDiv.appendChild(this.studioCanvasDiv);if(this.ps){this.ps.destroy()}this.ps=new PerfectScrollbar(this.studioCanvasDiv,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});this.showMapButton=document.getElementById(g.showMapBtn);this.fileLoadTab=document.getElementById("fileLoadTab");this.fileLoadTab.addEventListener("change",function(h){d.carregaTablatura(h)},false);this.showEditorButton=document.getElementById(g.showEditorBtn);this.updateButton=document.getElementById(g.updateBtn);this.loadButton=document.getElementById(g.loadBtn);this.saveButton=document.getElementById(g.saveBtn);this.editPartButton=document.getElementById(g.editPartBtn);this.savePartButton=document.getElementById(g.savePartBtn);this.gotoMeasureButton=document.getElementById(g.gotoMeasureBtn);this.playButton=document.getElementById(g.playBtn);this.stopButton=document.getElementById(g.stopBtn);this.currentPlayTimeLabel=document.getElementById(g.currentPlayTimeLabel);this.gotoMeasureButton.addEventListener("keypress",function(h){if(h.keyCode===13){d.startPlay("repeat",this.value,200)}},false);this.gotoMeasureButton.addEventListener("focus",function(h){if(this.value===SITE.translator.getResource("gotoMeasure").val){this.value=""}},false);this.gotoMeasureButton.addEventListener("blur",function(h){if(this.value===""){this.value=SITE.translator.getResource("gotoMeasure").val}},false);this.showEditorButton.addEventListener("click",function(h){h.preventDefault();this.blur();d.showEditor()},false);this.showMapButton.addEventListener("click",function(h){h.preventDefault();this.blur();d.showKeyboard()},false);this.ckConvertToClub.addEventListener("click",function(){SITE.properties.partGen.convertToClub=!!this.checked;d.fireChanged()},false);this.ckConvertFromClub.addEventListener("click",function(){SITE.properties.partGen.convertFromClub=!!this.checked;
d.fireChanged()},false);this.ckShowABC.addEventListener("click",function(){SITE.properties.partGen.showABCText=!!this.checked;d.abcDiv.style.display=this.checked?"":"none"},false);this.updateButton.addEventListener("click",function(){d.fireChanged()},false);this.loadButton.addEventListener("click",function(){d.fileLoadTab.click()},false);this.saveButton.addEventListener("click",function(){d.salvaTablatura()},false);this.editPartButton.addEventListener("click",function(){var h=d.renderedTune.text;if(h!==""){d.setVisible(false);SITE.SaveProperties();FILEMANAGER.saveLocal("ultimaPartituraEditada",h);d.mapa.menu.dispatchAction("menuRepertorio","ABC2PART")}},false);this.savePartButton.addEventListener("click",function(){d.salvaPartitura()},false);this.playerCallBackOnScroll=function(h){d.setScrolling(h)};this.playerCallBackOnPlay=function(h){var i=h.getTime().cTime;if(d.gotoMeasureButton){d.gotoMeasureButton.value=h.currentMeasure}if(d.currentPlayTimeLabel){d.currentPlayTimeLabel.innerHTML=i}};this.playerCallBackOnEnd=function(i){var j=d.midiPlayer.getWarnings();d.playButton.title=SITE.translator.getResource("playBtn");d.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';d.renderedTune.printer.clearSelection();d.blockEdition(false);if(j){var h="";j.forEach(function(k){h+=k+"<br>"});d.warningsDiv.style.color="blue";d.warningsDiv.innerHTML="<hr>"+h+"<hr>"}};this.playButton.addEventListener("click",function(){window.setTimeout(function(){d.startPlay("normal")},0)},false);this.stopButton.addEventListener("click",function(h){h.preventDefault();this.blur();d.blockEdition(false);if(d.currentPlayTimeLabel){d.gotoMeasureButton.value=SITE.translator.getResource("gotoMeasure").val}d.currentPlayTimeLabel.innerHTML="00:00";d.midiPlayer.stopPlay()},false);this.midiPlayer.defineCallbackOnPlay(d.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(d.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(d.playerCallBackOnScroll)};SITE.PartGen.prototype.setup=function(b){this.mapa.closeMapa();this.accordion.loadById(b.accordionId);var d=(b.accordionId==="GAITA_HOHNER_CLUB_IIIM_BR");var a=(b.accordionId==="GAITA_MINUANO_GC");this.convertToClub.style.display=d?"inline":"none";this.convertFromClub.style.display=a?"inline":"none";this.setVisible(true);if(this.editorWindow.getString()===""){var c=FILEMANAGER.loadLocal("ultimaTablaturaEditada");if(!c){c=this.getDemoText()}this.editorWindow.setString(c)}this.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none";this.fireChanged();this.editorWindow.restartUndoManager();this.Div.setSubTitle("- "+this.accordion.getTxtModel());this.showEditor(SITE.properties.partGen.editor.visible);if(SITE.properties.partGen.editor.floating){if(SITE.properties.partGen.editor.maximized){this.editorWindow.container.dispatchAction("MAXIMIZE")}else{this.editorWindow.container.dispatchAction("POPOUT")}}else{this.editorWindow.container.dispatchAction("POPIN")}this.showKeyboard(SITE.properties.partGen.keyboard.visible);this.keyboardWindow.setTitle(this.accordion.getTxtTuning()+" - "+this.accordion.getTxtNumButtons());this.resize()};SITE.PartGen.prototype.resize=function(){var i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var f=(i-78-10);var a=(d-8);this.Div.topDiv.style.left="3px";this.Div.topDiv.style.top="82px";this.Div.topDiv.style.height=Math.max(f,200)+"px";this.Div.topDiv.style.width=Math.max(a,400)+"px";var a=0,g=0;var j=this.controlDiv.clientHeight;var b=this.Div.dataDiv.clientHeight;if(!SITE.properties.showWarnings){a=this.warningsDiv.clientHeight}if(!SITE.properties.partGen.editor.floating){g=this.editorWindow.container.topDiv.clientHeight+4}this.studioCanvasDiv.style.height=b-(a+g+j+6)+"px";this.posicionaTeclado();this.editorWindow.resize();(this.ps)&&this.ps.update()};SITE.PartGen.prototype.posicionaTeclado=function(){if(!SITE.properties.partGen.keyboard.visible){return}var b=window.innerWidth;var c=this.keyboardWindow.topDiv;var a=parseInt(c.style.left.replace("px",""));if(a+c.offsetWidth>b){a=(b-(c.offsetWidth+50))}if(a<0){a=10}c.style.left=a+"px"};SITE.PartGen.prototype.closePartGen=function(b){var a=this;var c=a.editorWindow.getString();a.setVisible(false);a.editorWindow.setString("");a.midiPlayer.stopPlay();(b)&&SITE.SaveProperties();if(c!==""){FILEMANAGER.saveLocal("ultimaTablaturaEditada",c)}a.mapa.openMapa()};SITE.PartGen.prototype.showEditor=function(a){SITE.properties.partGen.editor.visible=(typeof a==="undefined"?!SITE.properties.partGen.editor.visible:a);if(SITE.properties.partGen.editor.visible){this.editorWindow.setVisible(true);document.getElementById("t2pI_showEditor").setAttribute("class","ico-folder-open")}else{document.getElementById("t2pI_showEditor").setAttribute("class","ico-folder");this.editorWindow.setVisible(false)}this.resize()};SITE.PartGen.prototype.showKeyboard=function(a){SITE.properties.partGen.keyboard.visible=(typeof a==="undefined"?!SITE.properties.partGen.keyboard.visible:a);this.accordion.render_opts.show=SITE.properties.partGen.keyboard.visible;if(SITE.properties.partGen.keyboard.visible){this.keyboardWindow.setVisible(true);this.accordion.printKeyboard(this.keyboardWindow.dataDiv);document.getElementById("t2pI_showMap").setAttribute("class","ico-folder-open");this.posicionaTeclado()}else{this.accordion.render_opts.show=false;this.keyboardWindow.setVisible(false);document.getElementById("t2pI_showMap").setAttribute("class","ico-folder")}};SITE.PartGen.prototype.editorCallback=function(b,a){switch(b){case"REFRESH":this.fireChanged();break;case"DOWNLOAD":this.salvaTablatura();break;case"MAXIMIZE":this.editorWindow.maximizeWindow(true,SITE.properties.partGen.editor);break;case"RESTORE":this.editorWindow.maximizeWindow(false,SITE.properties.partGen.editor);break;case"POPIN":this.editorWindow.dockWindow(true,SITE.properties.partGen.editor,0,0,"calc(100% - 5px)","200px");this.resize();break;case"POPOUT":this.editorWindow.dockWindow(false,SITE.properties.partGen.editor);this.resize();break;case"RESIZE":case"MOVE":this.editorWindow.retrieveProps(SITE.properties.partGen.editor);break;case"CLOSE":this.showEditor(false);break}};SITE.PartGen.prototype.t2pCallback=function(a){switch(a){case"CLOSE":this.closePartGen(true);break;case"HELP":this.mapa.showHelp("HelpTitle","PartGenTitle","/html/geradorPartitura.pt_BR.html",{width:"1024",height:"600"})}};SITE.PartGen.prototype.setVisible=function(a){this.Div.parent.style.display=a?"block":"none"};SITE.PartGen.prototype.fireChanged=function(){var a=this.editorWindow.getString();if(a!==""){FILEMANAGER.saveLocal("ultimaTablaturaEditada",a);this.renderedTune.text=this.tabParser.parse(a,this.accordion.loadedKeyboard,this.ckConvertToClub.checked,this.ckConvertFromClub.checked);this.printABC()}else{this.editorWindow.container.setSubTitle("");this.warningsDiv.innerHTML="";this.abcDiv.innerHTML="";this.renderedTune.div.innerHTML="";
delete this.renderedTune.abc.midi}this.resize()};SITE.PartGen.prototype.printABC=function(){this.abcDiv.innerHTML=this.renderedTune.text.replace(/\n/g,"<br>");var a=this.tabParser.getWarnings();if(a){this.warningsDiv.innerHTML=a;this.warningsDiv.style.color="red"}else{this.warningsDiv.innerHTML="Partitura gerada com sucesso!";this.warningsDiv.style.color="green"}this.parseABC();this.renderedTune.printer=new ABCXJS.write.Printer(new SVG.Printer(this.renderedTune.div),{},this.accordion.loadedKeyboard);this.renderedTune.printer.printABC(this.renderedTune.abc);this.renderedTune.printer.addSelectListener(this);this.media.show(this.renderedTune)};SITE.PartGen.prototype.parseABC=function(){var a=null;var b=new ABCXJS.parse.Parse(a,this.accordion);b.parse(this.renderedTune.text,this.parserparams);this.renderedTune.abc=b.getTune();this.renderedTune.title=this.renderedTune.abc.metaText.title;if(this.renderedTune.title){this.editorWindow.container.setSubTitle("- "+this.renderedTune.abc.metaText.title);if(!this.GApartGen||this.GApartGen!==this.renderedTune.abc.metaText.title){this.GApartGen=this.renderedTune.abc.metaText.title;SITE.ga("event","page_view",{page_title:this.GApartGen,page_path:SITE.root+"/tab2part"})}}else{this.editorWindow.container.setSubTitle("")}if(this.midiParser){this.midiParser.parse(this.renderedTune.abc,this.accordion.loadedKeyboard)}};SITE.PartGen.prototype.keyboardCallback=function(b){switch(b){case"MOVE":var a=this.keyboardWindow.topDiv.style;SITE.properties.partEdit.keyboard.left=a.left;SITE.properties.partEdit.keyboard.top=a.top;break;case"ROTATE":this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);SITE.properties.partEdit.keyboard.transpose=this.accordion.render_opts.transpose;SITE.properties.partEdit.keyboard.mirror=this.accordion.render_opts.mirror;break;case"ZOOM":this.accordion.scaleKeyboard(this.keyboardWindow.dataDiv);SITE.properties.partEdit.keyboard.scale=this.accordion.render_opts.scale;break;case"GLOBE":this.accordion.changeNotation();SITE.properties.partEdit.keyboard.label=this.accordion.render_opts.label;break;case"CLOSE":this.showKeyboard(false);break}};SITE.PartGen.prototype.highlight=function(a){};SITE.PartGen.prototype.unhighlight=function(a){if(SITE.properties.partGen.editor.visible){this.editorWindow.clearSelection(a)}};SITE.PartGen.prototype.updateSelection=function(a){return};SITE.PartGen.prototype.salvaPartitura=function(){if(FILEMANAGER.requiredFeaturesAvailable()){var a=this.renderedTune.abc.metaText.title+".abcx";var b=this.renderedTune.text;FILEMANAGER.download(a,b)}else{alert(SITE.translator.getResource("err_saving"))}};SITE.PartGen.prototype.salvaTablatura=function(){if(FILEMANAGER.requiredFeaturesAvailable()){var a=this.renderedTune.abc.metaText.title+".tab";var b=this.editorWindow.getString();FILEMANAGER.download(a,b)}else{alert(SITE.translator.getResource("err_saving"))}};SITE.PartGen.prototype.carregaTablatura=function(a){var b=this;FILEMANAGER.loadLocalFiles(a,function(){b.doCarregaTablatura(FILEMANAGER.files);a.target.value=""})};SITE.PartGen.prototype.doCarregaTablatura=function(a){this.editorWindow.setString(a[0].content);this.fireChanged()};SITE.PartGen.prototype.blockEdition=function(a){this.editorWindow.setReadOnly(!a);this.editorWindow.container.dispatchAction("READONLY");if(a){this.editorWindow.setEditorHighLightStyle()}else{this.editorWindow.clearEditorHighLightStyle();this.editorWindow.aceEditor.focus()}};SITE.PartGen.prototype.startPlay=function(b,c,a){this.ypos=this.studioCanvasDiv.scrollTop;this.lastStaffGroup=-1;if(this.midiPlayer.playing){if(b==="normal"){this.playButton.title=SITE.translator.getResource("playBtn");this.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}this.blockEdition(false)}else{this.accordion.clearKeyboard();if(b==="normal"){this.blockEdition(true);if(this.midiPlayer.startPlay(this.renderedTune.abc.midi)){this.playButton.title=SITE.translator.getResource("pause");this.playButton.innerHTML='&#160;<i class="ico-pause"></i>&#160;'}}else{if(this.midiPlayer.startDidacticPlay(this.renderedTune.abc.midi,b,c,a)){}}}};SITE.PartGen.prototype.setScrolling=function(c){if(!this.studioCanvasDiv||c.currAbsElem.staffGroup===this.lastStaffGroup){return}this.lastStaffGroup=c.currAbsElem.staffGroup;var e=c.printer.staffgroups[0].top;var b=this.studioCanvasDiv.clientHeight-e;var d=c.printer.staffgroups[c.currAbsElem.staffGroup].top-12;var a=d+c.printer.staffgroups[c.currAbsElem.staffGroup].height;if(a>b+this.ypos||this.ypos>d-e){this.ypos=d;this.studioCanvasDiv.scrollTop=this.ypos}};SITE.PartGen.prototype.getDemoText=function(){return"%hidefingering\nT:Hino do Grêmio\nC:Lupicínio Rodrigues\nC:(adapt. Cezar Ferreira)\nL:1/8\nQ:140\nM:4/4\nK:C\n|: C c       C  c       | G  g  G g | C c       C  c       | G  g G g       |\n|: 9 7'. 8   6' 8.  7'  |           | 9 7'. 8   6' 8.  7'  |                |\n|:                      | 7' 5'   z |                      | 7'   z 9.  8'  |\n+  2 1.5 0.5 2  1.5 0.5   2  2  2 2   2 1.5 0.5 2  1.5 0.5   2  2 2 1.5 0.5\nf: 5 3   4   2  4   3     3  2    *   5 3   4   2  4   3     3      3   2\n\n|  C  z   z   A  z   z   | F   f  F f       | C  g       G  g       | C  c C c :|\n|  8'                    |                  | 8'                    | 6'     z :|\n|     10. 9'  11 9'. 11  | 10' 11 z 9.  8'  |    11. 9'  7' 8'. 9   |          :|\n+  2  1.5 0.5 2  1.5 0.5   2   2  2 1.5 0.5   2  1.5 0.5 2  1.5 0.5   2  2 2 2\nf: 2  4   3   5  3   5     4   5  * 2   3     2  5   3   2  3   4     2\n"};if(!window.SITE){window.SITE={}}SITE.PartEdit=function(b,e){this.mapa=b;this.parserparams=b.parserparams;var c=this;this.Div=new DRAGGABLE.ui.Window(e.partEditDiv,["help"],{translator:SITE.translator,statusbar:false,draggable:false,top:"3px",left:"1px",width:"100%",height:"100%",title:"PartEditTitle"},{listener:this,method:"a2pCallback"});this.Div.setVisible(true);this.Div.dataDiv.style.overflow="hidden";this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);var a="a2pCanvasDiv";var d="a2pWarningsDiv";this.renderedTune={text:undefined,abc:undefined,title:undefined,tab:undefined,div:undefined,selector:undefined};if(e.generate_tablature){if(e.generate_tablature==="accordion"){this.accordion=new window.ABCXJS.tablature.Accordion(e.accordion_options,SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);if(e.accordionNameSpan){this.accordionNameSpan=document.getElementById(e.accordionNameSpan);this.accordionNameSpan.innerHTML=this.accordion.getFullName()}}else{throw new Error("Tablatura para "+e.generate_tablature+" não suportada!")}}this.editorWindow=new ABCXJS.edit.EditArea(this.Div.dataDiv,{listener:this,method:"editorCallback"},{draggable:SITE.properties.partEdit.editor.floating,toolbar:true,statusbar:true,translator:SITE.translator,title:"PartEditEditorTitle",compileOnChange:false});this.editorWindow.setVisible(false);this.controlDiv=document.createElement("DIV");
this.controlDiv.setAttribute("id","a2pcontrolDiv");this.controlDiv.setAttribute("class","controlDiv btn-group");this.Div.dataDiv.appendChild(this.controlDiv);this.controlDiv.innerHTML=document.getElementById(e.controlDiv).innerHTML;document.getElementById(e.controlDiv).innerHTML="";this.media=new SITE.Media(this.Div.dataDiv,e.btShowMedia,SITE.properties.partEdit.media);this.keyboardWindow=new DRAGGABLE.ui.Window(this.Div.dataDiv,["move","rotate","zoom","globe"],{title:"",translator:SITE.translator,statusbar:false,top:SITE.properties.partEdit.keyboard.top,left:SITE.properties.partEdit.keyboard.left},{listener:this,method:"keyboardCallback"});this.accordion.setRenderOptions({draggable:true,show:SITE.properties.partEdit.keyboard.visible,transpose:SITE.properties.partEdit.keyboard.transpose,mirror:SITE.properties.partEdit.keyboard.mirror,scale:SITE.properties.partEdit.keyboard.scale,label:SITE.properties.partEdit.keyboard.label});this.warningsDiv=document.createElement("DIV");this.warningsDiv.setAttribute("id",d);this.warningsDiv.setAttribute("class","warningsDiv");this.Div.dataDiv.appendChild(this.warningsDiv);this.studioCanvasDiv=document.createElement("DIV");this.studioCanvasDiv.setAttribute("id","a2pStudioCanvasDiv");this.studioCanvasDiv.setAttribute("class","studioCanvasDiv");this.canvasDiv=document.createElement("DIV");this.canvasDiv.setAttribute("id",a);this.canvasDiv.setAttribute("class","canvasDiv");this.studioCanvasDiv.appendChild(this.canvasDiv);this.renderedTune.div=this.canvasDiv;this.Div.dataDiv.appendChild(this.studioCanvasDiv);if(this.ps){this.ps.destroy()}this.ps=new PerfectScrollbar(this.studioCanvasDiv,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});this.fileLoadABC=document.getElementById("fileLoadABC");this.fileLoadABC.addEventListener("change",function(f){c.carregaPartitura(f)},false);this.showEditorButton=document.getElementById(e.showEditorBtn);this.showMapButton=document.getElementById(e.showMapBtn);this.updateButton=document.getElementById(e.updateBtn);this.loadButton=document.getElementById(e.loadBtn);this.saveButton=document.getElementById(e.saveBtn);this.printButton=document.getElementById(e.printBtn);this.playButton=document.getElementById(e.playBtn);this.stopButton=document.getElementById(e.stopBtn);this.currentPlayTimeLabel=document.getElementById(e.currentPlayTimeLabel);this.showEditorButton.addEventListener("click",function(f){f.preventDefault();this.blur();c.showEditor()},false);this.showMapButton.addEventListener("click",function(f){f.preventDefault();this.blur();c.showKeyboard()},false);this.updateButton.addEventListener("click",function(){c.fireChanged()},false);this.loadButton.addEventListener("click",function(){c.fileLoadABC.click()},false);this.saveButton.addEventListener("click",function(){c.salvaPartitura()},false);this.printButton.addEventListener("click",function(f){f.preventDefault();this.blur();c.mapa.printPreview(c.renderedTune.div.innerHTML,["#topBar","#mapaDiv","#partEditDiv"],c.renderedTune.abc.formatting.landscape)},false);this.playerCallBackOnScroll=function(f){c.setScrolling(f)};this.playerCallBackOnPlay=function(f){var g=f.getTime().cTime;if(c.gotoMeasureButton){c.gotoMeasureButton.value=f.currentMeasure}if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML=g}};this.playerCallBackOnEnd=function(g){var h=c.midiPlayer.getWarnings();c.playButton.title=SITE.translator.getResource("playBtn");c.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';c.renderedTune.printer.clearSelection();c.accordion.clearKeyboard(true);c.blockEdition(false);if(h){var f="";h.forEach(function(i){f+=i+"<br>"});c.warningsDiv.style.color="blue";c.warningsDiv.innerHTML="<hr>"+f+"<hr>"}};this.playButton.addEventListener("click",function(){window.setTimeout(function(){c.startPlay("normal")},0)},false);this.stopButton.addEventListener("click",function(f){f.preventDefault();this.blur();c.blockEdition(false);if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML="00:00"}c.midiPlayer.stopPlay()},false);this.midiPlayer.defineCallbackOnPlay(c.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(c.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(c.playerCallBackOnScroll)};SITE.PartEdit.prototype.setup=function(a){this.mapa.closeMapa();this.accordion.loadById(a.accordionId);this.setVisible(true);if(this.editorWindow.getString()===""){var b=FILEMANAGER.loadLocal("ultimaPartituraEditada");if(!b){b=this.getDemoText()}this.editorWindow.setString(b)}this.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none";this.fireChanged();this.editorWindow.restartUndoManager();this.Div.setSubTitle("- "+this.accordion.getTxtModel());this.showEditor(SITE.properties.partEdit.editor.visible);if(SITE.properties.partEdit.editor.floating){if(SITE.properties.partEdit.editor.maximized){this.editorWindow.container.dispatchAction("MAXIMIZE")}else{this.editorWindow.container.dispatchAction("POPOUT")}}else{this.editorWindow.container.dispatchAction("POPIN")}this.showKeyboard(SITE.properties.partEdit.keyboard.visible);this.keyboardWindow.setTitle(this.accordion.getTxtTuning()+" - "+this.accordion.getTxtNumButtons());this.resize()};SITE.PartEdit.prototype.resize=function(){var i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var d=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var f=(i-78-10);var a=(d-8);this.Div.topDiv.style.left="3px";this.Div.topDiv.style.top="82px";this.Div.topDiv.style.height=Math.max(f,200)+"px";this.Div.topDiv.style.width=Math.max(a,400)+"px";var a=0,g=0;var j=this.controlDiv.clientHeight;var b=this.Div.dataDiv.clientHeight;if(!SITE.properties.showWarnings){a=this.warningsDiv.clientHeight}if(!SITE.properties.partEdit.editor.floating){g=this.editorWindow.container.topDiv.clientHeight+4}this.studioCanvasDiv.style.height=b-(a+g+j+6)+"px";this.posicionaTeclado();this.editorWindow.resize();(this.ps)&&this.ps.update()};SITE.PartEdit.prototype.posicionaTeclado=function(){if(!SITE.properties.partEdit.keyboard.visible){return}var b=window.innerWidth;var c=this.keyboardWindow.topDiv;var a=parseInt(c.style.left.replace("px",""));if(a+c.offsetWidth>b){a=(b-(c.offsetWidth+50))}if(a<0){a=10}c.style.left=a+"px"};SITE.PartEdit.prototype.closePartEdit=function(b){var a=this;var c=a.editorWindow.getString();a.setVisible(false);a.editorWindow.setString("");a.midiPlayer.stopPlay();(b)&&SITE.SaveProperties();if(c!==""){FILEMANAGER.saveLocal("ultimaPartituraEditada",c)}a.mapa.openMapa()};SITE.PartEdit.prototype.showEditor=function(a){SITE.properties.partEdit.editor.visible=(typeof a==="undefined"?!SITE.properties.partEdit.editor.visible:a);if(SITE.properties.partEdit.editor.visible){this.editorWindow.setVisible(true);document.getElementById("a2pI_showEditor").setAttribute("class","ico-folder-open")}else{document.getElementById("a2pI_showEditor").setAttribute("class","ico-folder");
this.editorWindow.setVisible(false)}this.resize()};SITE.PartEdit.prototype.showKeyboard=function(a){SITE.properties.partEdit.keyboard.visible=(typeof a==="undefined"?!SITE.properties.partEdit.keyboard.visible:a);this.accordion.render_opts.show=SITE.properties.partEdit.keyboard.visible;if(SITE.properties.partEdit.keyboard.visible){this.keyboardWindow.setVisible(true);this.accordion.printKeyboard(this.keyboardWindow.dataDiv);document.getElementById("a2pI_showMap").setAttribute("class","ico-folder-open");this.posicionaTeclado()}else{this.accordion.render_opts.show=false;this.keyboardWindow.setVisible(false);document.getElementById("a2pI_showMap").setAttribute("class","ico-folder")}};SITE.PartEdit.prototype.editorCallback=function(b,a){switch(b){case"0":break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"10":case"11":case"-1":case"-2":case"-3":case"-4":case"-5":case"-6":case"-7":case"-8":case"-9":case"-10":case"-11":this.fireChanged(parseInt(b),{force:true});break;case"OCTAVEUP":this.fireChanged(12,{force:true});break;case"OCTAVEDOWN":this.fireChanged(-12,{force:true});break;case"REFRESH":this.fireChanged();break;case"DOWNLOAD":this.salvaPartitura();break;case"MAXIMIZE":this.editorWindow.maximizeWindow(true,SITE.properties.partEdit.editor);break;case"RESTORE":this.editorWindow.maximizeWindow(false,SITE.properties.partEdit.editor);break;case"POPIN":this.editorWindow.dockWindow(true,SITE.properties.partEdit.editor,0,0,"calc(100% - 5px)","200px");this.resize();break;case"POPOUT":this.editorWindow.dockWindow(false,SITE.properties.partEdit.editor);this.resize();break;case"RESIZE":case"MOVE":this.editorWindow.retrieveProps(SITE.properties.partEdit.editor);break;case"CLOSE":this.showEditor(false);break}};SITE.PartEdit.prototype.a2pCallback=function(a){switch(a){case"CLOSE":this.closePartEdit(true);break;case"HELP":alert("Not implemented yet!")}};SITE.PartEdit.prototype.setVisible=function(a){this.Div.parent.style.display=a?"block":"none"};SITE.PartEdit.prototype.fireChanged=function(a){var b=this.editorWindow.getString();if(b!==""){FILEMANAGER.saveLocal("ultimaPartituraEditada",b);this.parseABC(b,a);this.printABC()}else{this.editorWindow.container.setSubTitle("");this.warningsDiv.innerHTML="";this.renderedTune.div.innerHTML="";delete this.renderedTune.abc.midi}this.resize()};SITE.PartEdit.prototype.parseABC=function(g,c){c=c||0;var a=new ABCXJS.parse.Transposer(c);var f=new ABCXJS.parse.Parse(a,this.accordion);try{f.parse(g,this.parserparams);this.renderedTune.text=f.getStrTune();if(this.renderedTune.text!==g){this.editorWindow.setString(this.renderedTune.text)}}catch(d){waterbug.log("Could not parse ABC.");waterbug.show()}this.renderedTune.abc=f.getTune();this.renderedTune.title=this.renderedTune.abc.metaText.title;if(this.editorWindow.keySelector){this.editorWindow.keySelector.populate(a.keyToNumber(a.getKeyVoice(0)))}var b=f.getWarnings()||[];if(this.renderedTune.title){this.editorWindow.container.setSubTitle("- "+this.renderedTune.abc.metaText.title);if(!this.GApartEdit||this.GApartEdit!==this.renderedTune.abc.metaText.title){this.GApartEdit=this.renderedTune.abc.metaText.title;SITE.ga("event","page_view",{page_title:this.GApartEdit,page_path:SITE.root+"/abc2part"})}}else{this.editorWindow.container.setSubTitle("")}if(this.midiParser){this.midiParser.parse(this.renderedTune.abc,this.accordion.loadedKeyboard);b=b.concat(this.midiParser.getWarnings())}if(b.length>0){this.warningsDiv.innerHTML=b.join("<br>");this.warningsDiv.style.color="red"}else{this.warningsDiv.innerHTML="Partitura gerada com sucesso!";this.warningsDiv.style.color="green"}};SITE.PartEdit.prototype.printABC=function(){this.renderedTune.div.innerHTML="";this.renderedTune.printer=new ABCXJS.write.Printer(new SVG.Printer(this.renderedTune.div),{},this.accordion.loadedKeyboard);this.renderedTune.printer.printABC(this.renderedTune.abc);this.renderedTune.printer.addSelectListener(this);this.media.show(this.renderedTune)};SITE.PartEdit.prototype.highlight=function(a){if(!this.midiPlayer.playing){if(SITE.properties.partEdit.keyboard.visible){this.accordion.clearKeyboard(true);this.midiParser.setSelection(a)}if(SITE.properties.partEdit.editor.visible){this.editorWindow.setSelection(a)}}};SITE.PartEdit.prototype.unhighlight=function(a){if(SITE.properties.partEdit.editor.visible){this.editorWindow.clearSelection(a)}};SITE.PartEdit.prototype.updateSelection=function(c){var b=this;if(c){var a=b.editorWindow.getSelection();try{b.renderedTune.printer.rangeHighlight(a)}catch(d){}delete this.updating}else{if(this.updating){return}this.updating=true;setTimeout(b.updateSelection(true),300)}};SITE.PartEdit.prototype.keyboardCallback=function(b){switch(b){case"MOVE":var a=this.keyboardWindow.topDiv.style;SITE.properties.partEdit.keyboard.left=a.left;SITE.properties.partEdit.keyboard.top=a.top;break;case"ROTATE":this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);SITE.properties.partEdit.keyboard.transpose=this.accordion.render_opts.transpose;SITE.properties.partEdit.keyboard.mirror=this.accordion.render_opts.mirror;break;case"ZOOM":this.accordion.scaleKeyboard(this.keyboardWindow.dataDiv);SITE.properties.partEdit.keyboard.scale=this.accordion.render_opts.scale;break;case"GLOBE":this.accordion.changeNotation();SITE.properties.partEdit.keyboard.label=this.accordion.render_opts.label;break;case"CLOSE":this.showKeyboard(false);break}};SITE.PartEdit.prototype.salvaPartitura=function(){if(FILEMANAGER.requiredFeaturesAvailable()){var a=this.renderedTune.abc.metaText.title+".abcx";var b=this.renderedTune.text;FILEMANAGER.download(a,b)}else{alert(SITE.translator.getResource("err_saving"))}};SITE.PartEdit.prototype.carregaPartitura=function(a){var b=this;FILEMANAGER.loadLocalFiles(a,function(){b.doCarregaPartitura(FILEMANAGER.files);a.target.value=""})};SITE.PartEdit.prototype.doCarregaPartitura=function(a){this.editorWindow.setString(a[0].content);this.fireChanged()};SITE.PartEdit.prototype.blockEdition=function(a){this.editorWindow.setReadOnly(!a);this.editorWindow.container.dispatchAction("READONLY");if(a){this.editorWindow.setEditorHighLightStyle()}else{this.editorWindow.clearEditorHighLightStyle();this.editorWindow.aceEditor.focus()}};SITE.PartEdit.prototype.startPlay=function(a,b){this.ypos=this.studioCanvasDiv.scrollTop;this.lastStaffGroup=-1;if(this.midiPlayer.playing){if(a==="normal"){this.playButton.title=SITE.translator.getResource("playBtn");this.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}this.blockEdition(false)}else{this.accordion.clearKeyboard();if(a==="normal"){this.blockEdition(true);if(this.midiPlayer.startPlay(this.renderedTune.abc.midi)){this.playButton.title=SITE.translator.getResource("pause");this.playButton.innerHTML='&#160;<i class="ico-pause"></i>&#160;'}}else{if(this.midiPlayer.startDidacticPlay(this.renderedTune.abc.midi,a,b)){}}}};SITE.PartEdit.prototype.setScrolling=function(c){if(!this.studioCanvasDiv||c.currAbsElem.staffGroup===this.lastStaffGroup){return
}this.lastStaffGroup=c.currAbsElem.staffGroup;var e=c.printer.staffgroups[0].top;var b=this.studioCanvasDiv.clientHeight-e;var d=c.printer.staffgroups[c.currAbsElem.staffGroup].top-12;var a=d+c.printer.staffgroups[c.currAbsElem.staffGroup].height;if(a>b+this.ypos||this.ypos>d-e){this.ypos=d;this.studioCanvasDiv.scrollTop=this.ypos}};SITE.PartEdit.prototype.getDemoText=function(){return'X: 1\nT:Oh! Susannah\nF:/images/susannah.tablatura.png\nM:2/4\nL:1/4\nQ:100\nK:G\nV:melodia treble\n|"C"c c|e/2e/2 -e/2e/2|"G"d/2d/2 B/2G/2|"D7"A3/2G/4A/4|\\\n"G"B/2d/2 d3/4e/4|d/2B/2 G/2A/2|"G"B/2B/2 "D7"A/2A/2|"G"G2 |\nV:baixos bass\n| C, [C,E,G,] | C, z | G,, z | D, z | G,, z | G,, z | D, [D,^F,A,] | G,, z |\nV:tablatura accordionTab'};if(!window.SITE){window.SITE={}}SITE.TabGen=function(a,d){var b=this;this.mapa=a;this.accordion=a.accordion;this.parserparams=a.parserparams;var c="p2tWarningsDiv";this.Div=new DRAGGABLE.ui.Window(d.tabGenDiv,null,{translator:SITE.translator,statusbar:false,draggable:false,top:"3px",left:"1px",width:"100%",height:"100%",title:"TabGenTitle"},{listener:this,method:"p2tCallback"});this.Div.setVisible(true);this.Div.dataDiv.style.overflow="hidden";this.controlDiv=document.createElement("DIV");this.controlDiv.setAttribute("id","p2tcontrolDiv");this.controlDiv.setAttribute("class","controlDiv btn-group");this.Div.dataDiv.appendChild(this.controlDiv);this.controlDiv.innerHTML=document.getElementById(d.controlDiv).innerHTML;document.getElementById(d.controlDiv).innerHTML="";this.warningsDiv=document.createElement("DIV");this.warningsDiv.setAttribute("id",c);this.warningsDiv.setAttribute("class","warningsDiv");this.Div.dataDiv.appendChild(this.warningsDiv);this.abcEditorDiv=document.createElement("DIV");this.Div.dataDiv.appendChild(this.abcEditorDiv);this.tabEditorDiv=document.createElement("DIV");this.Div.dataDiv.appendChild(this.tabEditorDiv);this.tabParser=new ABCXJS.Part2Tab();this.abcEditorWindow=new ABCXJS.edit.EditArea(this.abcEditorDiv,{listener:this,method:"abcEditorCallback"},{draggable:SITE.properties.tabGen.abcEditor.floating,toolbar:true,statusbar:true,translator:SITE.translator,title:"TabGenSourceEditorTitle",compileOnChange:false});this.abcEditorWindow.setVisible(true);this.abcEditorWindow.container.setButtonVisible("CLOSE",false);this.abcEditorWindow.container.setButtonVisible("DOWNLOAD",false);this.abcEditorWindow.container.setButtonVisible("OCTAVEUP",false);this.abcEditorWindow.container.setButtonVisible("OCTAVEDOWN",false);this.abcEditorWindow.keySelector.setVisible(false);this.tabEditorWindow=new ABCXJS.edit.EditArea(this.tabEditorDiv,{listener:this,method:"tabEditorCallback"},{draggable:SITE.properties.tabGen.tabEditor.floating,toolbar:true,statusbar:true,translator:SITE.translator,title:"TabGenTargetEditorTitle",compileOnChange:false});this.tabEditorWindow.setVisible(true);this.tabEditorWindow.container.setButtonVisible("CLOSE",false);this.tabEditorWindow.container.setButtonVisible("DOWNLOAD",false);this.tabEditorWindow.container.setButtonVisible("OCTAVEUP",false);this.tabEditorWindow.container.setButtonVisible("OCTAVEDOWN",false);this.tabEditorWindow.container.setButtonVisible("REFRESH",false);this.tabEditorWindow.keySelector.setVisible(false);this.updateButton=document.getElementById(d.updateBtn);this.openButton=document.getElementById(d.openBtn);this.saveButton=document.getElementById(d.saveBtn);this.updateButton.addEventListener("click",function(){b.fireChanged()},false);this.saveButton.addEventListener("click",function(){b.salvaTablatura()},false);this.openButton.addEventListener("click",function(){var e=b.tabEditorWindow.getString();b.setVisible(false);SITE.SaveProperties();if(e!==""){FILEMANAGER.saveLocal("ultimaTablaturaEditada",e);b.mapa.menu.dispatchAction("menuRepertorio","TAB2PART")}},false)};SITE.TabGen.prototype.setup=function(a){this.mapa.closeMapa();this.setVisible(true);this.abcEditorWindow.setString(a);this.abcEditorWindow.container.dispatchAction("READONLY");if(SITE.properties.tabGen.abcEditor.floating){if(SITE.properties.tabGen.abcEditor.maximized){this.abcEditorWindow.container.dispatchAction("MAXIMIZE")}else{this.abcEditorWindow.container.dispatchAction("POPOUT")}}else{this.abcEditorWindow.container.dispatchAction("POPIN")}this.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none";this.fireChanged();if(SITE.properties.tabGen.tabEditor.floating){if(SITE.properties.tabGen.tabEditor.maximized){this.tabEditorWindow.container.dispatchAction("MAXIMIZE")}else{this.tabEditorWindow.container.dispatchAction("POPOUT")}}else{this.tabEditorWindow.container.dispatchAction("POPIN")}this.tabEditorWindow.container.dispatchAction("READONLY");this.tabEditorWindow.restartUndoManager();this.resize()};SITE.TabGen.prototype.setVisible=function(a){this.Div.parent.style.display=a?"block":"none"};SITE.TabGen.prototype.fireChanged=function(){this.title="";var a=this.tabParser.parse(this.abcEditorWindow.getString(),this.accordion.loadedKeyboard);this.title=this.tabParser.title;if(!this.GAtabGen||this.GAtabGen!==this.tabParser.title){this.GAtabGen=this.tabParser.title;SITE.ga("event","page_view",{page_title:this.GAtabGen,page_path:SITE.root+"/part2tab"})}this.printTablature(a)};SITE.TabGen.prototype.salvaTablatura=function(){if(FILEMANAGER.requiredFeaturesAvailable()){var a=this.title+".tab";var b=this.tabEditorWindow.getString();FILEMANAGER.download(a,b)}else{alert(SITE.translator.getResource("err_saving"))}};SITE.TabGen.prototype.printTablature=function(b){this.tabEditorWindow.setString(b);var a=this.tabParser.getWarnings();if(a){this.warningsDiv.innerHTML=a;this.warningsDiv.style.color="red"}else{this.warningsDiv.innerHTML="Tablatura extraída com sucesso!";this.warningsDiv.style.color="green"}};SITE.TabGen.prototype.resize=function(){var d=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var c=(d-78-10);var a=(b-8);this.Div.topDiv.style.left="3px";this.Div.topDiv.style.top="82px";this.Div.topDiv.style.height=Math.max(c,200)+"px";this.Div.topDiv.style.width=Math.max(a,400)+"px"};SITE.TabGen.prototype.updateSelection=function(a){return};SITE.TabGen.prototype.closeTabGen=function(){var a=this;a.setVisible(false);SITE.SaveProperties();a.mapa.openMapa()};SITE.TabGen.prototype.p2tCallback=function(a){switch(a){case"CLOSE":this.closeTabGen();break}};SITE.TabGen.prototype.tabEditorCallback=function(a){switch(a){case"REFRESH":this.fireChanged();break;case"MAXIMIZE":this.tabEditorWindow.maximizeWindow(true,SITE.properties.tabGen.tabEditor);break;case"RESTORE":this.tabEditorWindow.maximizeWindow(false,SITE.properties.tabGen.tabEditor);break;case"POPIN":this.tabEditorWindow.dockWindow(true,SITE.properties.tabGen.tabEditor,0,0,"calc(100% - 5px)","400px");this.resize();break;case"POPOUT":this.tabEditorWindow.dockWindow(false,SITE.properties.tabGen.tabEditor);this.resize();break;case"RESIZE":case"MOVE":this.tabEditorWindow.retrieveProps(SITE.properties.tabGen.tabEditor);
break}};SITE.TabGen.prototype.abcEditorCallback=function(a){switch(a){case"REFRESH":this.fireChanged();break;case"MAXIMIZE":this.abcEditorWindow.maximizeWindow(true,SITE.properties.tabGen.abcEditor);break;case"RESTORE":this.abcEditorWindow.maximizeWindow(false,SITE.properties.tabGen.abcEditor);break;case"POPIN":this.abcEditorWindow.dockWindow(true,SITE.properties.tabGen.abcEditor,0,0,"calc(100% - 5px)","400px");this.resize();break;case"POPOUT":this.abcEditorWindow.dockWindow(false,SITE.properties.tabGen.abcEditor);this.resize();break;case"RESIZE":case"MOVE":this.abcEditorWindow.retrieveProps(SITE.properties.tabGen.abcEditor);break}};if(!window.ABCXJS){window.ABCXJS={}}String.prototype.replaceAll=function(a,b){var c=this;return c.replace(new RegExp(a,"g"),b)};ABCXJS.Tab2PartLine=function(){this.basses=[];this.treble="";this.tablature="";this.fingeringLine=""};ABCXJS.Tab2Part=function(b,a){this.toClub=b||false;this.fromClub=a||false;this.ties=[];this.keyAcidentals=[];this.barAccidentals=[];this.barBassAccidentals=[];this.startSyms="|/+%f";this.barSyms=":]|[";this.spaces="-. \t";this.bassOctave=2;this.inTriplet=false;this.init();this.addWarning=function(c){this.warnings.push(c)};this.getWarnings=function(){return this.warnings.join("<br>")}};ABCXJS.Tab2Part.prototype.init=function(){this.tabText;this.tabLines;this.endColumn=0;this.startColumn=null;this.durationLine=null;this.columnDuration="";this.barEnding=false;this.trebleStaffs={open:null,close:null};this.parsedLines=[];this.currLine=0;this.abcText="";this.updateBarNumberOnNextNote=false;this.alertedBarNumber=0;this.currBar=0;this.currStaff=-1;this.warnings=[]};ABCXJS.Tab2Part.prototype.parse=function(f,a,g,b){this.init();this.tabText=f;this.tabLines=this.extractLines();this.keyboard=a;this.hasErrors=false;this.toClub=g;this.fromClub=b;this.directives={landscape:"%landscape",stretchlast:"%stretchlast",pagenumbering:"%pagenumbering",staffsep:"%staffsep 20",barsperstaff:"%barsperstaff 6",papersize:"%%papersize A4",barnumbers:"%%barnumbers 0"};while((!this.hasErrors)&&this.currLine<this.tabLines.length){if(this.skipEmptyLines()){this.parseLine();this.currLine++}}if(!this.hasErrors){this.addLine("V:1 treble");var c="";this.parsedLines.forEach(function(d){c+=d.treble+"\n";if(d.fingeringLine){c+=d.fingeringLine+"\n"}});this.addLine(c.slice(0,-1));this.addLine("V:2 bass");var c="";this.parsedLines.forEach(function(d){c+=d.basses[0]+"\n"});this.addLine(c.slice(0,-1));this.addLine("V:3 accordionTab");c="";this.parsedLines.forEach(function(d){c+=d.tablature+"\n"});this.addLine(c.slice(0,-1))}for(var e in this.directives){this.abcText=this.directives[e]+"\n"+this.abcText}return this.abcText};ABCXJS.Tab2Part.prototype.extractLines=function(){var a=this.tabText.split("\n");a.forEach(function(c,d){if(c.charAt(0)!=="%"){var b=c.split("%");a[d]=b[0].trim()}});return a};ABCXJS.Tab2Part.prototype.parseLine=function(){var g=this.tabLines[this.currLine].match(/^([ACRFKLMNTQZ]\:*[^\r\n\t\%]*)/g);var c=this.tabLines[this.currLine].match(/^\%/);if(c){var e=false;for(var f in this.directives){if(this.tabLines[this.currLine].includes(f)){this.directives[f]=this.tabLines[this.currLine];e=true;break}}if(!e){this.addLine(this.tabLines[this.currLine])}}else{if(g){var b=this.tabLines[this.currLine].match(/^([ACRFKLMNTQZ]\:)/g);switch(b[0]){case"K:":var a=ABCXJS.parse.denormalizeAcc(g[0].trim().substr(2));if(this.toClub){switch(a){case"G":a="C";break;case"Am":a="Dm";break;case"C":a="F"}}else{if(this.fromClub){switch(a){case"C":a="G";break;case"Dm":a="Am";break;case"F":a="C"}}}g[0]="K:"+a;this.keyAcidentals=ABCXJS.parse.parseKeyVoice.standardKey(a);break}this.addLine(g[0])}else{this.parseStaff()}}};ABCXJS.Tab2Part.prototype.skipEmptyLines=function(){while(this.currLine<this.tabLines.length){if(this.tabLines[this.currLine].match(/^[\n\r\t]*$/)===null){return true}this.currLine++}return false};ABCXJS.Tab2Part.prototype.addLine=function(a){this.abcText+=a+"\n"};ABCXJS.Tab2Part.prototype.parseStaff=function(){var c=this.idStaff();if(!c){this.addWarning("Linha Ínvalida: ["+(this.currLine+1)+'] --> "'+this.tabLines[this.currLine]+'"');this.hasErrors=true;return}var a=1;var b=1000;while(a>0&&--b){this.posiciona(c);a=this.read(c);switch(a){case 1:this.addBar(c,c[0].token.str);break;case 2:if(c[0].token.type==="triplet"){this.addTriplet(c,c[0].token.str)}else{this.addNotes(c)}break}}if(!b){this.addWarning("Não pude processar tablatura após 1000 ciclos. Possivel desalinhamento de texto.");this.hasErrors=true}};ABCXJS.Tab2Part.prototype.addBar=function(c,d){var a=true;this.addTabElem(d+" ");for(var b=0;b<c.length;b++){if(c[b].st!=="closed"){if(c[b].bass){this.addBassElem(c[b].idBass,d+" ")}else{if(a){this.addTrebleElem(d+" ");a=false}}this.setStaffState(c[b])}}};ABCXJS.Tab2Part.prototype.addTriplet=function(b,c){if(c.charAt(0)==="("){this.addTrebleElem(c+" ")}this.addTabElem(c+" ");for(var a=0;a<b.length;a++){this.setStaffState(b[a])}};ABCXJS.Tab2Part.prototype.addNotes=function(d){var f;var a=true;var k=true;var g=false;for(var c=0;k&&c<d.length;c++){if(d[c].st==="processing"&&!d[c].bass){a=d[c].open;k=false;g=true}}if(!g){if(this.alertedBarNumber!==d[0].token.barNumber){this.addWarning("Compasso "+d[0].token.barNumber+": Pelo menos uma pausa deveria ser adicionada à melodia!.");this.alertedBarNumber=d[0].token.barNumber}}k=true;for(var c=0;c<d.length;c++){if(d[c].st==="processing"){if(d[c].bass){var h=this.handleBassNote(d[c].token.str);if(d[c].token.added&&h.pitch!=="z"){f=">"}else{d[c].token.added=true;f=h.pitch}this.addTabElem(f);if(d[c].token.afinal){var e=this.checkBass(h.pitch,a);if(!e){if(this.alertedBarNumber!==d[c].token.barNumber){this.addWarning("Compasso "+d[c].token.barNumber+": Baixo não encontrado ou não compatível com o movimento do fole.");this.alertedBarNumber=d[c].token.barNumber}}this.addBassElem(d[c].idBass,d[c],e);this.setStaffState(d[c])}}else{if(k){this.addTabElem(a?"-":"+");k=false}f="";for(var b=0;b<d[c].token.aStr.length;b++){if(d[c].token.added&&d[c].token.aStr[b]!=="z"){f+=">"}else{f+=this.toHex(d[c].token.aStr[b])}}d[c].token.added=true;if(d[c].token.aStr.length>1){f="["+f+"]"}if((a&&d[c].open)||(!a&&!d[c].open)){if(this.ties.length>0){var l=this.ties.pop();if(l!==f){this.ties.push(l)}else{f="";for(var b=0;b<d[c].token.aStr.length;b++){f+=">"}if(d[c].token.aStr.length>1){f="["+f+"]"}}}else{if(d[c].token.lastChar.indexOf("-")>=0){this.ties.push(f)}}this.addTabElem(f);if((this.trebleStaffs.open&&this.trebleStaffs.open.token.afinal)||(this.trebleStaffs.close&&this.trebleStaffs.close.token.afinal)){this.addTrebleElem(d[c]);if(this.trebleStaffs.open){this.setStaffState(this.trebleStaffs.open);this.trebleStaffs.open.token.afinal=true}if(this.trebleStaffs.close){this.setStaffState(this.trebleStaffs.close);this.trebleStaffs.close.token.afinal=true}}}else{if(this.alertedBarNumber!==d[c].token.barNumber){this.addWarning("Compasso "+d[c].token.barNumber+": Não é possível ter ambos (abrindo e fechando) movimento de fole.");this.alertedBarNumber=d[c].token.barNumber
}}}}}if(this.columnDuration&&this.columnDuration.length){this.addTabElem(parseFloat(this.columnDuration))}this.addTabElem(" ")};ABCXJS.Tab2Part.prototype.addTabElem=function(a){this.parsedLines[this.currStaff].tablature+=a};ABCXJS.Tab2Part.prototype.handleBassNote=function(b){var a=false,d=false,c=false;if("@XxZz".indexOf(b.charAt(0))>0){c=true}if(b.charAt(b.length-1)==="m"){d=true}if(b===b.toLowerCase()){a=true}return{pitch:b,isRest:c,isMinor:d,isChord:a}};ABCXJS.Tab2Part.prototype.addBassElem=function(a,d,c){if(typeof(d)==="string"){this.parsedLines[this.currStaff].basses[a]+=d}else{if(d.hasToken&&d.token.afinal){var b=this.handleBassNote(d.token.str);var e;if(b.isRest){e=b.pitch}else{if(b.isChord){e=this.getChord(b.pitch,(c.isMinor!==undefined?c.isMinor:b.isMinor))}else{e=this.getTabNote(b.pitch,this.bassOctave,true)}}e+=this.handleDuration(d.token.duration*(this.inTriplet?2/3:1))+(d.token.lastChar.indexOf("-")>=0?"-":"")+(d.token.lastChar.indexOf(".")>=0?"":" ");this.parsedLines[this.currStaff].basses[a]+=e}}};ABCXJS.Tab2Part.prototype.addTrebleElem=function(a){var b;if(typeof(a)==="string"){this.parsedLines[this.currStaff].treble+=a}else{b=this.getPitch(a);b+=this.handleDuration(a.token.duration)+(a.token.lastChar.indexOf("-")>=0?"-":"")+(a.token.lastChar.indexOf(".")>=0?"":" ");this.parsedLines[this.currStaff].treble+=b}};ABCXJS.Tab2Part.prototype.handleDuration=function(b){var a="";if(b!==1){a=""+b;if(b%1!==0){var c=""+(b-b%0.001);switch(c){case"1.499":a="3/2";break;case"0.666":a="2/3";break;case"0.499":a="/2";break;case"0.333":a="/3";break;case"0.249":a="/4";break;case"0.166":a="/6";break;case"0.124":a="/8";break}}}return a};ABCXJS.Tab2Part.prototype.getPitch=function(e){var c="";for(var d=0;d<e.token.aStr.length;d++){var f=e.token.aStr[d];if(f!=="z"){var a=this.getButton(f);if(a){var g=e.open?a.openNote:a.closeNote;f=this.getTabNote(g.key,g.octave,false)}}c+=f}return e.token.aStr.length>1?"["+c+"]":c};ABCXJS.Tab2Part.prototype.getChord=function(g,f){var e=ABCXJS.parse.normalizeAcc(g.toUpperCase().replace("M",""));var d=ABCXJS.parse.key2number[e];if(!(d>=0)){throw new Error("Acorde não identificado: "+e)}var c=d+(f?3:4);var b=d+7;var a=this.bassOctave+1;return"["+this.getTabNote(ABCXJS.parse.number2keysharp[d%12],a,true)+this.getTabNote(ABCXJS.parse.number2keysharp[c%12],a+Math.trunc(c/12),true)+this.getTabNote(ABCXJS.parse.number2keysharp[b%12],a+Math.trunc(b/12),true)+"]"};ABCXJS.Tab2Part.prototype.getTabNote=function(j,k,f){var h=j.match(/[♯♭]/g);var c=h?j.charAt(0):j;var l=this.getKeyAccOffset(c);if(h&&l===null){var d,b,g,e,a=ABCXJS.parse.key2number[j];if(h[0]==="♯"){d=ABCXJS.parse.number2keyflat[a%12]}else{d=ABCXJS.parse.number2keysharp[a%12]}b=d.match(/[♯♭]/g);g=d.charAt(0);e=this.getKeyAccOffset(g);if(e){j=d;c=g;l=e;h=b}}if(h){if((h[0]==="♯"&&l==="sharp")||(h[0]==="♭"&&l==="flat")){}else{c=((h[0]==="♯")?"^":"_")+c}}else{if(l){c="="+c}}if(f){if(h){if(this.barBassAccidentals[c]){if(this.barBassAccidentals[c]===h[0]){c=c.charAt(1)}}else{this.barBassAccidentals[c.charAt(1)]=h[0]}}else{if(this.barBassAccidentals[c]){c="="+c}}}else{if(h){if(this.barAccidentals[c]){if(this.barAccidentals[c]===h[0]){c=c.charAt(1)}}else{this.barAccidentals[c.charAt(1)]=h[0]}}else{if(this.barAccidentals[c]){c="="+c}}}var i=c;if(k<4){i=c+Array(5-k).join(",")}else{if(k===5){i=c.toLowerCase()}else{if(k>5){i=c.toLowerCase()+Array(k-4).join("'")}}}return i};ABCXJS.Tab2Part.prototype.setStaffState=function(a){a.hasToken=false;a.st=(a.linhas[0].pos<this.tabLines[a.linhas[0].l].length?"waiting for data":"closed")};ABCXJS.Tab2Part.prototype.idStaff=function(){var b=[],f=-1,h=true,m=-1,g=0,n=0;this.endColumn=0;this.startColumn=null;this.durationLine=null;this.columnDuration=null;this.trebleStaffs={open:null,close:null};this.parsedLines[++this.currStaff]=new ABCXJS.Tab2PartLine();while(this.currLine<this.tabLines.length&&this.tabLines[this.currLine].trim().length&&this.startSyms.indexOf(this.tabLines[this.currLine].charAt(0))>=0){var a=true;switch(this.tabLines[this.currLine].charAt(0)){case"|":if(this.tabLines[this.currLine].match(/[ABCDFEGabcdefg]/)){b[++f]={hasToken:false,bass:true,idBass:++m,linhas:[{l:this.currLine,pos:0}],st:"waiting for data"};this.parsedLines[this.currStaff].basses[m]=""}else{h=!h;b[++f]={hasToken:false,bass:false,open:h,linhas:[{l:this.currLine,pos:0}],st:"waiting for data"};if(h){this.trebleStaffs.open=b[f]}else{this.trebleStaffs.close=b[f]}}break;case"/":b[f].linhas.push({l:this.currLine,pos:0});break;case"+":a=false;this.durationLine=this.currLine;break;case"f":a=false;this.parsedLines[this.currStaff].fingeringLine=this.tabLines[this.currLine];break;case"%":a=false;break}if(a&&g<this.tabLines[this.currLine].length){g=this.tabLines[this.currLine].length;n=this.currLine}this.currLine++}if(b.length===0){return null}var d=0,c;while((c=(this.tabLines[n].substr(d+1).indexOf("|")))>0){d+=c+1;for(var e=0;e<b.length;e++){var o=b[e];for(var f=0;f<o.linhas.length;f++){var c=this.tabLines[o.linhas[f].l];if(c.length>d&&c.charAt(d)!=="|"){this.addWarning("Possível falta de sincronismo na pauta "+(this.currStaff+1)+", linha "+(e+1)+", coluna "+(d+1)+". Barras desalinhadas.")}}}}return b};ABCXJS.Tab2Part.prototype.posiciona=function(f){var g=false;var h=0;this.startColumn=this.endColumn;this.barEnding=false;while(!g){g=true;for(var c=0;g&&c<f.length;c++){var a=f[c];h+=a.linhas.length;for(var d=0;g&&d<a.linhas.length;d++){var b=this.tabLines[a.linhas[d].l];if(this.endColumn<b.length&&this.spaces.indexOf(b.charAt(this.endColumn))<0){g=false;this.endColumn++}}}}this.endColumn++;g=false;while(!g){for(var c=0;!g&&c<f.length;c++){var a=f[c];h+=a.linhas.length;for(var d=0;!g&&d<a.linhas.length;d++){var b=this.tabLines[a.linhas[d].l];if(this.endColumn>=b.length||this.spaces.indexOf(b.charAt(this.endColumn))<0){if(b.charAt(this.endColumn)&&this.barSyms.indexOf(b.charAt(this.endColumn))>=0){this.barEnding=true}g=true}}}if(!g){this.endColumn++}}if(this.durationLine&&this.durationLine>=0){var e=this.tabLines[this.durationLine].substr(this.startColumn,this.endColumn-this.startColumn).trim();this.columnDuration=e.length>0?e:""}};ABCXJS.Tab2Part.prototype.read=function(d){var c=0,b=0;for(var a=0;a<d.length;a++){var e=d[a];switch(e.st){case"waiting for data":e.token=this.getToken(e);if(e.hasToken){e.st=(e.token.type==="bar")?"waiting end of interval":"processing";b=(e.token.type==="bar")?1:2}else{b=2}break;case"waiting end of interval":b=1;break;case"closed":b=0;break;case"processing":this.updateToken(e);b=2;break}c=Math.max(b,c)}return c};ABCXJS.Tab2Part.prototype.getToken=function(g){var q="():|[]/";var t=g.linhas.length;var w=false;var e=null;var k="";var n=[];var o="";this.skipSyms(g,this.spaces);for(var s=0;s<t;s++){var f="";var l=g.linhas[s];var m=false;while(l.pos<Math.min(this.tabLines[l.l].length,this.endColumn)&&!m){var u=this.tabLines[l.l].charAt(l.pos);if(u!==" "&&u!=="."&&u!=="-"){f+=u;l.pos++}else{if(q.indexOf(f.charAt(0))>=0){for(var r=1;r<t;r++){g.linhas[r].pos=l.pos}t=1}else{k+=u
}m=true}}if(f.trim().length>0){if(this.toClub&&q.indexOf(f.charAt(0))<0&&f!=="z"){if(g.bass){switch(f){case"C":f="F";break;case"c":f="f";break;case"D":f="G";break;case"d":f="g";break;case"E":f="A";break;case"e":f="a";break;case"F":f="B♭";break;case"f":f="b♭";break;case"G":f="C";break;case"g":f="c";break;case"A":f="D";break;case"a":f="d";break;case"am":f="dm";break}}else{var h=f.match(/^[0-9]*/g);var v=f.replace(h[0],"");f=(parseInt(h[0])+1)+v}}if(this.fromClub&&q.indexOf(f.charAt(0))<0&&f!=="z"){if(g.bass){switch(f){case"A":f="E";break;case"a":f="e";break;case"B♭":f="F";break;case"b♭":f="f";break;case"C":f="G";break;case"c":f="g";break;case"D":f="A";break;case"d":f="a";break;case"dm":f="am";break;case"F":f="C";break;case"f":f="c";break;case"G":f="D";break;case"g":f="d";break}}else{var h=f.match(/^[0-9]*/g);var v=f.replace(h[0],"");f=(parseInt(h[0])-1)+v}}n.push(f);o+=f}var d=this.tabLines[l.l].charAt(this.endColumn);var b=this.spaces.indexOf(d)>=0;if(this.barEnding||l.pos>=this.tabLines[l.l].length||!b){w=true}}g.hasToken=o.trim().length!==0;if(g.hasToken){if(q.indexOf(o.charAt(0))>=0){if(o.charAt(0)==="("||o.charAt(0)===")"){e="triplet";this.inTriplet=(o.charAt(0)==="(")}else{e="bar";this.barAccidentals=[];this.barBassAccidentals=[];this.updateBarNumberOnNextNote=true}}else{e="note";o=this.normalizeAcc(o);if(this.updateBarNumberOnNextNote){this.updateBarNumberOnNextNote=false;this.currBar++}if(n.length>1){o="["+o+"]"}}}var p=1;if(this.columnDuration&&this.columnDuration.length){p=parseFloat(this.columnDuration)}return{str:o,aStr:n,duration:p,barNumber:this.currBar,type:e,afinal:w,added:false,lastChar:k}};ABCXJS.Tab2Part.prototype.normalizeAcc=function(b){var a=b.charAt(0);if(b.length>1){a+=b.substr(1).replace(new RegExp("#","g"),"♯").replace(new RegExp("b","g"),"♭")}return a};ABCXJS.Tab2Part.prototype.updateToken=function(a){var b=false;var f=a.linhas.length;for(var c=0;c<f;c++){var e=a.linhas[c];if(this.barEnding||e.pos>=this.tabLines[e.l].length||this.spaces.indexOf(this.tabLines[e.l].charAt(this.endColumn))<0){b=true}}var d=1;if(this.columnDuration&&this.columnDuration.length){d=parseFloat(this.columnDuration)}a.token.duration+=d;if(b){a.token.afinal=true}};ABCXJS.Tab2Part.prototype.skipSyms=function(a,c){for(var b=0;b<a.linhas.length;b++){while(a.linhas[b].pos<Math.min(this.tabLines[a.linhas[b].l].length,this.endColumn)&&c.indexOf(this.tabLines[a.linhas[b].l].charAt(a.linhas[b].pos))>=0){a.linhas[b].pos++}}};ABCXJS.Tab2Part.prototype.getButton=function(a){if(a==="x"||a===" "||a===""||!this.keyboard){return null}var d=this.keyboard;var e=parseInt(isNaN(a.substr(0,2))||a.length===1?1:2);var c=a.substr(0,e)-1;var f=a.length-e;if(d.keyMap[f][c]){return d.keyMap[f][c]}return null};ABCXJS.Tab2Part.prototype.checkBass=function(c,a){if(c==="-->"||!this.keyboard){return false}if(c==="z"){return true}var g=this.keyboard;var h=g.parseNote(c.replace("m",":m"),true);for(var d=g.keyMap.length;d>g.keyMap.length-2;d--){for(var e=0;e<g.keyMap[d-1].length;e++){var f=g.keyMap[d-1][e];if((a&&f.openNote.key===h.key&&h.isMinor===f.openNote.isMinor)||(!a&&f.closeNote.key===h.key&&h.isMinor===f.closeNote.isMinor)){return a?f.openNote:f.closeNote.key}}}return false};ABCXJS.Tab2Part.prototype.toHex=function(c){if(c==="z"||c===">"){return c}var d=c.indexOf("'");var b=c.substr(0,d);var a=c.substr(d);return(d<0)?parseInt(c).toString(16):parseInt(b).toString(16)+a};ABCXJS.Tab2Part.prototype.getKeyAccOffset=function(c){for(var b=0;b<this.keyAcidentals.length;b++){if(this.keyAcidentals[b].note.toLowerCase()===c.toLowerCase()){return this.keyAcidentals[b].acc}}return null};function toDecimalNote(b){var a;switch(b){case">":a=" ";break;case"z":a="z";break;default:a=parseInt(b,16)}return a}function regexp_match(c,b){var a,d=[];while((a=b.exec(c))!==null){d.push(a);if(a.index===b.lastIndex){b.lastIndex++}}return d}function lpad(d,f,e){if(!d||!f||d.length>=e){return d}var a=(e-d.length)/f.length;for(var b=0;b<a;b++){d=f+d}return d}function rpad(d,f,e){if(!d||!f||d.length>=e){return d}var a=(e-d.length)/f.length;for(var b=0;b<a;b++){d+=f}return d}if(!window.ABCXJS){window.ABCXJS={}}ABCXJS.Part2TabLine=function(){this.basses="";this.sparring="";this.close=[""];this.open=[""];this.duration="";this.pos=0};ABCXJS.Part2Tab=function(){this.validBars={"|":"bar_thin","||":"bar_thin_thin","[|":"bar_thick_thin","|]":"bar_thin_thick",":|:":"bar_dbl_repeat",":||:":"bar_dbl_repeat","::":"bar_dbl_repeat","|:":"bar_left_repeat","||:":"bar_left_repeat","[|:":"bar_left_repeat",":|":"bar_right_repeat",":||":"bar_right_repeat",":|]":"bar_right_repeat"};this.validBasses="abcdefgABCDEFGz>+-";this.startSyms="[|:";this.spaces=" \t";this.init();this.addWarning=function(a){this.warnings.push(a)};this.getWarnings=function(){return this.warnings.join("<br>")}};ABCXJS.Part2Tab.prototype.init=function(){this.partText;this.partLines;this.parsedLines=[];this.currLine=0;this.tabText="";this.currBar=0;this.warnings=[];this.inTab=false;this.inTreble=false;this.trebleVoice="";this.fingerLine=[];this.lastParsed={notes:undefined,tabLine:undefined};this.finalTabLines=[]};ABCXJS.Part2Tab.prototype.parse=function(d,a){this.init();this.partText=d;this.partLines=this.extractLines();this.keyboard=a;this.hasErrors=false;this.title=undefined;while((!this.hasErrors)&&this.currLine<this.partLines.length){if(this.skipEmptyLines()){this.parseLine();this.currLine++}}var e=this.finalTabLines;for(var b=0;b<e.length;b++){this.addLine(e[b].basses);for(var c=0;c<e[b].close.length;c++){this.addLine(e[b].close[c])}for(var c=0;c<e[b].open.length;c++){this.addLine(e[b].open[c])}this.addLine(e[b].duration);if(this.fingerLine[b]&&this.fingerLine[b]!==""){this.addLine(this.fingerLine[b]+"\n")}else{this.addLine("\n")}}return this.tabText};ABCXJS.Part2Tab.prototype.extractLines=function(){var a=this.partText.split("\n");a.forEach(function(c,d){var b=c.split("%");a[d]=b[0].trim()});return a};ABCXJS.Part2Tab.prototype.parseLine=function(){var d=this.partLines[this.currLine].match(/^([ACFKLMNTQVZ]\:*[^\r\n\t\%]*)/g);if(d){var j=this.partLines[this.currLine].match(/^([ACFKLMNTQVZ]\:)/g);switch(j[0]){case"V:":var h=(d[0].match(/accordionTab/g)!==null);var g=(d[0].match(/bass/g)!==null);var m=(d[0].match(/treble/g)!==null);this.inTab=h;this.inTreble=m||!(h||g);if(this.inTreble){var l=this.partLines[this.currLine].match(/^(V:\S.)/);this.trebleVoice=l[0].trim()}break;case"T:":if(!this.title){this.title=ABCXJS.parse.denormalizeAcc(d[0].trim().substr(2))}break;case"K:":var c=ABCXJS.parse.denormalizeAcc(d[0].trim().substr(2));d[0]="K:"+c;this.keyAcidentals=ABCXJS.parse.parseKeyVoice.standardKey(c);break}if(j[0]!=="V:"){this.addLine(d[0])}}else{if(this.inTab){this.finalTabLines.push(this.parseTab())}else{var l=this.partLines[this.currLine].match(/\[(V:\S)\]/);var e=(this.partLines[this.currLine].match(/^(f\:)/g)!==null);var i=(this.partLines[this.currLine].match(/^(w\:)/g)!==null);if(l){this.inTreble=(this.trebleVoice!==""&&l[1]===this.trebleVoice)}if(this.inTreble){if(e){this.fingerLine[this.fingerLine.length-1]=this.partLines[this.currLine]
}else{if(!i){this.fingerLine.push("")}}}}}};ABCXJS.Part2Tab.prototype.parseTab=function(){var a={str:this.partLines[this.currLine],posi:0,pos:0,tokenType:1,currToken:""};var c=new ABCXJS.Part2TabLine();if(a.length===0){this.hasErrors=true;return}var b=1000;while(a.tokenType>0&&--b){this.getToken(a,c);switch(a.tokenType){case 1:this.addBar(c,a.currToken);break;case 2:this.addNotes(c,a);break;case 3:this.addTriplet(c,a);break}}if(a.tokenType<0){this.addWarning("Encontrados símbolos inválidos na linha ("+(this.currLine+1)+","+(a.posi+1)+") .");this.hasErrors=true}if(!b){this.addWarning("Não pude processar tablatura após 1000 ciclos. Possivel desalinhamento de texto.");this.hasErrors=true}return c};ABCXJS.Part2Tab.prototype.addBar=function(d,b){var a=b.length;d.basses+=b+" ";for(var c=0;c<d.close.length;c++){d.close[c]+=b+" "}for(var c=0;c<d.open.length;c++){d.open[c]+=b+" "}if(d.pos===0){d.sparring+="/"+rpad(" "," ",a);d.duration="+"+rpad(" "," ",a)}else{d.sparring+=b+" ";d.duration+=rpad(" "," ",a+1)}d.pos+=(a+1)};ABCXJS.Part2Tab.prototype.addTriplet=function(d,b){var a=b.currToken.length+1;d.basses+=b.currToken+" ";for(var c=0;c<d.open.length;c++){d.open[c]+=b.currToken+" "}for(var c=0;c<d.close.length;c++){d.close[c]+=b.currToken+" "}d.sparring+=rpad(" "," ",a);d.duration+=rpad(" "," ",a);d.pos+=a};ABCXJS.Part2Tab.prototype.addNotes=function(c,k){var j=k.parsedNotes;if(j.empty&&(k.parsedNotes.bas.trim().length===0||k.parsedNotes.currBar!==this.lastParsed.notes.currBar)){this.lastParsed.notes.currBar=k.parsedNotes.currBar;var g=this.lastParsed.notes.notes;var e=this.lastParsed.tabLine;if(j.closing){var f=e.close[0].lastIndexOf(g[0])+this.lastParsed.notes.maxL;for(var a=0;a<e.close.length;a++){var h=e.close[a];if(a<j.notes.length){var b=h.lastIndexOf(g[a]);e.close[a]=h.slice(0,b)+h.slice(b).replace(g[a],g[a]+"-")}else{e.close[a]=h.slice(0,f)+" "+h.slice(f)}}for(var a=0;a<e.open.length;a++){var h=e.open[a];e.open[a]=h.slice(0,f)+" "+h.slice(f)}}else{var f=e.open[0].lastIndexOf(g[0])+this.lastParsed.notes.maxL;for(var a=0;a<e.open.length;a++){var h=e.open[a];if(a<j.notes.length){var b=h.lastIndexOf(g[a]);e.open[a]=h.slice(0,b)+h.slice(b).replace(g[a],g[a]+"-")}else{e.open[a]=h.slice(0,f)+" "+h.slice(f)}}for(var a=0;a<e.close.length;a++){var h=e.close[a];e.close[a]=h.slice(0,f)+" "+h.slice(f)}}e.duration=e.duration.slice(0,f)+" "+e.duration.slice(f);e.sparring=e.sparring.slice(0,f)+" "+e.sparring.slice(f);e.basses=e.basses.slice(0,f)+" "+e.basses.slice(f);k.parsedNotes=window.ABCXJS.parse.clone(this.lastParsed.notes);j.notes=g;j.maxL=Math.max(j.maxL,this.lastParsed.notes.maxL)}var d=j.maxL+1;c.basses+=j.bas+rpad(" "," ",d-j.bas.length);if(j.closing){while(c.close.length<j.notes.length){c.close.push(window.ABCXJS.parse.clone(c.sparring))}for(var a=0;a<c.close.length;a++){if(a<j.notes.length){c.close[a]+=j.notes[a]+rpad(" "," ",d-j.notes[a].length)}else{c.close[a]+=rpad(" "," ",d)}}for(var a=0;a<c.open.length;a++){c.open[a]+=rpad(" "," ",d)}}else{while(c.open.length<j.notes.length){c.open.push(window.ABCXJS.parse.clone(c.sparring))}for(var a=0;a<c.open.length;a++){if(a<j.notes.length){c.open[a]+=j.notes[a]+rpad(" "," ",d-j.notes[a].length)}else{c.open[a]+=rpad(" "," ",d)}}for(var a=0;a<c.close.length;a++){c.close[a]+=rpad(" "," ",d)}}c.sparring+=rpad(" "," ",d);if(j.duration==="1"||j.duration===""){c.duration+=rpad(" "," ",d)}else{c.duration+=j.duration+rpad(" "," ",d-j.duration.length)}c.pos+=d};ABCXJS.Part2Tab.prototype.getNotes=function(a,e,i){var o,c=[],j,m,k,h=0;k=a.match(/(A|B|C|D|E|F|G|z|>)[(♭|♯|m)]{0,1}/gi);if(k.length<1){return null}else{k[0]=k[0]===">"?" ":k[0];h=Math.max(h,k[0].length)}o=regexp_match(e,/\[(.*?)\](\d{0,1}[\.|\/]{0,1}\d{0,2})/gi);if(o.length===1){j=o[0][2];h=Math.max(h,j.length);m=regexp_match(o[0][1],/(\>|z|[a-f]|[0-9])(\'{0,})/gi);m.forEach(function(d){var b=toDecimalNote(d[1])+d[2];c.push(b);h=Math.max(h,b.length)})}else{o=regexp_match(e,/(\>|z|[a-f]|[0-9])(\'{0,})(\d{0,1}[\.|\/]{0,1}\d{0,2})/gi);if(o.length===1){c.push(toDecimalNote(o[0][1])+o[0][2]);h=Math.max(h,c[0].length);j=o[0][3];h=Math.max(h,j.length)}else{return null}}var f={bas:k[0],notes:c,duration:j,closing:i,maxL:h,currBar:this.currBar,empty:false};var g=" ";f.notes.forEach(function(b){g+=b});if(g.trim().length===0){f.empty=true}return f};ABCXJS.Part2Tab.prototype.parseNotes=function(d){var a,c,b=false;if(d.charAt(0)==="+"||d.charAt(0)==="-"){d="z"+d}if(d.indexOf("+")>0){a=d.split("+");b=true}if(d.indexOf("-")>0){a=d.split("-")}if(!a){return null}c=this.getNotes(a[0],a[1],b);return c};ABCXJS.Part2Tab.prototype.getToken=function(a,d){var b=false;var e="";this.skipSyms(a,this.spaces);a.currToken="";a.tokenType=0;a.posi=a.pos;while(a.pos<a.str.length&&!b){e=a.str.charAt(a.pos);if(e===" "){b=true;continue}if(a.tokenType===0){if(this.validBars[e]){a.tokenType=1}else{if(this.validBasses.indexOf(e)>=0){a.tokenType=2}else{if(e==="("||e===")"){a.tokenType=3}else{if(this.startSyms.indexOf(e)<0){a.tokenType=-1}}}}}else{switch(a.tokenType){case 1:if(!e.match(/(\||\d|\:|\])/g)){b=true;continue}break;case 2:case 3:if(e.match(/(\||\:)/g)){b=true;continue}break}}a.currToken+=e;a.pos++;if(a.tokenType===1){this.currBar++}}if(b&&a.tokenType===2){if(a.parsedNotes!==undefined&&!a.parsedNotes.empty){this.lastParsed.notes=a.parsedNotes;this.lastParsed.tabLine=d}a.parsedNotes=this.parseNotes(a.currToken);if(a.parsedNotes===null){a.tokenType=-1}}};ABCXJS.Part2Tab.prototype.skipSyms=function(a,b){while(a.pos<a.str.length&&b.indexOf(a.str.charAt(a.pos))>=0){a.pos++}};ABCXJS.Part2Tab.prototype.skipEmptyLines=function(){while(this.currLine<this.partLines.length){if(this.partLines[this.currLine].charAt(0)!=="%"&&this.partLines[this.currLine].match(/^[\s\r\t]*$/)===null){return true}this.currLine++}return false};ABCXJS.Part2Tab.prototype.addLine=function(a){this.tabText+=a+"\n"};if(!window.SITE){window.SITE={}}SITE.Repertorio=function(){this.accordion=new window.ABCXJS.tablature.Accordion({accordionMaps:DIATONIC.map.accordionMaps,translator:SITE.translator,render_keyboard_opts:{transpose:true,mirror:false,scale:1,draggable:false,show:true,label:false}},SITE.properties.options.tabFormat)};SITE.Repertorio.prototype.compileAll=function(){for(var d=0;d<this.accordion.accordions.length;d++){this.accordion.load(d);var g=new ABCXJS.parse.Parse(null,this.accordion);var i=new ABCXJS.midi.Parse();waterbug.log(this.accordion.loaded.id);for(var h in this.accordion.loaded.songs.items){waterbug.log(h);console.log(h);g.parse(this.accordion.loaded.songs.items[h]);var c=g.getWarnings()||[];var b=c.length;for(var e=0;e<c.length;e++){waterbug.logError("   "+c[e]);console.log("   "+c[e])}var f=g.getTune();i.parse(f,this.accordion.loadedKeyboard);var c=i.getWarnings();b+=c.length;for(var e=0;e<c.length;e++){waterbug.logError("   "+c[e]);console.log("   "+c[e])}waterbug.log(b>0?"":"--> OK");console.log(b>0?"":"--> OK");waterbug.log("");console.log("")}}waterbug.show()};SITE.Repertorio.prototype.geraIndex=function(e){var m=null;var p="geral";
var j={geral:[],transportada:[],corona:[],portuguesa:[]};for(var q=0;q<this.accordion.accordions.length;q++){this.accordion.load(q);p="geral";switch(this.accordion.loaded.id){case"GAITA_HOHNER_CLUB_IIIM_BR":p="club";case"GAITA_MINUANO_GC":m=j.geral;break;case"GAITA_HOHNER_CORONA_GCF":p="gcf";case"GAITA_HOHNER_CORONA_ADG":m=j.corona;break;case"CONCERTINA_PORTUGUESA":m=j.portuguesa;break;case"GAITA_MINUANO_BC_TRANSPORTADA":m=j.transportada;break}for(var u in this.accordion.loaded.songs.items){if(this.accordion.loaded.songs.details[u].hidden){continue}var o=u.replace("(corona)","").replace("(club)","").replace("(transportada)","").replace("(portuguesa)","").trim();var d=this.accordion.loaded.songs.details[u].composer;var f=this.accordion.loaded.songs.details[u].id;switch(p){case"club":case"gcf":var s=-1,g=0;while(s===-1&&g<m.length){if(m[g].title===o){s=g}g++}if(s!==-1){m[s].outro=f}else{m.push({title:o,composer:d,geral:0,outro:f})}break;case"geral":m.push({title:o,composer:d,geral:f,outro:0})}}}var v=function(l,h){if(l.title<h.title){return -1}if(l.title>h.title){return 1}return 0};j.geral.sort(v);j.transportada.sort(v);j.corona.sort(v);j.portuguesa.sort(v);var i='<html>\n    <head>\n        <title>Mapa para Acordões Diatônicos - Repertório Indexado</title>\n        <meta charset="UTF-8">\n        <meta name="robots" content="index,follow">\n        <meta name="revisit-after" content="7 days">\n        <meta name="keywords" content="diatonic accordion, notation, learning, practice, repertoire, abc tunes, midi, tablature acordeão diatônico, gaita de oito baixos, gaita ponto, notação musical, aprendizagem, prática, repertorio, notação abc, tablatura ">\n        <style>\n            h1 {font-family: Arial; font-size: 40px; line-height:10x; margin:3px; }\n            h2 {font-family: Arial; font-size: 30px; line-height:10x; margin:3px; }\n            h3 {font-family: Arial; font-size: 20px; line-height:10x; margin:3px; }\n            p {font-family: Arial; font-size: 15px; line-height:10x; margin:3px; margin-bottom: 10px; }\n            .credit {font-style: italic; }\n            .destaque {font-style: italic; font-weight: bold;}\n            table.interna {border-collapse: collapse; width:calc(100% - 10px); min-width:'+(e?450:650)+"px; max-width:1024px; margin:3px; }\n            table.interna tr {font-family: Arial; background: #dfdfdf;}\n            table.interna tr:nth-child(even) { background-color:  #c0c0c0; }\n            table.interna th {background: blue; color: white; text-align: left; padding: 3px;}\n            table.interna td {text-align: left; padding: 3px;}\n            table.interna img { width: 40px;}\n            table.interna .center {text-align: center;}\n            table.interna .title {font-weight:bold;}\n            table.interna .composer {font-style:italic;}\n            table.interna .abc_link { color: black; text-decoration: none; } \n            table.interna .abc_link:hover {  color: blue;   text-decoration: none; }\n        </style>\n    </head>\n<body>\n<br>\n";if(!e){i+='<h1>Mapa para Acordões Diatônicos</h1>\n<p class="credit">Desenvolvido por: <span class="destaque">Flávio Vani</span>\n<br>Coordenação musical: <span class="destaque">prof. Cezar Ferreira</span></p>\n<p>Esta página apresenta, em ordem alfabética, todo o repertório do site. O site é composto de partituras para acordeão diatônico com \ntablaturas.</p>\n<p><span class="destaque">Nota: </span>Clique no checkmark verde (à direita) para abrir o site na partitura com o acordeão selecionado.</p>\n'}i+='<h2>Repertório Geral</h2>\n<h3>Tablaturas para acordeão G/C e/ou Club IIIM</h3>\n<table class="interna"><tr><th>Título</th>'+(e?"":"<th>Autor(es)</th>")+'<th class="center">G/C</th><th class="center">C/F  Club(br)</th></tr>\n';for(var c=0;c<j.geral.length;c++){s=c+1;i+='<tr><td class="title" >'+s+".&nbsp;"+j.geral[c].title+"</td>"+(e?"\n":'<td class="composer" >'+j.geral[c].composer+"</td>\n")+'<td class="center">'+this.makeAnchor(e,"GAITA_MINUANO_GC",j.geral[c].geral)+'</td>\n<td class="center">'+this.makeAnchor(e,"GAITA_HOHNER_CLUB_IIIM_BR",j.geral[c].outro)+"</td></tr>\n"}i+='</table>\n<br><h2>Transportada</h2>\n<h3>Tablaturas para acordeão Transportado</h3>\n<table class="interna"><tr><th>Título</th>'+(e?"":"<th>Autor(es)</th>")+'<th class="center">B/C</th></tr>\n';for(var c=0;c<j.transportada.length;c++){i+='<tr><td class="title" >'+j.transportada[c].title+"</td>"+(e?"\n":'<td class="composer" >'+j.transportada[c].composer+"</td>\n")+'<td class="center">'+this.makeAnchor(e,"GAITA_MINUANO_BC_TRANSPORTADA",j.transportada[c].geral)+"</td></tr>\n"}i+='</table>\n<br><h2>Portuguesa</h2>\n<h3>Tablaturas para Concertina Portuguesa em sistema diatônico italiano </h3>\n<table class="interna"><tr><th>Título</th>'+(e?"":"<th>Autor(es)</th>")+'<th class="center">G/C/F</th></tr>\n';for(var c=0;c<j.portuguesa.length;c++){i+='<tr><td class="title" >'+j.portuguesa[c].title+"</td>"+(e?"\n":'<td class="composer" >'+j.portuguesa[c].composer+"</td>\n")+'<td class="center">'+this.makeAnchor(e,"CONCERTINA_PORTUGUESA",j.portuguesa[c].geral)+"</td></tr>\n"}i+='</table>\n<br><h2>Corona</h2>\n<h3>Tablaturas para acordeões Corona Series A/D/G e/ou G/F/C</h3>\n<table class="interna"><tr><th>Título</th>'+(e?"":"<th>Autor(es)</th>")+'<th class="center">A/D/G</th><th class="center">G/C/F</th></tr>\n';for(var c=0;c<j.corona.length;c++){s=c+1;i+='<tr><td class="title" >'+s+".&nbsp;"+j.corona[c].title+"</td>"+(e?"\n":'<td class="composer" >'+j.corona[c].composer+"</td>\n")+'<td class="center">'+this.makeAnchor(e,"GAITA_HOHNER_CORONA_ADG",j.corona[c].geral)+'</td>\n<td class="center">'+this.makeAnchor(e,"GAITA_HOHNER_CORONA_GCF",j.corona[c].outro)+"</td></tr>\n"}i+="</table>\n<br>\n</body>\n</html>\n";if(e){var k=!this.win;if(k){this.win=new DRAGGABLE.ui.Window(e.mapDiv,null,{translator:SITE.translator,statusbar:false,draggable:true,top:"10px",left:"800px",width:"auto",height:"80%",title:"IDXREPERTOIRE"},null);this.win.dataDiv.className="draggableData"}this.win.setVisible(true);this.win.dataDiv.innerHTML=i;var b=new PerfectScrollbar(this.win.dataDiv,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});if(k){var n=window.innerWidth-this.win.topDiv.clientWidth-12;this.win.topDiv.style.left=(n<0?0:n)+"px"}this.bindSongs(this.win.dataDiv,e)}else{FILEMANAGER.download("repertorio.indexado.pt_BR.html",i)}};SITE.Repertorio.prototype.makeAnchor=function(d,b,e){var c="/";var a='<img alt="nao" src="/images/nao.png" >';if(e>0){if(d){a='<img alt="sim" src="/images/sim.png" data-song="'+b+"#"+e+'" >'}else{a='<a href="'+c+"?accordion="+b+"&id="+e+'"><img alt="sim" src="/images/sim.png" ></a>'}}return a};SITE.Repertorio.prototype.bindSongs=function(a,f){var g=function(j,h){j.stopPropagation();j.preventDefault();var i=h.getAttribute("data-song").split("#");f.setup({accordionId:i[0],songId:i[1]})};var e=a.querySelectorAll("[data-song]");
var d=Array.prototype.slice.apply(e);for(var b=0;b<d.length;b++){var c=d[b];c.addEventListener("touchstart",function(h){g(h,this)});c.addEventListener("mouseover",function(h){this.style.cursor="pointer"});c.addEventListener("click",function(h){g(h,this)})}};