function KellyColorPicker(t){var h,B,o,r,a,n=Math.PI,K=!0,U=new Object,l=!(U.radius=4),u=!1,c="quad",p=!1,d=!1,s=!0,g=new Array,y=new Array,v=document.createElement("canvas"),f=!1,m=!1,q=null,x=!1,X=!0,L="mixed",w=new Object,e=(w.tag=!1,!(w.margin=6)),b=this,O=2,C=200,S="#000000",z=1,D=!1,_=new Array,k=!1,F=new Array;function j(t,i,e){i=!!i;var s=new Object,i=(s.width,s.widthPercentage=22,s.imageData=null,s.align=t,s.selected=i,s.color="#ffffff",s.position,s.paddingY=-4,s.paddingX=4,s.lineWidth=1,s.selectSize=4,"right"==t&&(s.paddingX=-1*s.paddingX),s.selected&&(s.color=S),e&&(s.color=e),s.updateSize=function(){this.width=parseInt(C-C/100*(100-this.widthPercentage)),"left"==this.align?this.position={x:0,y:C-this.width}:"right"==this.align&&(this.position={x:C-this.width,y:C-this.width})},s.calcS=function(t){return Math.abs((t[1].x-t[0].x)*(t[2].y-t[0].y)-(t[2].x-t[0].x)*(t[1].y-t[0].y))/2},s.isDotIn=function(t){var i=new Array;"left"==this.align?(i[0]={x:this.position.x,y:this.position.y},i[1]={x:this.position.x,y:this.position.y+this.width},i[2]={x:this.position.x+this.width,y:this.position.y+this.width}):(i[0]={x:this.position.x+this.width,y:this.position.y},i[1]={x:i[0].x,y:i[0].y+this.width},i[2]={x:i[0].x-this.width,y:this.position.y+this.width});for(var e=0;e<=i.length-1;++e)i[e].x+=this.paddingX,i[e].y+=this.paddingY;var s=this.calcS(i),t=[{x:i[0].x,y:i[0].y},{x:i[1].x,y:i[1].y},{x:t.x,y:t.y}],o=this.calcS(t);return t[1]={x:i[2].x,y:i[2].y},o+=this.calcS(t),t[0]={x:i[1].x,y:i[1].y},o+=this.calcS(t),Math.ceil(o)==Math.ceil(s)},s.draw=function(){v.width=this.width,v.height=this.width,f.clearRect(0,0,this.width,this.width),f.beginPath(),"left"==this.align&&(f.moveTo(this.lineWidth/2,this.width-this.lineWidth),f.lineTo(this.width,this.width-this.lineWidth),f.lineTo(this.lineWidth,this.lineWidth),f.lineTo(this.lineWidth,this.width-this.lineWidth)),"right"==this.align&&(f.moveTo(this.lineWidth/2,this.width-this.lineWidth),f.lineTo(this.width-this.lineWidth,this.width-this.lineWidth),f.lineTo(this.width-this.lineWidth,this.lineWidth),f.lineTo(this.lineWidth,this.width-this.lineWidth)),this.selected&&(f.fillStyle="rgba(255,255,255, 1)",f.fill(),f.strokeStyle="rgba(0, 0, 0, 1)",f.stroke(),f.closePath(),f.beginPath(),f.lineWidth=this.lineWidth,"left"==this.align&&(f.moveTo(this.selectSize,this.width-this.selectSize),f.lineTo(this.width-2*this.selectSize,this.width-this.selectSize),f.lineTo(this.selectSize,2*this.selectSize),f.lineTo(this.selectSize,this.width-this.selectSize)),"right"==this.align)&&(f.moveTo(2*this.selectSize,this.width-this.selectSize),f.lineTo(this.width-this.selectSize,this.width-this.selectSize),f.lineTo(this.width-this.selectSize,2*this.selectSize),f.lineTo(2*this.selectSize,this.width-this.selectSize));var t=Z(this.color);f.fillStyle="rgba("+t.r+","+t.g+","+t.b+", 1)",f.fill(),f.strokeStyle="rgba(0, 0, 0, 1)",f.stroke(),this.imageData=f.getImageData(0,0,this.width,this.width),u.drawImage(v,this.position.x+this.paddingX,this.position.y+this.paddingY)},_.length);_[i]=s}var N,i,P=new Object,M=(P.width=18,P.imageData=null,P.innerRadius,P.startAngle=0,P.outerRadius,P.outerStrokeStyle="rgba(0,0,0,0.2)",P.innerStrokeStyle="rgba(0,0,0,0.2)",P.pos,P.draw=function(){if(this.imageData)u.putImageData(this.imageData,0,0);else{for(var t=this.startAngle,i=0;i<=360;i++){var e=tt(i-2),s=tt(i),e=(u.beginPath(),u.moveTo(o,o),u.arc(o,o,this.outerRadius,e,s,!1),u.closePath(),J(t/360,1,1));u.fillStyle="rgb("+e.r+", "+e.g+", "+e.b+")",u.fill(),360<=++t&&(t=0)}u.globalCompositeOperation="destination-out",u.beginPath(),u.arc(o,o,this.innerRadius,0,2*n),u.fill(),u.globalCompositeOperation="source-over",u.strokeStyle=this.innerStrokeStyle,u.lineWidth=2,u.stroke(),u.closePath(),u.beginPath(),u.arc(o,o,this.outerRadius,0,2*n),u.strokeStyle=this.outerStrokeStyle,u.lineWidth=2,u.stroke(),u.closePath(),this.imageData=u.getImageData(0,0,C,C)}},P.isDotIn=function(t){return Math.pow(this.pos.x-t.x,2)+Math.pow(this.pos.y-t.y,2)<Math.pow(this.outerRadius,2)&&Math.pow(this.pos.x-t.x,2)+Math.pow(this.pos.y-t.y,2)>Math.pow(this.innerRadius,2)},new Object),T=(M.lineWeight=2,M.height=4,M.paddingX=2,M.path,new Object),I=(T.width=18,T.padding=4,T.outerStrokeStyle="rgba(0,0,0,0.2)",T.innerStrokeStyle="rgba(0,0,0,0.2)",T.height,T.pos,T.updateSize=function(){this.pos={x:C+T.padding,y:T.padding},this.height=C-2*T.padding},T.draw=function(){var t=u.createLinearGradient(0,0,0,this.height);t.addColorStop(0,"rgba("+a.r+","+a.g+","+a.b+",1)"),t.addColorStop(1,"rgba("+a.r+","+a.g+","+a.b+",0)"),u.beginPath(),u.rect(this.pos.x,this.pos.y,this.width,this.height),u.fillStyle="white",u.fill(),u.fillStyle=t,u.fill(),u.strokeStyle="rgba(0,0,0, 0.2)",u.lineWidth=2,u.stroke(),u.closePath()},T.dotToAlpha=function(t){return 1-Math.abs(this.pos.y-t.y)/this.height},T.alphaToDot=function(t){return{x:0,y:this.height-this.height*t}},T.limitDotPosition=function(t){t=t.y;return(t=t<this.pos.y?this.pos.y:t)>this.pos.y+this.height&&(t=this.pos.y+this.height),{x:this.pos.x,y:t}},T.isDotIn=function(t){return!(t.x<this.pos.x||t.x>this.pos.x+T.width||t.y<this.pos.y||t.y>this.pos.y+this.height)},new Object);function H(t){var t=t.getBoundingClientRect(),i=0,e=0;return p&&(e=T.width+2*T.padding),t.width>t.height&&(i=t.height),t.height>t.width&&(i=t.width),i=parseInt(i),p&&(i-=e),!(i<=0)&&i}function Y(t,i){var e,s=1,o=!1;return(t=t.trim(t)).length<=7?3==(t="#"==t.charAt(0)?t.slice(1):t).length?o=t+t:6==t.length&&(o=t):"rgb"==t.substring(0,3)&&3<=(t=t.split(",")).length&&t.length<=4&&(t[0]=t[0].replace("rgba(",""),t[0]=t[0].replace("rgb(",""),(e={r:parseInt(t[0]),g:parseInt(t[1]),b:parseInt(t[2])}).r<=255)&&e.g<=255&&e.b<=255&&(o=$(e),4==t.length)&&1<(s=!(s=parseFloat(t[3]))||s<0?0:s)&&(s=1),(!1!==o||!i)&&{h:o="#"!=(o=!1===o?"000000":o).charAt(0)?"#"+o:o,a:s}}function G(){var t;return F.quad||((t=new Object).size,t.padding=2,t.path,t.imageData=null,t.dotToSv=function(t){return{s:Math.abs(this.path[3].x-t.x)/this.size,v:Math.abs(this.path[3].y-t.y)/this.size}},t.svToDot=function(t){var i=this.path[0].x,e=this.path[0].y,s=.02;C<150?s=.07:C<100&&(s=.16);for(var o=0;o<this.size;o++)for(var a=0;a<this.size;a++){var n={x:a+i,y:o+e},h=this.dotToSv(n),r=Math.abs(h.s-t.s),h=Math.abs(h.v-t.v);if(r<s&&h<s)return n}return{x:0,y:0}},t.limitDotPosition=function(t){var i=t.x,t=t.y;return{x:i=(i=i<this.path[0].x?this.path[0].x:i)>this.path[0].x+this.size?this.path[0].x+this.size:i,y:t=(t=t<this.path[0].y?this.path[0].y:t)>this.path[0].y+this.size?this.path[0].y+this.size:t}},t.draw=function(){this.imageData||(this.imageData=u.createImageData(this.size,this.size));for(var t=0,i=this.path[0].x,e=this.path[0].y,s=0;s<this.size;s++)for(var o=0;o<this.size;o++){var a=this.dotToSv({x:o+i,y:s+e}),a=J(r.h,a.s,a.v);this.imageData.data[t+0]=a.r,this.imageData.data[t+1]=a.g,this.imageData.data[t+2]=a.b,this.imageData.data[t+3]=255,t+=4}u.putImageData(this.imageData,i,e),u.beginPath(),u.strokeStyle="rgba(0,0,0, 0.2)",u.lineWidth=2;for(t=0;t<=this.path.length-1;++t)0==t?u.moveTo(this.path[t].x,this.path[t].y):u.lineTo(this.path[t].x,this.path[t].y);u.stroke(),u.closePath()},t.updateSize=function(){var t=2*P.innerRadius-2*M.paddingX-2*this.padding;this.size=Math.floor(t/Math.sqrt(2)),this.path=new Array,this.path[0]={x:this.size/2*-1,y:this.size/2*-1},this.path[1]={x:this.path[0].x+this.size,y:this.path[0].y},this.path[2]={x:this.path[1].x,y:this.path[1].y+this.size},this.path[3]={x:this.path[2].x-this.size,y:this.path[2].y},this.path[4]={x:this.path[0].x,y:this.path[0].y};for(var i=0;i<=this.path.length-1;++i)this.path[i].x+=P.pos.x,this.path[i].y+=P.pos.y},t.isDotIn=function(t){return!(t.x<this.path[0].x||t.x>this.path[0].x+this.size||t.y<this.path[0].y||t.y>this.path[0].y+this.size)},F.quad=t)}function V(){var t;return F.triangle||((t=new Object).size,t.padding=2,t.path,t.imageData=null,t.followWheel=!0,t.s,t.sOnTop=!1,t.outerRadius,t.limitDotPosition=function(t){var i=t.x,t=t.y,e=this.path[0].x,s=this.path[2].x,o=t,e=Math.min(Math.max(s,i),e),a=(this.path[0].y-this.path[1].y)/(this.path[0].x-this.path[1].x),n=Math.ceil(this.path[1].y+a*(e-this.path[1].x)),a=(this.path[0].y-this.path[2].y)/(this.path[0].x-this.path[2].x),a=Math.floor(this.path[2].y+a*(e-this.path[2].x));return i<s&&(P.pos.y,P.pos.x,o=t),{x:e,y:o=Math.min(Math.max(n,o),a)}},t.svToDot=function(t){var i=.02;C<150?i=.07:C<100&&(i=.16);for(var e=0;e<this.size;e++)for(var s=0;s<this.size;s++){var o={x:this.path[1].x+s,y:this.path[1].y+e};if(h.isDotIn(o)){var a=this.dotToSv(o),n=Math.abs(a.s-t.s),a=Math.abs(a.v-t.v);if(n<i&&a<i)return o}}return{x:0,y:0}},t.draw=function(){this.imageData||(this.imageData=f.createImageData(this.size,this.size)),v.width=this.size,v.height=this.size;for(var t=this.path[1].x,i=this.path[1].y,e=0,s=0;s<this.size;s++)for(var o=0;o<this.size;o++){var a={x:this.path[1].x+o,y:this.path[1].y+s};h.isDotIn(a)?(a=this.dotToSv(a),a=J(r.h,a.s,a.v),this.imageData.data[e+0]=a.r,this.imageData.data[e+1]=a.g,this.imageData.data[e+2]=a.b,this.imageData.data[e+3]=255):(this.imageData.data[e+0]=0,this.imageData.data[e+1]=0,this.imageData.data[e+2]=0,this.imageData.data[e+3]=0),e+=4}f.putImageData(this.imageData,0,0),u.drawImage(v,t,i),u.beginPath(),u.strokeStyle="rgba(0, 0, 0, 0.3)",u.lineWidth=2;for(var n=this.path,e=0;e<=n.length-1;++e)0==e?u.moveTo(n[e].x,n[e].y):u.lineTo(n[e].x,n[e].y);u.stroke(),u.closePath()},t.calcS=function(t){return Math.abs((t[1].x-t[0].x)*(t[2].y-t[0].y)-(t[2].x-t[0].x)*(t[1].y-t[0].y))/2},t.dotToSv=function(t){var i=function(t,i){var e=(i[0].x-i[1].x)*(i[0].x-i[1].x)+(i[0].y-i[1].y)*(i[0].y-i[1].y),t=(t.x-i[0].x)*(i[1].x-i[0].x)+(t.y-i[0].y)*(i[1].y-i[0].y),s=!0,t=t/e;t<0&&(t=0,s=!1);1<t&&(s=!(t=1));return{x:i[0].x+t*(i[1].x-i[0].x),y:i[0].y+t*(i[1].y-i[0].y),pt:s}}({x:t.x,y:t.y},this.vol),i=(i=i,e=this.vol[0],Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))),e=(i=(i=i<1?Math.floor(i):i)>this.h-1?this.h:i)/this.h,i=Math.abs(et(t,this.sSide));return i<30&&(i=30),i=60-(i-=30),{s:i/=60,v:e}},t.isDotIn=function(t){var t=[{x:this.path[0].x,y:this.path[0].y},{x:this.path[1].x,y:this.path[1].y},{x:t.x,y:t.y}],i=this.calcS(t);return t[1]={x:this.path[2].x,y:this.path[2].y},i+=this.calcS(t),t[0]={x:this.path[1].x,y:this.path[1].y},i+=this.calcS(t),Math.ceil(i)==Math.ceil(this.s)},t.updateSize=function(){this.outerRadius=P.innerRadius-M.paddingX-this.padding,this.size=Math.floor(2*this.outerRadius*Math.sin(tt(60)));var t=Math.sqrt(3)/2*this.size;this.h=Math.sqrt(3)/2*this.size,this.path=new Array,this.path[0]={x:this.outerRadius,y:0},this.path[1]={x:this.path[0].x-t,y:this.size/2*-1},this.path[2]={x:this.path[1].x,y:this.size/2},this.path[3]={x:this.path[0].x,y:this.path[0].y};for(var i,e=0;e<=this.path.length-1;++e)this.path[e].x+=P.pos.x,this.path[e].y+=P.pos.y;this.vol=new Array,this.s=this.calcS(this.path),this.sOnTop?(i=it(this.path[0],this.path[2]),this.vol[0]={x:this.path[1].x,y:this.path[1].y},this.vol[1]={x:i.x,y:i.y},this.sSide=this.path[1]):(i=it(this.path[0],this.path[1]),this.vol[0]={x:this.path[2].x,y:this.path[2].y},this.vol[1]={x:i.x,y:i.y},this.sSide=this.path[2])},F.triangle=t)}function W(t,i,e,s){(t="object"!=typeof t?document.getElementById(t):t)&&(g[(s=s||"")+i]=e,t.addEventListener?t.addEventListener(i,g[s+i]):t.attachEvent("on"+i,g[s+i]))}function R(t,i,e){(t="object"!=typeof t?document.getElementById(t):t)&&g[(e=e||"")+i]&&(t.removeEventListener?t.removeEventListener(i,g[e+i]):t.detachEvent("on"+i,g[e+i]),g[e+i]=null)}function J(t,i,e){var s,o,a,n,h,r,l;switch(t&&void 0===i&&void 0===e&&(i=t.s,e=t.v,t=t.h),h=e*(1-i),r=e*(1-(n=6*t-(t=Math.floor(6*t)))*i),l=e*(1-(1-n)*i),t%6){case 0:s=e,o=l,a=h;break;case 1:s=r,o=e,a=h;break;case 2:s=h,o=e,a=l;break;case 3:s=h,o=r,a=e;break;case 4:s=l,o=h,a=e;break;case 5:s=e,o=h,a=r}return{r:Math.floor(255*s),g:Math.floor(255*o),b:Math.floor(255*a)}}function Q(t,i,e){t&&void 0===i&&void 0===e&&(i=t.g,e=t.b,t=t.r),t/=255,i/=255,e/=255;var s,o=Math.max(t,i,e),a=Math.min(t,i,e),n=o,h=o-a,r=0==o?0:h/o;if(o==a)s=0;else{switch(o){case t:s=(i-e)/h+(i<e?6:0);break;case i:s=(e-t)/h+2;break;case e:s=(t-i)/h+4}s/=6}return{h:s,s:r,v:n}}function Z(t){t=parseInt("#"==t.charAt(0)?t.slice(1):t,16);return{r:t>>16,g:t>>8&255,b:255&t}}function $(t){function i(t){return 1===(t=t.toString(16)).length?"0"+t:t}return"#"+i(t.r)+i(t.g)+i(t.b)}function tt(t){return t*(n/180)}function it(t,i){return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}function et(t,i,e){var s=t.x-(i=i||{x:0,y:0}).x,t=t.y-i.y,i=180*Math.atan2(t,s)/n;return i=e&&i<0?360+i:i}function st(){B=O+M.paddingX,m=!1,P.imageData=null,o=C/2,P.pos={x:o,y:o},P.outerRadius=o-B,P.innerRadius=P.outerRadius-P.width,M.path=[{x:P.innerRadius-M.paddingX,y:-1*M.height},{x:P.outerRadius+M.paddingX,y:-1*M.height},{x:P.outerRadius+M.paddingX,y:M.height},{x:P.innerRadius-M.paddingX,y:M.height},{x:P.innerRadius-M.paddingX,y:-1*M.height}];var t=C;p&&(t+=T.width+2*T.padding),"CANVAS"!=e.tagName&&(e.style.width=t+"px",e.style.height=C+"px"),l.width=t,l.height=C;for(var i=0;i<=_.length-1;++i)_[i].updateSize();k&&(k.imageData.triangle=null,k.imageData.quad=null,k.updateSize()),h.updateSize(),p&&T.updateSize()}function ot(t){if(x){if(y.updateinput)if(!(0,y.updateinput)(b,x,t))return;var i="rgba("+a.r+", "+a.g+", "+a.b+", "+z.toFixed(2)+")";t||(x.value=!(z<1&&"mixed"===L||"hex"!==L&&"mixed"!==L)?S:i),X&&(r.v<.5?x.style.color="#FFF":x.style.color="#000",x.style.background=i)}}function at(){W(l,"mousedown",function(t){b.mouseDownEvent(t)},"wait_action_"),W(l,"touchstart",function(t){b.mouseDownEvent(t)},"wait_action_"),W(l,"mouseout",function(t){b.mouseOutEvent(t)},"wait_action_"),W(window,"touchmove",function(t){b.touchMoveEvent(t)},"wait_action_"),W(l,"mousemove",function(t){b.mouseMoveRest(t)},"wait_action_")}function nt(){R(l,"mousedown","wait_action_"),R(l,"touchstart","wait_action_"),R(l,"mouseout","wait_action_"),R(window,"touchmove","wait_action_"),R(l,"mousemove","wait_action_")}function A(t){t=t||window.event;var i,e,s=document.body.scrollLeft+document.documentElement.scrollLeft,o=document.body.scrollTop+document.documentElement.scrollTop;if(t.touches)try{i=t.touches[0].clientX+s,e=t.touches[0].clientY+o}catch(t){}else i=t.clientX+s,e=t.clientY+o;var a=l.getBoundingClientRect();return{x:i-=a.left+s,y:e-=a.top+o}}function ht(t){for(var i=!1,e=0;e<=_.length-1;++e)_[e].selected&&(i=e),_[e].selected=!1;for(var s=!1,e=0;e<=_.length-1;++e)if(e==t){_[e].selected=!0,b.setColorByHex(_[e].color),s=!0;break}s&&y.selectcolorsaver&&(0,y.selectcolorsaver)(b,_[t]),s||!1===i||(_[i].selected=!0)}function rt(){for(var t=0;t<=_.length-1;++t)_[t].selected&&(_[t].color=S)}function lt(){if(_.length)for(var t=0;t<=_.length-1;++t)_[t].draw()}function E(){if(u&&(u.clearRect(0,0,l.width,l.height),m?(u.putImageData(q,0,0),lt()):(P.draw(),h.draw(),p&&T.draw(),lt(),k&&k.draw(),d||(q=u.getImageData(0,0,l.width,l.height),m=!0)),1)){for(var t,i=360*r.h-P.startAngle,e=(p&&(u.beginPath(),t=T.height*(1-z),u.rect(T.pos.x-2,T.padding+t-1,T.width+4,2),u.strokeStyle="rgba(0,0,0, 0.8)",u.lineWidth=2,u.stroke(),u.closePath()),u.beginPath(),function(t,i){i=tt(i);for(var e=new Array,s=0;s<=t.length-1;++s)e[s]={x:t[s].x*Math.cos(i)-t[s].y*Math.sin(i),y:t[s].x*Math.sin(i)+t[s].y*Math.cos(i)};return e}(M.path,i,(P.pos.x,P.pos.y))),s=0;s<=e.length-1;++s)e[s].x+=P.pos.x,e[s].y+=P.pos.y,0==s?u.moveTo(e[s].x,e[s].y):u.lineTo(e[s].x,e[s].y);u.strokeStyle="rgba(0,0,0,0.8)",u.lineWidth=M.lineWeight,u.stroke(),u.closePath(),.5<r.v&&r.s<.5?u.strokeStyle="rgba(0, 0, 0, 1)":u.strokeStyle="rgba(255, 255, 255, 1)",u.beginPath(),u.lineWidth=2,u.arc(r.x,r.y,U.radius,0,2*n),u.stroke(),u.closePath()}}I.svCursorData=null,I.stCursor=null,I.curType=0,I.size=16,I.initSvCursor=function(){if(!l)return!1;var t=document.body;if(this.curType=1,this.stCursor||(this.stCursor=t.style.cursor),this.stCursor||(this.stCursor="auto"),this.svCursorData)t.style.cursor=this.svCursorData;else{if(!v)return!1;var i=this.size+2,e=(v.width=i,v.height=i,f.clearRect(0,0,this.size,this.size),f.strokeStyle="rgba(255, 255, 255, 1)",f.beginPath(),f.lineWidth=2,f.arc(i/2,i/2,this.size/2,0,2*n),f.stroke(),f.closePath(),v.toDataURL());if(this.svCursorData="url("+e+") "+i/2+" "+i/2+", auto",!this.svCursorData)return!1;t.style.cursor=this.svCursorData,-1===t.style.cursor.indexOf(e)&&(this.svCursorData="crosshair",t.style.cursor="crosshair")}return!0},I.initStandartCursor=function(){this.stCursor&&(I.curType=0,document.body.style.cursor=this.stCursor)},I.updateCursor=function(t){!K||KellyColorPicker.cursorLock||(h.isDotIn(t)?I.initSvCursor():I.initStandartCursor())},this.popUpClose=function(t){if(!1!==w.tag){if(t){if(t.target==x||t.target==l)return!1;if(t.target==w.tag)return!1}w.tag.style.display="none",KellyColorPicker.activePopUp==b&&(KellyColorPicker.activePopUp=!1)}},this.popUpShow=function(t){if(!1!==w.tag){if(y.popupshow)if(!(0,y.popupshow)(b,t))return;KellyColorPicker.popupEventsInclude||(W(document,"click",function(t){return!!KellyColorPicker.activePopUp&&KellyColorPicker.activePopUp.popUpClose(t)},"popup_close_"),W(window,"resize",function(t){if(KellyColorPicker.activePopUp)return KellyColorPicker.activePopUp.popUpShow(t)},"popup_resize_"),KellyColorPicker.popupEventsInclude=!0),KellyColorPicker.activePopUp&&KellyColorPicker.activePopUp.popUpClose(!1);var t=b.getCanvas().width,i=b.getAlphaFig(),i=(i&&(t-=i.width+i.padding),parseInt(w.tag.style.paddingBottom)+parseInt(w.tag.style.paddingTop)),e=(i<=0&&(i=0),x.getBoundingClientRect()),i=e.top+(window.scrollY||window.pageYOffset||document.body.scrollTop)-i,e=e.left+(window.scrollX||window.pageXOffset||document.body.scrollLeft);return w.tag.style.top=i-t-w.margin+"px",w.tag.style.left=e+"px",w.tag.style.display="block",KellyColorPicker.activePopUp=b,!1}},this.setHueByDot=function(t){t=et(t,P.pos)+P.startAngle;r.h=(t=t<0?360+t:t)/360,a=J(r.h,r.s,r.v),S=$(a),rt(),y.change&&(0,y.change)(b),ot(),m=!1,E()},this.setColorForColorSaver=function(t,i){var e=Y(t,!0);if(e)return(i=b.getColorSaver(i)).selected?this.setColorByHex(t,!1):(i.color=e.h,E()),!0},this.setColorByHex=function(t,i){i=i||!1;var e=z;if(!1!==t){if(!t||!t.length)return;var s=Y(t,!0);if(!s)return;t=s.h,p&&(e=s.a)}else t=S;p&&t==S&&m&&e!=z?(z=e,E()):S&&t==S&&m||(z=e,a=Z(t),S=t,r=Q(a),s=h.svToDot(r),r.x=s.x,r.y=s.y,m=!1,rt(),E(),y.change&&(0,y.change)(b),ot(i))},this.setAlphaByDot=function(t){z=T.dotToAlpha(t),y.change&&(0,y.change)(b),ot(),E()},this.setAlpha=function(t){z=t,ot(),E()},this.setColorByDot=function(t){var i=h.dotToSv(t);r.s=i.s,r.v=i.v,r.x=t.x,r.y=t.y,1<r.s&&(r.s=1),r.s<0&&(r.s=0),1<r.v&&(r.v=1),r.v<0&&(r.v=0),a=J(r.h,r.s,r.v),S=$(a),rt(),y.change&&(0,y.change)(b),ot(),E()},this.mouseOutEvent=function(t){0<I.curType&&!KellyColorPicker.cursorLock&&I.initStandartCursor()},this.mouseMoveRest=function(t){var i;d||s&&(s=!1,i=A(t),I.updateCursor(i),requestAnimationFrame(function(){s=!0}),y.mousemoverest)&&(0,y.mousemoverest)(t,b,i)},this.touchMoveEvent=function(t){d&&event.preventDefault()},this.mouseDownEvent=function(t){t.preventDefault();var i,e=!1,s=A(t);if(P.isDotIn(s))d="wheel",b.setHueByDot(s),i=function(t){b.wheelMouseMove(t,s)},e=function(t){KellyColorPicker.cursorLock=!1,b.wheelMouseUp(t,s)};else if(h.isDotIn(s))d="sv",b.setColorByDot(s),i=function(t){b.svMouseMove(t,s)},e=function(t){KellyColorPicker.cursorLock=!1,b.svMouseUp(t,s)};else if(p&&T.isDotIn(s))d="alpha",b.setAlphaByDot(s),i=function(t){b.alphaMouseMove(t,s)},e=function(t){KellyColorPicker.cursorLock=!1,b.alphaMouseUp(t,s)};else if(k&&k.isDotIn(s))b.setMethod();else if(_.length)for(var o=0;o<=_.length-1;++o)if(_[o].isDotIn(s)){ht(o);break}i&&e&&(nt(),KellyColorPicker.cursorLock=b,W(document,"mouseup",e,"action_process_"),W(document,"mousemove",i,"action_process_"),W(document,"touchend",e,"action_process_"),W(document,"touchmove",i,"action_process_"))},this.wheelMouseMove=function(t,i){var e;t.preventDefault(),d&&s&&(s=!1,e=A(t),requestAnimationFrame(function(){s=!0}),b.setHueByDot(e),y.mousemoveh)&&(0,y.mousemoveh)(t,b,e)},this.wheelMouseUp=function(t,i){var e;t.preventDefault(),d&&(R(document,"mouseup","action_process_"),R(document,"mousemove","action_process_"),R(document,"touchend","action_process_"),R(document,"touchmove","action_process_"),at(),m=d=!1,E(),e=A(t),I.updateCursor(e),y.mouseuph)&&(0,y.mouseuph)(t,b,e)},this.alphaMouseMove=function(t,i){var e;t.preventDefault(),d&&s&&(s=!1,e=A(t),e=T.limitDotPosition(e),requestAnimationFrame(function(){s=!0}),b.setAlphaByDot(e),y.mousemovealpha)&&(0,y.mousemovealpha)(t,b,e)},this.alphaMouseUp=function(t,i){var e;t.preventDefault(),d&&(R(document,"mouseup","action_process_"),R(document,"mousemove","action_process_"),R(document,"touchend","action_process_"),R(document,"touchmove","action_process_"),at(),d=!1,e=A(t),I.updateCursor(e),y.mouseupalpha)&&(0,y.mouseupalpha)(t,b,e)},this.svMouseMove=function(t,i){var e;t.preventDefault(),d&&s&&(s=!1,e=A(t),e=h.limitDotPosition(e),requestAnimationFrame(function(){s=!0}),b.setColorByDot(e),y.mousemovesv)&&(0,y.mousemovesv)(t,b,e)},this.svMouseUp=function(t,i){var e;t.preventDefault(),d&&(R(document,"mouseup","action_process_"),R(document,"mousemove","action_process_"),R(document,"touchend","action_process_"),R(document,"touchmove","action_process_"),at(),d=!1,e=A(t),I.updateCursor(e),y.mouseupsv)&&(0,y.mouseupsv)(t,b,e)},this.addUserEvent=function(t,i){return y[t]=i,!0},this.removeUserEvent=function(t){return!!y[t]&&!(y[t]=null)},this.getCanvas=function(){return!!u&&l},this.getCtx=function(){return u||!1},this.getInput=function(){return x},this.getSvFig=function(){return h},this.getSvFigCursor=function(){return U},this.getWheel=function(){return P},this.getWheelCursor=function(){return M},this.getCurColorHsv=function(){return r},this.getCurColorRgb=function(){return a},this.getCurColorHex=function(){return S},this.getCurColorRgba=function(){return{r:a.r,g:a.g,b:a.b,a:z}},this.getCurAlpha=function(){return z},this.getAlphaFig=function(){return!!p&&T},this.getPopup=function(){return w},this.getSize=function(){return C},this.getColorSaver=function(t){for(var i=0;i<=_.length-1;++i)if(!t&&_[i].selected||_[i].align==t)return _[i].rgb=Z(_[i].color),_[i].hsv=Q(_[i].rgb.r,_[i].rgb.g,_[i].rgb.b),_[i]},this.setColorSaver=function(t){if(!t)return!1;for(var i=0;i<=_.length-1;++i)if(_[i].align==t)return ht(i),_[i]},this.updateView=function(t){return!!u&&(t&&(P.imageData=null,h.imageData=null,q=null),m=!1,st(),E(),!0)},this.resize=function(t,i){if(u){if(t==C&&!i)return!0;m=!1,P.imageData=null,h.imageData=null,q=null,C=t,st(),b.setColorByHex(!1)}return!1},this.syncSize=function(t){var i;return D&&(i=H(D))&&b.resize(i),!1},this.setMethod=function(t){return t||(t="triangle")==c&&(t="quad"),t!=c&&("quad"==c||"triangle"==c)&&("quad"==(c=t)&&(h=G()),"triangle"==c&&(h=V()),b.resize(C,!0),y.setmethod&&(0,y.setmethod)(b,c),!0)},this.destroy=function(){if(!b)return!1;0<I.curType&&(KellyColorPicker.cursorLock=!1,I.initStandartCursor()),d&&(R(document,"mouseup","action_process_"),R(document,"mousemove","action_process_"),R(document,"touchend","action_process_"),R(document,"touchmove","action_process_"),d=!1),w.tag&&R(x,"click","popup_"),x&&(R(x,"click","input_edit_"),R(x,"change","input_edit_"),R(x,"keyup","input_edit_"),R(x,"keypress","input_edit_")),KellyColorPicker.popupEventsInclude&&g.popup_close_click&&(KellyColorPicker.activePopUp&&KellyColorPicker.activePopUp.popUpClose(!1),R(document,"click","popup_close_"),R(window,"resize","popup_resize_"),KellyColorPicker.popupEventsInclude=!1),P.imageData=null,h.imageData=null,v=q=null,e&&e.parentNode&&e.parentNode.removeChild(e),D&&R(window,"resize","canvas_"),nt(),b=null},i=N="",void 0!==(t=t).alpha_slider&&(t.alphaSlider=t.alpha_slider),void 0!==t.input_color&&(t.inputColor=t.input_color),void 0!==t.input_format&&(t.inputFormat=t.input_format),t.input&&"object"!=typeof t.input?(t.input=document.getElementById(t.input),x=t.input):"object"==typeof t.input&&(x=t.input),void 0!==t.changeCursor&&(K=t.changeCursor),void 0!==t.alpha&&(z=t.alpha),void 0!==t.alphaSlider&&(p=t.alphaSlider),void 0!==t.inputColor&&(X=t.inputColor),void 0!==t.inputFormat&&(L=t.inputFormat),t.userEvents&&(y=t.userEvents),t.place&&"object"!=typeof t.place&&(i=t.place,t.place=document.getElementById(t.place)),t.resizeWith&&("object"!=typeof t.resizeWith&&(t.resizeWith=document.getElementById(t.resizeWith)),D=t.resizeWith)&&(H(D)&&(t.size=H(D)),W(window,"resize",function(t){return b.syncSize(t)},"canvas_")),t.place?e=t.place:x?(w.tag=document.createElement("div"),w.tag.className="popup-kelly-color",t.popupClass?w.tag.className=t.inputClassName:(w.tag.className="popup-kelly-color",w.tag.style.position="absolute",w.tag.style.bottom="0px",w.tag.style.left="0px",w.tag.style.display="none",w.tag.style.backgroundColor="#e1e1e1",w.tag.style.border="1px solid #bfbfbf",w.tag.style.boxShadow="7px 7px 14px -3px rgba(0,0,0,0.24)",w.tag.style.borderTopLeftRadius="4px",w.tag.style.borderTopRightRadius="4px",w.tag.style.borderBottomLeftRadius="4px",w.tag.style.borderBottomRightRadius="4px",w.tag.style.padding="12px",w.tag.style.boxSizing="content-box"),e=w.tag,document.getElementsByTagName("body")[0].appendChild(w.tag),W(x,"click",function(t){return b.popUpShow(t)},"popup_")):N+='| "place" ('+i+") not not found",t.size&&0<t.size&&(C=t.size),i=!1,t.color?i=Y(t.color):x&&x.value&&(i=Y(x.value)),i&&(S=i.h,p)&&(z=i.a),!t.method||"triangle"!=t.method&&"quad"!=t.method||(c=t.method),function(){if(!e)return;"CANVAS"!=e.tagName?(l=document.createElement("CANVAS"),e.appendChild(l)):l=e;void 0!==window.G_vmlCanvasManager&&(l=window.G_vmlCanvasManager.initElement(l),v=window.G_vmlCanvasManager.initElement(v));return l.getContext&&l.getContext("2d")&&(u=l.getContext("2d"),f=v.getContext("2d"),1)}()||(N+=" | cant init canvas context"),N?"undefined"!=typeof console&&console.log("KellyColorPicker : "+N):("quad"==c&&(h=G()),"triangle"==c&&(h=V()),x&&(W(x,"click",i=function(t){(t=t||window.event).target||(t.target=t.srcElement),b.setColorByHex(t.target.value,!0)},"input_edit_"),W(x,"change",i,"input_edit_"),W(x,"keyup",i,"input_edit_"),W(x,"keypress",i,"input_edit_")),t.colorSaver&&(j("left",!0),j("right")),t.methodSwitch&&((k=new Object).size,k.sizePercentage=10,k.position,k.paddingY=4,k.paddingX=4,k.imageData=new Array,k.lineWidth=2,k.color="#c1ebf5",k.updateSize=function(){this.size=parseInt(C-C/100*(100-this.sizePercentage)),this.size<16&&(this.size=16),this.position={x:this.paddingX,y:this.paddingY}},k.draw=function(){var t,i,e,s,o,a;this.imageData[c]?u.putImageData(this.imageData[c],this.position.x,this.position.y):(t=Z(this.color),v.width=this.size,v.height=this.size,f.clearRect(0,0,this.size,this.size),f.beginPath(),a="triangle"==c?"quad":"triangle",f.beginPath(),this.size<35?e=i=v.width/2:(i=v.width/2-this.lineWidth,f.arc(this.size/2,this.size/2,i,0,2*n),f.strokeStyle="rgba(0, 0, 0, 0.4)",f.lineWidth=this.lineWidth,f.stroke(),e=i-6,f.closePath(),f.beginPath(),f.arc(this.size/2,this.size/2,e,0,2*n),f.strokeStyle="rgba(0, 0, 0, 0.4)",f.lineWidth=this.lineWidth,f.stroke(),f.closePath()),f.beginPath(),"quad"==a?(s=Math.floor((2*e-4)/Math.sqrt(2)),(o={x:(a=(this.size-s)/2)+s,y:a+s/2}).y=o.y-s/2,f.moveTo(o.x,o.y),f.lineTo(o.x-s,o.y),f.lineTo(o.x-s,o.y+s),f.lineTo(o.x,o.y+s)):(s=Math.floor((2*e-4)*Math.sin(tt(60))),o={x:2*e+(i-e),y:this.size/2},a=Math.sqrt(3)/2*s,f.moveTo(o.x,o.y),f.lineTo(o.x-a,o.y-s/2),f.lineTo(o.x-a,o.y+s/2),f.lineTo(o.x,o.y)),f.lineTo(o.x,o.y),f.fillStyle="rgba("+t.r+","+t.g+","+t.b+", 1)",f.fill(),f.lineWidth=this.lineWidth,f.strokeStyle="rgba(0, 0, 0, 0.6)",f.stroke(),f.closePath(),this.imageData[c]=f.getImageData(0,0,v.width,v.width),u.drawImage(v,this.position.x,this.position.y))},k.isDotIn=function(t){return t.x>=this.position.x&&t.x<=this.position.x+this.size&&t.y>=this.position.y&&t.y<=this.position.y+this.size}),at(),st(),b.setColorByHex(!1))}KellyColorPicker.cursorLock=!1,KellyColorPicker.activePopUp=!1,KellyColorPicker.popupEventsInclude=!1,KellyColorPicker.attachToInputByClass=function(t,i){for(var e=new Array,s=document.getElementsByClassName(t),o=0;o<s.length;o++)i?i.input=s[o]:i={input:s[o],size:150},e.push(new KellyColorPicker(i));return e};