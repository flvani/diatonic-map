function KellyColorPicker(p){var k=Math.PI;var M;var T=true;var ao=new Object;ao.radius=4;var q=false;var I=false;var an="quad";var af=false;var j=false;var P=true;var L=new Array();var J=new Array();var G=document.createElement("canvas");var n=false;var ad=false;var x=null;var f=false;var ak=true;var am="mixed";var O=new Object;O.tag=false;O.margin=6;var h=false;var Q=this;var S=2;var ag;var B=200;var b;var r;var o;var V="#000000";var aq=1;var ah=false;var al=new Array();var i=false;var s=new Array();function U(){i=new Object;i.size;i.sizePercentage=10;i.position;i.paddingY=4;i.paddingX=4;i.imageData=new Array();i.lineWidth=2;i.color="#c1ebf5";i.updateSize=function(){this.size=parseInt(B-(B/100)*(100-this.sizePercentage));if(this.size<16){this.size=16}this.position={x:this.paddingX,y:this.paddingY}};i.draw=function(){if(this.imageData[an]){I.putImageData(this.imageData[an],this.position.x,this.position.y);return}var ay=W(this.color);G.width=this.size;G.height=this.size;n.clearRect(0,0,this.size,this.size);n.beginPath();var at="triangle";if(an=="triangle"){at="quad"}n.beginPath();if(this.size<35){var ax=G.width/2;var aA=ax}else{var ax=(G.width/2)-this.lineWidth;n.arc(this.size/2,this.size/2,ax,0,k*2);n.strokeStyle="rgba(0, 0, 0, 0.4)";n.lineWidth=this.lineWidth;n.stroke();var aA=ax-6;n.closePath();n.beginPath();n.arc(this.size/2,this.size/2,aA,0,k*2);n.strokeStyle="rgba(0, 0, 0, 0.4)";n.lineWidth=this.lineWidth;n.stroke();n.closePath()}n.beginPath();var aw;if(at=="quad"){var au=(aA*2)-4;aw=Math.floor(au/Math.sqrt(2));var az=(this.size-aw)/2;var a={x:az+aw,y:az+aw/2};a.y=a.y-(aw/2);n.moveTo(a.x,a.y);n.lineTo(a.x-aw,a.y);n.lineTo(a.x-aw,a.y+aw);n.lineTo(a.x,a.y+aw)}else{aw=Math.floor((2*aA-4)*Math.sin(Y(60)));var a={x:aA*2+(ax-aA),y:this.size/2};var av=((Math.sqrt(3)/2)*aw);n.moveTo(a.x,a.y);n.lineTo(a.x-av,a.y-(aw/2));n.lineTo(a.x-av,a.y+(aw/2));n.lineTo(a.x,a.y)}n.lineTo(a.x,a.y);n.fillStyle="rgba("+ay.r+","+ay.g+","+ay.b+", 1)";n.fill();n.lineWidth=this.lineWidth;n.strokeStyle="rgba(0, 0, 0, 0.6)";n.stroke();n.closePath();this.imageData[an]=n.getImageData(0,0,G.width,G.width);I.drawImage(G,this.position.x,this.position.y)};i.isDotIn=function(a){if(a.x>=this.position.x&&a.x<=this.position.x+this.size&&a.y>=this.position.y&&a.y<=this.position.y+this.size){return true}return false}}function ar(aw,au,a){if(!au){au=false}else{au=true}var av=new Object;av.width;av.widthPercentage=22;av.imageData=null;av.align=aw;av.selected=au;av.color="#ffffff";av.position;av.paddingY=-4;av.paddingX=4;av.lineWidth=1;av.selectSize=4;if(aw=="right"){av.paddingX=av.paddingX*-1}if(av.selected){av.color=V}if(a){av.color=a}av.updateSize=function(){this.width=parseInt(B-(B/100)*(100-this.widthPercentage));if(this.align=="left"){this.position={x:0,y:B-this.width}}else{if(this.align=="right"){this.position={x:B-this.width,y:B-this.width}}}};av.calcS=function(ax){return Math.abs((ax[1].x-ax[0].x)*(ax[2].y-ax[0].y)-(ax[2].x-ax[0].x)*(ax[1].y-ax[0].y))/2};av.isDotIn=function(ax){var aB=new Array();if(this.align=="left"){aB[0]={x:this.position.x,y:this.position.y};aB[1]={x:this.position.x,y:this.position.y+this.width};aB[2]={x:this.position.x+this.width,y:this.position.y+this.width}}else{aB[0]={x:this.position.x+this.width,y:this.position.y};aB[1]={x:aB[0].x,y:aB[0].y+this.width};aB[2]={x:aB[0].x-this.width,y:this.position.y+this.width}}for(var az=0;az<=aB.length-1;++az){aB[az].x+=this.paddingX;aB[az].y+=this.paddingY}var aC=this.calcS(aB);var ay=[{x:aB[0].x,y:aB[0].y},{x:aB[1].x,y:aB[1].y},{x:ax.x,y:ax.y}];var aA=this.calcS(ay);ay[1]={x:aB[2].x,y:aB[2].y};aA+=this.calcS(ay);ay[0]={x:aB[1].x,y:aB[1].y};aA+=this.calcS(ay);if(Math.ceil(aA)==Math.ceil(aC)){return true}else{return false}};av.draw=function(){G.width=this.width;G.height=this.width;n.clearRect(0,0,this.width,this.width);n.beginPath();if(this.align=="left"){n.moveTo(this.lineWidth/2,this.width-this.lineWidth);n.lineTo(this.width,this.width-this.lineWidth);n.lineTo(this.lineWidth,this.lineWidth);n.lineTo(this.lineWidth,this.width-this.lineWidth)}if(this.align=="right"){n.moveTo(this.lineWidth/2,this.width-this.lineWidth);n.lineTo(this.width-this.lineWidth,this.width-this.lineWidth);n.lineTo(this.width-this.lineWidth,this.lineWidth);n.lineTo(this.lineWidth,this.width-this.lineWidth)}if(this.selected){n.fillStyle="rgba(255,255,255, 1)";n.fill();n.strokeStyle="rgba(0, 0, 0, 1)";n.stroke();n.closePath();n.beginPath();n.lineWidth=this.lineWidth;if(this.align=="left"){n.moveTo(this.selectSize,this.width-this.selectSize);n.lineTo(this.width-this.selectSize*2,this.width-this.selectSize);n.lineTo(this.selectSize,this.selectSize*2);n.lineTo(this.selectSize,this.width-this.selectSize)}if(this.align=="right"){n.moveTo(this.selectSize*2,this.width-this.selectSize);n.lineTo(this.width-this.selectSize,this.width-this.selectSize);n.lineTo(this.width-this.selectSize,this.selectSize*2);n.lineTo(this.selectSize*2,this.width-this.selectSize)}}var ax=W(this.color);n.fillStyle="rgba("+ax.r+","+ax.g+","+ax.b+", 1)";n.fill();n.strokeStyle="rgba(0, 0, 0, 1)";n.stroke();this.imageData=n.getImageData(0,0,this.width,this.width);I.drawImage(G,this.position.x+this.paddingX,this.position.y+this.paddingY)};var at=al.length;al[at]=av}var A=new Object;A.width=18;A.imageData=null;A.innerRadius;A.startAngle=0;A.outerRadius;A.outerStrokeStyle="rgba(0,0,0,0.2)";A.innerStrokeStyle="rgba(0,0,0,0.2)";A.pos;A.draw=function(){if(this.imageData){I.putImageData(this.imageData,0,0)}else{var a=this.startAngle;for(var av=0;av<=360;av++){var au=Y(av-2);var at=Y(av);I.beginPath();I.moveTo(b,b);I.arc(b,b,this.outerRadius,au,at,false);I.closePath();var aw=Z(a/360,1,1);I.fillStyle="rgb("+aw.r+", "+aw.g+", "+aw.b+")";I.fill();a++;if(a>=360){a=0}}I.globalCompositeOperation="destination-out";I.beginPath();I.arc(b,b,this.innerRadius,0,k*2);I.fill();I.globalCompositeOperation="source-over";I.strokeStyle=this.innerStrokeStyle;I.lineWidth=2;I.stroke();I.closePath();I.beginPath();I.arc(b,b,this.outerRadius,0,k*2);I.strokeStyle=this.outerStrokeStyle;I.lineWidth=2;I.stroke();I.closePath();this.imageData=I.getImageData(0,0,B,B)}};A.isDotIn=function(a){if(Math.pow(this.pos.x-a.x,2)+Math.pow(this.pos.y-a.y,2)<Math.pow(this.outerRadius,2)){if(Math.pow(this.pos.x-a.x,2)+Math.pow(this.pos.y-a.y,2)>Math.pow(this.innerRadius,2)){return true}}return false};var D=new Object;D.lineWeight=2;D.height=4;D.paddingX=2;D.path;var N=new Object;N.width=18;N.padding=4;N.outerStrokeStyle="rgba(0,0,0,0.2)";N.innerStrokeStyle="rgba(0,0,0,0.2)";N.height;N.pos;N.updateSize=function(){this.pos={x:B+N.padding,y:N.padding};this.height=B-N.padding*2};N.draw=function(){var a=I.createLinearGradient(0,0,0,this.height);a.addColorStop(0,"rgba("+o.r+","+o.g+","+o.b+",1)");a.addColorStop(1,"rgba("+o.r+","+o.g+","+o.b+",0)");I.beginPath();I.rect(this.pos.x,this.pos.y,this.width,this.height);I.fillStyle="white";I.fill();I.fillStyle=a;I.fill();I.strokeStyle="rgba(0,0,0, 0.2)";I.lineWidth=2;I.stroke();I.closePath()};N.dotToAlpha=function(a){return 1-Math.abs(this.pos.y-a.y)/this.height
};N.alphaToDot=function(a){return{x:0,y:this.height-(this.height*a)}};N.limitDotPosition=function(a){var at=a.y;if(at<this.pos.y){at=this.pos.y}if(at>this.pos.y+this.height){at=this.pos.y+this.height}return{x:this.pos.x,y:at}};N.isDotIn=function(a){if(a.x<this.pos.x||a.x>this.pos.x+N.width||a.y<this.pos.y||a.y>this.pos.y+this.height){return false}return true};var ab=new Object;ab.svCursorData=null;ab.stCursor=null;ab.curType=0;ab.size=16;ab.initSvCursor=function(){if(!q){return false}var at=document.body;this.curType=1;if(!this.stCursor){this.stCursor=at.style.cursor}if(!this.stCursor){this.stCursor="auto"}if(this.svCursorData){at.style.cursor=this.svCursorData;return true}if(!G){return false}var a=this.size+2;G.width=a;G.height=a;n.clearRect(0,0,this.size,this.size);n.strokeStyle="rgba(255, 255, 255, 1)";n.beginPath();n.lineWidth=2;n.arc(a/2,a/2,this.size/2,0,k*2);n.stroke();n.closePath();var au=a;var av=G.toDataURL();this.svCursorData="url("+av+") "+au/2+" "+au/2+", auto";if(!this.svCursorData){return false}at.style.cursor=this.svCursorData;if(at.style.cursor.indexOf(av)===-1){this.svCursorData="crosshair";at.style.cursor="crosshair"}return true};ab.initStandartCursor=function(){if(!this.stCursor){return}ab.curType=0;document.body.style.cursor=this.stCursor};ab.updateCursor=function(a){if(!T){return}if(KellyColorPicker.cursorLock){return}if(M.isDotIn(a)){ab.initSvCursor()}else{ab.initStandartCursor()}};function e(at){var ay="",aw="";if(at.alpha_slider!==undefined){at.alphaSlider=at.alpha_slider}if(at.input_color!==undefined){at.inputColor=at.input_color}if(at.input_format!==undefined){at.inputFormat=at.input_format}if(at.input&&typeof at.input!=="object"){at.input=document.getElementById(at.input);f=at.input}else{if(typeof at.input==="object"){f=at.input}}if(at.changeCursor!==undefined){T=at.changeCursor}if(at.alpha!==undefined){aq=at.alpha}if(at.alphaSlider!==undefined){af=at.alphaSlider}if(at.inputColor!==undefined){ak=at.inputColor}if(at.inputFormat!==undefined){am=at.inputFormat}if(at.userEvents){J=at.userEvents}if(at.place&&typeof at.place!=="object"){aw=at.place;at.place=document.getElementById(at.place)}if(at.resizeWith){if(typeof at.resizeWith!=="object"){at.resizeWith=document.getElementById(at.resizeWith)}ah=at.resizeWith;if(ah){var au=m(ah);if(au){at.size=m(ah)}R(window,"resize",function(az){return Q.syncSize(az)},"canvas_")}}if(at.place){h=at.place}else{if(f){O.tag=document.createElement("div");O.tag.className="popup-kelly-color";if(!at.popupClass){O.tag.className="popup-kelly-color";O.tag.style.position="absolute";O.tag.style.bottom="0px";O.tag.style.left="0px";O.tag.style.display="none";O.tag.style.backgroundColor="#e1e1e1";O.tag.style.border="1px solid #bfbfbf";O.tag.style.boxShadow="7px 7px 14px -3px rgba(0,0,0,0.24)";O.tag.style.borderTopLeftRadius="4px";O.tag.style.borderTopRightRadius="4px";O.tag.style.borderBottomLeftRadius="4px";O.tag.style.borderBottomRightRadius="4px";O.tag.style.padding="12px";O.tag.style.boxSizing="content-box"}else{O.tag.className=at.inputClassName}h=O.tag;var a=document.getElementsByTagName("body")[0];a.appendChild(O.tag);R(f,"click",function(az){return Q.popUpShow(az)},"popup_")}else{ay+='| "place" ('+aw+") not not found"}}if(at.size&&at.size>0){B=at.size}var av=false;if(at.color){av=ae(at.color)}else{if(f&&f.value){av=ae(f.value)}}if(av){V=av.h;if(af){aq=av.a}}if(at.method&&(at.method=="triangle"||at.method=="quad")){an=at.method}if(!ac()){ay+=" | cant init canvas context"}if(ay){if(typeof console!=="undefined"){console.log("KellyColorPicker : "+ay)}return}if(an=="quad"){M=d()}if(an=="triangle"){M=H()}if(f){var ax=function(az){var az=az||window.event;if(!az.target){az.target=az.srcElement}Q.setColorByHex(az.target.value,true)};R(f,"click",ax,"input_edit_");R(f,"change",ax,"input_edit_");R(f,"keyup",ax,"input_edit_");R(f,"keypress",ax,"input_edit_")}if(at.colorSaver){ar("left",true);ar("right")}if(at.methodSwitch){U()}c();z();Q.setColorByHex(false)}function m(au){var av=au.getBoundingClientRect();var at=0;var a=0;if(af){a=N.width+N.padding*2}if(av.width>av.height){at=av.height}if(av.height>av.width){at=av.width}at=parseInt(at);if(af){at-=a}if(at<=0){return false}return at}function ae(aw,a){var ax=1;var av=false;aw=aw.trim(aw);if(aw.length<=7){if(aw.charAt(0)=="#"){aw=aw.slice(1)}if(aw.length==3){av=aw+aw}else{if(aw.length==6){av=aw}}}else{if(aw.substring(0,3)=="rgb"){var au=aw.split(",");if(au.length>=3&&au.length<=4){au[0]=au[0].replace("rgba(","");au[0]=au[0].replace("rgb(","");var at={r:parseInt(au[0]),g:parseInt(au[1]),b:parseInt(au[2])};if(at.r<=255&&at.g<=255&&at.b<=255){av=aa(at);if(au.length==4){ax=parseFloat(au[3]);if(!ax||ax<0){ax=0}if(ax>1){ax=1}}}}}}if(av===false&&a){return false}if(av===false){av="000000"}if(av.charAt(0)!="#"){av="#"+av}return{h:av,a:ax}}function d(){if(s.quad){return s.quad}var a=new Object;a.size;a.padding=2;a.path;a.imageData=null;a.dotToSv=function(at){return{s:Math.abs(this.path[3].x-at.x)/this.size,v:Math.abs(this.path[3].y-at.y)/this.size}};a.svToDot=function(aC){var av=this.path[0].x;var at=this.path[0].y;var aw=0.02;if(B<150){aw=0.07}else{if(B<100){aw=0.16}}for(var az=0;az<this.size;az++){for(var aA=0;aA<this.size;aA++){var au={x:aA+av,y:az+at};var ax=this.dotToSv(au);var aB=Math.abs(ax.s-aC.s),ay=Math.abs(ax.v-aC.v);if(aB<aw&&ay<aw){return au}}}return{x:0,y:0}};a.limitDotPosition=function(au){var at=au.x;var av=au.y;if(at<this.path[0].x){at=this.path[0].x}if(at>this.path[0].x+this.size){at=this.path[0].x+this.size}if(av<this.path[0].y){av=this.path[0].y}if(av>this.path[0].y+this.size){av=this.path[0].y+this.size}return{x:at,y:av}};a.draw=function(){if(!this.imageData){this.imageData=I.createImageData(this.size,this.size)}var aw=0;var ay=this.path[0].x;var ax=this.path[0].y;for(var aA=0;aA<this.size;aA++){for(var at=0;at<this.size;at++){var av={x:at+ay,y:aA+ax};var au=this.dotToSv(av);var az=Z(r.h,au.s,au.v);this.imageData.data[aw+0]=az.r;this.imageData.data[aw+1]=az.g;this.imageData.data[aw+2]=az.b;this.imageData.data[aw+3]=255;aw+=4}}I.putImageData(this.imageData,ay,ax);I.beginPath();I.strokeStyle="rgba(0,0,0, 0.2)";I.lineWidth=2;for(var aw=0;aw<=this.path.length-1;++aw){if(aw==0){I.moveTo(this.path[aw].x,this.path[aw].y)}else{I.lineTo(this.path[aw].x,this.path[aw].y)}}I.stroke();I.closePath()};a.updateSize=function(){var au=(A.innerRadius*2)-D.paddingX*2-this.padding*2;this.size=Math.floor(au/Math.sqrt(2));this.path=new Array();this.path[0]={x:-1*(this.size/2),y:-1*(this.size/2)};this.path[1]={x:this.path[0].x+this.size,y:this.path[0].y};this.path[2]={x:this.path[1].x,y:this.path[1].y+this.size};this.path[3]={x:this.path[2].x-this.size,y:this.path[2].y};this.path[4]={x:this.path[0].x,y:this.path[0].y};for(var at=0;at<=this.path.length-1;++at){this.path[at].x+=A.pos.x;this.path[at].y+=A.pos.y}};a.isDotIn=function(at){if(at.x<this.path[0].x||at.x>this.path[0].x+this.size||at.y<this.path[0].y||at.y>this.path[0].y+this.size){return false}return true};s.quad=a;return a}function H(){if(s.triangle){return s.triangle
}var a=new Object;a.size;a.padding=2;a.path;a.imageData=null;a.followWheel=true;a.s;a.sOnTop=false;a.outerRadius;a.limitDotPosition=function(av){var aC=av.x;var aB=av.y;var aD;var au=this.path[0].x;var az=this.path[2].x;var ax=aC;var aw=aB;ax=Math.min(Math.max(az,ax),au);var aA=((this.path[0].y-this.path[1].y)/(this.path[0].x-this.path[1].x));var ay=Math.ceil((this.path[1].y+(aA*(ax-this.path[1].x))));aA=((this.path[0].y-this.path[2].y)/(this.path[0].x-this.path[2].x));var at=Math.floor((this.path[2].y+(aA*(ax-this.path[2].x))));if(aC<az){aD=((A.pos.y-aB)/(A.pos.x-aC));aw=aB}aw=Math.min(Math.max(ay,aw),at);return{x:ax,y:aw}};a.svToDot=function(au){var aA=0.02;if(B<150){aA=0.07}else{if(B<100){aA=0.16}}for(var az=0;az<this.size;az++){for(var at=0;at<this.size;at++){var av={x:this.path[1].x+at,y:this.path[1].y+az};if(M.isDotIn(av)){var aw=this.dotToSv(av);var ay=Math.abs(aw.s-au.s),ax=Math.abs(aw.v-au.v);if(ay<aA&&ax<aA){return av}}}}return{x:0,y:0}};a.draw=function(){if(!this.imageData){this.imageData=n.createImageData(this.size,this.size)}G.width=this.size;G.height=this.size;var ay=this.path[1].x;var av=this.path[1].y;var au=0;for(var ax=0;ax<this.size;ax++){for(var az=0;az<this.size;az++){var at={x:this.path[1].x+az,y:this.path[1].y+ax};if(!M.isDotIn(at)){this.imageData.data[au+0]=0;this.imageData.data[au+1]=0;this.imageData.data[au+2]=0;this.imageData.data[au+3]=0}else{var aB=this.dotToSv(at);var aA=Z(r.h,aB.s,aB.v);this.imageData.data[au+0]=aA.r;this.imageData.data[au+1]=aA.g;this.imageData.data[au+2]=aA.b;this.imageData.data[au+3]=255}au+=4}}n.putImageData(this.imageData,0,0);I.drawImage(G,ay,av);I.beginPath();I.strokeStyle="rgba(0, 0, 0, 0.3)";I.lineWidth=2;var aw=this.path;for(var au=0;au<=aw.length-1;++au){if(au==0){I.moveTo(aw[au].x,aw[au].y)}else{I.lineTo(aw[au].x,aw[au].y)}}I.stroke();I.closePath()};a.calcS=function(at){return Math.abs((at[1].x-at[0].x)*(at[2].y-at[0].y)-(at[2].x-at[0].x)*(at[1].y-at[0].y))/2};a.dotToSv=function(au){var aw=aj({x:au.x,y:au.y},this.vol);var at=t(aw,this.vol[0]);if(at<1){at=Math.floor(at)}if(at>this.h-1){at=this.h}var av=at/(this.h);var ax=Math.abs(w(au,this.sSide));if(ax<30){ax=30}ax-=30;ax=60-ax;ax=ax/60;return{s:ax,v:av}};a.isDotIn=function(at){var au=[{x:this.path[0].x,y:this.path[0].y},{x:this.path[1].x,y:this.path[1].y},{x:at.x,y:at.y}];var av=this.calcS(au);au[1]={x:this.path[2].x,y:this.path[2].y};av+=this.calcS(au);au[0]={x:this.path[1].x,y:this.path[1].y};av+=this.calcS(au);if(Math.ceil(av)==Math.ceil(this.s)){return true}else{return false}};a.updateSize=function(){this.outerRadius=A.innerRadius-D.paddingX-this.padding;this.size=Math.floor((2*this.outerRadius)*Math.sin(Y(60)));var av=((Math.sqrt(3)/2)*this.size);this.h=((Math.sqrt(3)/2)*this.size);this.path=new Array();this.path[0]={x:this.outerRadius,y:0};this.path[1]={x:this.path[0].x-av,y:-1*(this.size/2)};this.path[2]={x:this.path[1].x,y:this.size/2};this.path[3]={x:this.path[0].x,y:this.path[0].y};for(var au=0;au<=this.path.length-1;++au){this.path[au].x+=A.pos.x;this.path[au].y+=A.pos.y}this.vol=new Array();this.s=this.calcS(this.path);if(this.sOnTop){var at=g(this.path[0],this.path[2]);this.vol[0]={x:this.path[1].x,y:this.path[1].y};this.vol[1]={x:at.x,y:at.y};this.sSide=this.path[1]}else{var at=g(this.path[0],this.path[1]);this.vol[0]={x:this.path[2].x,y:this.path[2].y};this.vol[1]={x:at.x,y:at.y};this.sSide=this.path[2]}};s.triangle=a;return a}function R(a,at,av,au){if(typeof a!=="object"){a=document.getElementById(a)}if(!a){return false}if(!au){au=""}L[au+at]=av;if(!a.addEventListener){a.attachEvent("on"+at,L[au+at])}else{a.addEventListener(at,L[au+at])}return true}function l(a,at,au){if(typeof a!=="object"){a=document.getElementById(a)}if(!a){return false}if(!au){au=""}if(!L[au+at]){return false}if(!a.removeEventListener){a.detachEvent("on"+at,L[au+at])}else{a.removeEventListener(at,L[au+at])}L[au+at]=null;return true}function Z(aw,aC,aA){var a,ax,az,av,ay,au,at,aB;if(aw&&aC===undefined&&aA===undefined){aC=aw.s,aA=aw.v,aw=aw.h}av=Math.floor(aw*6);ay=aw*6-av;au=aA*(1-aC);at=aA*(1-ay*aC);aB=aA*(1-(1-ay)*aC);switch(av%6){case 0:a=aA,ax=aB,az=au;break;case 1:a=at,ax=aA,az=au;break;case 2:a=au,ax=aA,az=aB;break;case 3:a=au,ax=at,az=aA;break;case 4:a=aB,ax=au,az=aA;break;case 5:a=aA,ax=au,az=at;break}return{r:Math.floor(a*255),g:Math.floor(ax*255),b:Math.floor(az*255)}}function u(a,av,ax){if(a&&av===undefined&&ax===undefined){av=a.g,ax=a.b,a=a.r}a=a/255,av=av/255,ax=ax/255;var ay=Math.max(a,av,ax),at=Math.min(a,av,ax);var au,aA,az=ay;var aw=ay-at;aA=ay==0?0:aw/ay;if(ay==at){au=0}else{switch(ay){case a:au=(av-ax)/aw+(av<ax?6:0);break;case av:au=(ax-a)/aw+2;break;case ax:au=(a-av)/aw+4;break}au/=6}return{h:au,s:aA,v:az}}function W(a){var at=parseInt(a.charAt(0)=="#"?a.slice(1):a,16);return{r:at>>16,g:at>>8&255,b:at&255}}function aa(a){var at=function(av){var au=av.toString(16);return au.length===1?"0"+au:au};return"#"+at(a.r)+at(a.g)+at(a.b)}function Y(a){return a*(k/180)}function t(at,a){return Math.sqrt(Math.pow(at.x-a.x,2)+Math.pow(at.y-a.y,2))}function g(at,a){return{x:(at.x+a.x)/2,y:(at.y+a.y)/2}}function aj(au,at){var a=(at[0].x-at[1].x)*(at[0].x-at[1].x)+(at[0].y-at[1].y)*(at[0].y-at[1].y);var ax=(au.x-at[0].x)*(at[1].x-at[0].x)+(au.y-at[0].y)*(at[1].y-at[0].y);var aw=true;var av=ax/a;if(av<0){av=0;aw=false}if(av>1){av=1;aw=false}return{x:at[0].x+av*(at[1].x-at[0].x),y:at[0].y+av*(at[1].y-at[0].y),pt:aw}}function w(av,ay,au){if(!ay){ay={x:0,y:0}}var ax=av.x-ay.x;var at=av.y-ay.y;var aw=Math.atan2(at,ax)*180/(k);if(au&&aw<0){aw=360+aw}return aw}function v(at,av){av=Y(av);var au=new Array();for(var a=0;a<=at.length-1;++a){au[a]={x:at[a].x*Math.cos(av)-at[a].y*Math.sin(av),y:at[a].x*Math.sin(av)+at[a].y*Math.cos(av)}}return au}function z(){ag=S+D.paddingX;ad=false;A.imageData=null;b=B/2;A.pos={x:b,y:b};A.outerRadius=b-ag;A.innerRadius=A.outerRadius-A.width;D.path=[{x:A.innerRadius-D.paddingX,y:D.height*-1},{x:A.outerRadius+D.paddingX,y:D.height*-1},{x:A.outerRadius+D.paddingX,y:D.height},{x:A.innerRadius-D.paddingX,y:D.height},{x:A.innerRadius-D.paddingX,y:D.height*-1}];var at=B;if(af){at+=N.width+N.padding*2}if(h.tagName!="CANVAS"){h.style.width=at+"px";h.style.height=B+"px"}q.width=at;q.height=B;for(var a=0;a<=al.length-1;++a){al[a].updateSize()}if(i){i.imageData.triangle=null;i.imageData.quad=null;i.updateSize()}M.updateSize();if(af){N.updateSize()}}function X(au){if(!f){return}if(J.updateinput){var at=J.updateinput;if(!at(Q,f,au)){return}}var a="rgba("+o.r+", "+o.g+", "+o.b+", "+aq.toFixed(2)+")";if(!au){if(aq<1&&am==="mixed"){f.value=a}else{if(am==="hex"||am==="mixed"){f.value=V}else{f.value=a}}}if(ak){if(r.v<0.5){f.style.color="#FFF"}else{f.style.color="#000"}f.style.background=a}}function ac(){if(!h){return false}if(h.tagName!="CANVAS"){q=document.createElement("CANVAS");h.appendChild(q)}else{q=h}if(typeof window.G_vmlCanvasManager!="undefined"){q=window.G_vmlCanvasManager.initElement(q);G=window.G_vmlCanvasManager.initElement(G)}if(!!(q.getContext&&q.getContext("2d"))){I=q.getContext("2d");
n=G.getContext("2d");return true}else{return false}}function c(){R(q,"mousedown",function(a){Q.mouseDownEvent(a)},"wait_action_");R(q,"touchstart",function(a){Q.mouseDownEvent(a)},"wait_action_");R(q,"mouseout",function(a){Q.mouseOutEvent(a)},"wait_action_");R(window,"touchmove",function(a){Q.touchMoveEvent(a)},"wait_action_");R(q,"mousemove",function(a){Q.mouseMoveRest(a)},"wait_action_")}function K(){l(q,"mousedown","wait_action_");l(q,"touchstart","wait_action_");l(q,"mouseout","wait_action_");l(window,"touchmove","wait_action_");l(q,"mousemove","wait_action_")}function F(av){av=av||window.event;var a,ax;var aw=document.body.scrollLeft+document.documentElement.scrollLeft;var au=document.body.scrollTop+document.documentElement.scrollTop;if(av.touches){try{a=av.touches[0].clientX+aw;ax=av.touches[0].clientY+au}catch(av){}}else{a=av.clientX+aw;ax=av.clientY+au}var at=q.getBoundingClientRect();a-=at.left+aw;ax-=at.top+au;return{x:a,y:ax}}function ai(av){var at=false;for(var au=0;au<=al.length-1;++au){if(al[au].selected){at=au}al[au].selected=false}var a=false;for(var au=0;au<=al.length-1;++au){if(au==av){al[au].selected=true;Q.setColorByHex(al[au].color);a=true;break}}if(a&&J.selectcolorsaver){var aw=J.selectcolorsaver;aw(Q,al[av])}if(!a&&at!==false){al[at].selected=true}return a}function E(){for(var a=0;a<=al.length-1;++a){if(al[a].selected){al[a].color=V}}}function y(){if(al.length){for(var a=0;a<=al.length-1;++a){al[a].draw()}}}function C(){if(!I){return false}I.clearRect(0,0,q.width,q.height);if(ad){I.putImageData(x,0,0);y();return true}A.draw();M.draw();if(af){N.draw()}y();if(i){i.draw()}if(!j){x=I.getImageData(0,0,q.width,q.height);ad=true}return true}function ap(){if(!C()){return false}var ax=r.h*360-A.startAngle;if(af){I.beginPath();var a=2;var au=2;var av=N.height*(1-aq);I.rect(N.pos.x-au,N.padding+av-a/2,N.width+au*2,a);I.strokeStyle="rgba(0,0,0, 0.8)";I.lineWidth=2;I.stroke();I.closePath()}I.beginPath();var aw=v(D.path,ax,{x:A.pos.x,y:A.pos.y});for(var at=0;at<=aw.length-1;++at){aw[at].x+=A.pos.x;aw[at].y+=A.pos.y;if(at==0){I.moveTo(aw[at].x,aw[at].y)}else{I.lineTo(aw[at].x,aw[at].y)}}I.strokeStyle="rgba(0,0,0,0.8)";I.lineWidth=D.lineWeight;I.stroke();I.closePath();if(r.v>0.5&&r.s<0.5){I.strokeStyle="rgba(0, 0, 0, 1)"}else{I.strokeStyle="rgba(255, 255, 255, 1)"}I.beginPath();I.lineWidth=2;I.arc(r.x,r.y,ao.radius,0,k*2);I.stroke();I.closePath();return false}this.popUpClose=function(a){if(O.tag===false){return}if(a){if(a.target==f||a.target==q){return false}if(a.target==O.tag){return false}}O.tag.style.display="none";if(KellyColorPicker.activePopUp==Q){KellyColorPicker.activePopUp=false}};this.popUpShow=function(aw){if(O.tag===false){return}if(J.popupshow){var az=J.popupshow;if(!az(Q,aw)){return}}if(!KellyColorPicker.popupEventsInclude){R(document,"click",function(aB){if(KellyColorPicker.activePopUp){return KellyColorPicker.activePopUp.popUpClose(aB)}else{return false}},"popup_close_");R(window,"resize",function(aB){if(KellyColorPicker.activePopUp){return KellyColorPicker.activePopUp.popUpShow(aB)}},"popup_resize_");KellyColorPicker.popupEventsInclude=true}if(KellyColorPicker.activePopUp){KellyColorPicker.activePopUp.popUpClose(false)}var av=Q.getCanvas().width;var at=Q.getAlphaFig();if(at){av-=at.width+at.padding}var au=parseInt(O.tag.style.paddingBottom)+parseInt(O.tag.style.paddingTop);if(au<=0){au=0}var aA=f.getBoundingClientRect();var ax=aA.top+(window.scrollY||window.pageYOffset||document.body.scrollTop)-au;var a=aA.left+(window.scrollX||window.pageXOffset||document.body.scrollLeft);var ay=6;O.tag.style.top=(ax-av-O.margin)+"px";O.tag.style.left=a+"px";O.tag.style.display="block";KellyColorPicker.activePopUp=Q;return false};this.setHueByDot=function(a){var at=w(a,A.pos)+A.startAngle;if(at<0){at=360+at}r.h=at/360;o=Z(r.h,r.s,r.v);V=aa(o);E();if(J.change){var au=J.change;au(Q)}X();ad=false;ap()};this.setColorForColorSaver=function(at,av){var a=ae(at,true);if(!a){return}var au=Q.getColorSaver(av);if(au.selected){this.setColorByHex(at,false)}else{au.color=a.h;ap()}return true};this.setColorByHex=function(at,ax){if(!ax){ax=false}var a=aq;if(at!==false){if(!at||!at.length){return}var av=ae(at,true);if(!av){return}at=av.h;if(af){a=av.a}}else{at=V}if(af&&at==V&&ad&&a!=aq){aq=a;ap();return}if(V&&at==V&&ad){return}aq=a;o=W(at);V=at;r=u(o);var au=M.svToDot(r);r.x=au.x;r.y=au.y;ad=false;E();ap();if(J.change){var aw=J.change;aw(Q)}X(ax)};this.setAlphaByDot=function(a){aq=N.dotToAlpha(a);if(J.change){var at=J.change;at(Q)}X();ap()};this.setAlpha=function(a){aq=a;X();ap()};this.setColorByDot=function(at){var a=M.dotToSv(at);r.s=a.s;r.v=a.v;r.x=at.x;r.y=at.y;if(r.s>1){r.s=1}if(r.s<0){r.s=0}if(r.v>1){r.v=1}if(r.v<0){r.v=0}o=Z(r.h,r.s,r.v);V=aa(o);E();if(J.change){var au=J.change;au(Q)}X();ap()};this.mouseOutEvent=function(a){if(ab.curType>0&&!KellyColorPicker.cursorLock){ab.initStandartCursor()}};this.mouseMoveRest=function(at){if(j){return}if(!P){return}P=false;var a=F(at);ab.updateCursor(a);requestAnimationFrame(function(){P=true});if(J.mousemoverest){var au=J.mousemoverest;au(at,Q,a)}};this.touchMoveEvent=function(a){if(j){event.preventDefault()}};this.mouseDownEvent=function(av){av.preventDefault();var at,a=false;var aw=F(av);if(A.isDotIn(aw)){j="wheel";Q.setHueByDot(aw);at=function(ax){Q.wheelMouseMove(ax,aw)};a=function(ax){KellyColorPicker.cursorLock=false;Q.wheelMouseUp(ax,aw)}}else{if(M.isDotIn(aw)){j="sv";Q.setColorByDot(aw);at=function(ax){Q.svMouseMove(ax,aw)};a=function(ax){KellyColorPicker.cursorLock=false;Q.svMouseUp(ax,aw)}}else{if(af&&N.isDotIn(aw)){j="alpha";Q.setAlphaByDot(aw);at=function(ax){Q.alphaMouseMove(ax,aw)};a=function(ax){KellyColorPicker.cursorLock=false;Q.alphaMouseUp(ax,aw)}}else{if(i&&i.isDotIn(aw)){Q.setMethod()}else{if(al.length){for(var au=0;au<=al.length-1;++au){if(al[au].isDotIn(aw)){ai(au);break}}}}}}}if(at&&a){K();KellyColorPicker.cursorLock=Q;R(document,"mouseup",a,"action_process_");R(document,"mousemove",at,"action_process_");R(document,"touchend",a,"action_process_");R(document,"touchmove",at,"action_process_")}};this.wheelMouseMove=function(at,a){at.preventDefault();if(!j){return}if(!P){return}P=false;var au=F(at);requestAnimationFrame(function(){P=true});Q.setHueByDot(au);if(J.mousemoveh){var av=J.mousemoveh;av(at,Q,au)}};this.wheelMouseUp=function(at,a){at.preventDefault();if(!j){return}l(document,"mouseup","action_process_");l(document,"mousemove","action_process_");l(document,"touchend","action_process_");l(document,"touchmove","action_process_");c();j=false;ad=false;ap();var au=F(at);ab.updateCursor(au);if(J.mouseuph){var av=J.mouseuph;av(at,Q,au)}};this.alphaMouseMove=function(at,a){at.preventDefault();if(!j){return}if(!P){return}P=false;var au=F(at);au=N.limitDotPosition(au);requestAnimationFrame(function(){P=true});Q.setAlphaByDot(au);if(J.mousemovealpha){var av=J.mousemovealpha;av(at,Q,au)}};this.alphaMouseUp=function(at,a){at.preventDefault();if(!j){return}l(document,"mouseup","action_process_");l(document,"mousemove","action_process_");
l(document,"touchend","action_process_");l(document,"touchmove","action_process_");c();j=false;var au=F(at);ab.updateCursor(au);if(J.mouseupalpha){var av=J.mouseupalpha;av(at,Q,au)}};this.svMouseMove=function(at,a){at.preventDefault();if(!j){return}if(!P){return}P=false;var au=F(at);au=M.limitDotPosition(au);requestAnimationFrame(function(){P=true});Q.setColorByDot(au);if(J.mousemovesv){var av=J.mousemovesv;av(at,Q,au)}};this.svMouseUp=function(at,a){at.preventDefault();if(!j){return}l(document,"mouseup","action_process_");l(document,"mousemove","action_process_");l(document,"touchend","action_process_");l(document,"touchmove","action_process_");c();j=false;var au=F(at);ab.updateCursor(au);if(J.mouseupsv){var av=J.mouseupsv;av(at,Q,au)}};this.addUserEvent=function(a,at){J[a]=at;return true};this.removeUserEvent=function(a){if(!J[a]){return false}J[a]=null;return true};this.getCanvas=function(){if(!I){return false}return q};this.getCtx=function(){if(!I){return false}return I};this.getInput=function(){return f};this.getSvFig=function(){return M};this.getSvFigCursor=function(){return ao};this.getWheel=function(){return A};this.getWheelCursor=function(){return D};this.getCurColorHsv=function(){return r};this.getCurColorRgb=function(){return o};this.getCurColorHex=function(){return V};this.getCurColorRgba=function(){return{r:o.r,g:o.g,b:o.b,a:aq}};this.getCurAlpha=function(){return aq};this.getAlphaFig=function(){if(af){return N}else{return false}};this.getPopup=function(){return O};this.getSize=function(){return B};this.getColorSaver=function(at){for(var a=0;a<=al.length-1;++a){if((!at&&al[a].selected)||al[a].align==at){al[a].rgb=W(al[a].color);al[a].hsv=u(al[a].rgb.r,al[a].rgb.g,al[a].rgb.b);return al[a]}}};this.setColorSaver=function(at){if(!at){return false}for(var a=0;a<=al.length-1;++a){if(al[a].align==at){ai(a);return al[a]}}};this.updateView=function(a){if(!I){return false}if(a){A.imageData=null;M.imageData=null;x=null}ad=false;z();ap();return true};this.resize=function(a,at){if(!I){return false}if(a==B&&!at){return true}ad=false;A.imageData=null;M.imageData=null;x=null;B=a;z();Q.setColorByHex(false);return false};this.syncSize=function(at){if(!ah){return false}var a=m(ah);if(a){Q.resize(a)}return false};this.setMethod=function(a){if(!a){a="triangle";if(an=="triangle"){a="quad"}}if(a==an){return false}if(an!="quad"&&an!="triangle"){return false}an=a;if(an=="quad"){M=d()}if(an=="triangle"){M=H()}Q.resize(B,true);if(J.setmethod){var at=J.setmethod;at(Q,an)}return true};this.destroy=function(){if(!Q){return false}if(ab.curType>0){KellyColorPicker.cursorLock=false;ab.initStandartCursor()}if(j){l(document,"mouseup","action_process_");l(document,"mousemove","action_process_");l(document,"touchend","action_process_");l(document,"touchmove","action_process_");j=false}if(O.tag){l(f,"click","popup_")}if(f){l(f,"click","input_edit_");l(f,"change","input_edit_");l(f,"keyup","input_edit_");l(f,"keypress","input_edit_")}if(KellyColorPicker.popupEventsInclude&&L.popup_close_click){if(KellyColorPicker.activePopUp){KellyColorPicker.activePopUp.popUpClose(false)}l(document,"click","popup_close_");l(window,"resize","popup_resize_");KellyColorPicker.popupEventsInclude=false}A.imageData=null;M.imageData=null;x=null;G=null;if(h&&h.parentNode){h.parentNode.removeChild(h)}if(ah){l(window,"resize","canvas_")}K();Q=null};e(p)}KellyColorPicker.cursorLock=false;KellyColorPicker.activePopUp=false;KellyColorPicker.popupEventsInclude=false;KellyColorPicker.attachToInputByClass=function(e,b){var c=new Array();var a=document.getElementsByClassName(e);for(var d=0;d<a.length;d++){if(b){b.input=a[d]}else{b={input:a[d],size:150}}c.push(new KellyColorPicker(b))}return c};