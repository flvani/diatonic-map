window.FILEMANAGER||(window.FILEMANAGER={reader:new FileReader,files:[],currName:null,currExtension:"abcx",type:"text"},FILEMANAGER.reader.onload=function(e){FILEMANAGER.loaded++,FILEMANAGER.now=!0,FILEMANAGER.files.push({fileName:FILEMANAGER.currName,extension:FILEMANAGER.currExtension,type:FILEMANAGER.type,content:e.target.result})}),FILEMANAGER.managedResources={},FILEMANAGER.total=0,FILEMANAGER.loaded=0,FILEMANAGER.timeouts=0,FILEMANAGER.timeoutInterval=50,FILEMANAGER.maxTimeouts=400,FILEMANAGER.errors="",FILEMANAGER.success="",FILEMANAGER.register=function(e){FILEMANAGER.total++,FILEMANAGER.managedResources[e]?FILEMANAGER.managedResources[e].qtde++:FILEMANAGER.managedResources[e]={qtde:1,succ:0,fail:0}},FILEMANAGER.deregister=function(e,E){FILEMANAGER.managedResources[e]&&(E?(FILEMANAGER.loaded++,FILEMANAGER.managedResources[e].succ++):FILEMANAGER.managedResources[e].fail++)},FILEMANAGER.getPercent=function(){return FILEMANAGER.total?FILEMANAGER.loaded/FILEMANAGER.total*100:0},FILEMANAGER.checkResources=function(){var e,E,A=0;for(e in FILEMANAGER.managedResources)if(0<(E=FILEMANAGER.managedResources[e]).qtde&&E.succ+E.fail<E.qtde&&FILEMANAGER.timeouts<FILEMANAGER.maxTimeouts)return FILEMANAGER.timeouts++,-1;for(e in FILEMANAGER.managedResources)0<(E=FILEMANAGER.managedResources[e]).qtde&&(0<E.fail||E.succ+E.fail<E.qtde)?(FILEMANAGER.errors+="\tRecurso "+e+" teve problemas ao carregar ("+E.qtde+"/"+E.succ+"/"+E.fail+").\n",A=1):FILEMANAGER.success+="\tRecurso "+e+": "+E.qtde+" ok...\n";return A},FILEMANAGER.waitResources=function(e){switch(FILEMANAGER.checkResources()){case-1:e.onProgress&&e.onProgress({perc:FILEMANAGER.getPercent()}),window.setTimeout(function(){FILEMANAGER.waitResources(e)},FILEMANAGER.timeoutInterval);break;case 1:e.onLoad&&e.onLoad(!1);break;case 0:e.onProgress&&e.onProgress({perc:FILEMANAGER.getPercent(),timeouts:FILEMANAGER.timeouts,success:FILEMANAGER.success}),e.onLoad&&e.onLoad(!0)}},FILEMANAGER.loadLocalFiles=function(e,E){var A=e.target.files;FILEMANAGER.now=!0,FILEMANAGER.loaded=0,FILEMANAGER.files=[],FILEMANAGER.interval=window.setInterval(function(){FILEMANAGER.doLoad(E,A)},100)},FILEMANAGER.doLoad=function(e,E){FILEMANAGER.loaded===E.length?(window.clearInterval(FILEMANAGER.interval),e()):FILEMANAGER.now&&(FILEMANAGER.currName=E[FILEMANAGER.loaded].name,e=E[FILEMANAGER.loaded].name.split("."),FILEMANAGER.currExtension=e[e.length-1],"image"===E[FILEMANAGER.loaded].type.substr(0,5)?(FILEMANAGER.reader.readAsDataURL(E[FILEMANAGER.loaded]),FILEMANAGER.type="image"):(FILEMANAGER.reader.readAsText(E[FILEMANAGER.loaded]),FILEMANAGER.type="text"),FILEMANAGER.now=!1)},FILEMANAGER.download=function(e,E){var A;A=E,e=e,A=new Blob([E],{type:"text/plain"}),(E=document.createElement("a")).download=e,E.href=window.URL.createObjectURL(A),E.dataset.downloadurl=["text/plain",E.download,E.href].join(":"),E.draggable=!0,E.classList.add("dragout"),e=E,(A=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,self,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(A)},FILEMANAGER.requiredFeaturesAvailable=function(){return!!(window.File&&window.FileReader&&window.FileList&&window.Blob)},FILEMANAGER.html5StorageSupport=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return waterbug.log("html5 storage not supported."),!1}},FILEMANAGER.saveLocal=function(e,E){FILEMANAGER.html5StorageSupport()&&localStorage.setItem(e,E)},FILEMANAGER.loadLocal=function(e){if(FILEMANAGER.html5StorageSupport())return localStorage.getItem(e)},FILEMANAGER.removeLocal=function(e){if(FILEMANAGER.html5StorageSupport())return localStorage.removeItem(e)};