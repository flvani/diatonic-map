if(!window.SITE){window.SITE={}}window.dataLayer=window.dataLayer||[];SITE.ga=function(){if(ga&&(window.location.href.indexOf("diatonicmap.com.br")>=0||window.location.href.indexOf("android_asset")>=0)&&SITE.getVersion("mainSITE","")!=="debug"&&SITE.getVersion("mainSITE","")!=="unknown"){if(window.AnalyticsApplication){window.AnalyticsApplication.logEvent(JSON.stringify(arguments))}else{console.log("No native APIs found.");ga.apply(this,arguments)}}else{console.log("Funcao ga não definida.")}};SITE.findGetParameter=function(c){var a=null,e=[];var b=window.location.search.substr(1).split("&");for(var d=0;d<b.length;d++){e=b[d].split("=");if(e[0]===c){a=decodeURIComponent(e[1])}}return a};SITE.getDate=function(){var b=new Date();var a=b.getDate();var c=b.getMonth()+1;var d=b.getFullYear();return d*10000+c*100+a};SITE.getVersion=function(a,b){var d=document.getElementById(a);if(!d){return"unknown"}var c=d.src.match(/\_[0-9]*\.[0-9]*/g);return c?b+c[0].substr(1):"debug"};SITE.getLanguage=function(){var b=window.navigator.userLanguage||window.navigator.language;if(b.indexOf("-")>=0){b=b.replace("-","_");for(var a in SITE.properties.known_languages){if(a.toLowerCase()===b.toLocaleLowerCase()){return a}}}for(var a in SITE.properties.known_languages){if(a.substr(0,2)===b.substr(0,2)){return a}}return"en_US"};SITE.LoadProperties=function(){var b=false;try{SITE.properties=JSON.parse(FILEMANAGER.loadLocal("diatonic-map.site.properties"))}catch(c){waterbug.log("Could not load the properties.");waterbug.show("Could not save the properties");SITE.ga("send","event","Error","html5storage","loadingLocal",{nonInteraction:true})}var a=SITE.getVersion("mainSITE","");if(!SITE.properties){SITE.ResetProperties()}else{if(a==="debug"){SITE.properties.options.showConsole=true}else{if(!SITE.properties.version||SITE.properties.version==="debug"||parseFloat(SITE.properties.version)<parseFloat(a)){SITE.properties.version=a;b=true}}}if(!SITE.properties.known_languages){SITE.properties.known_languages={de_DE:{file:"languages/de_DE.lang",image:"images/de_DE.png",name:"Deustch"},en_US:{file:"languages/en_US.lang",image:"images/en_US.png",name:"US English"},es_ES:{file:"languages/es_ES.lang",image:"images/es_ES.png",name:"Español"},fr_FR:{file:"languages/fr_FR.lang",image:"images/fr_FR.png",name:"Français"},it_IT:{file:"languages/it_IT.lang",image:"images/it_IT.png",name:"Italiano"},pt_BR:{file:"languages/pt_BR.lang",image:"images/pt_BR.png",name:"Português do Brasil"}};SITE.properties.options.language=SITE.getLanguage();SITE.properties.colors.highLight="#ff0000";SITE.properties.options.showWarnings=false;SITE.properties.options.showConsole=false;SITE.properties.options.pianoSound=false;SITE.properties.options.autoRefresh=false;SITE.properties.options.keyboardRight=false;b=true}if(!SITE.properties.studio.media){SITE.properties.studio.media={visible:false,top:"20px",left:"1200px",width:100,height:200};SITE.properties.partGen.media={visible:false,top:"20px",left:"1200px",width:100,height:200};b=true}if(!SITE.properties.partEdit){SITE.properties.partEdit={media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};b=true}if(b){SITE.SaveProperties()}};SITE.SaveProperties=function(){try{FILEMANAGER.saveLocal("diatonic-map.site.properties",JSON.stringify(SITE.properties))}catch(a){waterbug.log("Could not save the properties");waterbug.show("Could not save the properties");SITE.ga("send","event","Error","html5storage","savingLocal",{nonInteraction:true})}};SITE.ResetProperties=function(){SITE.properties={};SITE.properties.known_languages={de_DE:{file:"languages/de_DE.lang",image:"images/de_DE.png",name:"Deustch"},en_US:{file:"languages/en_US.lang",image:"images/en_US.png",name:"US English"},es_ES:{file:"languages/es_ES.lang",image:"images/es_ES.png",name:"Español"},fr_FR:{file:"languages/fr_FR.lang",image:"images/fr_FR.png",name:"Français"},it_IT:{file:"languages/it_IT.lang",image:"images/it_IT.png",name:"Italiano"},pt_BR:{file:"languages/pt_BR.lang",image:"images/pt_BR.png",name:"Português do Brasil"}};SITE.properties.version=SITE.getVersion("mainSITE","");SITE.properties.colors={useTransparency:true,highLight:"#ff0000",fill:"white",background:"none",close:"#ff3a3a",open:"#ffba3b"};SITE.properties.options={language:SITE.getLanguage(),showWarnings:false,showConsole:false,pianoSound:false,autoRefresh:false,keyboardRight:false};SITE.properties.mediaDiv={visible:true,top:"20px",left:"1200px",width:100,height:200};SITE.properties.tabGen={abcEditor:{floating:false,maximized:false,top:"70px",left:"25px",width:"940px",height:"560px"},tabEditor:{floating:false,maximized:false,top:"140px",left:"75px",width:"940px",height:"560px"}};SITE.properties.partEdit={media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};SITE.properties.partGen={showABCText:false,convertFromClub:false,convertToClub:false,media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};SITE.properties.studio={mode:"normal",timerOn:false,trebleOn:true,bassOn:true,media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};FILEMANAGER.saveLocal("ultimaTablaturaEditada","");FILEMANAGER.saveLocal("ultimaPartituraEditada","");SITE.SaveProperties()};if(!window.SITE){window.SITE={}}if(!window.SITE.lang){window.SITE.lang={}}SITE.Translator=function(a){a=a||{};if(!a.language){a.language="pt_BR"}this.language=null;this.loadLanguage(a.language,a.callback)};SITE.Translator.prototype.loadLanguage=function(d,e){var c=1;var b=this;FILEMANAGER.register("LANG");if(!SITE.properties||!SITE.properties.known_languages){SITE.ResetProperties()}if(!SITE.properties.known_languages[d]){b.log("Unknown language: "+d+". Loading English...");d="en_US";SITE.properties.options.language=d;SITE.SaveProperties()}var a=SITE.properties.known_languages[d].file;$.getJSON(a,{format:"json"}).done(function(f){FILEMANAGER.deregister("LANG",true);b.language=f}).fail(function(g,h,f){FILEMANAGER.deregister("LANG",false);b.log("Failed to load language "+d+":\nLoading: "+g.responseText.substr(1,40)+"...\nError:\n "+h+", "+f+".")}).always(function(){c--;if(c===0){e&&e()}})};SITE.Translator.prototype.menuPopulate=function(e,d){var a,b;e.emptySubMenu(d);for(var f in SITE.properties.known_languages){var c='<img src="'+SITE.properties.known_languages[f].image+'" />&#160;'+SITE.properties.known_languages[f].name;
a=e.addItemSubMenu(d,c+"|"+f);if(this.language&&this.language.id===f){b=a}}if(b){e.setSubMenuTitle(d,e.selectItem(d,b))}};SITE.Translator.prototype.getResource=function(b){if(!this.language){return null}var a=this.language.resources[b];(!a)&&this.log('Missing translation for "'+b+'" in "'+this.language.langName+'".');return a};SITE.Translator.prototype.translate=function(a){if(!this.language){return}a=a||document;var d=a.querySelectorAll("[data-translate]");var f=Array.prototype.slice.apply(d);for(var c=0;c<f.length;c++){var e=f[c];var b=this.language.resources[e.getAttribute("data-translate")];if(b){switch(e.nodeName){case"INPUT":if(e.type==="text"){e.title=b.tip;e.value=b.val}break;case"BUTTON":case"DIV":case"I":e.title=b;break;default:e.innerHTML=b}}else{this.log('Missing translatation for "'+e.getAttribute("data-translate")+'" in "'+this.language.langName+'".')}}};SITE.Translator.prototype.sortLanguages=function(){this.languages.sort(function(d,c){return parseInt(d.menuOrder)-parseInt(c.menuOrder)})};SITE.Translator.prototype.log=function(a){if(a.substr(27,6)==="GAITA_"){return}if(a.substr(27,11)==="CONCERTINA_"){return}waterbug.log(a);(SITE.properties.options.showConsole)&&waterbug.show()};if(!window.SITE){window.SITE={}}SITE.Media=function(b,d,a){var c=this;this.Div=b||null;this.proportion=0.55666667;this.youTubeURL=false;this.properties=a;if(d){this.showMediaButton=document.getElementById(d);this.showMediaButton.addEventListener("click",function(){c.callback("OPEN")},false)}this.mediaWindow=new DRAGGABLE.ui.Window(this.Div,null,{title:"showMedia",translator:SITE.translator,alternativeResize:true,top:this.properties.top,left:this.properties.left},{listener:this,method:"callback"})};SITE.Media.prototype.callback=function(b){switch(b){case"RESIZE":this.resize();var a=this.mediaWindow.dataDiv;this.properties.width=a.clientWidth;this.properties.height=a.clientHeight;SITE.SaveProperties();break;case"MOVE":var a=this.mediaWindow.topDiv;this.properties.top=a.style.top;this.properties.left=a.style.left;SITE.SaveProperties();break;case"OPEN":this.properties.visible=true;SITE.SaveProperties();this.mediaWindow.setVisible(true);this.resize();this.posiciona();if(this.showMediaButton){this.showMediaButton.style.display="none"}break;case"CLOSE":this.pause();this.properties.visible=false;SITE.SaveProperties();if(this.showMediaButton){this.mediaWindow.setVisible(false);this.showMediaButton.style.display="block"}break}return false};SITE.Media.prototype.pause=function(){if(!this.mediaWindow||!this.currTab){return}var a=this.currTab.div.getElementsByTagName("iframe")[0];if(!a){return}a.contentWindow.postMessage('{"event":"command","func":"pauseVideo", "args":""}',"*")};SITE.Media.prototype.show=function(f){var h=this;var c,i;if(f.abc&&f.abc.metaText.url){c=f.abc.metaText.url}if(c){var d=300;var g=17;if(c!==this.url){this.url=c;if(this.properties.width>100){d=this.properties.width;g=Math.round((d-100)/11)}else{if(window.innerWidth>=1200){d=600;g=46}else{if(window.innerWidth>=950){d=400;g=27}}}var o=d*this.proportion;this.mediaWindow.dataDiv.style.width=d+"px";this.mediaWindow.topDiv.style.width=d+"px";this.mediaWindow.dataDiv.style.height=o+"px";this.mediaWindow.topDiv.style.height=o+"px";if(!this.tabDiv){this.tabDiv=document.createElement("div");this.tabDiv.className="media-tabs";this.mediaWindow.topDiv.appendChild(this.tabDiv)}else{this.tabDiv.innerHTML="";this.mediaWindow.dataDiv.innerHTML=""}var m=c.split("\n");this.tabs={};this.currTab=null;for(var a=0;a<m.length&&a<10;a++){var p=(this.mediaWindow.id*10+a);this.youTubeURL=(m[a].match(/www.youtube-nocookie.com/g)!==null);this.isPDF=(m[a].match(/.*pdf/)!==null);var l=m[a].match(/\&.*\;/g);var n=m[a];var k="";if(l){n=m[a].replace(l[0],"");k=l[0].substring(3,l[0].length-1);if(k.length>g){k=k.substring(0,g)+"..."}}var b=document.createElement("div");b.className="media-content";this.mediaWindow.dataDiv.appendChild(b);if(this.youTubeURL){i='<iframe id="e'+p+'" src="'+n+'?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allowfullscreen="allowfullscreen" ></iframe>'}else{i='<embed id="e'+p+'" src="'+n+'" "></embed>'}b.innerHTML=i;this.embed=document.getElementById("e"+p);this.embed.style.width="100%";this.embed.style.height=(this.youTubeURL?"100%":(this.isPDF?"calc(100% - 4px)":"auto"));this.tabs["w"+p]={div:b,tit:k,u2be:this.youTubeURL};if(m.length>1){var e=document.createElement("input");e.id="w"+p;e.type="radio";e.name="mediaControl"+this.mediaWindow.id;e.className="tab-selector-"+a;this.tabDiv.appendChild(e);var e=document.createElement("label");e.htmlFor="w"+p;e.className="media-tab-label-"+a;e.innerHTML="#"+(a+1);this.tabDiv.appendChild(e)}}this.showTab=function(s){this.pause();for(var q in this.tabs){this.tabs[q].div.className="media-content";if(!s){s=q;var r=document.getElementById(s);if(r){r.checked=true}}}this.tabs[s].div.className="media-visible";this.currTab=this.tabs[s];this.mediaWindow.dataDiv.style.overflow=this.currTab.u2be?"hidden":"auto";this.mediaWindow.setSubTitle(this.currTab.tit?"- "+this.currTab.tit:"");this.resize()};if(m.length>1){var j=document.getElementsByName("mediaControl"+this.mediaWindow.id);for(var a=0;a<j.length;a++){j[a].addEventListener("change",function(){h.showTab(this.id)})}}h.showTab()}if(this.showMediaButton){this.showMediaButton.style.display=(this.properties.visible?"none":"inline")}this.mediaWindow.setVisible(this.properties.visible);if(this.properties.visible){this.resize();this.posiciona()}else{this.pause()}}else{this.pause();this.mediaWindow.setVisible(false);if(this.showMediaButton){this.showMediaButton.style.display="none"}}};SITE.Media.prototype.posiciona=function(){if(!this.mediaWindow.topDiv||this.mediaWindow.topDiv.style.display==="none"){return}var b=document.body.clientWidth||document.documentElement.clientWidth||window.innerWidth;b=Math.min(b,this.mediaWindow.parent.clientWidth);var d=this.mediaWindow.topDiv;var a=parseInt(d.style.left.replace("px",""));var c=a;if(a+d.offsetWidth>b){a=(b-(d.offsetWidth+30))}if(a<0){a=10}if(a!==c){d.style.left=a+"px";this.properties.left=a+"px";SITE.SaveProperties()}};SITE.Media.prototype.resize=function(){var b=this.mediaWindow.menuDiv.clientHeight+(this.mediaWindow.bottomBar?this.mediaWindow.bottomBar.clientHeight:0);this.mediaWindow.dataDiv.style.width=this.mediaWindow.topDiv.clientWidth+"px";this.mediaWindow.dataDiv.style.height=(this.mediaWindow.topDiv.clientHeight-b)+"px";if(this.currTab.u2be){var a=(this.mediaWindow.topDiv.clientWidth*this.proportion);this.mediaWindow.dataDiv.style.height=a+"px";this.mediaWindow.topDiv.style.height=(a+b)+"px"}};if(!window.SITE){window.SITE={}}SITE.AppView=function(b,f,e){this.mapa=b;if(!b){this.isApp=true}if(SITE.properties.options.keyboardRight){this.resize=this.resizeRight}else{this.resize=this.resizeLeft}this.ypos=0;this.lastStaffGroup=-1;this.lastYpos=0;var c=this;var a="canvasDiv";var d="warningsDiv";this.warnings=[];this.renderedTune={text:undefined,abc:undefined,title:undefined,tab:undefined,div:undefined,selector:undefined};
this.Div=new DRAGGABLE.ui.Window(f.studioDiv,null,{translator:SITE.translator,statusbar:false,draggable:false,top:"0",left:"0",width:"100%",height:"100%",title:"EstudioTitle"},{listener:this,method:"appViewCallBack"});this.keyboardWindow=new DRAGGABLE.ui.Window(f.keyboardDiv,["rotate","globe"],{title:"",translator:SITE.translator,statusbar:false,draggable:false,top:"3px",left:"1px"},{listener:this,method:"keyboardCallback"});this.Div.setVisible(true);this.Div.dataDiv.style.overflow="hidden";if(f.generate_tablature){if(f.generate_tablature==="accordion"){this.accordion=new ABCXJS.tablature.Accordion(f.accordion_options);if(f.accordionNameSpan){this.accordionNameSpan=document.getElementById(f.accordionNameSpan);this.accordionNameSpan.innerHTML=this.accordion.getFullName()}}else{throw new Error("Tablatura para "+f.generate_tablature+" não suportada!")}}this.accordion.setRenderOptions({draggable:false,show:SITE.properties.studio.keyboard.visible,transpose:SITE.properties.studio.keyboard.transpose,mirror:SITE.properties.studio.keyboard.mirror,scale:0.8,label:SITE.properties.studio.keyboard.label});this.controlDiv=document.createElement("DIV");this.controlDiv.setAttribute("id","controlDiv");this.controlDiv.setAttribute("class","controlDiv btn-group draggableToolBarApp");this.Div.dataDiv.appendChild(this.controlDiv);this.controlDiv.innerHTML=document.getElementById(f.studioControlDiv).innerHTML;document.getElementById(f.studioControlDiv).innerHTML="";this.controlDiv.style.paddingBottom="5px";this.media=new SITE.Media(this.Div.dataDiv,f.btShowMedia,SITE.properties.studio.media);this.warningsDiv=document.createElement("DIV");this.warningsDiv.setAttribute("id",d);this.warningsDiv.setAttribute("class","warningsDiv");this.Div.dataDiv.appendChild(this.warningsDiv);this.studioCanvasDiv=document.createElement("DIV");this.studioCanvasDiv.setAttribute("id",f.studioCanvasDiv);this.studioCanvasDiv.setAttribute("class","studioCanvasDiv");this.canvasDiv=document.createElement("DIV");this.canvasDiv.setAttribute("id",a);this.canvasDiv.setAttribute("class","canvasDiv");this.studioCanvasDiv.appendChild(this.canvasDiv);this.Div.dataDiv.appendChild(this.studioCanvasDiv);this.renderedTune.div=this.canvasDiv;if(this.ps){this.ps.destroy()}this.ps=new PerfectScrollbar(this.studioCanvasDiv,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});if(f.onchange){this.onchangeCallback=f.onchange}this.saveButton=document.getElementById(f.saveBtn);this.forceRefreshButton=document.getElementById(f.forceRefresh);this.printButton=document.getElementById(f.printBtn);this.backButton=document.getElementById(f.backBtn);this.showMapButton=document.getElementById(f.showMapBtn);this.modeButton=document.getElementById(e.modeBtn);this.timerButton=document.getElementById(e.timerBtn);this.FClefButton=document.getElementById(e.FClefBtn);this.GClefButton=document.getElementById(e.GClefBtn);this.playButton=document.getElementById(e.playBtn);this.stopButton=document.getElementById(e.stopBtn);this.gotoMeasureButton=document.getElementById(e.gotoMeasureBtn);this.untilMeasureButton=document.getElementById(e.untilMeasureBtn);this.currentPlayTimeLabel=document.getElementById(e.currentPlayTimeLabel);this.stepButton=document.getElementById(e.stepBtn);this.stepMeasureButton=document.getElementById(e.stepMeasureBtn);this.repeatButton=document.getElementById(e.repeatBtn);this.clearButton=document.getElementById(e.clearBtn);this.tempoButton=document.getElementById(e.tempoSld);this.backButton.addEventListener("click",function(g){g.preventDefault();c.closeEstudio();this.blur()},false);this.showMapButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.showKeyboard();c.resize()},false);if(!this.isApp){this.forceRefreshButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.fireChanged(0,{force:true,showProgress:true})},false);this.saveButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.salvaMusica()},false)}this.printButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.ga("send","event","Mapa5","print",c.renderedTune.title);c.printPreview(c.renderedTune.div.innerHTML,["#topBar","#mapaDiv"],c.renderedTune.abc.formatting.landscape);return},false);this.modeButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.changePlayMode()},false);this.timerButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.properties.studio.timerOn=!SITE.properties.studio.timerOn;c.setTimerIcon(0)},false);this.FClefButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.properties.studio.bassOn=!SITE.properties.studio.bassOn;c.setBassIcon()},false);this.GClefButton.addEventListener("click",function(g){g.preventDefault();this.blur();SITE.properties.studio.trebleOn=!SITE.properties.studio.trebleOn;c.setTrebleIcon()},false);this.playButton.addEventListener("click",function(g){g.preventDefault();this.blur();window.setTimeout(function(){c.startPlay("normal")},0)},false);this.stopButton.addEventListener("click",function(g){g.preventDefault();this.blur();if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML="00:00.00"}c.studioStopPlay()},false);this.clearButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.renderedTune.printer.clearSelection();c.accordion.clearKeyboard(true);c.currentPlayTimeLabel.innerHTML="00:00.00";c.studioStopPlay()},false);this.stepButton.addEventListener("click",function(g){g.preventDefault();this.blur();c.startPlay("note")},false);this.stepMeasureButton.addEventListener("click",function(g){g.preventDefault();c.startPlay("measure")},false);this.repeatButton.addEventListener("click",function(g){g.preventDefault();this.blur();if(!c.midiPlayer.playing){c.startPlay("repeat",c.gotoMeasureButton.value,c.untilMeasureButton.value)}},false);this.slider=new DRAGGABLE.ui.Slider(this.tempoButton,{min:25,max:200,start:100,step:5,color:"#FF6B6B",bgcolor:"#FFAFAF",callback:function(g){c.midiPlayer.setAndamento(g)}});this.gotoMeasureButton.addEventListener("keypress",function(g){if(g.keyCode===13){c.startPlay("goto",this.value,c.untilMeasureButton.value)}},false);this.gotoMeasureButton.addEventListener("focus",function(g){if(this.value===SITE.translator.getResource("gotoMeasure").val){this.value=""}},false);this.gotoMeasureButton.addEventListener("blur",function(g){if(this.value===""){this.value=SITE.translator.getResource("gotoMeasure").val}},false);this.untilMeasureButton.addEventListener("keypress",function(g){if(g.keyCode===13){c.startPlay("goto",c.gotoMeasureButton.value,this.value)}},false);this.untilMeasureButton.addEventListener("focus",function(g){if(this.value===SITE.translator.getResource("untilMeasure").val){this.value=""}},false);this.untilMeasureButton.addEventListener("blur",function(g){if(this.value===""){this.value=SITE.translator.getResource("untilMeasure").val
}},false);this.playerCallBackOnScroll=function(g){c.setScrolling(g)};this.playerCallBackOnPlay=function(g){var h=g.getTime().cTime;if(c.gotoMeasureButton&&!parseInt(c.untilMeasureButton.value)){c.gotoMeasureButton.value=g.currentMeasure}if(c.currentPlayTimeLabel){c.currentPlayTimeLabel.innerHTML=h}c.midiPlayer.setPlayableClefs((SITE.properties.studio.trebleOn?"T":"")+(SITE.properties.studio.bassOn?"B":""))};this.playerCallBackOnEnd=function(h){var j=c.midiPlayer.getWarnings();c.playButton.title=SITE.translator.getResource("playBtn");c.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';c.renderedTune.printer.clearSelection();c.accordion.clearKeyboard(true);if(j){var i=document.getElementById("warningsDiv");var g="";j.forEach(function(k){g+=k+"<br/>"});i.style.color="blue";i.innerHTML=g}};this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);this.midiPlayer.defineCallbackOnPlay(this.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(this.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(this.playerCallBackOnScroll)};SITE.AppView.prototype.setup=function(b,a){if(this.mapa){this.mapa.closeMapa()}this.accordion.loadById(a);this.renderedTune.abc=b.abc;this.renderedTune.text=b.text;this.renderedTune.title=b.title;this.studioCanvasDiv.scrollTop=0;this.changePlayMode(SITE.properties.studio.mode);this.setBassIcon();this.setTrebleIcon();this.setTimerIcon(0);this.setVisible(true);this.fireChanged(0,{force:true});this.Div.setTitle(b.title);this.Div.setSubTitle("- "+this.accordion.getTxtModel()+" "+this.accordion.getTxtTuning());this.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none";this.showKeyboard(SITE.properties.studio.keyboard.visible);this.keyboardWindow.setTitle(this.accordion.getTxtTuning()+" - "+this.accordion.getTxtNumButtons());this.resize();SITE.translator.translate(this.Div.topDiv)};SITE.AppView.prototype.resizeLeft=function(){var j=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var f=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var b=(f-2);var g=(j-4);var a=SITE.properties.studio.keyboard.visible?this.keyboardWindow.topDiv.clientWidth+1:0;this.keyboardWindow.topDiv.style.top=0;this.keyboardWindow.topDiv.style.left=0;this.keyboardWindow.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.top=0;this.Div.topDiv.style.left=a+"px";this.Div.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.width=Math.max(b-a,400)+"px";var b=0,i=0;var k=this.controlDiv.clientHeight;var d=this.Div.dataDiv.clientHeight;if(!SITE.properties.showWarnings){b=this.warningsDiv.clientHeight}this.studioCanvasDiv.style.height=d-(b+i+k+6)+"px";this.media.posiciona();(this.ps)&&this.ps.update()};SITE.AppView.prototype.resizeRight=function(){var j=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var f=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var b=(f-2);var g=(j-4);var a=SITE.properties.studio.keyboard.visible?this.keyboardWindow.topDiv.clientWidth+1:0;this.keyboardWindow.topDiv.style.top=0;this.keyboardWindow.topDiv.style.left=(b-a+1)+"px";this.keyboardWindow.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.top=0;this.Div.topDiv.style.left=0;this.Div.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.width=Math.max(b-a,400)+"px";var b=0,i=0;var k=this.controlDiv.clientHeight;var d=this.Div.dataDiv.clientHeight;if(!SITE.properties.showWarnings){b=this.warningsDiv.clientHeight}this.studioCanvasDiv.style.height=d-(b+i+k+6)+"px";this.media.posiciona();(this.ps)&&this.ps.update()};SITE.AppView.prototype.showKeyboard=function(a){SITE.properties.studio.keyboard.visible=(typeof a==="undefined"?!SITE.properties.studio.keyboard.visible:a);this.accordion.render_opts.show=SITE.properties.studio.keyboard.visible;if(SITE.properties.studio.keyboard.visible){this.keyboardWindow.setVisible(true);this.accordion.printKeyboard(this.keyboardWindow.dataDiv);this.showMapButton.innerHTML='<i class="ico-keyboard" ></i>'}else{this.accordion.render_opts.show=false;this.keyboardWindow.setVisible(false);this.showMapButton.innerHTML='<i class="ico-keyboard" style="opacity:0.5;"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:3px"></i>'}};SITE.AppView.prototype.appViewCallBack=function(a){switch(a){case"CLOSE":this.closeEstudio(true);break}};SITE.AppView.prototype.studioStopPlay=function(a){this.midiPlayer.stopPlay()};SITE.AppView.prototype.closeEstudio=function(a){this.setVisible(false);SITE.SaveProperties();this.keyboardWindow.setVisible(false);this.studioStopPlay()};SITE.AppView.prototype.setVisible=function(a){this.Div.parent.style.display=a?"block":"none"};SITE.AppView.prototype.setAutoRefresh=function(a){};SITE.AppView.prototype.keyboardCallback=function(a){switch(a){case"ROTATE":this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);SITE.properties.studio.keyboard.transpose=this.accordion.render_opts.transpose;SITE.properties.studio.keyboard.mirror=this.accordion.render_opts.mirror;break;case"GLOBE":this.accordion.changeNotation();SITE.properties.studio.keyboard.label=this.accordion.render_opts.label;break;case"CLOSE":this.showKeyboard(false);this.resize();break}};SITE.AppView.prototype.setScrolling=function(c){if(!this.studioCanvasDiv||!c.currAbsElem||c.currAbsElem.staffGroup===this.lastStaffGroup){return}this.lastStaffGroup=c.currAbsElem.staffGroup;var e=c.printer.staffgroups[0].top;var b=this.studioCanvasDiv.clientHeight-e;var d=c.printer.staffgroups[c.currAbsElem.staffGroup].top-12;var a=d+c.printer.staffgroups[c.currAbsElem.staffGroup].height;if(a>b+this.ypos||this.ypos>d-e){this.ypos=d;this.studioCanvasDiv.scrollTop=this.ypos}};SITE.AppView.prototype.changePlayMode=function(a){SITE.properties.studio.mode=a?a:(SITE.properties.studio.mode==="normal"?"learning":"normal");this.midiPlayer.setAndamento(this.slider.getValue());if(SITE.properties.studio.mode==="normal"){$("#divDidacticPlayControls").hide();SITE.properties.studio.mode="normal";this.modeButton.innerHTML='<i class="ico-listening" ></i>';$("#divNormalPlayControls").fadeIn();$("#spanShowMedia").fadeIn()}else{$("#divNormalPlayControls").hide();SITE.properties.studio.mode="learning";this.modeButton.innerHTML='<i class="ico-learning" ></i>';$("#divDidacticPlayControls").fadeIn();$("#spanShowMedia").hide()}};SITE.AppView.prototype.posicionaTeclado=function(){return;if(!SITE.properties.studio.keyboard.visible){return}var b=window.innerWidth;var c=this.keyboardWindow.topDiv;var a=parseInt(c.style.left.replace("px",""));if(a+c.offsetWidth>b){a=(b-(c.offsetWidth+50))}if(a<0){a=10}c.style.left=a+"px"};SITE.AppView.prototype.startPlay=function(b,d,a){this.ypos=this.studioCanvasDiv.scrollTop;this.lastStaffGroup=-1;var c=this;if(this.midiPlayer.playing){if(b==="normal"){this.playButton.title=SITE.translator.getResource("playBtn");
this.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}}else{this.accordion.clearKeyboard();window.setTimeout(function(){c.StartPlayWithTimer(c.renderedTune.abc.midi,b,d,a,SITE.properties.studio.timerOn?10:0)},0)}};SITE.AppView.prototype.setBassIcon=function(){if(SITE.properties.studio.bassOn){this.FClefButton.innerHTML='<i class="ico-clef-bass" ></i>'}else{this.FClefButton.innerHTML='<i class="ico-clef-bass" style="opacity:0.5;"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:3px"></i>'}};SITE.AppView.prototype.setTrebleIcon=function(){if(SITE.properties.studio.trebleOn){this.GClefButton.innerHTML='<i class="ico-clef-treble" ></i>'}else{this.GClefButton.innerHTML='<i class="ico-clef-treble" style="opacity:0.5;"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:3px"></i>'}};SITE.AppView.prototype.setTimerIcon=function(b){b=b||0;var a="00";if(SITE.properties.studio.timerOn){switch(b){case 0:a="00";break;case 1:a="05";break;case 2:a="15";break;case 3:a="20";break;case 6:a="30";break;case 9:a="45";break;default:a=""}if(a!==""){if(a!=="00"){MIDI.noteOn(0,90,100,0);MIDI.noteOff(0,90,b>3?0.1:0.05)}this.timerButton.innerHTML='<i class="ico-timer-'+a+'" ></i>'}}else{this.timerButton.innerHTML='<i class="ico-timer-00" style="opacity:0.5;"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:4px"></i>'}};SITE.AppView.prototype.StartPlayWithTimer=function(f,c,e,b,a){var d=this;if(c!=="note"&&SITE.properties.studio.timerOn&&a>0){d.setTimerIcon(a);a-=1;window.setTimeout(function(){d.StartPlayWithTimer(f,c,e,b,a)},1000/3)}else{d.setTimerIcon(0);if(c==="normal"){this.midiPlayer.setPlayableClefs("TB");if(this.midiPlayer.startPlay(this.renderedTune.abc.midi)){SITE.ga("send","event","Mapa5","play",this.renderedTune.title);this.playButton.title=SITE.translator.getResource("pause");this.playButton.innerHTML='&#160;<i class="ico-pause"></i>&#160;'}}else{this.midiPlayer.setPlayableClefs((SITE.properties.studio.trebleOn?"T":"")+(SITE.properties.studio.bassOn?"B":""));SITE.ga("send","event","Mapa5","didactic-play",this.renderedTune.title);this.midiPlayer.startDidacticPlay(this.renderedTune.abc.midi,c,e,b)}}};SITE.AppView.prototype.parseABC=function(c,d){var g=this.renderedTune.text;this.warnings=[];if(g===""){this.renderedTune.text=this.initialText=this.renderedTune.abc=undefined;return true}if(g===this.initialText&&!d){this.updateSelection();return false}if(typeof c!=="undefined"){if(this.transposer){this.transposer.reset(c)}else{this.transposer=new ABCXJS.parse.Transposer(c)}}if(!this.abcParser){this.abcParser=new ABCXJS.parse.Parse(this.transposer,this.accordion)}try{this.abcParser.parse(g,this.parserparams);this.renderedTune.abc=this.abcParser.getTune();this.renderedTune.text=this.initialText=this.abcParser.getStrTune()}catch(f){waterbug.log("Could not parse ABC.");waterbug.show()}var b=this.abcParser.getWarnings()||[];for(var a=0;a<b.length;a++){this.warnings.push(b[a])}if(this.midiParser){this.midiParser.parse(this.renderedTune.abc,this.accordion.loadedKeyboard);this.midiPlayer.reset();this.midiPlayer.setAndamento(this.slider.getValue());var b=this.midiParser.getWarnings();for(var a=0;a<b.length;a++){this.warnings.push(b[a])}}return true};SITE.AppView.prototype.onChange=function(){this.studioCanvasDiv.scrollTop=this.lastYpos;this.resize()};SITE.AppView.prototype.fireChanged=function(b,a){if(this.changing){return}this.lastYpos=this.studioCanvasDiv.scrollTop||0;this.changing=true;var c=a||{};var d=c.force||false;var e=c.showProgress||false;if(this.parseABC(b,d)){this.modelChanged(e)}else{delete this.changing}};SITE.AppView.prototype.modelChanged=function(c){var b=this;if(c){var a=this.mapa.startLoader("ModelChanged");a.start(function(){b.onModelChanged(a)},"<br>&nbsp;&nbsp;&nbsp;Gerando partitura...<br><br>")}else{b.onModelChanged()}};SITE.AppView.prototype.onModelChanged=function(a){this.renderedTune.div.innerHTML="";this.renderedTune.div.style.display="none";if(this.renderedTune.abc===undefined){delete this.changing;return}this.renderedTune.div.style.display="";var b=new SVG.Printer(this.renderedTune.div);this.renderedTune.printer=new ABCXJS.write.Printer(b,this.printerparams);this.renderedTune.printer.printTune(this.renderedTune.abc);if(this.warningsDiv){this.warningsDiv.style.color=this.warnings.length>0?"red":"green";this.warningsDiv.innerHTML=(this.warnings.length>0?this.warnings.join("<br/>"):"No warnings or errors.")}this.renderedTune.printer.addSelectListener(this);this.updateSelection();if(this.onchangeCallback){this.onchangeCallback(this)}if(a){a.update(false,"<br>&nbsp;&nbsp;&nbsp;Gerando tablatura...<br><br>");a.stop()}this.media.show(this.renderedTune);delete this.changing};SITE.AppView.prototype.highlight=function(a){if(!this.midiPlayer.playing){if(SITE.properties.studio.keyboard.visible){this.accordion.clearKeyboard(true);this.midiParser.setSelection(a)}}};SITE.AppView.prototype.unhighlight=function(a){};SITE.AppView.prototype.updateSelection=function(b){var a=this;if(b){delete this.updating}else{if(this.updating){return}this.updating=true;setTimeout(a.updateSelection(true),300)}};SITE.AppView.prototype.printPreview=function(b,c,d){var a=document.getElementById("printPreviewDiv");var e={};c.forEach(function(g){var f=document.getElementById(g.substring(1));e[g.substring(1)]=f.style.display;f.style.display="none"});this.changePageOrientation(d?"landscape":"portrait");a.innerHTML=b;a.style.display="block";setTimeout(function(){var f=new cloudprint.Gadget();f.setPrintDocument("text/html","Print",a.innerHTML);f.openPrintDialog();a.style.display="none";c.forEach(function(h){var g=document.getElementById(h.substring(1));g.style.display=e[h.substring(1)]})})};SITE.AppView.prototype.changePageOrientation=function(a){var b=document.createElement("style");document.head.appendChild(b);b.innerHTML="@page {margin: 1cm; size: "+a+"}"};if(!window.SITE){window.SITE={}}SITE.App=function(d,a,c){document.body.style.overflow="hidden";var b=this;this.ypos=0;this.lastStaffGroup=-1;this.container=document.getElementById("mapaDiv");this.tab={title:"",text:"",ddmId:"menuSongs",type:"songs"};ABCXJS.write.color.useTransparency=SITE.properties.colors.useTransparency;ABCXJS.write.color.highLight=SITE.properties.colors.highLight;DIATONIC.map.color.fill=SITE.properties.colors.fill;DIATONIC.map.color.background=SITE.properties.colors.background;DIATONIC.map.color.close=SITE.properties.colors.close;DIATONIC.map.color.open=SITE.properties.colors.open;this.settingsMenu=document.getElementById(d.settingsMenu);this.accordion=new window.ABCXJS.tablature.Accordion(d.accordion_options);this.abcParser=new ABCXJS.parse.Parse(null,this.accordion);this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);this.accordionSelector=new ABCXJS.edit.AccordionSelector(d.mapMenuGaitasDiv,d.mapMenuGaitasDiv,{listener:b,method:"menuCallback",label:"Accordion"});this.tab.title=FILEMANAGER.loadLocal("property."+this.accordion.getId()+".songs.title")||this.accordion.loaded.getFirstSong();
this.openBtn=document.getElementById(d.openBtn);this.openBtn.addEventListener("click",function(e){b.openEstudio()},false);this.songSelector=document.getElementById(d.mapMenuSongsDiv);this.gaitaImagePlaceHolder=document.getElementById(d.accordionImagePlaceHolder);this.settingsMenu.addEventListener("click",function(e){e.preventDefault();this.blur();b.showSettings()},false);this.aPolicy=document.getElementById("aPolicy");this.aTerms=document.getElementById("aTerms");this.aVersion=document.getElementById("aVersion");this.aPolicy.addEventListener("click",function(e){e.preventDefault();this.blur();b.showModal("PrivacyTitle","","privacidade/index.html",{width:"800",height:"500",print:false})},false);this.aTerms.addEventListener("click",function(e){e.preventDefault();this.blur();b.showModal("TermsTitle","","privacidade/termos.e.condicoes.html",{width:"800",height:"500",print:false})},false);this.aVersion.addEventListener("click",function(e){e.preventDefault();this.blur();b.showModal("AboutAppTitle","","privacidade/sobreApp.html",{width:"800",height:"500",print:false})},false);this.defineInstrument(true);this.showAccordionName();this.showAccordionImage();this.accordionSelector.populate(false);this.songSelectorPopulate();SITE.translator.translate();this.setVisible(true);this.resize()};SITE.App.prototype.songSelectorPopulate=function(){var e=false;var f=this.accordion.loaded.songs;var a=this.tab.ddmId;var g="songs";this.menuSongs=new DRAGGABLE.ui.DropdownMenu(this.songSelector,{listener:this,method:"showABC",translate:false,label:"Song"},[{title:"...",ddmId:this.tab.ddmId,itens:[]}]);for(var d=0;d<f.sortedIndex.length;d++){var h=f.sortedIndex[d];var b=h.replace(/\(.*\)/g,"").trim();var j=0;if(!f.details[h]||isNaN(parseInt(f.details[h].id))){waterbug.logError('Missing or incorrect ID (X:nnn) for "'+h+'"');waterbug.show()}else{j=f.details[h].id}if(f.details[h].hidden){continue}var c=this.menuSongs.addItemSubMenu(a,b+"|"+g+"#"+j);if(h===this.tab.title){e=true;this.menuSongs.setSubMenuTitle(this.tab.ddmId,b);this.menuSongs.selectItem(this.tab.ddmId,c);this.tab.text=this.accordion.loaded.getAbcText(this.tab.type,h)}}if(!e&&f.sortedIndex.length>0){var h=f.sortedIndex[0];var b=h.replace(/\(.*\)/g,"").trim();this.menuSongs.setSubMenuTitle(this.tab.ddmId,b);this.menuSongs.selectItem(this.tab.ddmId,this.tab.type+"#"+f.details[h].id);this.tab.text=this.accordion.loaded.getAbcText(this.tab.type,h)}};SITE.App.prototype.setup=function(a){this.midiPlayer.reset();this.accordion.loadById(a.accordionId);this.showAccordionName();this.showAccordionImage();this.accordionSelector.populate(false);this.songSelectorPopulate();this.resize();if(!this.accordion.loaded.localResource){FILEMANAGER.saveLocal("property.accordion",this.accordion.getId())}};SITE.App.prototype.resize=function(){return;var d=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var b=document.getElementById("section1");var a=document.getElementById("section2");var c=(d-b.clientHeight-(a.clientHeight-this.tuneContainerDiv.clientHeight)-78-14-2);this.tuneContainerDiv.style.height=Math.max(c,200)+"px";this.renderedTune.div.style.height=(Math.max(c,200)-5)+"px";(this.renderedTune.ps)&&this.renderedTune.ps.update();this.renderedChord.div.style.height=(Math.max(c,200)-5)+"px";(this.renderedChord.ps)&&this.renderedChord.ps.update();this.renderedPractice.div.style.height=(Math.max(c,200)-5)+"px";(this.renderedPractice.ps)&&this.renderedPractice.ps.update();this.media.posiciona()};SITE.App.prototype.menuCallback=function(a){switch(a){case"GAITA_MINUANO_GC":case"CONCERTINA_PORTUGUESA":case"GAITA_HOHNER_CORONA_SERIES":case"GAITA_HOHNER_CLUB_IIIM_BR":case"GAITA_MINUANO_BC_TRANSPORTADA":default:this.setup({accordionId:a})}};SITE.App.prototype.openEstudio=function(c,e){var b=this;var d=b.getActiveTab();if(e){e.preventDefault();c.blur()}if(!this.studio){this.studio=new SITE.AppView(null,{studioDiv:"studioDiv",keyboardDiv:"kebyoardDiv",studioControlDiv:"studioControlDiv",studioCanvasDiv:"studioCanvasDiv",generate_tablature:"accordion",backBtn:"backBtn",showMapBtn:"showMapBtn",printBtn:"printBtn",btShowMedia:"buttonShowMedia2",accordion_options:{id:this.accordion.getId(),accordionMaps:DIATONIC.map.accordionMaps,translator:SITE.translator,render_keyboard_opts:{transpose:false,mirror:false,scale:0.8,draggable:false,show:false,label:false}},onchange:function(f){f.onChange()}},{modeBtn:"modeBtn",timerBtn:"timerBtn",playBtn:"playBtn2",stopBtn:"stopBtn2",clearBtn:"clearBtn",gotoMeasureBtn:"gotoMeasureBtn",untilMeasureBtn:"untilMeasureBtn",stepBtn:"stepBtn",repeatBtn:"repeatBtn",stepMeasureBtn:"stepMeasureBtn",tempoSld:"tempoSld",GClefBtn:"GClefBtn",FClefBtn:"FClefBtn",currentPlayTimeLabel:"currentPlayTimeLabel2"})}if(d.text){SITE.ga("send","event","Mapa5","view",d.title);var a=this.startLoader("OpenEstudio");a.start(function(){b.studio.setup(d,b.accordion.getId());a.stop()},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")}};SITE.App.prototype.startPlay=function(b,c){var a=this.getActiveTab();this.ypos=this.tuneContainerDiv.scrollTop;this.lastStaffGroup=-1;if(this.midiPlayer.playing){if(b==="normal"){this.playButton.title=SITE.translator.getResource("playBtn");this.playButton.innerHTML='<i class="ico-play"></i>';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}}else{this.accordion.clearKeyboard();if(b==="normal"){if(this.midiPlayer.startPlay(a.abc.midi)){SITE.ga("send","event","Mapa5","play",a.title);this.playButton.title=SITE.translator.getResource("pause");this.playButton.innerHTML='<i class="ico-pause"></i>'}}else{if(this.midiPlayer.startDidacticPlay(a.abc.midi,b,c)){SITE.ga("send","event","Mapa5","didactic-play",a.title)}}}};SITE.App.prototype.setScrolling=function(c){if(!this.activeTab||c.currAbsElem.staffGroup===this.lastStaffGroup){return}this.lastStaffGroup=c.currAbsElem.staffGroup;var e=c.printer.staffgroups[0].top;var b=this.activeTab.div.clientHeight-e;var d=c.printer.staffgroups[c.currAbsElem.staffGroup].top-12;var a=d+c.printer.staffgroups[c.currAbsElem.staffGroup].height;if(a>b+this.ypos||this.ypos>d-e){this.ypos=d;this.activeTab.div.scrollTop=this.ypos}};SITE.App.prototype.showTab=function(b){var a=this.getActiveTab();if(a){a.selector.style.display="none";this.silencia(true)}a=this.setActiveTab(b);a.selector.style.display="block";this.media.show(a)};SITE.App.prototype.showABC=function(f){var e,g,c=this;var d=c.getActiveTab();var b=f.split("#");if(f.indexOf("#")>=0&&parseInt(b[1])>0){e=b[0];g=this.accordion.loaded[e].ids[b[1]]}else{waterbug.logError("ABCX not found!");waterbug.show();return}if(this.tab.title!==g&&this.menuSongs.selectItem(this.tab.ddmId,f)){this.tab.title=g;this.tab.text=this.accordion.loaded.getAbcText(e,g);var h=g.replace(/\(.*\)/g,"").trim();this.menuSongs.setSubMenuTitle(this.tab.ddmId,(h.length>43?h.substr(0,40)+"...":h));if(!this.accordion.loaded.localResource){FILEMANAGER.saveLocal("property."+this.accordion.getId()+"."+e+".title",g)}}else{console.log("Song title not found!")
}};SITE.App.prototype.renderTAB=function(a){if(a.title===undefined||a.text===undefined){a.text=undefined;a.title=undefined;return}this.abcParser.parse(a.text,this.parserparams);a.abc=this.abcParser.getTune();a.text=this.abcParser.getStrTune();if(this.midiParser){this.midiParser.parse(a.abc,this.accordion.loadedKeyboard)}var b=new SVG.Printer(a.div);a.printer=new ABCXJS.write.Printer(b,this.printerparams);a.printer.printTune(a.abc);a.printer.addSelectListener(this);this.accordion.clearKeyboard(true);a.div.scrollTop=0;if(a.ps){a.ps.update()}else{a.ps=new PerfectScrollbar(a.div,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500})}};SITE.App.prototype.getActiveTab=function(){return this.tab};SITE.App.prototype.setVisible=function(a){this.container.style.display=(a?"block":"none")};SITE.App.prototype.showAccordionImage=function(){this.gaitaImagePlaceHolder.innerHTML='<img src="'+this.accordion.loaded.image+'" alt="'+this.accordion.getFullName()+" "+SITE.translator.getResource("keys")+'" style="height:200px; width:200px;" />'};SITE.App.prototype.showAccordionName=function(){var a=this.accordion.getFullName()+' <span data-translate="keys">'+SITE.translator.getResource("keys")+"</span>";this.accordionSelector.menu.setSubMenuTitle(this.accordionSelector.ddmId,a)};SITE.App.prototype.highlight=function(a){if(!this.midiPlayer.playing){this.accordion.clearKeyboard(true);this.midiParser.setSelection(a)}};SITE.App.prototype.startLoader=function(e,b,d,c){var a=new window.widgets.Loader({id:e,bars:0,radius:0,lineWidth:20,lineHeight:70,timeout:1,background:"rgba(0,0,0,0.5)",container:b?b:document.body,onstart:d,oncomplete:c});return a};SITE.App.prototype.defineInstrument=function(b){var c=SITE.properties.options.pianoSound?"acoustic_grand_piano":"accordion";var a=function(){var d=SITE.properties.options.pianoSound?0:21;MIDI.programChange(0,d);MIDI.programChange(1,d);MIDI.programChange(2,d);MIDI.programChange(3,d);MIDI.programChange(4,d);MIDI.programChange(5,d)};if(b){a();return}MIDI.widget=new sketch.ui.Timer({size:180,cor1:SITE.properties.colors.close,cor2:SITE.properties.colors.open});MIDI.widget.setFormat(SITE.translator.getResource("loading"));MIDI.loadPlugin({soundfontUrl:"./soundfont/",instruments:c,onprogress:function(g,d,e){var f=((d*100)+e)/(g);MIDI.widget.setValue(Math.round(f))},callback:function(){a()}})};SITE.App.prototype.showSettings=function(){var c=600;var b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var a=70;if(!this.settings){this.settings={};this.settings.window=new DRAGGABLE.ui.Window(null,null,{title:"PreferencesTitle",translator:SITE.translator,statusbar:false,top:"40px",left:a+"px",height:"400px",width:c+"px",zIndex:50},{listener:this,method:"settingsCallback"});this.settings.window.topDiv.style.zIndex=101;this.settings.window.dataDiv.innerHTML='        <div class="menu-group">            <table>              <tr>                <th colspan="2"><span data-translate="PrefsIdiom" >'+SITE.translator.getResource("PrefsIdiom")+'</span></th><th><div id="settingsLanguageMenu" class="topMenu"></div></th>              </tr>              <tr>                <th colspan="2"><br><span data-translate="PrefsColor" >'+SITE.translator.getResource("PrefsColor")+'</span></th><td></td>              </tr>              <tr>                <td style="width:15px;"></td><td data-translate="PrefsColorHighlight" >'+SITE.translator.getResource("PrefsColorHighlight")+'</td><td><input id="corRealce" type="text" readonly ><input id="chkTransparency" type="checkbox">&nbsp;                        <a style="text-decoration:none; color:black;" href="#" onClick="(function(){document.getElementById(\'chkTransparency\').checked=!document.getElementById(\'chkTransparency\').checked})();return false;">                        <span data-translate="PrefsColorTransparency" >'+SITE.translator.getResource("PrefsColorTransparency")+'</span></td>              </tr>              <tr>                <td></td><td data-translate="PrefsColorClosingBellows" >'+SITE.translator.getResource("PrefsColorClosingBellows")+'</td><td><input readonly id="foleFechando" type="text" ></td>              </tr>              <tr>                <td></td><td data-translate="PrefsColorOpeningBellows" >'+SITE.translator.getResource("PrefsColorOpeningBellows")+'</td><td><input readonly id="foleAbrindo" type="text" ></td>              </tr>              <tr>                <th colspan="2"><br><span data-translate="PrefsProps" >'+SITE.translator.getResource("PrefsProps")+'</span></th><td></td>              </tr>              <tr style="height:40px;">                <td> </td><td colspan="2"><input id="chkPiano" type="checkbox">&nbsp;                <a style="text-decoration:none; color:black;" href="#" onClick="(function(){document.getElementById(\'chkPiano\').checked=!document.getElementById(\'chkPiano\').checked})();return false;">                <span data-translate="PrefsPropsCKPiano" >'+SITE.translator.getResource("PrefsPropsCKPiano")+'</span></a></td>              </tr>              <tr>                <td> </td><td colspan="2"><input id="chkKeyboardRight" type="checkbox">&nbsp;                <a style="text-decoration:none; color:black;" href="#" onClick="(function(){document.getElementById(\'chkKeyboardRight\').checked=!document.getElementById(\'chkKeyboardRight\').checked})();return false;">                <span data-translate="PrefsPropsCKkeyboardAlignRight" >'+SITE.translator.getResource("PrefsPropsCKkeyboardAlignRight")+'</span></td>              </tr>              <tr style="display:none;">                <td> </td><td colspan="2"><input id="chkWarnings" type="checkbox">&nbsp;<span data-translate="PrefsPropsCKShowWarnings" >'+SITE.translator.getResource("PrefsPropsCKShowWarnings")+'</span></td>              </tr>              <tr style="display:none;">                <td> </td><td colspan="2"><input id="chkAutoRefresh" type="checkbox">&nbsp;<span data-translate="PrefsPropsCKAutoRefresh" >'+SITE.translator.getResource("PrefsPropsCKAutoRefresh")+'</span></td>              </tr>              </table>        </div>        <div id="pg" class="pushbutton-group" style="right: 0; bottom: 0;" >            <div id="botao1"></div>\n            <div id="botao2"></div>\n            <div id="botao3"></div>\n        </div>';this.settings.window.addPushButtons(["botao1|apply","botao2|reset|PrefsReset","botao3|cancel"]);this.settings.menu=new DRAGGABLE.ui.DropdownMenu("settingsLanguageMenu",{listener:this,method:"settingsCallback",translate:false},[{title:"Idioma",ddmId:"menuIdiomas",itens:[]}]);this.picker=new DRAGGABLE.ui.ColorPicker(["corRealce","foleFechando","foleAbrindo"],{readonly:false,translator:SITE.translator});SITE.translator.menuPopulate(this.settings.menu,"menuIdiomas");this.settings.lang=SITE.properties.options.language;this.settings.useTransparency=document.getElementById("chkTransparency");
this.settings.corRealce=document.getElementById("corRealce");this.settings.closeColor=document.getElementById("foleFechando");this.settings.openColor=document.getElementById("foleAbrindo");this.settings.keyboardRight=document.getElementById("chkKeyboardRight");this.settings.showWarnings=document.getElementById("chkWarnings");this.settings.autoRefresh=document.getElementById("chkAutoRefresh");this.settings.pianoSound=document.getElementById("chkPiano")}this.settings.corRealce.style.backgroundColor=this.settings.corRealce.value=SITE.properties.colors.highLight;this.settings.closeColor.style.backgroundColor=this.settings.closeColor.value=SITE.properties.colors.close;this.settings.openColor.style.backgroundColor=this.settings.openColor.value=SITE.properties.colors.open;this.settings.keyboardRight.checked=SITE.properties.options.keyboardRight;this.settings.showWarnings.checked=SITE.properties.options.showWarnings;this.settings.autoRefresh.checked=SITE.properties.options.autoRefresh;this.settings.pianoSound.checked=SITE.properties.options.pianoSound;this.settings.useTransparency.checked=SITE.properties.colors.useTransparency;this.settings.window.setVisible(true)};SITE.App.prototype.settingsCallback=function(b,a){switch(b){case"de_DE":case"en_US":case"es_ES":case"fr_FR":case"it_IT":case"pt_BR":this.settings.lang=b;this.settings.menu.setSubMenuTitle("menuIdiomas",this.settings.menu.selectItem("menuIdiomas",b));break;case"MOVE":break;case"CLOSE":case"CANCEL":this.picker.close();this.settings.window.setVisible(false);break;case"APPLY":SITE.properties.colors.highLight=this.settings.corRealce.value;SITE.properties.colors.close=this.settings.closeColor.value;SITE.properties.colors.open=this.settings.openColor.value;SITE.properties.options.keyboardRight=this.settings.keyboardRight.checked;SITE.properties.options.showWarnings=this.settings.showWarnings.checked;SITE.properties.options.autoRefresh=this.settings.autoRefresh.checked;SITE.properties.colors.useTransparency=this.settings.useTransparency.checked;this.picker.close();this.settings.window.setVisible(false);this.applySettings();SITE.SaveProperties();break;case"RESET":this.alert=new DRAGGABLE.ui.Alert(this.settings.window,b,"<br>"+SITE.translator.getResource("resetMsgTitle"),"<br>"+SITE.translator.getResource("resetMsgDescription"),{translator:SITE.translator});break;case"RESET-YES":this.alert.close();this.picker.close();this.settings.window.setVisible(false);SITE.ResetProperties();SITE.ga("send","event","Configuration","reset",SITE.properties.version);this.applySettings();break;case"RESET-NO":case"RESET-CANCEL":this.alert.close();break}};SITE.App.prototype.applySettings=function(){if(this.settings.lang!==SITE.properties.options.language){SITE.properties.options.language=this.settings.lang;SITE.ga("send","event","Configuration","changeLang",SITE.properties.options.language);SITE.translator.loadLanguage(this.settings.lang,function(){SITE.translator.translate()})}if(this.settings.pianoSound.checked!==SITE.properties.options.pianoSound){SITE.properties.options.pianoSound=this.settings.pianoSound.checked;SITE.ga("send","event","Configuration","changeInstrument",SITE.properties.options.pianoSound?"piano":"accordion");this.defineInstrument()}if(this.studio){this.studio.warningsDiv.style.display=SITE.properties.options.showWarnings?"block":"none";if(SITE.properties.options.keyboardRight){this.studio.resize=this.studio.resizeRight}else{this.studio.resize=this.studio.resizeLeft}}this.resizeActiveWindow();ABCXJS.write.color.useTransparency=SITE.properties.colors.useTransparency;ABCXJS.write.color.highLight=SITE.properties.colors.highLight;DIATONIC.map.color.close=SITE.properties.colors.close;DIATONIC.map.color.open=SITE.properties.colors.open;this.accordion.loadedKeyboard.legenda.setOpen();this.accordion.loadedKeyboard.legenda.setClose()};SITE.App.prototype.changePageOrientation=function(a){var b=document.createElement("style");document.head.appendChild(b);b.innerHTML="@page {margin: 1cm; size: "+a+"}"};SITE.App.prototype.resizeActiveWindow=function(){if(this.studio&&window.getComputedStyle(this.studio.Div.parent).display!=="none"){this.studio.resize()}else{this.resize()}};SITE.App.prototype.silencia=function(a){if(this.studio&&window.getComputedStyle(this.studio.Div.parent).display!=="none"){if(this.studio.midiPlayer.playing){if(a){this.studio.midiPlayer.stopPlay()}else{this.studio.startPlay("normal")}}}};SITE.App.prototype.setFocus=function(){};SITE.App.prototype.showModal=function(h,g,d,c){var f=this;c=c||{};c.width=typeof c.width==="undefined"?"800":c.width;c.height=typeof c.height==="undefined"?undefined:c.height;c.print=typeof c.print==="undefined"?true:c.print;var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var b=e/2-c.width/2;if(!this.modalWindow){this.modalWindow=new DRAGGABLE.ui.Window(null,["print|printBtn"],{title:"",translator:SITE.translator,draggable:true,statusbar:false,top:"30px",height:"90%",left:"60px",width:"calc(90% - 60px)",zIndex:70},{listener:this,method:"modalCallback"});this.modalWindow.dataDiv.style.height="auto";this.modalWindow.dataDiv.innerHTML='<object id="myFrame" data="" type="text/html" ></object>              <div id="pg" class="pushbutton-group" style="right: 4px; bottom: 4px;" >                <div id="btClose"></div>\n             </div>';this.modalWindow.addPushButtons(["btClose|close"])}this.modalWindow.setTitle(h,SITE.translator);this.modalWindow.setSubTitle(g,SITE.translator);this.modalWindow.setButtonVisible("PRINT",c.print);this.iframe=document.getElementById("myFrame");this.modalWindow.topDiv.style.opacity="0";this.modalWindow.setVisible(true);this.modalWindow.dataDiv.height=(this.modalWindow.topDiv.clientHeight-25)+"px";this.iframe.style.width="100%";this.iframe.style.height=(this.modalWindow.topDiv.clientHeight-25)+"px";this.modalWindow.dataDiv.height=this.iframe.style.height;this.info;this.container;var a=this.startLoader("Modal");f.iframe.setAttribute("data",d);f.iframe.addEventListener("load",function(){f.container=this.contentDocument.getElementById("modalContainer");f.info=this.contentDocument.getElementById("siteVerI");$(f.iframe).ready(function(){if(f.info){f.info.innerHTML=SITE.siteVersion}if(f.container){f.container.style.top="0";f.container.style.height=(f.modalWindow.dataDiv.clientHeight-70)+"px";f.container.style.overflow="hidden";f.container.style.border="1px solid rgba(255, 153, 34, 0.2)";var j=new PerfectScrollbar(f.container,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});var l=f.container.getElementsByTagName("a");for(var k=0;k<l.length;k++){l[k].onclick=function(){return false}}}f.modalWindow.topDiv.style.opacity="1";a.stop()});a.start(function(){})},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")};SITE.App.prototype.modalCallback=function(b){that=this;if(b==="CLOSE"){that.iframe.setAttribute("data","");
that.modalWindow.setVisible(false)}else{if(b==="PRINT"){var a=this.iframe.contentDocument.getElementById("modalContainer");if(a){this.printPreview(a.innerHTML,["#"+this.modalWindow.topDiv.id,"#topBar","#mapaDiv"],false)}}}};