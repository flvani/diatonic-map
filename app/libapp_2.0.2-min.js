if(!window.SITE){window.SITE={gtagInitiated:false}}window.dataLayer=window.dataLayer||[];SITE.ga=function(){if(gtag&&(window.location.href.indexOf("diatonicmap.com.br")>=0||window.location.href.indexOf("androidplatform")>=0)&&SITE.getVersion("mainSITE","")!=="debug"&&SITE.getVersion("mainSITE","")!=="unknown"){if(SITE.debug){console.log("App is in Debug mode")}else{if(!SITE.gtagInitiated){gtag("js",new Date());gtag("config","UA-62839199-4");SITE.gtagInitiated=true}gtag(arguments[0],arguments[1],arguments[2])}}else{console.log("Funcao gtag não definida.")}};SITE.findGetParameter=function(c){var a=null,e=[];var b=window.location.search.substr(1).split("&");for(var d=0;d<b.length;d++){e=b[d].split("=");if(e[0]===c){a=decodeURIComponent(e[1])}}return a};SITE.getDate=function(){var b=new Date();var a=b.getDate();var c=b.getMonth()+1;var d=b.getFullYear();return d*10000+c*100+a};SITE.getVersion=function(a,b){var d=document.getElementById(a);if(!d){return"unknown"}var c=d.src.match(/\_[0-9]*\.[0-9]*[\.[0-9]*]*/g);return c?b+c[0].substr(1):"debug"};SITE.getLanguage=function(){var b=window.navigator.userLanguage||window.navigator.language;if(b.indexOf("-")>=0){b=b.replace("-","_");for(var a in SITE.properties.known_languages){if(a.toLowerCase()===b.toLocaleLowerCase()){return a}}}for(var a in SITE.properties.known_languages){if(a.substr(0,2)===b.substr(0,2)){return a}}return"en_US"};SITE.LoadProperties=function(){var b=false;try{SITE.properties=JSON.parse(FILEMANAGER.loadLocal("diatonic-map.site.properties"))}catch(c){waterbug.log("Could not load the properties.");waterbug.show("Could not save the properties");SITE.ga("event","html5storage",{event_category:"Error",event_label:"loadingLocal",non_interaction:true})}var a=SITE.getVersion("mainSITE","");if(!SITE.properties){SITE.ResetProperties()}else{if(a==="debug"){SITE.properties.options.showConsole=true}else{if(!SITE.properties.version||SITE.properties.version==="debug"||parseFloat(SITE.properties.version)<parseFloat(a)){SITE.properties.version=a;b=true}}}if(!SITE.properties.known_languages){SITE.properties.known_languages={de_DE:{file:"languages/de_DE.lang",image:"images/de_DE.png",name:"Deustch"},en_US:{file:"languages/en_US.lang",image:"images/en_US.png",name:"US English"},es_ES:{file:"languages/es_ES.lang",image:"images/es_ES.png",name:"Español"},fr_FR:{file:"languages/fr_FR.lang",image:"images/fr_FR.png",name:"Français"},it_IT:{file:"languages/it_IT.lang",image:"images/it_IT.png",name:"Italiano"},pt_BR:{file:"languages/pt_BR.lang",image:"images/pt_BR.png",name:"Português do Brasil"}};SITE.properties.options.language=SITE.getLanguage();SITE.properties.colors.highLight="#ff0000";SITE.properties.options.showWarnings=false;SITE.properties.options.showConsole=false;SITE.properties.options.pianoSound=false;SITE.properties.options.autoRefresh=false;SITE.properties.options.keyboardRight=false;SITE.properties.options.suppressTitles=false;b=true}if(!SITE.properties.studio.media){SITE.properties.studio.media={visible:false,top:"20px",left:"1200px",width:100,height:200};SITE.properties.partGen.media={visible:false,top:"20px",left:"1200px",width:100,height:200};b=true}if(!SITE.properties.partEdit){SITE.properties.partEdit={media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};b=true}SITE.properties.options.tabFormat=0;SITE.properties.options.lyrics=true;SITE.properties.options.fingering=true;SITE.properties.options.rowsNumbered=false;if(SITE.properties.options.tabFormat===undefined){b=true;SITE.properties.options.tabFormat=0}if(SITE.properties.options.tabShowOnlyNumbers===undefined){b=true;SITE.properties.options.tabShowOnlyNumbers=false}if(b){SITE.SaveProperties()}};SITE.SaveProperties=function(){try{FILEMANAGER.saveLocal("diatonic-map.site.properties",JSON.stringify(SITE.properties))}catch(a){waterbug.log("Could not save the properties");waterbug.show("Could not save the properties");SITE.ga("event","html5storage",{event_category:"Error",event_label:"savingLocal",non_interaction:true})}};SITE.ResetProperties=function(){SITE.properties={};SITE.properties.known_languages={de_DE:{file:"languages/de_DE.lang",image:"images/de_DE.png",name:"Deustch"},en_US:{file:"languages/en_US.lang",image:"images/en_US.png",name:"US English"},es_ES:{file:"languages/es_ES.lang",image:"images/es_ES.png",name:"Español"},fr_FR:{file:"languages/fr_FR.lang",image:"images/fr_FR.png",name:"Français"},it_IT:{file:"languages/it_IT.lang",image:"images/it_IT.png",name:"Italiano"},pt_BR:{file:"languages/pt_BR.lang",image:"images/pt_BR.png",name:"Português do Brasil"}};SITE.properties.version=SITE.getVersion("mainSITE","");SITE.properties.colors={useTransparency:true,highLight:"#ff0000",fill:"white",background:"none",close:"#ff3a3a",open:"#ffba3b"};SITE.properties.options={language:SITE.getLanguage(),showWarnings:false,showConsole:false,pianoSound:false,autoRefresh:false,keyboardRight:false,suppressTitles:false,tabFormat:0,tabShowOnlyNumbers:false};SITE.properties.mediaDiv={visible:true,top:"20px",left:"1200px",width:100,height:200};SITE.properties.tabGen={abcEditor:{floating:false,maximized:false,top:"70px",left:"25px",width:"940px",height:"560px"},tabEditor:{floating:false,maximized:false,top:"140px",left:"75px",width:"940px",height:"560px"}};SITE.properties.partEdit={media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};SITE.properties.partGen={showABCText:false,convertFromClub:false,convertToClub:false,media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};SITE.properties.studio={mode:"normal",timerOn:false,trebleOn:true,bassOn:true,media:{visible:false,top:"20px",left:"1200px",width:100,height:200},editor:{visible:true,floating:false,maximized:false,top:"40px",left:"50px",width:"700px",height:"480px"},keyboard:{visible:false,top:"65px",left:"1200px",scale:1,mirror:true,transpose:false,label:false}};FILEMANAGER.saveLocal("ultimaTablaturaEditada","");FILEMANAGER.saveLocal("ultimaPartituraEditada","");SITE.SaveProperties()};if(!window.SITE){window.SITE={}}if(!window.SITE.lang){window.SITE.lang={}}SITE.Translator=function(a){a=a||{};if(!a.language){a.language="pt_BR"}this.language=null;this.loadLanguage(a.language,a.callback)};SITE.Translator.prototype.loadLanguage=function(d,e){var c=1;var b=this;FILEMANAGER.register("LANG");if(!SITE.properties||!SITE.properties.known_languages){SITE.ResetProperties()}if(!SITE.properties.known_languages[d]){b.log("Unknown language: "+d+". Loading English...");
d="en_US";SITE.properties.options.language=d;SITE.SaveProperties()}var a=SITE.properties.known_languages[d].file;$.getJSON(a,{format:"json"}).done(function(f){FILEMANAGER.deregister("LANG",true);b.language=f}).fail(function(g,h,f){FILEMANAGER.deregister("LANG",false);b.log("Failed to load language "+d+":\nLoading: "+g.responseText.substr(1,40)+"...\nError:\n "+h+", "+f+".")}).always(function(){c--;if(c===0){e&&e()}})};SITE.Translator.prototype.menuPopulate=function(e,d){var a,b;e.emptySubMenu(d);for(var f in SITE.properties.known_languages){var c='<img src="'+SITE.properties.known_languages[f].image+'" />&#160;'+SITE.properties.known_languages[f].name;a=e.addItemSubMenu(d,c+"|"+f);if(this.language&&this.language.id===f){b=a}}if(b){e.setSubMenuTitle(d,e.selectItem(d,b))}};SITE.Translator.prototype.getResource=function(b){if(!this.language){return null}var a=this.language.resources[b];(!a)&&this.log('Missing translation for "'+b+'" in "'+this.language.langName+'".');return a};SITE.Translator.prototype.translate=function(a){if(!this.language){return}a=a||document;var d=a.querySelectorAll("[data-translate]");var f=Array.prototype.slice.apply(d);for(var c=0;c<f.length;c++){var e=f[c];var b=this.language.resources[e.getAttribute("data-translate")];if(b){switch(e.nodeName){case"INPUT":if(e.type==="text"){e.title=b.tip;e.value=b.val}break;case"BUTTON":case"DIV":case"I":e.title=b;break;default:e.innerHTML=b}}else{this.log('Missing translatation for "'+e.getAttribute("data-translate")+'" in "'+this.language.langName+'".')}}};SITE.Translator.prototype.sortLanguages=function(){this.languages.sort(function(d,c){return parseInt(d.menuOrder)-parseInt(c.menuOrder)})};SITE.Translator.prototype.log=function(a){if(a.substr(27,7)==="CORONA_"){return}if(a.substr(27,7)==="HOHNER_"){return}if(a.substr(27,6)==="GAITA_"){return}if(a.substr(27,11)==="CONCERTINA_"){return}waterbug.log(a);(SITE.properties.options.showConsole)&&waterbug.show()};if(!window.SITE){window.SITE={}}SITE.Media=function(b,d,a){var c=this;this.Div=b||null;this.proportion=0.55666667;this.youTubeURL=false;this.properties=a;if(d){this.showMediaButton=document.getElementById(d);this.showMediaButton.addEventListener("click",function(){c.callback("OPEN")},false)}this.mediaWindow=new DRAGGABLE.ui.Window(this.Div,null,{title:"showMedia",translator:SITE.translator,alternativeResize:true,top:this.properties.top,left:this.properties.left},{listener:this,method:"callback"})};SITE.Media.prototype.callback=function(b){switch(b){case"RESIZE":this.resize();var a=this.mediaWindow.dataDiv;this.properties.width=a.clientWidth;this.properties.height=a.clientHeight;SITE.SaveProperties();break;case"MOVE":var a=this.mediaWindow.topDiv;this.properties.top=a.style.top;this.properties.left=a.style.left;SITE.SaveProperties();break;case"OPEN":this.properties.visible=true;SITE.SaveProperties();this.mediaWindow.setVisible(true);this.resize();this.posiciona();if(this.showMediaButton){this.showMediaButton.style.display="none"}break;case"CLOSE":this.pause();this.properties.visible=false;SITE.SaveProperties();if(this.showMediaButton){this.mediaWindow.setVisible(false);this.showMediaButton.style.display="block"}break}return false};SITE.Media.prototype.pause=function(){if(!this.mediaWindow||!this.currTab){return}var a=this.currTab.div.getElementsByTagName("iframe")[0];if(!a){return}a.contentWindow.postMessage('{"event":"command","func":"pauseVideo", "args":""}',"*")};SITE.Media.prototype.show=function(f){var h=this;var c,i;if(f.abc&&f.abc.metaText.url){c=f.abc.metaText.url}if(c){var d=300;var g=17;if(c!==this.url){this.url=c;if(this.properties.width>100){d=this.properties.width;g=Math.round((d-100)/11)}else{if(window.innerWidth>=1200){d=600;g=46}else{if(window.innerWidth>=950){d=400;g=27}}}var o=d*this.proportion;this.mediaWindow.dataDiv.style.width=d+"px";this.mediaWindow.topDiv.style.width=d+"px";this.mediaWindow.dataDiv.style.height=o+"px";this.mediaWindow.topDiv.style.height=o+"px";if(!this.tabDiv){this.tabDiv=document.createElement("div");this.tabDiv.className="media-tabs";this.mediaWindow.topDiv.appendChild(this.tabDiv)}else{this.tabDiv.innerHTML="";this.mediaWindow.dataDiv.innerHTML=""}var m=c.split("\n");this.tabs={};this.currTab=null;for(var a=0;a<m.length&&a<10;a++){var p=(this.mediaWindow.id*10+a);this.youTubeURL=(m[a].match(/www.youtube-nocookie.com/g)!==null);this.isPDF=(m[a].match(/.*pdf/)!==null);var l=m[a].match(/\&.*\;/g);var n=m[a];var k="";if(l){n=m[a].replace(l[0],"");k=l[0].substring(3,l[0].length-1);if(k.length>g){k=k.substring(0,g)+"..."}}var b=document.createElement("div");b.className="media-content";this.mediaWindow.dataDiv.appendChild(b);if(this.youTubeURL){i='<iframe id="e'+p+'" src="'+n+'?rel=0&amp;showinfo=0&amp;enablejsapi=1" frameborder="0" allowfullscreen="allowfullscreen" ></iframe>'}else{i='<embed id="e'+p+'" src="'+n+'" "></embed>'}b.innerHTML=i;this.embed=document.getElementById("e"+p);this.embed.style.width="100%";this.embed.style.height=(this.youTubeURL?"100%":(this.isPDF?"calc(100% - 4px)":"auto"));this.tabs["w"+p]={div:b,tit:k,u2be:this.youTubeURL};if(m.length>1){var e=document.createElement("input");e.id="w"+p;e.type="radio";e.name="mediaControl"+this.mediaWindow.id;e.className="tab-selector-"+a;this.tabDiv.appendChild(e);var e=document.createElement("label");e.htmlFor="w"+p;e.className="media-tab-label-"+a;e.innerHTML="#"+(a+1);this.tabDiv.appendChild(e)}}this.showTab=function(s){this.pause();for(var q in this.tabs){this.tabs[q].div.className="media-content";if(!s){s=q;var r=document.getElementById(s);if(r){r.checked=true}}}this.tabs[s].div.className="media-visible";this.currTab=this.tabs[s];this.mediaWindow.dataDiv.style.overflow=this.currTab.u2be?"hidden":"auto";this.mediaWindow.setSubTitle(this.currTab.tit?"- "+this.currTab.tit:"");this.resize()};if(m.length>1){var j=document.getElementsByName("mediaControl"+this.mediaWindow.id);for(var a=0;a<j.length;a++){j[a].addEventListener("change",function(){h.showTab(this.id)})}}h.showTab()}if(this.showMediaButton){this.showMediaButton.style.display=(this.properties.visible?"none":"inline")}this.mediaWindow.setVisible(this.properties.visible);if(this.properties.visible){this.resize();this.posiciona()}else{this.pause()}}else{this.pause();this.mediaWindow.setVisible(false);if(this.showMediaButton){this.showMediaButton.style.display="none"}}};SITE.Media.prototype.posiciona=function(){if(!this.mediaWindow.topDiv||this.mediaWindow.topDiv.style.display==="none"){return}var b=document.body.clientWidth||document.documentElement.clientWidth||window.innerWidth;b=Math.min(b,this.mediaWindow.parent.clientWidth);var d=this.mediaWindow.topDiv;var a=parseInt(d.style.left.replace("px",""));var c=a;if(a+d.offsetWidth>b){a=(b-(d.offsetWidth+30))}if(a<0){a=10}if(a!==c){d.style.left=a+"px";this.properties.left=a+"px";SITE.SaveProperties()}};SITE.Media.prototype.resize=function(){var b=this.mediaWindow.menuDiv.clientHeight+(this.mediaWindow.bottomBar?this.mediaWindow.bottomBar.clientHeight:0);this.mediaWindow.dataDiv.style.width=this.mediaWindow.topDiv.clientWidth+"px";
this.mediaWindow.dataDiv.style.height=(this.mediaWindow.topDiv.clientHeight-b)+"px";if(this.currTab.u2be){var a=(this.mediaWindow.topDiv.clientWidth*this.proportion);this.mediaWindow.dataDiv.style.height=a+"px";this.mediaWindow.topDiv.style.height=(a+b)+"px"}};if(!window.SITE){window.SITE={}}SITE.AppView=function(d,e,c){var b=this;this.app=d;this.isApp=true;this.parserparams={};this.ypos=0;this.lastStaffGroup=-1;this.lastYpos=0;var a="canvasDiv";this.warnings=[];this.renderedTune={text:undefined,abc:undefined,title:undefined,tab:undefined,div:undefined,selector:undefined};this.Div=new DRAGGABLE.ui.Window(e.studioDiv,null,{translator:SITE.translator,statusbar:false,draggable:false,top:"0",left:"0",width:"100%",height:"100%",title:"EstudioTitle"},{listener:this,method:"appViewCallBack"});this.keyboardWindow=new DRAGGABLE.ui.Window(e.keyboardDiv,["rotate","globe"],{title:"",translator:SITE.translator,statusbar:false,draggable:false,top:"3px",left:"1px"},{listener:this,method:"keyboardCallback"});this.keyboardWindow.extras=document.createElement("div");this.keyboardWindow.extras.style.display="none";this.keyboardWindow.extras.innerHTML='<button id="rotateBtnExtra" data-translate="rotate" ><i class="ico-rotate" ></i></button>            <button id="globeBtnExtra"  data-translate="globe" ><i class="ico-world" ></i></button>';this.keyboardWindow.extras.className="keyboard-btn-group";this.keyboardWindow.topDiv.appendChild(this.keyboardWindow.extras);this.rotateBtnExtra=document.getElementById("rotateBtnExtra");this.globeBtnExtra=document.getElementById("globeBtnExtra");this.rotateBtnExtra.addEventListener("click",function(f){f.preventDefault();b.keyboardCallback("ROTATE")},false);this.globeBtnExtra.addEventListener("click",function(f){f.preventDefault();b.keyboardCallback("GLOBE")},false);this.keyboardWindow.imagem=document.createElement("div");this.keyboardWindow.imagem.style.display="none";this.keyboardWindow.imagem.style.zIndex="5000";this.keyboardWindow.imagem.className="circular";this.keyboardWindow.topDiv.appendChild(this.keyboardWindow.imagem);SITE.translator.translate(this.keyboardWindow.extras);this.Div.setVisible(true);this.Div.dataDiv.style.overflow="hidden";if(e.generate_tablature){if(e.generate_tablature==="accordion"){this.accordion=new window.ABCXJS.tablature.Accordion(e.accordion_options,SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);if(e.accordionNameSpan){this.accordionNameSpan=document.getElementById(e.accordionNameSpan);this.accordionNameSpan.innerHTML=this.accordion.getFullName()}}else{throw new Error("Tablatura para "+e.generate_tablature+" não suportada!")}}this.accordion.setRenderOptions({draggable:false,show:SITE.properties.studio.keyboard.visible,transpose:SITE.properties.studio.keyboard.transpose,mirror:SITE.properties.studio.keyboard.mirror,scale:0.85,label:SITE.properties.studio.keyboard.label});this.controlDiv=document.createElement("DIV");this.controlDiv.setAttribute("id","controlDiv");this.controlDiv.setAttribute("class","controlDiv btn-group draggableToolBarApp");this.Div.dataDiv.appendChild(this.controlDiv);this.controlDiv.innerHTML=document.getElementById(e.studioControlDiv).innerHTML;document.getElementById(e.studioControlDiv).innerHTML="";this.controlDiv.style.borderBottom="1px solid rgba(255, 153, 34, 0.4)";this.Div.topDiv.style.borderLeft="1px solid rgba(255, 153, 34, 0.4)";this.media=new SITE.Media(this.Div.dataDiv,e.btShowMedia,SITE.properties.studio.media);this.studioCanvasDiv=document.createElement("DIV");this.studioCanvasDiv.setAttribute("id",e.studioCanvasDiv);this.studioCanvasDiv.setAttribute("class","studioCanvasDiv");this.canvasDiv=document.createElement("DIV");this.canvasDiv.setAttribute("id",a);this.canvasDiv.setAttribute("class","canvasDiv");this.studioCanvasDiv.appendChild(this.canvasDiv);this.Div.dataDiv.appendChild(this.studioCanvasDiv);this.renderedTune.div=this.canvasDiv;if(this.ps){this.ps.destroy()}this.ps=new PerfectScrollbar(this.studioCanvasDiv,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});if(e.onchange){this.onchangeCallback=e.onchange}this.saveButton=document.getElementById(e.saveBtn);this.forceRefreshButton=document.getElementById(e.forceRefresh);this.printButton=document.getElementById(e.printBtn);this.backButton=document.getElementById(e.backBtn);this.showMapButton=document.getElementById(e.showMapBtn);this.modeButton=document.getElementById(c.modeBtn);this.lyricsButton=document.getElementById(c.lyricsBtn);this.fingeringButton=document.getElementById(c.fingeringBtn);this.tabformatButton=document.getElementById(c.tabformatBtn);this.timerButton=document.getElementById(c.timerBtn);this.FClefButton=document.getElementById(c.FClefBtn);this.GClefButton=document.getElementById(c.GClefBtn);this.playButton=document.getElementById(c.playBtn);this.stopButton=document.getElementById(c.stopBtn);this.gotoMeasureButton=document.getElementById(c.gotoMeasureBtn);this.untilMeasureButton=document.getElementById(c.untilMeasureBtn);this.currentPlayTimeLabel=document.getElementById(c.currentPlayTimeLabel);this.stepButton=document.getElementById(c.stepBtn);this.stepMeasureButton=document.getElementById(c.stepMeasureBtn);this.repeatButton=document.getElementById(c.repeatBtn);this.clearButton=document.getElementById(c.clearBtn);this.tempoButton=document.getElementById(c.tempoSld);this.backButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.app.closeAppView()},false);this.showMapButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.showKeyboard();b.keyboardWindow.resize();b.Div.resize();b.resize()},false);if(!this.isApp){this.forceRefreshButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.fireChanged(0,{force:true,showProgress:true})},false);this.saveButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.salvaMusica()},false)}this.printButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.printPreview(b.renderedTune.div.innerHTML,["#topBar","#appDiv","#keyboardDiv","#studioDiv"],b.renderedTune.abc.formatting.landscape)},false);this.modeButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.changePlayMode()},false);this.lyricsButton.addEventListener("click",function(f){if(b.midiPlayer.playing){b.studioStopPlay()}f.preventDefault();this.blur();SITE.properties.options.lyrics=!SITE.properties.options.lyrics;b.parserparams.hideLyrics=!SITE.properties.options.lyrics;b.setLyricsIcon();b.fireChanged(0,{force:true,showProgress:true})},false);this.fingeringButton.addEventListener("click",function(f){if(b.midiPlayer.playing){b.midiPlayer.stopPlay}f.preventDefault();this.blur();SITE.properties.options.fingering=!SITE.properties.options.fingering;b.parserparams.hideFingering=!SITE.properties.options.fingering;b.setFingeringIcon();b.fireChanged(0,{force:true,showProgress:true})
},false);this.tabformatButton.addEventListener("click",function(f){if(b.midiPlayer.playing){b.midiPlayer.stopPlay}f.preventDefault();this.blur();SITE.properties.options.rowsNumbered=!SITE.properties.options.rowsNumbered;b.parserparams.ilheirasNumeradas=SITE.properties.options.rowsNumbered;b.fireChanged(0,{force:true,showProgress:true})},false);this.timerButton.addEventListener("click",function(f){f.preventDefault();this.blur();SITE.properties.studio.timerOn=!SITE.properties.studio.timerOn;b.setTimerIcon(0)},false);this.FClefButton.addEventListener("click",function(f){f.preventDefault();this.blur();SITE.properties.studio.bassOn=!SITE.properties.studio.bassOn;b.setBassIcon()},false);this.GClefButton.addEventListener("click",function(f){f.preventDefault();this.blur();SITE.properties.studio.trebleOn=!SITE.properties.studio.trebleOn;b.setTrebleIcon()},false);this.playButton.addEventListener("click",function(f){f.preventDefault();this.blur();window.setTimeout(function(){b.startPlay("normal")},0)},false);this.stopButton.addEventListener("click",function(f){f.preventDefault();this.blur();if(b.currentPlayTimeLabel){b.currentPlayTimeLabel.innerHTML="00:00"}b.studioStopPlay()},false);this.clearButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.renderedTune.printer.clearSelection();b.accordion.clearKeyboard(true);b.currentPlayTimeLabel.innerHTML="00:00";b.studioStopPlay()},false);this.stepButton.addEventListener("click",function(f){f.preventDefault();this.blur();b.startPlay("note")},false);this.stepMeasureButton.addEventListener("click",function(f){f.preventDefault();b.startPlay("measure")},false);this.repeatButton.addEventListener("click",function(f){f.preventDefault();this.blur();if(!b.midiPlayer.playing){b.startPlay("repeat",b.gotoMeasureButton.value,b.untilMeasureButton.value)}},false);this.slider=new DRAGGABLE.ui.Slider(this.tempoButton,{min:25,max:200,start:100,step:25,speed:100,color:"white",bgcolor:"red",size:{w:180,h:35,tw:60},callback:function(f){b.midiPlayer.setAndamento(f)}});this.gotoMeasureButton.addEventListener("keypress",function(f){if(f.keyCode===13){b.startPlay("goto",this.value,b.untilMeasureButton.value)}},false);this.gotoMeasureButton.addEventListener("focus",function(f){if(this.value===SITE.translator.getResource("gotoMeasure").val){this.value=""}},false);this.gotoMeasureButton.addEventListener("blur",function(f){if(this.value===""){this.value=SITE.translator.getResource("gotoMeasure").val}},false);this.untilMeasureButton.addEventListener("keypress",function(f){if(f.keyCode===13){b.startPlay("goto",b.gotoMeasureButton.value,this.value)}},false);this.untilMeasureButton.addEventListener("focus",function(f){if(this.value===SITE.translator.getResource("untilMeasure").val){this.value=""}},false);this.untilMeasureButton.addEventListener("blur",function(f){if(this.value===""){this.value=SITE.translator.getResource("untilMeasure").val}},false);this.playerCallBackOnScroll=function(f){b.setScrolling(f)};this.playerCallBackOnPlay=function(f){var g=f.getTime().cTime;if(b.gotoMeasureButton&&!parseInt(b.untilMeasureButton.value)){b.gotoMeasureButton.value=f.currentMeasure}if(b.currentPlayTimeLabel){b.currentPlayTimeLabel.innerHTML=g}b.midiPlayer.setPlayableClefs((SITE.properties.studio.trebleOn?"T":"")+(SITE.properties.studio.bassOn?"B":""))};this.playerCallBackOnEnd=function(f){var g=b.midiPlayer.getWarnings();b.playButton.title=SITE.translator.getResource("playBtn");b.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';b.renderedTune.printer.clearSelection();b.accordion.clearKeyboard(true)};this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);this.midiPlayer.defineCallbackOnPlay(this.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(this.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(this.playerCallBackOnScroll)};SITE.AppView.prototype.setup=function(b,a){this.accordion.loadById(a);this.renderedTune.abc=b.abc;this.renderedTune.text=b.text;this.renderedTune.title=b.title;this.changePlayMode(SITE.properties.studio.mode);this.setBassIcon();this.setTrebleIcon();this.setTimerIcon(0);this.setVisible(true);this.setKeyboardDetails();this.fireChanged(0,{force:true});this.studioCanvasDiv.scrollTop=0;this.Div.setTitle(b.title);this.Div.setSubTitle("- "+this.accordion.getTxtModel()+" "+this.accordion.getTxtTuning());this.keyboardWindow.setTitle(this.accordion.getTxtTuning()+" - "+this.accordion.getTxtNumButtons());this.showKeyboard(SITE.properties.studio.keyboard.visible);this.keyboardWindow.resize();this.Div.resize();this.resize();SITE.translator.translate(this.Div.topDiv)};SITE.AppView.prototype.resizeLeft=function(){var j=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var f=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var b=(f-2);var g=(j-4);var a=SITE.properties.studio.keyboard.visible?this.keyboardWindow.topDiv.clientWidth+1:0;this.keyboardWindow.topDiv.style.top=0;this.keyboardWindow.topDiv.style.left=0;this.keyboardWindow.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.top=0;this.Div.topDiv.style.left=a+"px";this.Div.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.width=Math.max(b-a,400)+"px";var b=0,i=0;var k=this.controlDiv.clientHeight;var d=this.Div.dataDiv.clientHeight;this.studioCanvasDiv.style.height=d-(b+i+k+6)+"px";this.media.posiciona();(this.ps)&&this.ps.update()};SITE.AppView.prototype.resizeRight=function(){var j=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var f=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var b=(f-2);var g=(j-4);var a=SITE.properties.studio.keyboard.visible?this.keyboardWindow.topDiv.clientWidth+1:0;this.keyboardWindow.topDiv.style.top=0;this.keyboardWindow.topDiv.style.left=(b-a+1)+"px";this.keyboardWindow.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.top=0;this.Div.topDiv.style.left=0;this.Div.topDiv.style.height=Math.max(g,200)+"px";this.Div.topDiv.style.width=Math.max(b-a,400)+"px";var b=0,i=0;var k=this.controlDiv.clientHeight;var d=this.Div.dataDiv.clientHeight;this.studioCanvasDiv.style.height=d-(b+i+k+6)+"px";this.media.posiciona();(this.ps)&&this.ps.update()};SITE.AppView.prototype.showKeyboard=function(a){SITE.properties.studio.keyboard.visible=(typeof a==="undefined"?!SITE.properties.studio.keyboard.visible:a);this.accordion.render_opts.show=SITE.properties.studio.keyboard.visible;if(SITE.properties.studio.keyboard.visible){this.keyboardWindow.setVisible(true);this.accordion.printKeyboard(this.keyboardWindow.dataDiv);this.showMapButton.innerHTML='<i class="ico-keyboard" ></i>'}else{this.accordion.render_opts.show=false;this.keyboardWindow.setVisible(false);this.showMapButton.innerHTML='<i class="ico-keyboard" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:4px; filter: grayscale(1);"></i>'
}};SITE.AppView.prototype.setKeyboardDetails=function(){this.keyboardWindow.imagem.innerHTML='<img src="'+this.app.accordion.loaded.image+'" title="'+this.app.accordion.getFullName()+" "+SITE.translator.getResource("keys")+'">';if(SITE.properties.options.keyboardRight){this.resize=this.resizeRight}else{this.resize=this.resizeLeft}if(SITE.properties.options.suppressTitles){this.keyboardWindow.imagem.style.display="inline";this.keyboardWindow.extras.style.display="inline"}else{this.keyboardWindow.imagem.style.display="none";this.keyboardWindow.extras.style.display="none"}this.Div.setMenuVisible(!SITE.properties.options.suppressTitles);this.keyboardWindow.setMenuVisible(!SITE.properties.options.suppressTitles);this.keyboardMirrorElements()};SITE.AppView.prototype.keyboardMirrorElements=function(a){if(this.keyboardWindow.extras){if(SITE.properties.studio.keyboard.mirror){this.keyboardWindow.extras.style.right="";this.keyboardWindow.extras.style.left="5px";this.keyboardWindow.imagem.style.right="";this.keyboardWindow.imagem.style.left="25px"}else{this.keyboardWindow.extras.style.right="5px";this.keyboardWindow.extras.style.left="";this.keyboardWindow.imagem.style.right="25px";this.keyboardWindow.imagem.style.left=""}}};SITE.AppView.prototype.keyboardCallback=function(a){switch(a){case"ROTATE":this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);SITE.properties.studio.keyboard.transpose=this.accordion.render_opts.transpose;SITE.properties.studio.keyboard.mirror=this.accordion.render_opts.mirror;this.keyboardMirrorElements();break;case"GLOBE":this.accordion.changeNotation();SITE.properties.studio.keyboard.label=this.accordion.render_opts.label;break;case"CLOSE":this.showKeyboard(false);this.resize();break}};SITE.AppView.prototype.appViewCallBack=function(a){switch(a){case"CLOSE":this.app.closeAppView();break}};SITE.AppView.prototype.studioStopPlay=function(a){this.midiPlayer.stopPlay()};SITE.AppView.prototype.setVisible=function(a){this.Div.parent.style.display=a?"block":"none"};SITE.AppView.prototype.setScrolling=function(c){if(!this.studioCanvasDiv||!c.currAbsElem||c.currAbsElem.staffGroup===this.lastStaffGroup){return}this.lastStaffGroup=c.currAbsElem.staffGroup;var e=c.printer.staffgroups[0].top;var b=this.studioCanvasDiv.clientHeight-e;var d=c.printer.staffgroups[c.currAbsElem.staffGroup].top-12;var a=d+c.printer.staffgroups[c.currAbsElem.staffGroup].height;if(a>b+this.ypos||this.ypos>d-e){this.ypos=d;this.studioCanvasDiv.scrollTop=this.ypos}};SITE.AppView.prototype.changePlayMode=function(a){SITE.properties.studio.mode=a?a:(SITE.properties.studio.mode==="normal"?"learning":"normal");this.midiPlayer.setAndamento(this.slider.getValue());if(SITE.properties.studio.mode==="normal"){$("#divDidacticPlayControls").hide();SITE.properties.studio.mode="normal";this.modeButton.innerHTML='<i class="ico-listening" ></i>';$("#divNormalPlayControls").fadeIn();$("#spanShowMedia").fadeIn()}else{$("#divNormalPlayControls").hide();SITE.properties.studio.mode="learning";this.modeButton.innerHTML='<i class="ico-learning" ></i>';$("#divDidacticPlayControls").fadeIn();$("#spanShowMedia").hide()}};SITE.AppView.prototype.startPlay=function(b,d,a){this.ypos=this.studioCanvasDiv.scrollTop;this.lastStaffGroup=-1;var c=this;if(this.midiPlayer.playing){if(b==="normal"){this.playButton.title=SITE.translator.getResource("playBtn");this.playButton.innerHTML='&#160;<i class="ico-play"></i>&#160;';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}}else{this.accordion.clearKeyboard();window.setTimeout(function(){c.StartPlayWithTimer(c.renderedTune.abc.midi,b,d,a,SITE.properties.studio.timerOn?10:0)},0)}};SITE.AppView.prototype.setBassIcon=function(){if(SITE.properties.studio.bassOn){this.FClefButton.innerHTML='<i class="ico-clef-bass" ></i>'}else{this.FClefButton.innerHTML='<i class="ico-clef-bass" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:3px; filter: grayscale(1);"></i>'}};SITE.AppView.prototype.setTrebleIcon=function(){if(SITE.properties.studio.trebleOn){this.GClefButton.innerHTML='<i class="ico-clef-treble" ></i>'}else{this.GClefButton.innerHTML='<i class="ico-clef-treble" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:3px; filter: grayscale(1);"></i>'}};SITE.AppView.prototype.setLyricsIcon=function(){if(SITE.properties.options.lyrics){this.lyricsButton.innerHTML='<i class="ico-letter-l" ></i>'}else{this.lyricsButton.innerHTML='<i class="ico-letter-l" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:4px; filter: grayscale(1);"></i>'}};SITE.AppView.prototype.setFingeringIcon=function(){if(SITE.properties.options.fingering){this.fingeringButton.innerHTML='<i class="ico-alien-fingering" ></i>'}else{this.fingeringButton.innerHTML='<i class="ico-alien-fingering" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:4px; filter: grayscale(1);"></i>'}};SITE.AppView.prototype.setTimerIcon=function(b){b=b||0;var a="00";if(SITE.properties.studio.timerOn){switch(b){case 0:a="00";break;case 1:a="05";break;case 2:a="15";break;case 3:a="20";break;case 6:a="30";break;case 9:a="45";break;default:a=""}if(a!==""){if(a!=="00"){MIDI.noteOn(0,90,100,0);MIDI.noteOff(0,90,b>3?0.1:0.05)}this.timerButton.innerHTML='<i class="ico-timer-'+a+'" ></i>'}}else{this.timerButton.innerHTML='<i class="ico-timer-00" style="opacity:0.5; filter: grayscale(1);"></i><i class="ico-forbidden" style="position:absolute;left:4px;top:6px; filter: grayscale(1);"></i>'}};SITE.AppView.prototype.StartPlayWithTimer=function(f,c,e,b,a){var d=this;if(c!=="note"&&SITE.properties.studio.timerOn&&a>0){d.setTimerIcon(a);a-=1;window.setTimeout(function(){d.StartPlayWithTimer(f,c,e,b,a)},1000/3)}else{d.setTimerIcon(0);if(c==="normal"){this.midiPlayer.setPlayableClefs("TB");if(this.midiPlayer.startPlay(this.renderedTune.abc.midi)){SITE.ga("event","play",{event_category:"Mapa",event_label:this.renderedTune.title});this.playButton.title=SITE.translator.getResource("pause");this.playButton.innerHTML='&#160;<i class="ico-pause"></i>&#160;'}}else{this.midiPlayer.setPlayableClefs((SITE.properties.studio.trebleOn?"T":"")+(SITE.properties.studio.bassOn?"B":""));SITE.ga("event","didactic-play",{event_category:"Mapa",event_label:this.renderedTune.title});this.midiPlayer.startDidacticPlay(this.renderedTune.abc.midi,c,e,b)}}};SITE.AppView.prototype.parseABC=function(c,d){var g=this.renderedTune.text;this.warnings=[];if(g===""){this.renderedTune.text=this.initialText=this.renderedTune.abc=undefined;return true}if(g===this.initialText&&!d){this.updateSelection();return false}if(typeof c!=="undefined"){if(this.transposer){this.transposer.reset(c)}else{this.transposer=new ABCXJS.parse.Transposer(c)}}if(!this.abcParser){this.abcParser=new ABCXJS.parse.Parse(this.transposer,this.accordion)
}try{this.abcParser.parse(g,this.parserparams);this.renderedTune.abc=this.abcParser.getTune();this.renderedTune.text=this.initialText=this.abcParser.getStrTune()}catch(f){waterbug.log("Could not parse ABC.");waterbug.show()}var b=this.abcParser.getWarnings()||[];for(var a=0;a<b.length;a++){this.warnings.push(b[a])}if(this.midiParser){this.midiParser.parse(this.renderedTune.abc,this.accordion.loadedKeyboard);this.midiPlayer.reset();this.midiPlayer.setAndamento(this.slider.getValue());var b=this.midiParser.getWarnings();for(var a=0;a<b.length;a++){this.warnings.push(b[a])}}return true};SITE.AppView.prototype.onChange=function(){this.studioCanvasDiv.scrollTop=this.lastYpos;this.resize()};SITE.AppView.prototype.fireChanged=function(b,a){if(this.changing){return}this.lastYpos=this.studioCanvasDiv.scrollTop||0;this.changing=true;var c=a||{};var d=c.force||false;var e=c.showProgress||false;if(this.parseABC(b,d)){this.modelChanged(e)}else{delete this.changing}};SITE.AppView.prototype.modelChanged=function(c){var b=this;if(c){var a=this.app.startLoader("ModelChanged");a.start(function(){b.onModelChanged(a)},"<br>&nbsp;&nbsp;&nbsp;Gerando partitura...<br><br>")}else{b.onModelChanged()}};SITE.AppView.prototype.onModelChanged=function(a){this.renderedTune.div.innerHTML="";this.renderedTune.div.style.display="none";if(this.renderedTune.abc===undefined){delete this.changing;return}this.renderedTune.div.style.display="";var b=new SVG.Printer(this.renderedTune.div);this.renderedTune.printer=new ABCXJS.write.Printer(b,this.printerparams,this.accordion.loadedKeyboard);this.renderedTune.printer.printTune(this.renderedTune.abc);this.renderedTune.printer.addSelectListener(this);this.updateSelection();if(this.onchangeCallback){this.onchangeCallback(this)}if(a){a.update(false,"<br>&nbsp;&nbsp;&nbsp;Gerando tablatura...<br><br>");a.stop()}this.media.show(this.renderedTune);delete this.changing};SITE.AppView.prototype.highlight=function(a){if(!this.midiPlayer.playing){if(SITE.properties.studio.keyboard.visible){this.accordion.clearKeyboard(true);this.midiParser.setSelection(a)}}};SITE.AppView.prototype.unhighlight=function(a){};SITE.AppView.prototype.updateSelection=function(b){var a=this;if(b){delete this.updating}else{if(this.updating){return}this.updating=true;setTimeout(a.updateSelection(true),300)}};SITE.AppView.prototype.printPreview=function(a,b,d){var c=this;c.dvPrintPane=document.getElementById("printPreviewDiv");c.divsToHide=b;c.savedDisplays={};b.forEach(function(f){var e=document.getElementById(f.substring(1));c.savedDisplays[f.substring(1)]=e.style.display;e.style.display="none"});SITE.ga("event","print",{event_category:"Mapa",event_label:this.renderedTune.title});this.changePageOrientation(d?"landscape":"portrait");c.dvPrintPane.innerHTML=a;c.dvPrintPane.style.display="block";setTimeout(function(){if(window.DiatonicApp){window.DiatonicApp.printPage(c.renderedTune.title)}else{window.print();c.endPreview()}})};SITE.AppView.prototype.endPreview=function(a,b,d){var c=this;c.dvPrintPane.style.display="none";c.divsToHide.forEach(function(f){var e=document.getElementById(f.substring(1));e.style.display=c.savedDisplays[f.substring(1)]})};SITE.AppView.prototype.changePageOrientation=function(a){var b=document.createElement("style");document.head.appendChild(b);b.innerHTML="@page {margin: 1cm; size: "+a+"}"};if(!window.SITE){window.SITE={}}SITE.App=function(d,a,c){document.body.style.overflow="hidden";var b=this;this.container=document.getElementById("appDiv");this.tab={title:"",text:"",ddmId:"menuSongs",type:"songs"};this.Back=this.Close;ABCXJS.write.color.useTransparency=SITE.properties.colors.useTransparency;ABCXJS.write.color.highLight=SITE.properties.colors.highLight;DIATONIC.map.color.fill=SITE.properties.colors.fill;DIATONIC.map.color.background=SITE.properties.colors.background;DIATONIC.map.color.close=SITE.properties.colors.close;DIATONIC.map.color.open=SITE.properties.colors.open;this.settingsMenu=document.getElementById(d.settingsMenu);this.accordion=new window.ABCXJS.tablature.Accordion(d.accordion_options,SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);this.accordionSelector=new ABCXJS.edit.AccordionSelector(d.mapMenuGaitasDiv,d.mapMenuGaitasDiv,{listener:b,method:"menuCallback",label:"Accordion"});this.tab.title=FILEMANAGER.loadLocal("property."+this.accordion.getId()+".songs.title")||this.accordion.loaded.getFirstSong();this.openBtn=document.getElementById(d.openBtn);this.openBtn.addEventListener("click",function(e){b.openAppView()},false);this.songSelector=document.getElementById(d.mapMenuSongsDiv);this.gaitaImagePlaceHolder=document.getElementById(d.accordionImagePlaceHolder);this.settingsMenu.addEventListener("click",function(e){e.preventDefault();this.blur();b.showSettings()},false);this.setPrivacyLang();this.defineInstrument(true);this.showAccordionName();this.showAccordionImage();this.accordionSelector.populate(false);this.songSelectorPopulate();SITE.translator.translate();this.setVisible(true);this.resize()};SITE.App.prototype.changeAccordion=function(a){this.accordion.loadById(a.accordionId);this.showAccordionName();this.showAccordionImage();this.accordionSelector.populate(false);this.songSelectorPopulate();this.resize();if(!this.accordion.loaded.localResource){FILEMANAGER.saveLocal("property.accordion",this.accordion.getId())}};SITE.App.prototype.resize=function(){return};SITE.App.prototype.songSelectorPopulate=function(){var e=false;var f=this.accordion.loaded.songs;var a=this.tab.ddmId;var g="songs";this.menuSongs=new DRAGGABLE.ui.DropdownMenu(this.songSelector,{listener:this,method:"showABC",translate:false,label:"Song"},[{title:"...",ddmId:this.tab.ddmId,itens:[]}]);for(var d=0;d<f.sortedIndex.length;d++){var h=f.sortedIndex[d];var b=h.replace(/\(.*\)/g,"").trim();var j=0;if(!f.details[h]||isNaN(parseInt(f.details[h].id))){waterbug.logError('Missing or incorrect ID (X:nnn) for "'+h+'"');waterbug.show()}else{j=f.details[h].id}if(f.details[h].hidden){continue}var c=this.menuSongs.addItemSubMenu(a,b+"|"+g+"#"+j);if(h===this.tab.title){e=true;this.menuSongs.setSubMenuTitle(this.tab.ddmId,b);this.menuSongs.selectItem(this.tab.ddmId,c);this.tab.text=this.accordion.loaded.getAbcText(this.tab.type,h)}}if(!e&&f.sortedIndex.length>0){var h=f.sortedIndex[0];this.tab.title=h;var b=h.replace(/\(.*\)/g,"").trim();this.menuSongs.setSubMenuTitle(this.tab.ddmId,b);this.menuSongs.selectItem(this.tab.ddmId,this.tab.type+"#"+f.details[h].id);this.tab.text=this.accordion.loaded.getAbcText(this.tab.type,h)}};SITE.App.prototype.showABC=function(e){var d,f,c=this;var b=e.split("#");if(e.indexOf("#")>=0&&parseInt(b[1])>0){d=b[0];f=this.accordion.loaded[d].ids[b[1]]}else{waterbug.logError("ABCX not found!");waterbug.show();return}if(this.tab.title!==f&&this.menuSongs.selectItem(this.tab.ddmId,e)){this.tab.title=f;this.tab.text=this.accordion.loaded.getAbcText(d,f);var g=f.replace(/\(.*\)/g,"").trim();this.menuSongs.setSubMenuTitle(this.tab.ddmId,(g.length>43?g.substr(0,40)+"...":g));
if(!this.accordion.loaded.localResource){FILEMANAGER.saveLocal("property."+this.accordion.getId()+"."+d+".title",f)}}else{console.log("Song title not found!")}};SITE.App.prototype.menuCallback=function(a){switch(a){case"GAITA_MINUANO_GC":case"CONCERTINA_PORTUGUESA":case"GAITA_HOHNER_CORONA_GCF":case"GAITA_HOHNER_CORONA_ADG":case"GAITA_HOHNER_CLUB_IIIM_BR":case"GAITA_MINUANO_BC_TRANSPORTADA":default:this.changeAccordion({accordionId:a})}};SITE.App.prototype.openAppView=function(c,d){var b=this;if(d){d.preventDefault();c.blur()}if(!this.appView){this.appView=new SITE.AppView(this,{studioDiv:"studioDiv",keyboardDiv:"keyboardDiv",studioControlDiv:"studioControlDiv",studioCanvasDiv:"studioCanvasDiv",generate_tablature:"accordion",backBtn:"backBtn",showMapBtn:"showMapBtn",printBtn:"printBtn",btShowMedia:"buttonShowMedia",accordion_options:{id:this.accordion.getId(),accordionMaps:DIATONIC.map.accordionMaps,translator:SITE.translator,render_keyboard_opts:{}},onchange:function(e){e.onChange()}},{modeBtn:"modeBtn",lyricsBtn:"lyricsBtn",fingeringBtn:"fingeringBtn",tabformatBtn:"tabformatBtn",timerBtn:"timerBtn",playBtn:"playBtn",stopBtn:"stopBtn",clearBtn:"clearBtn",gotoMeasureBtn:"gotoMeasureBtn",untilMeasureBtn:"untilMeasureBtn",stepBtn:"stepBtn",repeatBtn:"repeatBtn",stepMeasureBtn:"stepMeasureBtn",tempoSld:"tempoSld",GClefBtn:"GClefBtn",FClefBtn:"FClefBtn",currentPlayTimeLabel:"currentPlayTimeLabel"})}this.Back=this.closeAppView;if(b.tab.text){SITE.ga("event","view",{event_category:"Mapa",event_label:b.tab.title});console.log("view "+b.tab.title);var a=this.startLoader("openAppView");a.start(function(){b.appView.setup(b.tab,b.accordion.getId());a.stop()},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")}};SITE.App.prototype.setVisible=function(a){this.container.style.display=(a?"block":"none")};SITE.App.prototype.showAccordionImage=function(){this.gaitaImagePlaceHolder.innerHTML='<img src="'+this.accordion.loaded.image+'" alt="'+this.accordion.getFullName()+" "+SITE.translator.getResource("keys")+'" style="height:200px; width:200px;" />'};SITE.App.prototype.showAccordionName=function(){var a=this.accordion.getFullName()+' <span data-translate="keys">'+SITE.translator.getResource("keys")+"</span>";this.accordionSelector.menu.setSubMenuTitle(this.accordionSelector.ddmId,a)};SITE.App.prototype.startLoader=function(e,b,d,c){var a=new window.widgets.Loader({id:e,bars:0,radius:0,lineWidth:20,lineHeight:70,timeout:1,background:"rgba(0,0,0,0.5)",container:b?b:document.body,onstart:d,oncomplete:c});return a};SITE.App.prototype.defineInstrument=function(b){var c=this;c.instrument=SITE.properties.options.pianoSound?"acoustic_grand_piano":"accordion";var a=function(){var d=SITE.properties.options.pianoSound?0:21;MIDI.programChange(0,d);MIDI.programChange(1,d);MIDI.programChange(2,d);MIDI.programChange(3,d);MIDI.programChange(4,d);MIDI.programChange(5,d)};if(b){a();return}MIDI.widget=new sketch.ui.Timer({size:180,cor1:SITE.properties.colors.close,cor2:SITE.properties.colors.open});MIDI.widget.setFormat(SITE.translator.getResource("loading"));MIDI.loadPlugin({soundfontUrl:"./soundfont/",instruments:c.instrument,onprogress:function(g,d,e){var f=((d*100)+e)/(g);MIDI.widget.setValue(Math.round(f))},callback:function(){a()}})};SITE.App.prototype.showSettings=function(){var c=620;var b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var a=70;if(!this.settings){this.settings={};this.settings.popupWin=new DRAGGABLE.ui.Window(null,null,{title:"PreferencesTitle",translator:SITE.translator,statusbar:false,top:"40px",left:a+"px",height:"530px",width:c+"px",zIndex:50},{listener:this,method:"settingsCallback"});this.settings.popupWin.topDiv.style.zIndex=101;this.settings.popupWin.dataDiv.innerHTML='        <div class="menu-group">            <table>              <tr>                <th colspan="2"><span data-translate="PrefsIdiom" >'+SITE.translator.getResource("PrefsIdiom")+'</span></th>                <th><div id="settingsLanguageMenu" class="topMenu"></div></th>              </tr>              <tr style="display:none;">                <th colspan="2"><br><span data-translate="PrefsTabFormat" >'+SITE.translator.getResource("PrefsTabFormat")+'</span></th>                <th><br><div id="settingsTabMenu" class="topMenu"></div></th>              </tr>              <tr style="height:40px; display:none;">                <td> </td><td colspan="2"><div id="sldOnlyNumbers"></div>                <span data-translate="PrefsPropsOnlyNumbers" >'+SITE.translator.getResource("PrefsPropsOnlyNumbers")+'</span></a></td>              </tr>              <tr>                <th colspan="2"><br><span data-translate="PrefsColor" >'+SITE.translator.getResource("PrefsColor")+'</span></th><td></td>              </tr>              <tr>                <td style="width:15px;"></td><td data-translate="PrefsColorHighlight" >'+SITE.translator.getResource("PrefsColorHighlight")+'</td>                <td><input id="corRealce" type="text" readonly >&nbsp;<div id="sldTransparency"></div>                        <span data-translate="PrefsColorTransparency" >'+SITE.translator.getResource("PrefsColorTransparency")+'</span></td>              </tr>              <tr>                <td></td><td data-translate="PrefsColorClosingBellows" >'+SITE.translator.getResource("PrefsColorClosingBellows")+'</td>                <td><input readonly id="foleFechando" type="text" ></td>              </tr>              <tr>                <td></td><td data-translate="PrefsColorOpeningBellows" >'+SITE.translator.getResource("PrefsColorOpeningBellows")+'</td>                <td><input readonly id="foleAbrindo" type="text" ></td>              </tr>              <tr>                <th colspan="2"><br><span data-translate="PrefsProps" >'+SITE.translator.getResource("PrefsProps")+'</span></th><td></td>              </tr>              <tr style="height:40px;">                <td> </td><td colspan="2"><div id="sldPianoSound"></div>                <span data-translate="PrefsPropsCKPiano" >'+SITE.translator.getResource("PrefsPropsCKPiano")+'</span></a></td>              </tr>              <tr style="height:40px;">                <td> </td><td colspan="2"><div id="sldKeyboardRight"></div>                <span data-translate="PrefsPropsCKkeyboardAlignRight" >'+SITE.translator.getResource("PrefsPropsCKkeyboardAlignRight")+'</span></td>              </tr>              <tr style="height:40px;">                <td> </td><td colspan="2"><div id="sldSuppressTitles"></div>                <span data-translate="PrefsPropsChkSuppressTitles" >'+SITE.translator.getResource("PrefsPropsChkSuppressTitles")+'</span></td>              </tr>              <tr style="display:none;">                <td> </td><td colspan="2"><input id="chkWarnings" type="checkbox">&nbsp;                <span data-translate="PrefsPropsCKShowWarnings" >'+SITE.translator.getResource("PrefsPropsCKShowWarnings")+'</span></td>              </tr>              <tr style="display:none;">                <td> </td><td colspan="2"><input id="chkAutoRefresh" type="checkbox">&nbsp;                <span data-translate="PrefsPropsCKAutoRefresh" >'+SITE.translator.getResource("PrefsPropsCKAutoRefresh")+'</span></td>              </tr>              </table>        </div>        <div id="pg" class="pushbutton-group" style="right: 0; bottom: 0;" >            <div id="botao1"></div>\n            <div id="botao2"></div>\n            <div id="botao3"></div>\n        </div>';
this.settings.sldOnlyNumbers=new DRAGGABLE.ui.Slider(document.getElementById("sldOnlyNumbers"),{min:0,max:1,start:0,step:1,type:"bin",speed:100,color:"white",bgcolor:"red",size:{w:60,h:25,tw:40},callback:null});this.settings.sldTransparency=new DRAGGABLE.ui.Slider(document.getElementById("sldTransparency"),{min:0,max:1,start:0,step:1,type:"bin",speed:100,color:"white",bgcolor:"red",size:{w:60,h:25,tw:40},callback:null});this.settings.sldPianoSound=new DRAGGABLE.ui.Slider(document.getElementById("sldPianoSound"),{min:0,max:1,start:0,step:1,type:"bin",speed:100,color:"white",bgcolor:"red",size:{w:60,h:25,tw:40},callback:null});this.settings.sldKeyboardRight=new DRAGGABLE.ui.Slider(document.getElementById("sldKeyboardRight"),{min:0,max:1,start:0,step:1,type:"bin",speed:100,color:"white",bgcolor:"red",size:{w:60,h:25,tw:40},callback:null});this.settings.sldSuppressTitles=new DRAGGABLE.ui.Slider(document.getElementById("sldSuppressTitles"),{min:0,max:1,start:0,step:1,type:"bin",speed:100,color:"white",bgcolor:"red",size:{w:60,h:25,tw:40},callback:null});this.settings.popupWin.addPushButtons(["botao1|apply","botao2|reset|PrefsReset","botao3|cancel"]);this.settings.menu=new DRAGGABLE.ui.DropdownMenu("settingsLanguageMenu",{listener:this,method:"settingsCallback",translate:false},[{title:"Idioma",ddmId:"menuIdiomas",itens:[]}]);this.settings.tabMenu=new DRAGGABLE.ui.DropdownMenu("settingsTabMenu",{listener:this,method:"settingsCallback",translate:true},[{title:"...",ddmId:"menuFormato",itens:["&#160;Modelo Alemão|0TAB","&#160;Numérica 1 (se disponível)|1TAB","&#160;Numérica 2 (se disponível)|2TAB"]}]);this.settings.tabFormat=SITE.properties.options.tabFormat;this.settings.tabMenu.setSubMenuTitle("menuFormato",this.settings.tabMenu.selectItem("menuFormato",this.settings.tabFormat.toString()+"TAB"));this.picker=new DRAGGABLE.ui.ColorPicker(["corRealce","foleFechando","foleAbrindo"],{readonly:false,translator:SITE.translator});SITE.translator.menuPopulate(this.settings.menu,"menuIdiomas");this.settings.lang=SITE.properties.options.language;this.settings.corRealce=document.getElementById("corRealce");this.settings.closeColor=document.getElementById("foleFechando");this.settings.openColor=document.getElementById("foleAbrindo");this.settings.showWarnings=document.getElementById("chkWarnings");this.settings.autoRefresh=document.getElementById("chkAutoRefresh")}this.settings.originalOnlyNumber=SITE.properties.options.tabShowOnlyNumbers;this.settings.originalLang=SITE.properties.options.language;this.settings.originalPianoSound=SITE.properties.options.pianoSound;this.settings.corRealce.style.backgroundColor=this.settings.corRealce.value=SITE.properties.colors.highLight;this.settings.closeColor.style.backgroundColor=this.settings.closeColor.value=SITE.properties.colors.close;this.settings.openColor.style.backgroundColor=this.settings.openColor.value=SITE.properties.colors.open;this.settings.sldOnlyNumbers.setValue(SITE.properties.options.tabShowOnlyNumbers?"1":"0",false);this.settings.sldTransparency.setValue(SITE.properties.colors.useTransparency?"1":"0",false);this.settings.sldPianoSound.setValue(SITE.properties.options.pianoSound?"1":"0",false);this.settings.sldKeyboardRight.setValue(SITE.properties.options.keyboardRight?"1":"0",false);this.settings.sldSuppressTitles.setValue(SITE.properties.options.suppressTitles?"1":"0",false);this.settings.showWarnings.checked=SITE.properties.options.showWarnings;this.settings.autoRefresh.checked=SITE.properties.options.autoRefresh;this.settings.popupWin.setVisible(true)};SITE.App.prototype.settingsCallback=function(b,a){switch(b){case"0TAB":case"1TAB":case"2TAB":this.settings.tabFormat=b;this.settings.tabMenu.setSubMenuTitle("menuFormato",this.settings.tabMenu.selectItem("menuFormato",b));break;case"de_DE":case"en_US":case"es_ES":case"fr_FR":case"it_IT":case"pt_BR":this.settings.lang=b;this.settings.menu.setSubMenuTitle("menuIdiomas",this.settings.menu.selectItem("menuIdiomas",b));break;case"MOVE":break;case"CLOSE":case"CANCEL":this.picker.close();this.settings.popupWin.setVisible(false);break;case"APPLY":SITE.properties.colors.highLight=this.settings.corRealce.value;SITE.properties.colors.close=this.settings.closeColor.value;SITE.properties.colors.open=this.settings.openColor.value;SITE.properties.colors.useTransparency=this.settings.sldTransparency.getBoolValue();SITE.properties.options.keyboardRight=this.settings.sldKeyboardRight.getBoolValue();SITE.properties.options.suppressTitles=this.settings.sldSuppressTitles.getBoolValue();SITE.properties.options.tabShowOnlyNumbers=this.settings.sldOnlyNumbers.getBoolValue();SITE.properties.options.pianoSound=this.settings.sldPianoSound.getBoolValue();SITE.properties.options.language=this.settings.lang;SITE.properties.options.showWarnings=this.settings.showWarnings.checked;SITE.properties.options.autoRefresh=this.settings.autoRefresh.checked;this.picker.close();this.settings.popupWin.setVisible(false);this.applySettings();SITE.SaveProperties();break;case"RESET":this.alert=new DRAGGABLE.ui.Alert(this.settings.popupWin,b,"<br>"+SITE.translator.getResource("resetMsgTitle"),"<br>"+SITE.translator.getResource("resetMsgDescription"),{translator:SITE.translator});break;case"RESET-YES":this.alert.close();this.picker.close();this.settings.popupWin.setVisible(false);SITE.ResetProperties();SITE.ga("event","reset",{event_category:"Configuration",event_label:SITE.properties.version});this.applySettings();break;case"RESET-NO":case"RESET-CANCEL":this.alert.close();break}};SITE.App.prototype.applySettings=function(){if(parseInt(this.settings.tabFormat)!==SITE.properties.options.tabFormat||this.settings.originalOnlyNumber!==SITE.properties.options.tabShowOnlyNumbers){SITE.properties.options.tabFormat=parseInt(this.settings.tabFormat);this.accordion.setFormatoTab(SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers);if(this.appView){this.appView.accordion.setFormatoTab(SITE.properties.options.tabFormat,!SITE.properties.options.tabShowOnlyNumbers)}}if(this.settings.originalLang!==SITE.properties.options.language){SITE.ga("event","changeLang",{event_category:"Configuration",event_label:SITE.properties.options.language});SITE.translator.loadLanguage(this.settings.lang,function(){SITE.translator.translate()});this.setPrivacyLang()}if(this.settings.originalPianoSound!==SITE.properties.options.pianoSound){SITE.ga("event","changeInstrument",{event_category:"Configuration",event_label:SITE.properties.options.pianoSound?"piano":"accordion"});this.defineInstrument()}(this.appView)&&this.appView.setKeyboardDetails();this.resizeActiveWindow();ABCXJS.write.color.useTransparency=SITE.properties.colors.useTransparency;ABCXJS.write.color.highLight=SITE.properties.colors.highLight;DIATONIC.map.color.close=SITE.properties.colors.close;DIATONIC.map.color.open=SITE.properties.colors.open;this.accordion.loadedKeyboard.legenda.setOpen();this.accordion.loadedKeyboard.legenda.setClose()};SITE.App.prototype.resizeActiveWindow=function(){if(this.appView&&window.getComputedStyle(this.appView.Div.parent).display!=="none"){this.appView.resize()
}else{this.resize()}};SITE.App.prototype.silencia=function(a){if(this.appView&&window.getComputedStyle(this.appView.Div.parent).display!=="none"){if(this.appView.midiPlayer.playing){if(a){this.appView.midiPlayer.stopPlay()}else{this.appView.startPlay("normal")}}}};SITE.App.prototype.setFocus=function(){};SITE.App.prototype.showModal=function(h,g,d,c){var f=this;c=c||{};c.width=typeof c.width==="undefined"?"800":c.width;c.height=typeof c.height==="undefined"?undefined:c.height;c.print=typeof c.print==="undefined"?true:c.print;var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var b=e/2-c.width/2;if(!this.modalWindow){this.modalWindow=new DRAGGABLE.ui.Window(null,["print|printBtn"],{title:"",translator:SITE.translator,draggable:true,statusbar:false,top:"30px",height:"90%",left:"60px",width:"calc(92% - 60px)",zIndex:70},{listener:this,method:"modalCallback"});this.modalWindow.dataDiv.style.height="auto";this.modalWindow.dataDiv.innerHTML='<object id="myFrame" data="" type="text/html" ></object>              <div id="pg" class="pushbutton-group" style="right: 4px; bottom: 4px;" >                <div id="btClose"></div>\n             </div>';this.modalWindow.addPushButtons(["btClose|close"])}this.Back=this.modalClose;this.modalWindow.setTitle(h,SITE.translator);this.modalWindow.setSubTitle(g,SITE.translator);this.modalWindow.setButtonVisible("PRINT",c.print);this.iframe=document.getElementById("myFrame");this.modalWindow.topDiv.style.opacity="0";this.modalWindow.setVisible(true);this.modalWindow.dataDiv.height=(this.modalWindow.topDiv.clientHeight-25)+"px";this.iframe.style.width="100%";this.iframe.style.height=(this.modalWindow.topDiv.clientHeight-25)+"px";this.modalWindow.dataDiv.height=this.iframe.style.height;this.info;this.container;var a=this.startLoader("Modal");f.iframe.setAttribute("data",d);f.iframe.addEventListener("load",function(){f.container=this.contentDocument.getElementById("modalContainer");f.info=this.contentDocument.getElementById("siteVerI");$(f.iframe).ready(function(){if(f.info){f.info.innerHTML=SITE.siteVersion}if(f.container){f.container.style.top="0";f.container.style.height=(f.modalWindow.dataDiv.clientHeight-70)+"px";f.container.style.overflow="hidden";f.container.style.border="1px solid rgba(255, 153, 34, 0.2)";var j=new PerfectScrollbar(f.container,{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],wheelSpeed:1,wheelPropagation:false,suppressScrollX:false,minScrollbarLength:100,swipeEasing:true,scrollingThreshold:500});var l=f.container.getElementsByTagName("a");for(var k=0;k<l.length;k++){l[k].onclick=function(){return false}}}f.modalWindow.topDiv.style.opacity="1";a.stop()})},"<br/>&#160;&#160;&#160;"+SITE.translator.getResource("wait")+"<br/><br/>")};SITE.App.prototype.modalCallback=function(a){that=this;if(a==="CLOSE"){that.modalClose()}else{if(a==="PRINT"){}}};SITE.App.prototype.modalClose=function(){this.iframe.setAttribute("data","");this.modalWindow.setVisible(false);this.Back=this.Close};SITE.App.prototype.closeAppView=function(){this.appView.setVisible(false);this.appView.keyboardWindow.setVisible(false);this.appView.studioStopPlay();this.Back=this.Close;SITE.SaveProperties()};SITE.App.prototype.goBackOrClose=function(){return this.Back()};SITE.App.prototype.Close=function(){window.DiatonicApp&&window.DiatonicApp.closeApp()};SITE.App.prototype.setPrivacyLang=function(){var a=this;this.aPolicy=document.getElementById("aPolicy");this.aTerms=document.getElementById("aTerms");this.aVersion=document.getElementById("aVersion");this.aPolicy.addEventListener("click",function(b){b.preventDefault();this.blur();if(SITE.properties.options.language.toUpperCase().indexOf("PT")>=0){a.showModal("PrivacyTitle","","privacidade/politica.html",{width:"800",height:"500",print:false})}else{a.showModal("PrivacyTitle","","privacy/policy.html",{width:"800",height:"500",print:false})}},false);this.aTerms.addEventListener("click",function(b){b.preventDefault();this.blur();if(SITE.properties.options.language.toUpperCase().indexOf("PT")>=0){a.showModal("TermsTitle","","privacidade/termos.e.condicoes.html",{width:"800",height:"500",print:false})}else{a.showModal("TermsTitle","","privacy/terms.n.conditions.html",{width:"800",height:"500",print:false})}},false);this.aVersion.addEventListener("click",function(b){b.preventDefault();this.blur();if(SITE.properties.options.language.toUpperCase().indexOf("PT")>=0){a.showModal("AboutAppTitle","","privacidade/sobreApp.html",{width:"800",height:"500",print:false})}else{a.showModal("AboutAppTitle","","privacy/aboutApp.html",{width:"800",height:"500",print:false})}},false)};