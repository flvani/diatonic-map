if(!window.DR){window.DR={pt_BR:0,en_US:1,de_DE:2,es_ES:3,fr_FR:4,it_IT:5,ru_RU:6}}DR.initializeTranslator=function(a){DR.agents=[];DR.extras={};DR.resource={};var b=FILEMANAGER.loadLocal("property.language");DR.language=(b?parseInt(b):DR.pt_BR);DR.createResources(a);DR.createMenuOption("pt_BR","Português do Brasil");DR.loadLang(["languages/en_US.lang","languages/de_DE.lang"],DR.firstTranslation)};DR.firstTranslation=function(){if(DR.language!==DR.pt_BR&&DR.resource.DR_appName[DR.language]){DR.translate(DR.language)}};DR.translate=function(d){DR.language=d;FILEMANAGER.saveLocal("property.language",d);DR.showSelectedOption();for(var b=0;b<DR.agents.length;b++){var c=DR.agents[b];if(typeof(c)==="object"){c.translate()}else{var a=ABCXJS.parse.clone(DR.extras[c]);if(a){a.push(c)}else{a=[c]}a.forEach(function(f){var g=document.getElementById(f);if(g){var h;try{h=DR.resource[c][DR.language]}catch(i){h=DR.resource[c][0]}if(g.title){g.title=DR.resource[c][DR.language]}else{if(g.value){g.value=DR.resource[c][DR.language]}else{g.innerHTML=DR.resource[c][DR.language]}}}else{}})}}};DR.createMenuOption=function(c,b){var a=DR[c];DR.resource.DR_image[a]='<img src="img/'+c+'.png" width="32" height="32" alt="'+b+'" title="'+b+'" >';$("#opcoes_idioma").append('<li><a style="padding: 2px; width: 34px;" onclick="DR.translate(DR.'+c+');">'+DR.resource.DR_image[a]+"</a></li>")};DR.showSelectedOption=function(){document.getElementById("btn_idioma").innerHTML=DR.resource.DR_image[DR.language]};DR.getResource=function(a){try{return DR.resource[a][DR.language]?DR.resource[a][DR.language]:DR.resource[a][DR.pt_BR]}catch(b){console.log("getResource: resource '"+a+"' not found.")}};DR.createResources=function(a){DR.resource.DR_image=[];DR.resource.DR_title=[document.title];DR.resource.DR_description=[document.getElementById("DR_description").content];DR.resource.DR_push=["Fecha"];DR.resource.DR_pull=["Abre"];DR.resource.DR_pause=["Pausar"];DR.resource.DR_wait=["Aguarde..."];DR.resource.DR_debug=["Depurar"];DR.resource.DR_octave=["Oitava"];DR.resource.DR_goto=["Ir para..."];DR.resource.DR_until=["até..."];DR.resource.DR_err_saving=["Impossível salvar"];DR.resource.DR_keys=["botões"];DR.resource.DR_save_map=["Salvar mapa corrente"];DR.resource.DR_load_map=["Carregar mapa do disco local"];for(var b=0;b<a.length;b++){DR.createResource(a[b])}};DR.createResource=function(e){var a=e.match(/([0-9])*$/g);var b=e;a=a[0];if(a){b=e.replace(a,"")}var c=document.getElementById(e);if(c===null){console.log("createResource: resource '"+e+"' undefined!");return}if(typeof(e)==="string"){if(!DR.resource[b]){DR.addAgent(b);DR.resource[b]=[]}var d;if(c.title){d=[c.title]}else{if(c.value){d=[c.value]}else{d=[c.innerHTML]}}DR.resource[b][DR.pt_BR]=d;DR.addExtra(b,a,e)}};DR.forcedResource=function(b,c,a,d){if(!DR.resource[b]){DR.addAgent(b);DR.resource[b]=[]}DR.resource[b][DR.pt_BR]=c;DR.addExtra(b,a,d)};DR.addAgent=function(a){DR.agents.push(a)};DR.addExtra=function(b,a,c){if(a){if(!DR.extras[b]){DR.extras[b]=[]}DR.extras[b].push(c)}};DR.loadLang=function(c,a){var b=0;for(var d=0;d<c.length;d++){b++;FILEMANAGER.register("LANG");$.getJSON(c[d],{format:"json"}).done(function(f){FILEMANAGER.deregister("LANG",true);DR.createMenuOption(f.id,f.langName);for(var e in f.resources){var h=DR[f.id];var g=f.resources[e];if(!DR.resource[e]){DR.addAgent(e);DR.resource[e]=[]}DR.resource[e][h]=g}}).fail(function(g,h,e){FILEMANAGER.deregister("LANG",false);var f=h+", "+e;console.log("Language Load Failed:\nLoading: "+g.responseText.substr(1,40)+"...\nError:\n "+f)}).always(function(){b--;if(b===0&&a){a()}})}};if(!window.DRAGGABLE){window.DRAGGABLE={}}DRAGGABLE.Div=function(h,b,e,g,c,d){var a=this;this.translate=false;this.topDiv=document.getElementById(b);if(!this.topDiv){return}if(d&&DR){this.translate=function(){};DR.addAgent(this)}this.id=h;a.topDiv.style.position="fixed";if(this.topDiv.style.top===""){this.topDiv.style.top="100px"}if(this.topDiv.style.left===""){this.topDiv.style.left="100px"}this.marginTop=this.topDiv.offsetTop-parseInt(this.topDiv.style.top);this.marginLeft=this.topDiv.offsetLeft-parseInt(this.topDiv.style.left);var f=document.createElement("DIV");f.setAttribute("id","dMenu"+this.id);f.setAttribute("class","draggableMenu");f.setAttribute("draggable","false");f.innerHTML=this.addButtons(this.id,g,c)+this.addTitle(this.id,e);this.topDiv.appendChild(f);this.menuDiv=f;f=document.createElement("DIV");f.setAttribute("id","draggableData"+this.id);f.setAttribute("class","draggableData");this.topDiv.appendChild(f);this.dataDiv=f;this.titleSpan=document.getElementById("dSpanTitle"+this.id);this.moveButton=document.getElementById("dMenu"+this.id);this.closeButton=document.getElementById("dMINUSButton"+this.id);this.stopMouse=function(i){i.stopPropagation();i.preventDefault()};this.divMove=function(i){a.stopMouse(i);var j=((i.clientY-a.y)+parseInt(a.topDiv.style.top));a.topDiv.style.top=(j<43?43:j)+"px";a.topDiv.style.left=((i.clientX-a.x)+parseInt(a.topDiv.style.left))+"px";a.x=i.clientX;a.y=i.clientY};this.mouseUp=function(i){a.stopMouse(i);window.removeEventListener("mousemove",a.divMove,false);window.removeEventListener("mouseout",a.divMove,false);a.dataDiv.style.pointerEvents="auto";if(c){window[c]("MOVE")}};this.mouseDown=function(i){window.addEventListener("mouseup",a.mouseUp,false);a.stopMouse(i);a.dataDiv.style.pointerEvents="none";window.addEventListener("mousemove",a.divMove,false);window.addEventListener("mouseout",a.divMove,false);a.x=i.clientX;a.y=i.clientY};this.closeButton.addEventListener("mousedown",this.stopMouse,false);this.moveButton.addEventListener("mousedown",this.mouseDown,false);this.close=function(i){a.topDiv.style.display="none"};if(!c){this.closeButton.addEventListener("click",this.close,false)}};DRAGGABLE.Div.prototype.setTitle=function(a){this.titleSpan.innerHTML=a};DRAGGABLE.Div.prototype.addTitle=function(b,a){if(this.translate){DR.forcedResource("dSpanTranslatableTitle"+b,a)}return'<div class="dTitle"><span id="dSpanTranslatableTitle'+b+'" style="padding-left: 5px;">'+a+'</span><span id="dSpanTitle'+b+'" style="padding-left: 5px;"></span></div>'};DRAGGABLE.Div.prototype.addButtons=function(g,f,d){var c=["minus|Fechar"];var a="";var b=this;var e;if(f){c=c.concat(f)}c.forEach(function(h){h=h.split("|");h[1]=h.length>1?h[1]:"";if(b.translate){DR.forcedResource("d"+h[0].toUpperCase()+"ButtonA",h[1],g,"d"+h[0].toUpperCase()+"ButtonA"+g)}if(d){e=d+"('"+h[0].toUpperCase()+"');"}a+='<div id="d'+h[0].toUpperCase()+"Button"+g+'" class="dButton" draggable="false"><a href="#" id="d'+h[0].toUpperCase()+"ButtonA"+g+'" title="'+h[1]+'" onclick="'+e+'"><i class="icon-'+h[0].toLowerCase()+' icon-white"></i></a></div>'});return a};if(!window.SITE){window.SITE={}}SITE.Mapa=function(f,b,e){var d=this;this.ypos=0;this.currentTab="";this.currentABC=null;this.mediaWidth=300;this.mediaHeight=this.mediaWidth*0.55666667;this.studio=b.studio;this.renderedTune={text:undefined,abc:undefined,title:undefined,div:undefined,selector:undefined};
this.renderedChord={text:undefined,abc:undefined,title:undefined,div:undefined,selector:undefined};this.renderedPractice={text:undefined,abc:undefined,title:undefined,div:undefined,selector:undefined};this.renderedTune.div=document.getElementById(b.songDiv);this.renderedTune.parms=b.songSelectorParms;this.renderedTune.selector=document.getElementById(this.renderedTune.parms.div);this.renderedPractice.div=document.getElementById(b.practiceDiv);this.renderedPractice.parms=b.practiceSelectorParms;this.renderedPractice.selector=document.getElementById(this.renderedPractice.parms.div);this.renderedChord.div=document.getElementById(b.chordDiv);this.renderedChord.parms=b.chordSelectorParms;this.renderedChord.selector=document.getElementById(this.renderedChord.parms.div);this.playButton=document.getElementById(e.playBtn);this.stopButton=document.getElementById(e.stopBtn);this.currentPlayTimeLabel=document.getElementById(e.currentPlayTimeLabel);this.checkboxEspelho=document.getElementById(f.ckMirror);this.checkboxHorizontal=document.getElementById(f.ckHorizontal);this.checkboxPiano=document.getElementById(f.ckPiano);this.buttonChangeNotation=document.getElementById(f.btChangeNotation);this.checkboxAcordeon=document.getElementById(f.ckAccordion);this.tuneContainerDiv=document.getElementById(f.tuneContainerDiv);this.gaitaNamePlaceHolder=document.getElementById(f.accordionNamePlaceHolder);this.gaitaImagePlaceHolder=document.getElementById(f.accordionImagePlaceHolder);this.printButton=document.getElementById(f.printBtn);this.toolsButton=document.getElementById(f.toolsBtn);this.printButton.addEventListener("click",function(){if(d.currentABC.div.innerHTML&&d.studio){ga("send","event","Mapa","print",d.currentABC.title);d.studio.printPreview(d.currentABC.div.innerHTML,["#divTitulo","#mapContainerDiv"],d.currentABC.abc.formatting.landscape)}},false);this.toolsButton.addEventListener("click",function(){if(d.currentABC.div.innerHTML&&d.studio){ga("send","event","Mapa","tools",d.currentABC.title);d.showStudio()}},false);this.buttonChangeNotation.addEventListener("click",function(){d.accordion.changeNotation()},false);this.checkboxHorizontal.addEventListener("click",function(){d.accordion.layoutKeyboard({transpose:this.checked},d.keyboardDiv)},false);this.checkboxEspelho.addEventListener("click",function(){d.accordion.layoutKeyboard({mirror:this.checked},d.keyboardDiv)},false);this.playerCallBackOnScroll=function(g){d.setScrolling(g.currAbsElem.y,g.currChannel)};this.playerCallBackOnPlay=function(g){var h=g.getTime().cTime;if(d.gotoMeasureButton){d.gotoMeasureButton.value=g.currentMeasure}if(d.currentPlayTimeLabel){d.currentPlayTimeLabel.innerHTML=h}};this.playerCallBackOnEnd=function(h){var j=d.midiPlayer.getWarnings();d.playButton.title=DR.getResource("playBtn");d.playButton.innerHTML='&nbsp;<i class="icon-play"></i>&nbsp;';d.currentABC.abc.midi.printer.clearSelection();d.accordion.clearKeyboard(true);if(d.currentPlayTimeLabel){d.currentPlayTimeLabel.innerHTML="00:00.00"}if(j){var i=document.getElementById("warningsDiv");var g="";j.forEach(function(k){g+=k+"<br>"});i.style.color="blue";i.innerHTML="<hr>"+g+"<hr>"}};this.playButton.addEventListener("click",function(){d.startPlay("normal")},false);this.stopButton.addEventListener("click",function(){d.midiPlayer.stopPlay()},false);this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);this.midiPlayer.defineCallbackOnPlay(d.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(d.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(d.playerCallBackOnScroll);this.accordion=new window.ABCXJS.tablature.Accordion(f.accordion_options);this.keyboardDiv=f.keyboardDiv;this.loadAccordionList();this.showAccordionName();this.showAccordionImage();this.loadOriginalRepertoire();DR.addAgent(this);this.accordion.printKeyboard(this.keyboardDiv);var a=document.getElementById("mediaDiv");if(a){var c=FILEMANAGER.loadLocal("property.mediaDiv.settings");if(c){c=c.split("|");a.style.top=c[0];a.style.left=c[1]}}this.resize()};SITE.Mapa.prototype.setup=function(a){var b=this.accordion.loadById(a.accordionId);if(!b){console.log("Gaita não encontrada!");return}if(!b.localResource){FILEMANAGER.saveLocal("property.accordion",b.getId())}this.showAccordionName();this.showAccordionImage();this.midiPlayer.reset();this.loadOriginalRepertoire(a);this.accordion.printKeyboard(this.keyboardDiv);this.resize()};SITE.Mapa.prototype.resize=function(){var e=document.getElementById("div_principal");var f=document.getElementById("mapContainerDiv");var d=document.getElementById("tuneContainerDiv");d.style.height=(f.clientHeight-e.clientHeight-50)+"px";var c=window.innerWidth;if(c>1500){this.mediaWidth=500;this.mediaHeight=this.mediaWidth*0.55666667}var b=document.getElementById("mediaDiv");var a=parseInt(b.style.left.replace("px",""));if(a+this.mediaWidth>c){b.style.left=(c-(this.mediaWidth+50))+"px"}};SITE.Mapa.prototype.loadOriginalRepertoire=function(c){var b=this;var a=this.startLoader("LoadRepertoire");a.start(function(){b.loadOriginalRepertoire2(c,a)},"<br>&nbsp;&nbsp;&nbsp;"+DR.getResource("DR_wait")+"<br><br>")};SITE.Mapa.prototype.loadOriginalRepertoire2=function(b,a){b=b||{};this.renderedPractice.title=b.practiceTitle||FILEMANAGER.loadLocal("property."+this.getSelectedAccordion().getId()+".practice.title")||this.getSelectedAccordion().getFirstPractice();this.loadABCList("practice");this.renderTAB(this.currentTab==="tabPractices","practice");this.renderedChord.title=b.chordTitle||FILEMANAGER.loadLocal("property."+this.getSelectedAccordion().getId()+".chord.title")||this.getSelectedAccordion().getFirstChord();this.loadABCList("chord");this.renderTAB(this.currentTab==="tabChords","chord");this.renderedTune.title=b.songTitle||FILEMANAGER.loadLocal("property."+this.getSelectedAccordion().getId()+".song.title")||this.getSelectedAccordion().getFirstSong();this.loadABCList("song");this.renderTAB(this.currentTab==="tabTunes","song");a.stop()};SITE.Mapa.prototype.showStudio=function(){var b=this;var a=this.startLoader("Studio");a.start(function(){b.showStudio2(a)},"<br>&nbsp;&nbsp;&nbsp;"+DR.getResource("DR_wait")+"<br><br>")};SITE.Mapa.prototype.showStudio2=function(a){this.midiPlayer.stopPlay();$("#mapContainerDiv").hide();document.getElementById("divMenuAccordions").style.pointerEvents="none";document.getElementById("divMenuRepertoire").style.pointerEvents="none";document.getElementById("DR_accordions").style.color="gray";document.getElementById("DR_repertoire").style.color="gray";$("#studioDiv").show();this.studio.setup(this.currentABC,this.getSelectedAccordion().getId());this.setupProps();a.stop()};SITE.Mapa.prototype.setupProps=function(){var a=FILEMANAGER.loadLocal("property.studio.settings");if(a){a=a.split("|");this.studio.textVisible=(a[0]==="true");this.studio.editorVisible=(a[1]==="true");this.studio.mapVisible=(a[2]==="true");this.studio.editorWindow.topDiv.style.top=a[3];this.studio.editorWindow.topDiv.style.left=a[4];this.studio.keyboardWindow.topDiv.style.top=a[5];
this.studio.keyboardWindow.topDiv.style.left=a[6];this.studio.accordion.render_keyboard_opts.scale=parseFloat(a[7]);this.studio.accordion.render_keyboard_opts.mirror=(a[8]==="true");this.studio.accordion.render_keyboard_opts.transpose=(a[9]==="true");this.studio.accordion.render_keyboard_opts.label=(a[10]==="true");this.studio.textVisible=!this.studio.textVisible;this.studio.editorVisible=!this.studio.editorVisible;this.studio.mapVisible=!this.studio.mapVisible;this.studio.showABCXText();this.studio.showEditor();this.studio.showMap()}};SITE.Mapa.prototype.restoreStudio=function(){this.studio.textVisible=true;this.studio.editorVisible=false;this.studio.mapVisible=false;this.studio.editorWindow.topDiv.style.top="120px";this.studio.editorWindow.topDiv.style.left="40px";this.studio.keyboardWindow.topDiv.style.top="120px";this.studio.keyboardWindow.topDiv.style.left="900px";this.studio.accordion.render_keyboard_opts.scale=0.8;this.studio.accordion.render_keyboard_opts.mirror=false;this.studio.accordion.render_keyboard_opts.transpose=false;this.studio.accordion.render_keyboard_opts.label=false;FILEMANAGER.saveLocal("property.studio.settings",this.studio.textVisible+"|"+this.studio.editorVisible+"|"+this.studio.mapVisible+"|"+this.studio.editorWindow.topDiv.style.top+"|"+this.studio.editorWindow.topDiv.style.left+"|"+this.studio.keyboardWindow.topDiv.style.top+"|"+this.studio.keyboardWindow.topDiv.style.left+"|"+this.studio.accordion.render_keyboard_opts.scale+"|"+this.studio.accordion.render_keyboard_opts.mirror+"|"+this.studio.accordion.render_keyboard_opts.transpose+"|"+this.studio.accordion.render_keyboard_opts.label);this.setupProps()};SITE.Mapa.prototype.closeStudio=function(){var b=this;var a=this.startLoader("Studio");a.start(function(){b.closeStudio2(a)},"<br>&nbsp;&nbsp;&nbsp;"+DR.getResource("DR_wait")+"<br><br>")};SITE.Mapa.prototype.closeStudio2=function(a){this.studio.midiPlayer.stopPlay();FILEMANAGER.saveLocal("property.studio.settings",this.studio.textVisible+"|"+this.studio.editorVisible+"|"+this.studio.mapVisible+"|"+this.studio.editorWindow.topDiv.style.top+"|"+this.studio.editorWindow.topDiv.style.left+"|"+this.studio.keyboardWindow.topDiv.style.top+"|"+this.studio.keyboardWindow.topDiv.style.left+"|"+this.studio.accordion.render_keyboard_opts.scale+"|"+this.studio.accordion.render_keyboard_opts.mirror+"|"+this.studio.accordion.render_keyboard_opts.transpose+"|"+this.studio.accordion.render_keyboard_opts.label);$("#studioDiv").fadeOut();document.getElementById("divMenuAccordions").style.pointerEvents="auto";document.getElementById("divMenuRepertoire").style.pointerEvents="auto";document.getElementById("DR_accordions").style.color="inherit";document.getElementById("DR_repertoire").style.color="inherit";$("#mapContainerDiv").fadeIn();this.printTab();a.stop()};SITE.Mapa.prototype.startPlay=function(a,b){if(this.midiPlayer.playing){this.ypos=1000;if(a==="normal"){this.playButton.title=DR.getResource("playBtn");this.playButton.innerHTML='&nbsp;<i class="icon-play"></i>&nbsp;';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}}else{this.accordion.clearKeyboard();if(a==="normal"){if(this.midiPlayer.startPlay(this.currentABC.abc.midi)){ga("send","event","Mapa","play",this.currentABC.title);this.playButton.title=DR.getResource("DR_pause");this.playButton.innerHTML='&nbsp;<i class="icon-pause"></i>&nbsp;';this.ypos=1000}}else{if(this.midiPlayer.startDidacticPlay(this.currentABC.abc.midi,a,b)){ga("send","event","Mapa","didactic-play",this.currentABC.title);this.ypos=1000}}}};SITE.Mapa.prototype.setScrolling=function(b,a){if(!this.tuneContainerDiv||a>0){return}if(b!==this.ypos){this.ypos=b;this.tuneContainerDiv.scrollTop=this.ypos-40}};SITE.Mapa.prototype.rotateKeyboard=function(){this.accordion.rotateKeyboard()};SITE.Mapa.prototype.scaleKeyboard=function(){this.accordion.scaleKeyboard()};SITE.Mapa.prototype.loadAccordionList=function(){var a=this.accordion.accordions;var b=[];for(var d=0;d<a.length;d++){b.push([parseInt(a[d].menuOrder),a[d].getFullName(),a[d].getId()])}b.sort(function(e,c){return c-e});$("#opcoes_gaita").empty();for(var d=0;d<b.length;d++){$("#opcoes_gaita").append('<li><a href="#" id="pop_gaita_'+d+'" onclick="setupGaita(\''+b[d][2]+"')\">"+b[d][1]+" "+DR.getResource("DR_keys")+"</a></li>")}$("#opcoes_gaita").append('<hr style="height: 3px; margin: 5px;">').append('<li><a id="extra1" href="#" onclick="saveMap();">'+DR.getResource("DR_save_map")+"</a></li>").append('<li><a id="extra2" href="#" onclick="document.getElementById(\'fileLoadMap\').click();">'+DR.getResource("DR_load_map")+"</a></li>")};SITE.Mapa.prototype.salvaRepertorio=function(){if(FILEMANAGER.requiredFeaturesAvailable()){var a=this.getSelectedAccordion();var b=a.id+".abcx";var c="";for(var d in a.songs.items){c+=a.songs.items[d]+"\n\n"}FILEMANAGER.download(b,c)}else{alert(DR.getResource("DR_err_saving"))}};SITE.Mapa.prototype.save=function(){var a=this.getSelectedAccordion();var b='{\n   "id":'+JSON.stringify(a.id)+'\n  ,"menuOrder":'+JSON.stringify(a.menuOrder+100)+'\n  ,"model":'+JSON.stringify(a.model)+'\n  ,"tuning":'+JSON.stringify(a.tuning)+'\n  ,"buttons":'+JSON.stringify(a.buttons)+'\n  ,"pedal":'+JSON.stringify(a.keyboard.pedalInfo)+'\n  ,"keyboard":\n  {\n     "layout":'+JSON.stringify(a.keyboard.layout)+'\n     ,"keys":\n     {\n        "close":'+JSON.stringify(a.keyboard.keys.close)+'\n       ,"open":'+JSON.stringify(a.keyboard.keys.open)+'\n     }\n     ,"basses":\n     {\n        "close":'+JSON.stringify(a.keyboard.basses.close)+'\n       ,"open":'+JSON.stringify(a.keyboard.basses.open)+"\n     }\n  }\n}\n";FILEMANAGER.download(a.getName()+".accordion",b)};SITE.Mapa.prototype.load=function(b){var d,c,j;var g="",h="",k="";for(var i=0;i<b.length;i++){if(b[i].type==="image"){j=b[i].content}else{switch(b[i].extension.toLowerCase()){case"accordion":c=JSON.parse(b[i].content);break;case"tunes":g=b[i].content;break;case"chords":h=b[i].content;break;case"practices":k=b[i].content;break}}}c.image=j||"img/accordion.default.gif";if(!this.accordionExists(c.id)){d=new DIATONIC.map.AccordionMap(c,true);DIATONIC.map.accordionMaps.push(d);this.loadAccordionList()}if(!this.accordionIsCurrent(c.id)){this.setup({accordionId:c.id})}var e=this.getSelectedAccordion();if(g){var a=new ABCXJS.TuneBook(g);for(var l=0;l<a.tunes.length;l++){e.songs.items[a.tunes[l].title]=a.tunes[l].abc;e.songs.sortedIndex.push(a.tunes[l].title)}e.songs.sortedIndex.sort();this.renderedTune.title=e.getFirstSong();this.loadABCList("song");this.renderTAB(this.currentTab==="tabTunes","song")}if(h){var a=new ABCXJS.TuneBook(h);for(var l=0;l<a.tunes.length;l++){e.chords.items[a.tunes[l].title]=a.tunes[l].abc;e.chords.sortedIndex.push(a.tunes[l].title)}e.chords.sortedIndex.sort();this.renderedChord.title=e.getFirstChord();this.loadABCList("chord");this.renderTAB(this.currentTab==="tabChords","chord")}if(k){var a=new ABCXJS.TuneBook(k);for(var l=0;l<a.tunes.length;l++){e.practices.items[a.tunes[l].title]=a.tunes[l].abc;
e.practices.sortedIndex.push(a.tunes[l].title)}e.practices.sortedIndex.sort();this.renderedPractice.title=e.getFirstPractice();this.loadABCList("practice");this.renderTAB(this.currentTab==="tabPractices","practice")}};SITE.Mapa.prototype.carregaRepertorio=function(c,f){var e=this;var a=e.getSelectedAccordion();if(c){if(a.localResource){console.log("Can't reload repertoire for local accordion!");return}a.songs=a.loadABCX(a.songPathList,function(){e.renderedTune.title=a.getFirstSong();e.loadABCList("song");e.renderTAB(e.currentTab==="tabTunes","song")})}else{a.songs={items:{},sortedIndex:[]};for(var d=0;d<f.length;d++){var g=new ABCXJS.TuneBook(f[d].content);for(var b=0;b<g.tunes.length;b++){a.songs.items[g.tunes[b].title]=g.tunes[b].abc;a.songs.sortedIndex.push(g.tunes[b].title)}}a.songs.sortedIndex.sort();e.renderedTune.title=a.getFirstSong();e.loadABCList("song");e.renderTAB(this.currentTab==="tabTunes","song")}};SITE.Mapa.prototype.showAccordionImage=function(){this.gaitaImagePlaceHolder.innerHTML='<img src="'+this.getSelectedAccordion().getPathToImage()+'" alt="'+this.getSelectedAccordion().getFullName()+" "+DR.getResource("DR_keys")+'" style="height:200px; width:200px;" />'};SITE.Mapa.prototype.showAccordionName=function(){this.gaitaNamePlaceHolder.innerHTML=this.getSelectedAccordion().getFullName()+" "+DR.getResource("DR_keys")};SITE.Mapa.prototype.defineActiveTab=function(a){this.currentTab=a;this.midiPlayer.reset();if(this.currentABC){this.currentABC.selector.style.display="none"}switch(this.currentTab){case"tabTunes":this.currentABC=this.renderedTune;break;case"tabChords":this.currentABC=this.renderedChord;break;case"tabPractices":this.currentABC=this.renderedPractice;break}this.currentABC.selector.style.display="inline";if(this.currentABC.abc){this.showMedia(this.currentABC.abc.metaText.url)}else{this.showMedia()}};SITE.Mapa.prototype.printTab=function(){var a=this.getSelectedAccordion();this.accordion.printKeyboard(this.keyboardDiv);var b=this.studio.editArea.getString();if(b===this.currentABC.text){return}this.currentABC.text=b;switch(this.currentTab){case"tabTunes":a.setSong(this.currentABC.title,this.currentABC.text);this.renderTAB(true,"song");break;case"tabChords":a.setChord(this.currentABC.title,this.currentABC.text);this.renderTAB(true,"chord");break;case"tabPractices":a.setPractice(this.currentABC.title,this.currentABC.text);this.renderTAB(true,"practice");break}};SITE.Mapa.prototype.accordionExists=function(a){return this.accordion.accordionExists(a)};SITE.Mapa.prototype.accordionIsCurrent=function(a){return this.accordion.accordionIsCurrent(a)};SITE.Mapa.prototype.getSelectedAccordion=function(){return this.accordion.accordions[this.accordion.selected]};SITE.Mapa.prototype.showABC=function(d,c){var b=this;var a=this.startLoader("TABLoader"+d);a.start(function(){b.showABC2(d,c,a)},"<br>&nbsp;&nbsp;&nbsp;"+DR.getResource("DR_wait")+"<br><br>")};SITE.Mapa.prototype.showABC2=function(d,b,a){var c;switch(d){case"song":c=this.renderedTune;c.title=this.getSelectedAccordion().songs.sortedIndex[b];break;case"practice":c=this.renderedPractice;c.title=this.getSelectedAccordion().practices.sortedIndex[b];break;case"chord":c=this.renderedChord;c.title=this.getSelectedAccordion().chords.sortedIndex[b];break}FILEMANAGER.saveLocal("property."+this.getSelectedAccordion().getId()+"."+d+".title",c.title);document.getElementById(c.parms.span).innerHTML=(c.title.length>43?c.title.substr(0,40)+"...":c.title);this.renderTAB(true,d);this.tuneContainerDiv.scrollTop=0;a.stop()};SITE.Mapa.prototype.loadABCList=function(d){var c;var a;switch(d){case"song":c=this.renderedTune;a=this.getSelectedAccordion().songs.sortedIndex;break;case"practice":c=this.renderedPractice;a=this.getSelectedAccordion().practices.sortedIndex;break;case"chord":c=this.renderedChord;a=this.getSelectedAccordion().chords.sortedIndex;break}c.abc=c.text=undefined;c.div.innerHTML="";$("#"+c.parms.ul).empty();$("#"+c.parms.span).empty();for(var b=0;b<a.length;b++){var e=a[b];if(e===c.title){document.getElementById(c.parms.span).innerHTML=(e.length>43?e.substr(0,40)+"...":e)}$("#"+c.parms.ul).append('<li ><a href="#" id="'+d+b+'" onclick="showABC(\''+d+"','"+b+"')\">"+(e.length>43?e.substr(0,40)+"...":e)+"</a></li>")}};SITE.Mapa.prototype.renderTAB=function(d,b,f){var a;switch(b){case"song":a=this.renderedTune;a.text=this.getSelectedAccordion().getSong(a.title);break;case"practice":a=this.renderedPractice;a.text=this.getSelectedAccordion().getPractice(a.title);break;case"chord":a=this.renderedChord;a.text=this.getSelectedAccordion().getChord(a.title);break}if(a.title===""||a.text===undefined){a.text=undefined;a.title==="";this.showMedia();return}this.parseABC(a);a.div.innerHTML="";var e=Raphael(a.div,700,200);var c=new ABCXJS.write.Printer(e,f);$("#"+a.div.id).fadeIn();c.printABC(a.abc);$("#"+a.div.id).hide();if(d){$("#"+a.div.id).fadeIn();this.showMedia(a.abc.metaText.url)}};SITE.Mapa.prototype.mediaCallback=function(b){switch(b){case"MOVE":var a=document.getElementById("mediaDiv");FILEMANAGER.saveLocal("property.mediaDiv.settings",a.style.top+"|"+a.style.left);break;case"MINUS":this.showMedia();break}return false};SITE.Mapa.prototype.showMedia=function(b){if(b){var a='<iframe width="'+this.mediaWidth+'" height="'+this.mediaHeight+'" src="'+b+'?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>';$("#mediaDiv").find("[id^='draggableData']").html(a);$("#mediaDiv").fadeIn("slow")}else{$("#mediaDiv").fadeOut("slow");$("#mediaDiv").find("[id^='draggableData']").html("")}};SITE.Mapa.prototype.startLoader=function(d,c,b){var a=new window.widgets.Loader({id:d,bars:0,radius:0,lineWidth:20,lineHeight:70,timeout:1,background:"rgba(0,0,0,0.5)",container:document.body,oncomplete:b,onstart:c});return a};SITE.Mapa.prototype.parseABC=function(b){var a=null;var c=new ABCXJS.parse.Parse(a,this.accordion);c.parse(b.text,this.parserparams);b.abc=c.getTune();if(this.midiParser){this.midiParser.parse(b.abc,this.accordion.getKeyboard())}};SITE.Mapa.prototype.translate=function(){this.getSelectedAccordion().keyboard.legenda.setTextOpen(DR.getResource("DR_pull"));this.getSelectedAccordion().keyboard.legenda.setTextClose(DR.getResource("DR_push"));this.showAccordionName();document.title=DR.getResource("DR_title");document.getElementById("DR_description").setAttribute("content",DR.getResource("DR_description"));document.getElementById("toolsBtn").innerHTML='<i class="icon-wrench"></i>&nbsp;'+DR.getResource("toolsBtn");document.getElementById("printBtn2").innerHTML='<i class="icon-print"></i>&nbsp;'+DR.getResource("printBtn");document.getElementById("pdfBtn").innerHTML='<i class="icon-print"></i>&nbsp;'+DR.getResource("pdfBtn");document.getElementById("DR_message").alt=DR.getResource("DR_message");document.getElementById("octaveUpBtn").title=DR.getResource("DR_octave");document.getElementById("octaveUpBtn").innerHTML='<i class="icon-arrow-up"></i>&nbsp;'+DR.getResource("DR_octave");document.getElementById("octaveDwBtn").title=DR.getResource("DR_octave");
document.getElementById("octaveDwBtn").innerHTML='<i class="icon-arrow-down"></i>&nbsp;'+DR.getResource("DR_octave");document.getElementById("printBtn").innerHTML='<i class="icon-print"></i>&nbsp;'+DR.getResource("printBtn");document.getElementById("saveBtn").innerHTML='<i class="icon-download-alt"></i>&nbsp;'+DR.getResource("saveBtn");document.getElementById("forceRefresh").innerHTML=DR.getResource("forceRefresh");document.getElementById("forceRefresh2").innerHTML=DR.getResource("forceRefresh");document.getElementById("gotoMeasureBtn").value=DR.getResource("DR_goto");document.getElementById("untilMeasureBtn").value=DR.getResource("DR_until");this.loadAccordionList()};if(!window.SITE){window.SITE={}}SITE.EditArea=function(a){this.textarea=document.getElementById(a);this.initialText=this.textarea.value;this.isDragging=false};SITE.EditArea.prototype.addSelectionListener=function(a){this.textarea.onmousemove=function(b){if(this.isDragging){a.updateSelection()}}};SITE.EditArea.prototype.addChangeListener=function(a){this.textarea.onkeyup=function(){if(a.forceRefreshCheckbox&&a.forceRefreshCheckbox.checked){a.fireChanged()}else{a.updateSelection()}};this.textarea.onmousedown=function(){this.isDragging=true;a.updateSelection()};this.textarea.onmouseup=function(){this.isDragging=false;if(a.forceRefreshCheckbox&&a.forceRefreshCheckbox.checked){a.fireChanged()}else{a.updateSelection()}};this.textarea.onchange=function(){if(a.forceRefreshCheckbox&&a.forceRefreshCheckbox.checked){a.fireChanged()}else{a.updateSelection()}}};SITE.EditArea.prototype.setSelection=function(b,a){this.textarea.setSelectionRange(b,a);this.textarea.focus()};SITE.EditArea.prototype.getString=function(){return this.textarea.value};SITE.EditArea.prototype.setString=function(a){this.initialText=a;this.textarea.value=a;this.textarea.selectionStart=0;this.textarea.selectionEnd=0};SITE.EditArea.prototype.getElem=function(){return this.textarea};SITE.KeySelector=function(a){this.selector=document.getElementById(a);this.cromaticLength=12;if(this.selector){this.populate(0)}};SITE.KeySelector.prototype.populate=function(c){while(this.selector.options.length>0){this.selector.remove(0)}for(var b=this.cromaticLength+c;b>=-this.cromaticLength+2+c;b--){var a=document.createElement("option");if(b-1>c){a.innerHTML=ABCXJS.parse.number2keysharp[(b+this.cromaticLength-1)%this.cromaticLength]}else{a.innerHTML=ABCXJS.parse.number2keyflat[(b+this.cromaticLength-1)%this.cromaticLength]}a.value=(b+this.cromaticLength-1);this.selector.appendChild(a)}this.oldValue=c+this.cromaticLength;this.selector.value=c+this.cromaticLength};SITE.KeySelector.prototype.set=function(a){this.populate(a)};SITE.KeySelector.prototype.addChangeListener=function(a){this.selector.onchange=function(){a.editorChanged(this.value-a.keySelector.oldValue,"force")}};SITE.Estudio=function(d,c,b){this.ypos=0;this.lastYpos=0;var a=this;this.oldAbcText=null;this.warnings=[];this.currentMode="normal";this.editorVisible=false;this.mapVisible=false;this.textVisible=true;this.editorWindow=c.editorWindow;this.keyboardWindow=c.keyboardWindow;this.playTreble=true;this.playBass=true;this.clefsToPlay=(this.playTreble?"T":"")+(this.playBass?"B":"");this.setupEditor();this.renderedTune={text:undefined,abc:undefined,title:undefined,div:undefined,selector:undefined};if(typeof c.textArea==="string"){this.editArea=new SITE.EditArea(c.textArea)}else{this.editArea=c.textArea}this.editArea.addSelectionListener(this);this.editArea.addChangeListener(this);if(c.generate_tablature){if(c.generate_tablature==="accordion"){this.accordion=new ABCXJS.tablature.Accordion(c.accordion_options);if(c.accordionNameSpan){this.accordionNameSpan=document.getElementById(c.accordionNameSpan);this.accordionNameSpan.innerHTML=this.accordion.getFullName()}}else{throw new Error("Tablatura para "+c.generate_tablature+" não suportada!")}}if(c.canvas_id){this.renderedTune.div=document.getElementById(c.canvas_id)}else{if(c.paper_id){this.renderedTune.div=document.getElementById(c.paper_id)}else{this.renderedTune.div=document.createElement("DIV");this.editArea.getElem().parentNode.insertBefore(this.renderedTune.div,this.editArea.getElem())}}if(c.generate_warnings){if(c.warnings_id){this.warningsdiv=document.getElementById(c.warnings_id)}else{this.warningsdiv=this.renderedTune.div}}if(c.onchange){this.onchangeCallback=c.onchange}this.saveButton=document.getElementById(d.saveBtn);this.forceRefreshButton=document.getElementById(d.forceRefresh);this.forceRefreshCheckbox=document.getElementById(d.forceRefreshCheckbox);this.printButton=document.getElementById(d.printBtn);this.showMapButton=document.getElementById(d.showMapBtn);this.showEditorButton=document.getElementById(d.showEditorBtn);this.showTextButton=document.getElementById(d.showTextBtn);this.modeButton=document.getElementById(b.modeBtn);this.FClefButton=document.getElementById(b.FClefBtn);this.GClefButton=document.getElementById(b.GClefBtn);this.playButton=document.getElementById(b.playBtn);this.stopButton=document.getElementById(b.stopBtn);this.gotoMeasureButton=document.getElementById(b.gotoMeasureBtn);this.untilMeasureButton=document.getElementById(b.untilMeasureBtn);this.currentPlayTimeLabel=document.getElementById(b.currentPlayTimeLabel);this.stepButton=document.getElementById(b.stepBtn);this.stepMeasureButton=document.getElementById(b.stepMeasureBtn);this.repeatButton=document.getElementById(b.repeatBtn);this.clearButton=document.getElementById(b.clearBtn);this.tempoButton=document.getElementById(b.tempoBtn);this.forceRefreshButton.addEventListener("click",function(){a.fireChanged(0,"force")},false);this.saveButton.addEventListener("click",function(){a.salvaMusica()},false);this.showMapButton.addEventListener("click",function(){a.showMap()},false);this.showTextButton.addEventListener("click",function(){a.showABCXText()},false);if(!isChrome){this.showEditorButton.style.pointerEvents="none";this.showEditorButton.style.color="gray"}else{this.showEditorButton.addEventListener("click",function(){a.showEditor()},false)}this.printButton.addEventListener("click",function(){ga("send","event","Estúdio","print",a.renderedTune.title);a.printPreview(a.renderedTune.div.innerHTML,["#divTitulo","#studioDiv"],a.renderedTune.abc.formatting.landscape);return},false);this.modeButton.addEventListener("click",function(){a.changePlayMode()},false);this.FClefButton.addEventListener("click",function(){if(a.playBass){this.innerHTML='<img src="img/clave.fa.off.png" alt="" width="20" height="20">'}else{this.innerHTML='<img src="img/clave.fa.on.png" alt="" width="20" height="20">'}a.playBass=!a.playBass;a.clefsToPlay=(a.playTreble?"T":"")+(a.playBass?"B":"")},false);this.GClefButton.addEventListener("click",function(){if(a.playTreble){this.innerHTML='<img src="img/clave.sol.off.png" alt="" width="20" height="20">'}else{this.innerHTML='<img src="img/clave.sol.on.png" alt="" width="20" height="20">'}a.playTreble=!a.playTreble;a.clefsToPlay=(a.playTreble?"T":"")+(a.playBass?"B":"")},false);
this.playButton.addEventListener("click",function(){a.startPlay("normal")},false);this.stopButton.addEventListener("click",function(){a.midiPlayer.stopPlay()},false);this.clearButton.addEventListener("click",function(){a.renderedTune.printer.clearSelection();a.accordion.clearKeyboard(true);a.ypos=1000;a.currentPlayTimeLabel.innerHTML="00:00.00";a.midiPlayer.stopPlay()},false);this.stepButton.addEventListener("click",function(){a.startPlay("note")},false);this.stepMeasureButton.addEventListener("click",function(){a.startPlay("measure")},false);this.repeatButton.addEventListener("click",function(){a.startPlay("repeat",a.gotoMeasureButton.value,a.untilMeasureButton.value)},false);this.tempoButton.addEventListener("click",function(){var e=a.midiPlayer.adjustAndamento();switch(e){case 1:a.tempoButton.innerHTML="<b>&nbsp;1&nbsp;<b>";break;case 1/2:a.tempoButton.innerHTML="<b>&nbsp;&#189;&nbsp;<b>";break;case 1/4:a.tempoButton.innerHTML="<b>&nbsp;&#188;&nbsp;<b>";break}},false);this.gotoMeasureButton.addEventListener("keypress",function(f){if(f.keyCode===13){a.startPlay("goto",this.value,a.untilMeasureButton.value)}},false);this.gotoMeasureButton.addEventListener("focus",function(){if(this.value===DR.getResource("DR_goto")){this.value=""}},false);this.gotoMeasureButton.addEventListener("blur",function(){if(this.value===""){this.value=DR.getResource("DR_goto")}},false);this.untilMeasureButton.addEventListener("keypress",function(f){if(f.keyCode===13){a.startPlay("goto",a.gotoMeasureButton.value,this.value)}},false);this.untilMeasureButton.addEventListener("focus",function(){if(this.value===DR.getResource("DR_until")){this.value=""}},false);this.untilMeasureButton.addEventListener("blur",function(){if(this.value===""){this.value=DR.getResource("DR_until")}},false);if(c.generate_midi){this.playerCallBackOnScroll=function(e){a.setScrolling(e.currAbsElem.y,e.currChannel)};this.playerCallBackOnPlay=function(e){var f=e.getTime().cTime;if(a.gotoMeasureButton&&!parseInt(a.untilMeasureButton.value)){a.gotoMeasureButton.value=e.currentMeasure}if(a.currentPlayTimeLabel){a.currentPlayTimeLabel.innerHTML=f}a.midiPlayer.setPlayableClefs(a.clefsToPlay)};this.playerCallBackOnEnd=function(f){var h=a.midiPlayer.getWarnings();a.playButton.title=DR.getResource("playBtn");a.playButton.innerHTML='&nbsp;<i class="icon-play"></i>&nbsp;';a.renderedTune.printer.clearSelection();a.accordion.clearKeyboard(true);if(a.currentPlayTimeLabel){a.currentPlayTimeLabel.innerHTML="00:00.00"}if(h){var g=document.getElementById("warningsDiv");var e="";h.forEach(function(i){e+=i+"<br>"});g.style.color="blue";g.innerHTML="<hr>"+e+"<hr>"}};this.midiParser=new ABCXJS.midi.Parse();this.midiPlayer=new ABCXJS.midi.Player(this);this.midiPlayer.defineCallbackOnPlay(this.playerCallBackOnPlay);this.midiPlayer.defineCallbackOnEnd(this.playerCallBackOnEnd);this.midiPlayer.defineCallbackOnScroll(this.playerCallBackOnScroll)}DR.addAgent(this)};SITE.Estudio.prototype.setScrolling=function(c,a){var b=document.getElementById("studioCanvasDiv");if(!b||a>0){return}if(c!==this.ypos){this.ypos=c;b.scrollTop=this.ypos-40}};SITE.Estudio.prototype.translate=function(){this.initEditArea("editorTextArea")};SITE.Estudio.prototype.keyboardCallback=function(a){switch(a){case"MOVE":break;case"MINUS":this.hideMap();break;case"RETWEET":this.accordion.rotateKeyboard(this.keyboardWindow.dataDiv);break;case"ZOOM-IN":this.accordion.scaleKeyboard(this.keyboardWindow.dataDiv);break;case"GLOBE":this.accordion.changeNotation();break;default:alert(a)}};SITE.Estudio.prototype.changePageOrientation=function(a){var b=document.createElement("style");document.head.appendChild(b);b.innerHTML="@page {margin: 1cm; size: "+a+"}"};SITE.Estudio.prototype.printPreview=function(d,e,f){var a=f?"landscape":"portrait";var c=document.body.style.backgroundColor;var b=document.getElementById("printPreviewDiv");e.forEach(function(g){$(g).hide()});$("#printPreviewDiv").show();this.changePageOrientation(a);b.innerHTML=d;document.body.style.paddingTop="0px";document.body.style.backgroundColor="#fff";window.print();document.body.style.backgroundColor=c;document.body.style.paddingTop="50px";$("#printPreviewDiv").hide();e.forEach(function(g){$(g).show()})};SITE.Estudio.prototype.salvaMusica=function(){if(FILEMANAGER.requiredFeaturesAvailable()){this.parseABC(0);var a=this.renderedTune.abc.metaText.title+".abcx";var b=this.editArea.getString();FILEMANAGER.download(a,b)}else{alert(DR.getResource("DR_err_saving"))}};SITE.Estudio.prototype.hideMap=function(){this.mapVisible=false;this.accordion.render_keyboard_opts.show=this.mapVisible;this.keyboardWindow.topDiv.style.display="none";this.accordion.printKeyboard(this.keyboardWindow.dataDiv);document.getElementById("I_showMap").setAttribute("class","icon-folder-close")};SITE.Estudio.prototype.showMap=function(){this.mapVisible=!this.mapVisible;this.accordion.render_keyboard_opts.show=this.mapVisible;if(this.mapVisible){this.keyboardWindow.topDiv.style.display="inline";this.accordion.printKeyboard(this.keyboardWindow.dataDiv);document.getElementById("I_showMap").setAttribute("class","icon-folder-open")}else{this.hideMap()}};SITE.Estudio.prototype.showABCXText=function(){this.textVisible=!this.textVisible;if(this.textVisible){this.editArea.textarea.style.display="inline";document.getElementById("I_showText").setAttribute("class","icon-folder-open")}else{this.editArea.textarea.style.display="none";document.getElementById("I_showText").setAttribute("class","icon-folder-close")}this.resize()};SITE.Estudio.prototype.hideEditor=function(){document.getElementById("I_showEditor").setAttribute("class","icon-folder-close");this.editorWindow.topDiv.style.display="none";this.editorVisible=false;var a=editAreaLoader.getValue("editorTextArea");document.getElementById("textareaABC").readOnly=false;if(this.editArea.getString()!==a){this.editArea.setString(a);this.fireChanged(0,"force")}};SITE.Estudio.prototype.showEditor=function(){this.editorVisible=!this.editorVisible;if(this.editorVisible){document.getElementById("textareaABC").readOnly=true;editAreaLoader.setValue("editorTextArea",this.editArea.getString());editAreaLoader.setSelectionRange("editorTextArea",0,0);this.editorWindow.topDiv.style.display="inline";this.initEditArea("editorTextArea");document.getElementById("I_showEditor").setAttribute("class","icon-folder-open")}else{this.hideEditor()}};SITE.Estudio.prototype.setupEditor=function(){var a=this;var b="selKey";this.editorWindow.dataDiv.innerHTML='<textarea id="editorTextArea" rows="25"></textarea><div style="width: 100%; padding:2px; margin-left:2px;" ><select id="'+b+'" ></select><button id="octaveUpBtn" class="btn" title="+ Oitava" onclick="" ><i class="icon-arrow-up"></i>&nbsp;Oitava</button><button id="octaveDwBtn" class="btn" title="- Oitava" onclick="" ><i class="icon-arrow-down"></i>&nbsp;Oitava</button><button id="forceRefresh2" class="btn" title="Atualizar" onclick="" >Atualizar</button></div>';this.initEditArea("editorTextArea",850,478);
this.keySelector=new SITE.KeySelector(b);this.keySelector.addChangeListener(this);document.getElementById("octaveUpBtn").addEventListener("click",function(){a.editorChanged(12,"force")},false);document.getElementById("octaveDwBtn").addEventListener("click",function(){a.editorChanged(-12,"force")},false);document.getElementById("forceRefresh2").addEventListener("click",function(){a.editorChanged(0,"force")},false);DR.forcedResource("forceRefresh","Atualizar","2","forceRefresh2")};SITE.Estudio.prototype.editorCallback=function(a){switch(a){case"MOVE":break;case"MINUS":this.hideEditor();break;case"ZOOM-IN":case"RETWEET":default:alert(a)}return false};SITE.Estudio.prototype.initEditArea=function(f,a,b){var d={id:f,start_highlight:true,allow_toggle:false,syntax:"abc",toolbar:"search, |, undo, redo, |, highlight , reset_highlight ",allow_resize:"both",is_multi_files:false,show_line_colors:true,replace_tab_by_spaces:4};switch(DR.language){case DR.pt_BR:d.language="pt";break;case DR.en_US:d.language="en";break;case DR.de_DE:d.language="de";break}if(a&&b){d.min_width=a;d.min_height=b}else{var c=document.getElementById("frame_"+f);if(this.editorVisible&&d.language!==this.editorCurrLang&&c){d.min_width=c.clientWidth;d.min_height=c.clientHeight}else{return}}editAreaLoader.init(d);this.editorCurrLang=d.language};SITE.Estudio.prototype.changePlayMode=function(){if(this.currentMode==="normal"){$("#divNormalPlayControls").hide();this.currentMode="learning";this.modeButton.innerHTML='<img src="img/learning5.png" alt="" width="20" height="20">';this.midiPlayer.resetAndamento(this.currentMode);$("#divDidacticPlayControls").fadeIn()}else{$("#divDidacticPlayControls").hide();this.currentMode="normal";this.modeButton.innerHTML='<img src="img/listening3.png" alt="" width="20" height="20">';this.midiPlayer.resetAndamento(this.currentMode);$("#divNormalPlayControls").fadeIn()}};SITE.Estudio.prototype.resize=function(){var c=document.getElementById("textareaABC");var a=document.getElementById("studioMenu");var d=document.getElementById("studioHeader");var e=document.getElementById("studioContentDiv");var b=document.getElementById("studioCanvasDiv");c.style.width=parseInt(a.clientWidth)-24+"px";b.style.height=(e.clientHeight-d.clientHeight-a.clientHeight-10)+"px"};SITE.Estudio.prototype.startPlay=function(b,c,a){if(this.midiPlayer.playing){this.ypos=1000;if(b==="normal"){this.playButton.title=DR.getResource("playBtn");this.playButton.innerHTML='&nbsp;<i class="icon-play"></i>&nbsp;';this.midiPlayer.pausePlay()}else{this.midiPlayer.pausePlay(true)}}else{this.accordion.clearKeyboard();if(b==="normal"){this.midiPlayer.setPlayableClefs("TB");if(this.midiPlayer.startPlay(this.renderedTune.abc.midi)){ga("send","event","Estúdio","play",this.renderedTune.title);this.playButton.title=DR.getResource("DR_pause");this.playButton.innerHTML='&nbsp;<i class="icon-pause"></i>&nbsp;';this.ypos=1000}}else{this.midiPlayer.setPlayableClefs(this.clefsToPlay);ga("send","event","Estúdio","didactic-play",this.renderedTune.title);if(this.midiPlayer.startDidacticPlay(this.renderedTune.abc.midi,b,c,a)){this.ypos=1000}}}};SITE.Estudio.prototype.parseABC=function(c){this.warnings=[];if(typeof c!=="undefined"){if(this.transposer){this.transposer.reset(c)}else{this.transposer=new ABCXJS.parse.Transposer(c)}}var d=new ABCXJS.parse.Parse(this.transposer,this.accordion);d.parse(this.editArea.getString(),this.parserparams);this.renderedTune.abc=d.getTune();this.renderedTune.text=d.getStrTune();this.editArea.setString(this.renderedTune.text);if(this.transposer&&this.keySelector){this.keySelector.set(this.transposer.keyToNumber(this.transposer.getKeyVoice(0)))}var b=d.getWarnings()||[];for(var a=0;a<b.length;a++){this.warnings.push(b[a])}if(this.midiParser){this.midiParser.parse(this.renderedTune.abc,this.accordion.getKeyboard());var b=this.midiParser.getWarnings();for(var a=0;a<b.length;a++){this.warnings.push(b[a])}}return this.renderedTune.abc};SITE.Estudio.prototype.highlight=function(a){if(this.textVisible){this.editArea.setSelection(a.startChar,a.endChar)}if(this.mapVisible&&!this.midiPlayer.playing){this.accordion.clearKeyboard(true);if(a.bellows){this.selectButton(a)}}if(isChrome&&this.editorVisible){editAreaLoader.setSelectionRange("editorTextArea",a.startChar,a.endChar)}};SITE.Estudio.prototype.selectButton=function(b){for(var c=0;c<b.pitches.length;c++){var a;if(b.pitches[c].type==="rest"){continue}if(b.pitches[c].bass){a=this.midiParser.getBassButton(b.bellows,b.pitches[c].c)}else{a=this.midiParser.getButton(b.pitches[c].c)}if(a){if(b.bellows==="-"){a.setOpen()}else{a.setClose()}}}};SITE.Estudio.prototype.onChange=function(){document.getElementById("studioCanvasDiv").scrollTop=this.lastYpos};SITE.Estudio.prototype.editorChanged=function(a,b){this.editorChanging=true;this.editArea.setString(editAreaLoader.getValue("editorTextArea"));this.fireChanged(a,b)};SITE.Estudio.prototype.endEditorChanged=function(){if(!this.editorChanging){return}editAreaLoader.setValue("editorTextArea",this.editArea.getString());editAreaLoader.setSelectionRange("editorTextArea",0,0);this.editorChanging=false};SITE.Estudio.prototype.fireChanged=function(c,d){var b=this;var a=this.startLoader("FC");a.start(function(){b.fireChanged2(c,d,a)},"<br>&nbsp;&nbsp;&nbsp;"+DR.getResource("DR_wait")+"<br><br>")};SITE.Estudio.prototype.fireChanged2=function(b,c,a){if(c||this.oldAbcText!==this.editArea.getString()){this.oldAbcText=this.editArea.getString();this.lastYpos=document.getElementById("studioCanvasDiv").scrollTop||0;if(this.parseABC(b)){this.modelChanged()}}this.endEditorChanged();if(a){a.stop()}};SITE.Estudio.prototype.modelChanged=function(){this.renderedTune.div.innerHTML="";if(this.renderedTune.abc===undefined){return}var a=Raphael(this.renderedTune.div,1100,700);this.renderedTune.printer=new ABCXJS.write.Printer(a,this.printerparams);this.renderedTune.printer.printABC(this.renderedTune.abc);if(this.warningsdiv){this.warningsdiv.style.color=this.warnings.length>0?"red":"green";this.warningsdiv.innerHTML="<hr>"+(this.warnings.length>0?this.warnings.join("<br>"):"No warnings or errors.")+"<hr>"}this.renderedTune.printer.addSelectListener(this);this.updateSelection();if(this.onchangeCallback){this.onchangeCallback(this)}};SITE.Estudio.prototype.setup=function(b,a){this.resize();this.accordion.loadById(a);this.renderedTune.text=b.text;this.renderedTune.title=b.title;this.renderedTune.abc=b.abc;this.editArea.setString(this.renderedTune.text);editAreaLoader.setValue("editorTextArea",this.renderedTune.text);this.editorWindow.setTitle("-&nbsp;"+b.title);this.keyboardWindow.setTitle(this.accordion.getTxtTuning()+" - "+this.accordion.getTxtNumButtons());document.getElementById("spanStudioAccordeon").innerHTML=" - "+this.accordion.getTxtModel();document.getElementById("studioCanvasDiv").scrollTop=0;this.fireChanged2(0,"force")};SITE.Estudio.prototype.updateSelection=function(){try{var b=this.renderedTune.printer.rangeHighlight(this.editArea.textarea.selectionStart,this.editArea.textarea.selectionEnd);
if(this.mapVisible){this.accordion.clearKeyboard(true);for(var a=0;a<b.length;a++){if(b[a].abcelem.bellows){this.selectButton(b[a].abcelem)}}}}catch(c){}};SITE.Estudio.prototype.startLoader=function(d,c,b){var a=new window.widgets.Loader({id:d,bars:0,radius:0,lineWidth:20,lineHeight:70,timeout:1,background:"rgba(0,0,0,0.5)",container:document.body,oncomplete:b,onstart:c});return a};