<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Mapa para Acordeons Diatônicos</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="height=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0" />
        <link rel="stylesheet" href="fontsIco/abcx.css" />
        <link rel="stylesheet" href="fontsIco/abcx-window-font.css" />
        <link rel="stylesheet" href="fontsGoogle/fonts.css" />
        <link rel="stylesheet" href="css/styles4abcx.css" />
        <link rel="stylesheet" href="css/mapa.css" />
        <link rel="stylesheet" href="css/estudio.css" />
        <link rel="icon" type="image/icon" href="images/favicon.ico"/>
  </head>
    <body>
        
        <script type="text/javascript" src="proto_noconflict.js" ></script>
        <script type="text/javascript" src="jquery/jquery-1.11.1.min.js"></script>
        
        <!-- suporte a MIDI -->
        <script type="text/javascript" src="MIDI.js/MIDI.js"></script>
        
        <!-- suporte a arquivos -->
        <script type="text/javascript" src="file/filemanager.js"></script>
        
        <script type="text/javascript" src="ace4abcx/ace4abcx.js"></script>
        
        <!-- suporte a arquivos ABC -->
        <script id="mainABCX" type="text/javascript" src="abcxjs/abcxjs.js" ></script>
        
        <!-- suporte mapas de acordeons -->
        <script type="text/javascript" src="diatonic/diatonic.js"></script>
        
        <script type="text/javascript" src="languages/language.js"></script>
        <script type="text/javascript" src="site/mapa.js"></script>
        <script type="text/javascript" src="site/estudio.js"></script>
        

        <div id="topBar" class="topBar gradiente" >
            <span class="topTitle">
                Mapa para Acordeons Diatônicos
                <i class="ico-cogs topSettings" ></i>
            </span>
            <div class="dropdown-group">
                <div id="menu1Div" class="topMenu"></div>
            </div>
        </div> <!-- topBar -->
        <div id="mainDiv" class="mainDiv">
            <section id="s1" class="tabs">
                <input type="radio" checked="checked" />
                <label id="a_nome_gaita">...</label>
                <div class="btn-group">
                    <button id="buttonChangeNotation" >
                        <i class="ico-globe"></i>&nbsp;<span id="DR_chlabel">Mudar a notação</span>
                    </button>
                </div>
                <div class="tv-content-always">
                    <div id="contentKeyboard" style="position: relative; top: 0; left: 0; padding-right: 130px; padding-bottom: 10px; min-height: 180px; height: auto; width: auto;" ></div>
                    <div id="td_imagem_gaita" style="position: absolute; top: 0; right: 0; margin-right: 15px;"></div>
                    <div id="divABCXversion"  style="position: absolute; bottom: 0; right: 0; margin-right: 5px;">Powered by ABCXJS version 5.0</div>
                </div>
            </section>
            <section id="s2" class="tabs">
                <input id="tab-1" type="radio" name="radio-set" class="tab-selector-1" />
                <label for="tab-1" class="tab-label-1">Acordes</label>

                <input id="tab-2" type="radio" name="radio-set" class="tab-selector-2" />
                <label for="tab-2" class="tab-label-2">Exercícios</label>

                <input id="tab-3" type="radio" name="radio-set" class="tab-selector-3" checked="checked" />
                <label for="tab-3" class="tab-label-3">Músicas</label>

                <div class="btn-group" >
                    <div id="menu2Div" class="topMenu"></div>
                    <button id="buttonTools">
                        <i class="ico-wrench"></i>&nbsp;<span id="DR_tools">Ferramentas</span>
                    </button>
                    <button id="buttonPrinter" >
                        <i class="ico-printer"></i>&nbsp;<span id="DR_print">Imprimir</span>
                    </button>
                    <button id="buttonPlay" ><i class="ico-play"></i></button>
                    <button id="buttonStop" ><i class="ico-stop"></i></button>
                    <span id="currentPlayTimeLabel" class="text" >00:00:01</span>
                </div>

                <div id="tuneContainerDiv" class="tv-content">
                    <div class="tv-content-1">
                        <div id="tabChordsDiv"></div>
                    </div>
                    <div class="tv-content-2" >
                        <div id="tabPracticesDiv" ></div>
                    </div>
                    <div class="tv-content-3">
                        <div id="tabTunesDiv"></div>    
                    </div>    
                </div>
            </section>
        </div> <!-- corpo -->
        
        <script id="mainScript" type="text/javascript">
            
            var myMap;
            var myStudio;

            window.addEventListener( 'load', initApp );
            
            window.onresize = function() {
                if(! myStudio || ! myMap ) return;
                
                if( myStudio.visible) {
                    myStudio.resize();
                } else {     
                    myMap.resize();
                }    
            };
            
            function initApp() {
                
                var m1 = new ABCXJS.edit.DropdownMenu(
                        'menu1Div'
                        , {listener: myMap, method: 'callback'}
                , [{title: 'Acordeons', scroll: false,
                        itens: [
                            'Minuano|GAITA_MINUANO_GC',
                            'Minuano (transportada)|GAITA_MINUANO_BC_TRANSPORTADA',
                            'Hohner Club IIIM (BR)|GAITA_HOHNER_CLUB_IIIM_BR',
                            '------------------------------',
                            'Salvar mapa corrente',
                            'Carregar mapa do disco local'
                        ]},
                    {title: 'Repertório', scroll: false,
                        itens: [
                            'Restaurar o original',
                            'Carregar do drive local',
                            'Exportar para drive local',
                            'Partitura <i class="ico-play"> Tablatura',
                            'Tablatura <i class="ico-play"> Partitura'
                        ]},
                    {title: 'Informações', scroll: false,
                        itens: [
                            'Tutoriais <i class="ico-novo">|TUTORIAL',
                            'Mapas para acordeons|MAPS',
                            'Tablaturas para acordeons|TABS',
                            'Tablaturas para gaita transportada|TABSTRANSPORTADA',
                            'Símbolos de Repetição|JUMPS',
                            'Estúdio ABCX|ESTUDIO',
                            'Formato ABCX|ABCX',
                            'Sobre|ABOUT'
                        ]}
                ]);
                
                var m2 = new ABCXJS.edit.DropdownMenu(
                        'menu2Div'
                        , {listener: this, method: 'callback1'}
                        , [{title: 'Asa Branca', scroll: false,
                        itens: [
                            'Asa Branca',
                            'Começo de Verão',
                            'Numa sala de reboco'
                        ]}
                ]);
                
                DR.initializeTranslator([
                    'DR_appName'
                   ,'DR_about'
                   ,'DR_layout'
                   ,'DR_espelho'
                   ,'DR_horizontal'
                   ,'DR_showText'
                   ,'DR_showEditor'
                   ,'DR_showMap'
                   ,'DR_accordions'
                   ,'DR_repertoire'
                   ,'DR_chlabel'
                   ,'DR_info'
                   ,'DR_message'
                   ,'DR_original'
                   ,'DR_localLoad'
                   ,'DR_localSave'
                   ,'DR_accordion_maps'
                   ,'DR_tablature' 
                   ,'DR_abc_format'
                   ,"DR_repeatsyms" 
                   ,'DR_abc_editor'
                   ,'tabTunes'
                   ,'tabChords'
                   ,'tabPractices'
                   ,'showTextBtn'
                   ,'showEditorBtn'
                   ,'showMapBtn' 
                   ,'modeBtn'
                   ,'timerBtn'
                   ,'playBtn'
                   ,'playBtn2'
                   ,'stopBtn'
                   ,'stopBtn2'
                   ,'tempoBtn'
                   ,'stepBtn'
                   ,'stepMeasureBtn'
                   ,'repeatBtn'
                   ,'clearBtn'
                   ,'gotoMeasureBtn'
                   ,'untilMeasureBtn'
                   ,'toolsBtn'
                   ,'pdfBtn'
                   ,'printBtn'
                   ,'printBtn2'
                   ,'saveBtn'
                   ,'forceRefresh'
                   ,'DR_refresh'
                   ,'spanTitleStudio'
                   ,'dRESTOREButtonA'
                ]);
                
                w1 = new DRAGGABLE.Div(
                          null
                        , null
                        , {title: '', translate: false, statusBar: false, top: 100, left: 300, zIndex: 100}
                );

                //MIDI.widget = new sketch.ui.Timer({size:180, cor1:'#ffffff', cor2:'#ffff88' });
                MIDI.widget = new sketch.ui.Timer({size:180 });
                MIDI.widget.setFormat( 'Carregando...');

                DIATONIC.map.loadAccordionMaps(
                    [
                        'accordions/minuano.gc.accordion'
                       ,'accordions/minuano.bc.transportada.accordion'
                       ,'accordions/hohner.cf.club.br.accordion'
                       // 'accordions/hohner.gc.accordion'
                       //,'accordions/hohner.adg.corona.accordion'
                       //,'accordions/hohner.cf.club.accordion'
                    ]
                    , function () { 
                        FILEMANAGER.waitResources( { 
                            onProgress: function(event) {
                                if(event.success){
                                    MIDI.widget.setValue(0+Math.round(event.perc*.15));
                                    //console.log('\nPercentual: '+ event.perc + '\nTimeouts: ' + event.timeouts + '\n' + event.success );
                                } else {
                                    MIDI.widget.setValue(0+Math.round(event.perc*.15));
                                    //console.log('\nPercentual: '+ event.perc);
                                }
                            }
                            ,onLoad: createMap 
                        });
                    } 
                );
            }
            
            function loadMIDI() {
                
                MIDI.loadPlugin({
                     soundfontUrl: "./soundfont/"
                    ,instruments: "accordion" // default
                    ,onprogress: function(event) {
                        MIDI.widget.setValue(Math.round(MIDI.getPercent(event)*.35)+15);
                    }                            
                    ,onprogress2: function( percent ) {
                        MIDI.widget.setValue(50+Math.round(percent/2));
                    }        
                    ,callback: createMap
                });
            }
            
            function createMap() {
                
                MIDI.widget.setValue(100);

                var accordion = FILEMANAGER.loadLocal( 'property.accordion') || 'GAITA_MINUANO_GC';
                
                accordion = 'GAITA_MINUANO_BC_TRANSPORTADA';
                accordion = 'GAITA_HOHNER_CLUB_IIIM_BR';
                accordion = 'GAITA_MINUANO_GC';

                myStudio = new SITE.Estudio(
                    {   // interfaceParams
                        showMapBtn: 'showMapBtn'
                       ,showEditorBtn: 'showEditorBtn'
                       ,showTextBtn: 'showTextBtn'
                       ,printBtn:'printBtn2'
                       ,saveBtn:'saveBtn'
                       ,forceRefresh:'forceRefresh'
                       
                    },   
                    {   // editorParams
                        textArea: "textareaABC"
                       ,canvas_id: "canvasDiv"
                       ,refreshController_id: "chkAutoRefresh"
                       ,warnings_id: "warningsDiv"
                       ,generate_warnings: true
                       ,generate_midi: true
                       ,generate_tablature: 'accordion'
                       ,editorWindow: null //w1
                       ,keyboardWindow: null //w2
                       ,accordion_options: {
                             id: accordion
                            ,accordionMaps: DIATONIC.map.accordionMaps
                            ,render_keyboard_opts:{transpose:false, mirror:false, scale:0.8, draggable:true, show:false, label:false}}
                       ,onchange: function( studio ) { studio.onChange(); }
                  } 
                  , {   // playerParams
                        modeBtn: "modeBtn"
                      , timerBtn: "timerBtn"
                      , playBtn: "playBtn2"
                      , stopBtn: "stopBtn2"
                      , clearBtn: "clearBtn"
                      , gotoMeasureBtn: "gotoMeasureBtn"
                      , untilMeasureBtn: "untilMeasureBtn"
                      , stepBtn: "stepBtn"
                      , repeatBtn: "repeatBtn"
                      , stepMeasureBtn: "stepMeasureBtn"
                      , tempoBtn: "tempoBtn"
                      , GClefBtn: "GClefBtn"
                      , FClefBtn: "FClefBtn"
                      , currentPlayTimeLabel: "currentPlayTimeLabel2"
                  } 
                );
        
                myMap = new SITE.Mapa(
                    {   // interfaceParams
                        ckPiano: 'checkboxPiano'
                      , ckAccordion: 'checkboxAcordeon'
                      , ckMirror: 'checkboxEspelho'
                      , ckHorizontal: 'checkboxHorizontal'
                      , btChangeNotation: 'buttonChangeNotation'
                      , accordionNamePlaceHolder: 'a_nome_gaita'
                      , accordionImagePlaceHolder: 'td_imagem_gaita'
                      , tuneContainerDiv: 'tuneContainerDiv'
                      , printBtn: 'buttonPrinter'
                      , toolsBtn: 'buttonTools'
                      ,keyboardDiv: "contentKeyboard"
                      ,accordion_options: {
                             id: accordion
                            ,accordionMaps: DIATONIC.map.accordionMaps
                            ,render_keyboard_opts:{transpose:true, mirror:false, scale:1, draggable:false, show:true, label:false}}
                    }
                  , {   // tabParams
                        songSelectorParms: { div: 'divSongs', ul: 'ulSongs', span: 'spanSongs' }
                      , songDiv: 'tabTunesDiv'
                      , chordSelectorParms:  { div: 'divChords', ul: 'ulChords', span: 'spanChords' }
                      , chordDiv: 'tabChordsDiv'
                      , practiceSelectorParms: { div: 'divPractices', ul: 'ulPractices', span: 'spanPractices' }
                      , practiceDiv: 'tabPracticesDiv'
                      , studio: myStudio
                    }
                  , {   // playerParams
                        playBtn: "buttonPlay"
                      , stopBtn: "buttonStop"
                      , currentPlayTimeLabel: "currentPlayTimeLabel"
                    } 
                );

                

//                window.setTimeout( function() {
//                    activateApp();
//                    myMap.defineActiveTab( 'tabTunes' );
//                }, 5 );
            }
            
        </script> <!-- mainScript -->
    </body>
</html>
